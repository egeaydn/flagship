(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,18545,(e,t,a)=>{t.exports=e.r(7284)},65267,e=>{"use strict";e.i(4937);var t=e.i(78361),a=e.i(16015);let r={ORGANIZATIONS:"organizations",ORGANIZATION_MEMBERS:"organization_members",PROJECTS:"projects",ENVIRONMENTS:"environments",FEATURE_FLAGS:"feature_flags",FLAG_VALUES:"flag_values",API_KEYS:"api_keys",AUDIT_LOGS:"audit_logs",FLAG_ANALYTICS:"flag_analytics"};async function s(e){let s=await (0,t.addDoc)((0,t.collection)(a.db,r.ORGANIZATIONS),{...e,createdAt:(0,t.serverTimestamp)(),updatedAt:(0,t.serverTimestamp)()});return await (0,t.setDoc)((0,t.doc)(a.db,r.ORGANIZATION_MEMBERS,`${e.createdBy}_${s.id}`),{organizationId:s.id,userId:e.createdBy,role:"owner",createdAt:(0,t.serverTimestamp)()}),s.id}async function i(e){let s=(0,t.query)((0,t.collection)(a.db,r.ORGANIZATION_MEMBERS),(0,t.where)("userId","==",e)),i=(await (0,t.getDocs)(s)).docs.map(e=>e.data().organizationId);if(0===i.length)return[];let n=(0,t.query)((0,t.collection)(a.db,r.ORGANIZATIONS),(0,t.where)("__name__","in",i));return(await (0,t.getDocs)(n)).docs.map(e=>({id:e.id,...e.data()}))}async function n(e){let s=await (0,t.addDoc)((0,t.collection)(a.db,r.PROJECTS),{...e,createdAt:(0,t.serverTimestamp)(),updatedAt:(0,t.serverTimestamp)()});for(let e of[{name:"Development",key:"dev"},{name:"Staging",key:"staging"},{name:"Production",key:"prod"}])await (0,t.addDoc)((0,t.collection)(a.db,r.ENVIRONMENTS),{projectId:s.id,...e,createdAt:(0,t.serverTimestamp)(),updatedAt:(0,t.serverTimestamp)()});return s.id}async function d(e){let s=await (0,t.addDoc)((0,t.collection)(a.db,r.FEATURE_FLAGS),{...e,tags:e.tags||[],createdAt:(0,t.serverTimestamp)(),updatedAt:(0,t.serverTimestamp)()}),i=(0,t.query)((0,t.collection)(a.db,r.ENVIRONMENTS),(0,t.where)("projectId","==",e.projectId));for(let n of(await (0,t.getDocs)(i)).docs)await (0,t.addDoc)((0,t.collection)(a.db,r.FLAG_VALUES),{flagId:s.id,environmentId:n.id,enabled:!1,value:e.defaultValue,updatedAt:(0,t.serverTimestamp)()});return s}async function l(s){let i=(await e.A(39007)).default,n=Array.from(crypto.getRandomValues(new Uint8Array(16))).map(e=>e.toString(16).padStart(2,"0")).join(""),d=`fsk_${s.keyType}_${n}`,l=await i.hash(d,10),o=d.substring(0,12);return await (0,t.addDoc)((0,t.collection)(a.db,r.API_KEYS),{environmentId:s.environmentId,name:s.name,keyPrefix:o,keyHash:l,keyType:s.keyType,revoked:!1,lastUsedAt:null,createdAt:(0,t.serverTimestamp)(),createdBy:s.createdBy}),d}async function o(e){let s=(0,t.doc)(a.db,r.API_KEYS,e);await (0,t.updateDoc)(s,{revoked:!0,updatedAt:(0,t.serverTimestamp)()})}async function c(e){let s=(0,t.query)((0,t.collection)(a.db,r.API_KEYS),(0,t.where)("environmentId","==",e),(0,t.where)("revoked","==",!1));return(await (0,t.getDocs)(s)).docs.map(e=>({id:e.id,...e.data()}))}async function u(s){let i=await (0,t.addDoc)((0,t.collection)(a.db,r.AUDIT_LOGS),{...s,timestamp:(0,t.serverTimestamp)(),createdAt:(0,t.serverTimestamp)()});if(s.projectId&&s.action){let{triggerWebhooks:t}=await e.A(49847),a={FLAG_CREATED:"flag.created",FLAG_UPDATED:"flag.updated",FLAG_DELETED:"flag.deleted",FLAG_TOGGLED:"flag.toggled",TARGETING_RULES_UPDATED:"targeting.updated"}[s.action];a&&t(s.projectId,a,{flagKey:s.metadata?.flagKey||s.resourceName,flagName:s.resourceName,action:s.action,actor:s.userEmail||"Unknown",changes:s.changes,before:s.changes?.before,after:s.changes?.after}).catch(e=>console.error("Webhook trigger error:",e))}return i}async function g(e,s=100){let i=(0,t.query)((0,t.collection)(a.db,r.AUDIT_LOGS),(0,t.where)("organizationId","==",e));return(await (0,t.getDocs)(i)).docs.map(e=>({id:e.id,...e.data()})).sort((e,t)=>{let a=e.timestamp?.toMillis()||e.createdAt?.toMillis()||0;return(t.timestamp?.toMillis()||t.createdAt?.toMillis()||0)-a}).slice(0,s)}async function m(e,s,i=7){let n=(0,t.query)((0,t.collection)(a.db,r.FLAG_ANALYTICS),(0,t.where)("projectId","==",e),(0,t.where)("environmentId","==",s)),d=(await (0,t.getDocs)(n)).docs.map(e=>({id:e.id,...e.data()})),l=Date.now()-24*i*36e5;return d.filter(e=>(e.timestamp?.toMillis()||e.createdAt?.toMillis()||0)>=l)}async function p(e,t,a=7){let r=await m(e,t,a),s={};return r.forEach(e=>{let t=e.flagKey;s[t]||(s[t]={flagKey:t,flagId:e.flagId,evaluations:0,uniqueUsers:new Set,trueCount:0,falseCount:0,targetingAppliedCount:0}),s[t].evaluations++,e.userId&&s[t].uniqueUsers.add(e.userId),!0===e.result&&s[t].trueCount++,!1===e.result&&s[t].falseCount++,e.targetingApplied&&s[t].targetingAppliedCount++}),Object.values(s).map(e=>({...e,uniqueUsers:e.uniqueUsers.size}))}e.s(["COLLECTIONS",0,r,"createApiKey",()=>l,"createAuditLog",()=>u,"createFeatureFlag",()=>d,"createOrganization",()=>s,"createProject",()=>n,"getAggregatedAnalytics",()=>p,"getAuditLogs",()=>g,"getEnvironmentApiKeys",()=>c,"getUserOrganizations",()=>i,"revokeApiKey",()=>o])},53029,e=>{"use strict";var t=e.i(85434),a=e.i(78027),r=e.i(18545);e.i(13893);var s=e.i(34708),i=e.i(16015),n=e.i(65267);function d(){let e=(0,r.useParams)(),[d,l]=(0,a.useState)(null),[o,c]=(0,a.useState)([]),[u,g]=(0,a.useState)(!0),[m,p]=(0,a.useState)("all"),[h,x]=(0,a.useState)("");async function f(){try{g(!0);let t=e.slug,a=await (0,n.getAuditLogs)(t);c(a)}catch(e){console.error("Error loading audit logs:",e)}finally{g(!1)}}(0,a.useEffect)(()=>{document.title="Audit Logs | Flagship"},[]),(0,a.useEffect)(()=>{let e=(0,s.onAuthStateChanged)(i.auth,e=>{l(e)});return()=>e()},[]),(0,a.useEffect)(()=>{d&&f()},[d]);let y=o.filter(e=>("all"===m||!!e.action.toLowerCase().includes(m.toLowerCase()))&&(!h||!!e.resourceName?.toLowerCase().includes(h.toLowerCase())||!!e.userEmail?.toLowerCase().includes(h.toLowerCase())));return u?(0,t.jsx)("div",{className:"min-h-screen bg-gray-50 p-8",children:(0,t.jsx)("div",{className:"max-w-7xl mx-auto",children:(0,t.jsx)("p",{className:"text-gray-500",children:"Loading audit logs..."})})}):(0,t.jsx)("div",{className:"min-h-screen bg-gray-50 p-8",children:(0,t.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"ðŸ“‹ Audit Logs"}),(0,t.jsx)("p",{className:"text-gray-600 mt-2",children:"Track all changes and activities in your organization"})]}),(0,t.jsx)("div",{className:"bg-white rounded-lg shadow p-4 mb-6",children:(0,t.jsxs)("div",{className:"flex gap-4 flex-wrap",children:[(0,t.jsx)("div",{className:"flex-1 min-w-[200px]",children:(0,t.jsx)("input",{type:"text",placeholder:"Search by resource or user...",value:h,onChange:e=>x(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})}),(0,t.jsxs)("select",{value:m,onChange:e=>p(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500",children:[(0,t.jsx)("option",{value:"all",children:"All Actions"}),(0,t.jsx)("option",{value:"created",children:"Created"}),(0,t.jsx)("option",{value:"updated",children:"Updated"}),(0,t.jsx)("option",{value:"deleted",children:"Deleted"}),(0,t.jsx)("option",{value:"enabled",children:"Enabled"}),(0,t.jsx)("option",{value:"disabled",children:"Disabled"}),(0,t.jsx)("option",{value:"targeting",children:"Targeting Rules"})]})]})}),0===y.length?(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow p-8 text-center",children:[(0,t.jsx)("p",{className:"text-gray-500",children:"No audit logs found"}),(0,t.jsx)("p",{className:"text-sm text-gray-400 mt-2",children:"Activities will appear here as you make changes"})]}):(0,t.jsx)("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:(0,t.jsx)("div",{className:"divide-y divide-gray-200",children:y.map(e=>{var a,r;return(0,t.jsx)("div",{className:"p-6 hover:bg-gray-50 transition-colors",children:(0,t.jsx)("div",{className:"flex items-start justify-between",children:(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,t.jsx)("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${(a=e.action).includes("CREATED")?"bg-green-100 text-green-700":a.includes("DELETED")?"bg-red-100 text-red-700":a.includes("UPDATED")||a.includes("ENABLED")||a.includes("DISABLED")?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"}`,children:e.action.replace(/_/g," ").toLowerCase().split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")}),(0,t.jsxs)("span",{className:"text-gray-600 text-sm",children:["on ",(0,t.jsx)("span",{className:"font-medium text-gray-900",children:e.resourceName||e.resourceId})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[(0,t.jsxs)("span",{children:["ðŸ‘¤ ",(0,t.jsx)("span",{className:"font-medium",children:e.userEmail||"Unknown"})]}),(0,t.jsxs)("span",{children:["ðŸ•’ ",(r=e.timestamp||e.createdAt)?(r.toDate?r.toDate():new Date(r)).toLocaleString("tr-TR",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A"]}),(0,t.jsx)("span",{className:"px-2 py-1 bg-gray-100 rounded text-xs",children:e.resourceType})]}),e.changes&&(0,t.jsx)("div",{className:"mt-4 bg-gray-50 rounded-lg p-4 border border-gray-200",children:(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[void 0!==e.changes.before&&(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"text-xs font-semibold text-gray-700 mb-2",children:"BEFORE"}),(0,t.jsx)("pre",{className:"text-xs bg-white p-3 rounded border border-gray-200 overflow-auto max-h-32",children:JSON.stringify(e.changes.before,null,2)})]}),void 0!==e.changes.after&&(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"text-xs font-semibold text-gray-700 mb-2",children:"AFTER"}),(0,t.jsx)("pre",{className:"text-xs bg-white p-3 rounded border border-gray-200 overflow-auto max-h-32",children:JSON.stringify(e.changes.after,null,2)})]})]})})]})})},e.id)})})}),(0,t.jsx)("div",{className:"mt-6 bg-white rounded-lg shadow p-4",children:(0,t.jsxs)("div",{className:"text-sm text-gray-600",children:["Showing ",(0,t.jsx)("span",{className:"font-medium text-gray-900",children:y.length})," of"," ",(0,t.jsx)("span",{className:"font-medium text-gray-900",children:o.length})," audit logs"]})})]})})}e.s(["default",()=>d])},39007,e=>{e.v(t=>Promise.all(["static/chunks/6b0a6e6e30d1308a.js"].map(t=>e.l(t))).then(()=>t(85123)))},49847,e=>{e.v(t=>Promise.all(["static/chunks/0f624e89cf31ab38.js"].map(t=>e.l(t))).then(()=>t(28750)))}]);