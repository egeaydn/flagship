(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,28750,e=>{"use strict";var t=e.i(16015);e.i(4937);var a=e.i(78361);function r(e,t){switch(e.provider){case"slack":return function(e){let{event:t,data:a,timestamp:r}=e,s=n(t),o=function(e){switch(e){case"flag.created":return"good";case"flag.updated":return"warning";case"flag.deleted":return"danger";case"flag.toggled":return"#36a64f";case"targeting.updated":return"#439FE0";default:return"#808080"}}(t);return{text:`${s} Feature Flag Event: ${t}`,attachments:[{color:o,fields:[{title:"Event",value:t,short:!0},{title:"Flag",value:a.flagKey||"N/A",short:!0},{title:"Action",value:a.action,short:!0},{title:"Actor",value:a.actor||"System",short:!0},...a.changes?[{title:"Changes",value:`\`\`\`${JSON.stringify(a.changes,null,2)}\`\`\``,short:!1}]:[]],footer:"Flagship Feature Flags",ts:new Date(r).getTime()/1e3}]}}(t);case"discord":return function(e){let{event:t,data:a,timestamp:r}=e,s=n(t),o=function(e){switch(e){case"flag.created":return 3581519;case"flag.updated":return 0xff9800;case"flag.deleted":return 0xf44336;case"flag.toggled":return 2201331;case"targeting.updated":return 0x9c27b0;default:return 8421504}}(t);return{content:`${s} **Feature Flag Event:** ${t}`,embeds:[{color:o,fields:[{name:"Event",value:t,inline:!0},{name:"Flag",value:a.flagKey||"N/A",inline:!0},{name:"Action",value:a.action,inline:!0},{name:"Actor",value:a.actor||"System",inline:!0},...a.changes?[{name:"Changes",value:`\`\`\`json
${JSON.stringify(a.changes,null,2)}
\`\`\``,inline:!1}]:[]],footer:{text:"Flagship Feature Flags"},timestamp:r}]}}(t);default:return t}}function n(e){switch(e){case"flag.created":return"ðŸŽ‰";case"flag.updated":return"âœï¸";case"flag.deleted":return"ðŸ—‘ï¸";case"flag.toggled":return"ðŸ”„";case"targeting.updated":return"ðŸŽ¯";default:return"ðŸ“¢"}}async function s(e,t){if(!e.enabled)return{success:!1,error:"Webhook is disabled"};try{let a=r(e,t),n={"Content-Type":"application/json","User-Agent":"Flagship-Webhooks/1.0",...e.headers||{}};if(e.secret){let t=await o(JSON.stringify(a),e.secret);n["X-Flagship-Signature"]=t}let s=await fetch(e.url,{method:"POST",headers:n,body:JSON.stringify(a),signal:AbortSignal.timeout(1e4)}),l=s.ok,c=s.status;return await i({webhookId:e.id,event:t.event,payload:t,status:l?"success":"failed",statusCode:c,response:l?await s.text():void 0,error:l?void 0:`HTTP ${c}: ${s.statusText}`,attemptCount:1}),{success:l,statusCode:c}}catch(a){return await i({webhookId:e.id,event:t.event,payload:t,status:"failed",error:a.message,attemptCount:1}),{success:!1,error:a.message}}}async function o(e,t){let a=new TextEncoder,r=a.encode(e),n=a.encode(t),s=await crypto.subtle.importKey("raw",n,{name:"HMAC",hash:"SHA-256"},!1,["sign"]);return Array.from(new Uint8Array(await crypto.subtle.sign("HMAC",s,r))).map(e=>e.toString(16).padStart(2,"0")).join("")}async function i(e){try{await (0,a.addDoc)((0,a.collection)(t.db,"webhook_deliveries"),{...e,createdAt:(0,a.serverTimestamp)(),deliveredAt:"success"===e.status?(0,a.serverTimestamp)():null})}catch(e){console.error("Failed to log webhook delivery:",e)}}async function l(a,r,n){let{collection:o,query:i,where:l,getDocs:c}=await e.A(57696);try{let e=i(o(t.db,"webhooks"),l("projectId","==",a),l("enabled","==",!0),l("events","array-contains",r)),u=await c(e);if(u.empty)return;let d={event:r,timestamp:new Date().toISOString(),projectId:a,data:n},g=u.docs.map(e=>{let t={id:e.id,...e.data()};return s(t,d)});await Promise.allSettled(g)}catch(e){console.error("Failed to trigger webhooks:",e)}}e.s(["formatWebhookPayload",()=>r,"sendWebhook",()=>s,"triggerWebhooks",()=>l])},57696,e=>{e.v(t=>Promise.all(["static/chunks/516d75a9a8878607.js"].map(t=>e.l(t))).then(()=>t(65827)))}]);