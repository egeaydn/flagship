module.exports=[33278,(e,t,r)=>{"use strict";var n,i,s;Object.defineProperty(r,"__esModule",{value:!0}),r.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=r.DEFAULT_MAX_SEND_MESSAGE_LENGTH=r.Propagate=r.LogVerbosity=r.Status=void 0,function(e){e[e.OK=0]="OK",e[e.CANCELLED=1]="CANCELLED",e[e.UNKNOWN=2]="UNKNOWN",e[e.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",e[e.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",e[e.NOT_FOUND=5]="NOT_FOUND",e[e.ALREADY_EXISTS=6]="ALREADY_EXISTS",e[e.PERMISSION_DENIED=7]="PERMISSION_DENIED",e[e.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",e[e.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",e[e.ABORTED=10]="ABORTED",e[e.OUT_OF_RANGE=11]="OUT_OF_RANGE",e[e.UNIMPLEMENTED=12]="UNIMPLEMENTED",e[e.INTERNAL=13]="INTERNAL",e[e.UNAVAILABLE=14]="UNAVAILABLE",e[e.DATA_LOSS=15]="DATA_LOSS",e[e.UNAUTHENTICATED=16]="UNAUTHENTICATED"}(n||(r.Status=n={})),function(e){e[e.DEBUG=0]="DEBUG",e[e.INFO=1]="INFO",e[e.ERROR=2]="ERROR",e[e.NONE=3]="NONE"}(i||(r.LogVerbosity=i={})),function(e){e[e.DEADLINE=1]="DEADLINE",e[e.CENSUS_STATS_CONTEXT=2]="CENSUS_STATS_CONTEXT",e[e.CENSUS_TRACING_CONTEXT=4]="CENSUS_TRACING_CONTEXT",e[e.CANCELLATION=8]="CANCELLATION",e[e.DEFAULTS=65535]="DEFAULTS"}(s||(r.Propagate=s={})),r.DEFAULT_MAX_SEND_MESSAGE_LENGTH=-1,r.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=4194304},82702,(e,t,r)=>{"use strict";var n,i,s,a;Object.defineProperty(r,"__esModule",{value:!0}),r.isTracerEnabled=r.trace=r.log=r.setLoggerVerbosity=r.setLogger=r.getLogger=void 0;let o=e.r(33278),l=e.r(5365),u=e.r(53347).version,c={error:(e,...t)=>{console.error("E "+e,...t)},info:(e,...t)=>{console.error("I "+e,...t)},debug:(e,...t)=>{console.error("D "+e,...t)}},h=o.LogVerbosity.ERROR;switch((null!=(i=null!=(n=process.env.GRPC_NODE_VERBOSITY)?n:process.env.GRPC_VERBOSITY)?i:"").toUpperCase()){case"DEBUG":h=o.LogVerbosity.DEBUG;break;case"INFO":h=o.LogVerbosity.INFO;break;case"ERROR":h=o.LogVerbosity.ERROR;break;case"NONE":h=o.LogVerbosity.NONE}r.getLogger=()=>c,r.setLogger=e=>{c=e},r.setLoggerVerbosity=e=>{h=e},r.log=(e,...t)=>{let r;if(e>=h){switch(e){case o.LogVerbosity.DEBUG:r=c.debug;break;case o.LogVerbosity.INFO:r=c.info;break;case o.LogVerbosity.ERROR:r=c.error}r||(r=c.error),r&&r.bind(c)(...t)}};let d=null!=(a=null!=(s=process.env.GRPC_NODE_TRACE)?s:process.env.GRPC_TRACE)?a:"",f=new Set,p=new Set;for(let e of d.split(","))e.startsWith("-")?p.add(e.substring(1)):f.add(e);let m=f.has("all");function g(e,t,n){y(t)&&(0,r.log)(e,new Date().toISOString()+" | v"+u+" "+l.pid+" | "+t+" | "+n)}function y(e){return!p.has(e)&&(m||f.has(e))}r.trace=g,r.isTracerEnabled=y},14325,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getErrorCode=r.getErrorMessage=void 0,r.getErrorMessage=function(e){return e instanceof Error?e.message:String(e)},r.getErrorCode=function(e){return"object"==typeof e&&null!==e&&"code"in e&&"number"==typeof e.code?e.code:null}},64346,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Metadata=void 0;let n=e.r(82702),i=e.r(33278),s=e.r(14325),a=/^[0-9a-z_.-]+$/,o=/^[ -~]*$/;function l(e){return a.test(e)}function u(e){return o.test(e)}function c(e){return e.endsWith("-bin")}function h(e){return!e.startsWith("grpc-")}function d(e){return e.toLowerCase()}function f(e,t){if(!l(e))throw Error('Metadata key "'+e+'" contains illegal characters');if(null!=t)if(c(e)){if(!Buffer.isBuffer(t))throw Error("keys that end with '-bin' must have Buffer values")}else{if(Buffer.isBuffer(t))throw Error("keys that don't end with '-bin' must have String values");if(!u(t))throw Error('Metadata string value "'+t+'" contains illegal characters')}}class p{constructor(e={}){this.internalRepr=new Map,this.options=e}set(e,t){f(e=d(e),t),this.internalRepr.set(e,[t])}add(e,t){f(e=d(e),t);let r=this.internalRepr.get(e);void 0===r?this.internalRepr.set(e,[t]):r.push(t)}remove(e){e=d(e),this.internalRepr.delete(e)}get(e){return e=d(e),this.internalRepr.get(e)||[]}getMap(){let e={};for(let[t,r]of this.internalRepr)if(r.length>0){let n=r[0];e[t]=Buffer.isBuffer(n)?Buffer.from(n):n}return e}clone(){let e=new p(this.options),t=e.internalRepr;for(let[e,r]of this.internalRepr){let n=r.map(e=>Buffer.isBuffer(e)?Buffer.from(e):e);t.set(e,n)}return e}merge(e){for(let[t,r]of e.internalRepr){let e=(this.internalRepr.get(t)||[]).concat(r);this.internalRepr.set(t,e)}}setOptions(e){this.options=e}getOptions(){return this.options}toHttp2Headers(){let e={};for(let[t,r]of this.internalRepr)e[t]=r.map(m);return e}toJSON(){let e={};for(let[t,r]of this.internalRepr)e[t]=r;return e}static fromHttp2Headers(e){let t=new p;for(let r of Object.keys(e)){if(":"===r.charAt(0))continue;let a=e[r];try{c(r)?Array.isArray(a)?a.forEach(e=>{t.add(r,Buffer.from(e,"base64"))}):void 0!==a&&(h(r)?a.split(",").forEach(e=>{t.add(r,Buffer.from(e.trim(),"base64"))}):t.add(r,Buffer.from(a,"base64"))):Array.isArray(a)?a.forEach(e=>{t.add(r,e)}):void 0!==a&&t.add(r,a)}catch(t){let e=`Failed to add metadata entry ${r}: ${a}. ${(0,s.getErrorMessage)(t)}. For more information see https://github.com/grpc/grpc-node/issues/1173`;(0,n.log)(i.LogVerbosity.ERROR,e)}}return t}}r.Metadata=p;let m=e=>Buffer.isBuffer(e)?e.toString("base64"):e},68151,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.CallCredentials=void 0;let n=e.r(64346);function i(e){return"getRequestHeaders"in e&&"function"==typeof e.getRequestHeaders}class s{static createFromMetadataGenerator(e){return new o(e)}static createFromGoogleCredential(e){return s.createFromMetadataGenerator((t,r)=>{let s;(s=i(e)?e.getRequestHeaders(t.service_url):new Promise((r,n)=>{e.getRequestMetadata(t.service_url,(e,t)=>{e?n(e):t?r(t):n(Error("Headers not set by metadata plugin"))})})).then(e=>{let t=new n.Metadata;for(let r of Object.keys(e))t.add(r,e[r]);r(null,t)},e=>{r(e)})})}static createEmpty(){return new l}}r.CallCredentials=s;class a extends s{constructor(e){super(),this.creds=e}async generateMetadata(e){let t=new n.Metadata;for(let r of(await Promise.all(this.creds.map(t=>t.generateMetadata(e)))))t.merge(r);return t}compose(e){return new a(this.creds.concat([e]))}_equals(e){return this===e||e instanceof a&&this.creds.every((t,r)=>t._equals(e.creds[r]))}}class o extends s{constructor(e){super(),this.metadataGenerator=e}generateMetadata(e){return new Promise((t,r)=>{this.metadataGenerator(e,(e,n)=>{void 0!==n?t(n):r(e)})})}compose(e){return new a([this,e])}_equals(e){return this===e||e instanceof o&&this.metadataGenerator===e.metadataGenerator}}class l extends s{generateMetadata(e){return Promise.resolve(new n.Metadata)}compose(e){return e}_equals(e){return e instanceof l}}},23522,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getDefaultRootsData=r.CIPHER_SUITES=void 0;let n=e.r(22734);r.CIPHER_SUITES=process.env.GRPC_SSL_CIPHER_SUITES;let i=process.env.GRPC_DEFAULT_SSL_ROOTS_FILE_PATH,s=null;r.getDefaultRootsData=function(){return i?(null===s&&(s=n.readFileSync(i)),s):null}},91698,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ChannelCredentials=void 0;let n=e.r(55004),i=e.r(68151),s=e.r(23522);function a(e,t){if(e&&!(e instanceof Buffer))throw TypeError(`${t}, if provided, must be a Buffer.`)}class o{constructor(e){this.callCredentials=e||i.CallCredentials.createEmpty()}_getCallCredentials(){return this.callCredentials}static createSsl(e,t,r,i){var o;if(a(e,"Root certificate"),a(t,"Private key"),a(r,"Certificate chain"),t&&!r)throw Error("Private key must be given with accompanying certificate chain");if(!t&&r)throw Error("Certificate chain must be given with accompanying private key");return new u((0,n.createSecureContext)({ca:null!=(o=null!=e?e:(0,s.getDefaultRootsData)())?o:void 0,key:null!=t?t:void 0,cert:null!=r?r:void 0,ciphers:s.CIPHER_SUITES}),null!=i?i:{})}static createFromSecureContext(e,t){return new u(e,null!=t?t:{})}static createInsecure(){return new l}}r.ChannelCredentials=o;class l extends o{constructor(e){super(e)}compose(e){throw Error("Cannot compose insecure credentials")}_getConnectionOptions(){return null}_isSecure(){return!1}_equals(e){return e instanceof l}}class u extends o{constructor(e,t){super(),this.secureContext=e,this.verifyOptions=t,this.connectionOptions={secureContext:e},(null==t?void 0:t.checkServerIdentity)&&(this.connectionOptions.checkServerIdentity=t.checkServerIdentity)}compose(e){return new c(this,this.callCredentials.compose(e))}_getConnectionOptions(){return Object.assign({},this.connectionOptions)}_isSecure(){return!0}_equals(e){return this===e||e instanceof u&&this.secureContext===e.secureContext&&this.verifyOptions.checkServerIdentity===e.verifyOptions.checkServerIdentity}}class c extends o{constructor(e,t){super(t),this.channelCredentials=e}compose(e){let t=this.callCredentials.compose(e);return new c(this.channelCredentials,t)}_getConnectionOptions(){return this.channelCredentials._getConnectionOptions()}_isSecure(){return!0}_equals(e){return this===e||e instanceof c&&this.channelCredentials._equals(e.channelCredentials)&&this.callCredentials._equals(e.callCredentials)}}},1291,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.validateLoadBalancingConfig=r.getFirstUsableConfig=r.isLoadBalancerNameRegistered=r.createLoadBalancer=r.registerDefaultLoadBalancerType=r.registerLoadBalancerType=r.createChildChannelControlHelper=void 0,r.createChildChannelControlHelper=function(e,t){var r,n,i,s,a,o,l,u,c,h;return{createSubchannel:null!=(n=null==(r=t.createSubchannel)?void 0:r.bind(t))?n:e.createSubchannel.bind(e),updateState:null!=(s=null==(i=t.updateState)?void 0:i.bind(t))?s:e.updateState.bind(e),requestReresolution:null!=(o=null==(a=t.requestReresolution)?void 0:a.bind(t))?o:e.requestReresolution.bind(e),addChannelzChild:null!=(u=null==(l=t.addChannelzChild)?void 0:l.bind(t))?u:e.addChannelzChild.bind(e),removeChannelzChild:null!=(h=null==(c=t.removeChannelzChild)?void 0:c.bind(t))?h:e.removeChannelzChild.bind(e)}};let n={},i=null;r.registerLoadBalancerType=function(e,t,r){n[e]={LoadBalancer:t,LoadBalancingConfig:r}},r.registerDefaultLoadBalancerType=function(e){i=e},r.createLoadBalancer=function(e,t){let r=e.getLoadBalancerName();return r in n?new n[r].LoadBalancer(t):null},r.isLoadBalancerNameRegistered=function(e){return e in n},r.getFirstUsableConfig=function(e,t=!1){for(let t of e)if(t.getLoadBalancerName()in n)return t;return t&&i?new n[i].LoadBalancingConfig:null},r.validateLoadBalancingConfig=function(e){if(null===e||"object"!=typeof e)throw Error("Load balancing config must be an object");let t=Object.keys(e);if(1!==t.length)throw Error("Provided load balancing config has multiple conflicting entries");let r=t[0];if(r in n)return n[r].LoadBalancingConfig.createFromJson(e[r]);throw Error(`Unrecognized load balancing config name ${r}`)}},4924,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.extractAndSelectServiceConfig=r.validateServiceConfig=r.validateRetryThrottling=void 0;let n=e.r(46786),i=e.r(33278),s=e.r(1291),a=/^\d+(\.\d{1,9})?s$/,o="node";function l(e){if("service"in e&&""!==e.service){if("string"!=typeof e.service)throw Error(`Invalid method config name: invalid service: expected type string, got ${typeof e.service}`);if(!("method"in e)||""===e.method)return{service:e.service};if("string"!=typeof e.method)throw Error(`Invalid method config name: invalid method: expected type string, got ${typeof e.service}`);return{service:e.service,method:e.method}}if("method"in e&&void 0!==e.method)throw Error("Invalid method config name: method set with empty or unset service");return{}}function u(e){if(!("maxAttempts"in e)||!Number.isInteger(e.maxAttempts)||e.maxAttempts<2)throw Error("Invalid method config retry policy: maxAttempts must be an integer at least 2");if(!("initialBackoff"in e)||"string"!=typeof e.initialBackoff||!a.test(e.initialBackoff))throw Error("Invalid method config retry policy: initialBackoff must be a string consisting of a positive integer followed by s");if(!("maxBackoff"in e)||"string"!=typeof e.maxBackoff||!a.test(e.maxBackoff))throw Error("Invalid method config retry policy: maxBackoff must be a string consisting of a positive integer followed by s");if(!("backoffMultiplier"in e)||"number"!=typeof e.backoffMultiplier||e.backoffMultiplier<=0)throw Error("Invalid method config retry policy: backoffMultiplier must be a number greater than 0");if(!("retryableStatusCodes"in e&&Array.isArray(e.retryableStatusCodes)))throw Error("Invalid method config retry policy: retryableStatusCodes is required");if(0===e.retryableStatusCodes.length)throw Error("Invalid method config retry policy: retryableStatusCodes must be non-empty");for(let t of e.retryableStatusCodes)if("number"==typeof t){if(!Object.values(i.Status).includes(t))throw Error("Invalid method config retry policy: retryableStatusCodes value not in status code range")}else if("string"==typeof t){if(!Object.values(i.Status).includes(t.toUpperCase()))throw Error("Invalid method config retry policy: retryableStatusCodes value not a status code name")}else throw Error("Invalid method config retry policy: retryableStatusCodes value must be a string or number");return{maxAttempts:e.maxAttempts,initialBackoff:e.initialBackoff,maxBackoff:e.maxBackoff,backoffMultiplier:e.backoffMultiplier,retryableStatusCodes:e.retryableStatusCodes}}function c(e){if(!("maxAttempts"in e)||!Number.isInteger(e.maxAttempts)||e.maxAttempts<2)throw Error("Invalid method config hedging policy: maxAttempts must be an integer at least 2");if("hedgingDelay"in e&&("string"!=typeof e.hedgingDelay||!a.test(e.hedgingDelay)))throw Error("Invalid method config hedging policy: hedgingDelay must be a string consisting of a positive integer followed by s");if("nonFatalStatusCodes"in e&&Array.isArray(e.nonFatalStatusCodes))for(let t of e.nonFatalStatusCodes)if("number"==typeof t){if(!Object.values(i.Status).includes(t))throw Error("Invlid method config hedging policy: nonFatalStatusCodes value not in status code range")}else if("string"==typeof t){if(!Object.values(i.Status).includes(t.toUpperCase()))throw Error("Invlid method config hedging policy: nonFatalStatusCodes value not a status code name")}else throw Error("Invlid method config hedging policy: nonFatalStatusCodes value must be a string or number");let t={maxAttempts:e.maxAttempts};return e.hedgingDelay&&(t.hedgingDelay=e.hedgingDelay),e.nonFatalStatusCodes&&(t.nonFatalStatusCodes=e.nonFatalStatusCodes),t}function h(e){var t;let r={name:[]};if(!("name"in e)||!Array.isArray(e.name))throw Error("Invalid method config: invalid name array");for(let t of e.name)r.name.push(l(t));if("waitForReady"in e){if("boolean"!=typeof e.waitForReady)throw Error("Invalid method config: invalid waitForReady");r.waitForReady=e.waitForReady}if("timeout"in e)if("object"==typeof e.timeout){if(!("seconds"in e.timeout)||"number"!=typeof e.timeout.seconds)throw Error("Invalid method config: invalid timeout.seconds");if(!("nanos"in e.timeout)||"number"!=typeof e.timeout.nanos)throw Error("Invalid method config: invalid timeout.nanos");r.timeout=e.timeout}else if("string"==typeof e.timeout&&a.test(e.timeout)){let n=e.timeout.substring(0,e.timeout.length-1).split(".");r.timeout={seconds:0|n[0],nanos:(null!=(t=n[1])?t:0)|0}}else throw Error("Invalid method config: invalid timeout");if("maxRequestBytes"in e){if("number"!=typeof e.maxRequestBytes)throw Error("Invalid method config: invalid maxRequestBytes");r.maxRequestBytes=e.maxRequestBytes}if("maxResponseBytes"in e){if("number"!=typeof e.maxResponseBytes)throw Error("Invalid method config: invalid maxRequestBytes");r.maxResponseBytes=e.maxResponseBytes}if("retryPolicy"in e)if("hedgingPolicy"in e)throw Error("Invalid method config: retryPolicy and hedgingPolicy cannot both be specified");else r.retryPolicy=u(e.retryPolicy);else"hedgingPolicy"in e&&(r.hedgingPolicy=c(e.hedgingPolicy));return r}function d(e){if(!("maxTokens"in e)||"number"!=typeof e.maxTokens||e.maxTokens<=0||e.maxTokens>1e3)throw Error("Invalid retryThrottling: maxTokens must be a number in (0, 1000]");if(!("tokenRatio"in e)||"number"!=typeof e.tokenRatio||e.tokenRatio<=0)throw Error("Invalid retryThrottling: tokenRatio must be a number greater than 0");return{maxTokens:+e.maxTokens.toFixed(3),tokenRatio:+e.tokenRatio.toFixed(3)}}function f(e){let t={loadBalancingConfig:[],methodConfig:[]};if("loadBalancingPolicy"in e)if("string"==typeof e.loadBalancingPolicy)t.loadBalancingPolicy=e.loadBalancingPolicy;else throw Error("Invalid service config: invalid loadBalancingPolicy");if("loadBalancingConfig"in e)if(Array.isArray(e.loadBalancingConfig))for(let r of e.loadBalancingConfig)t.loadBalancingConfig.push((0,s.validateLoadBalancingConfig)(r));else throw Error("Invalid service config: invalid loadBalancingConfig");if("methodConfig"in e&&Array.isArray(e.methodConfig))for(let r of e.methodConfig)t.methodConfig.push(h(r));"retryThrottling"in e&&(t.retryThrottling=d(e.retryThrottling));let r=[];for(let e of t.methodConfig)for(let t of e.name){for(let e of r)if(t.service===e.service&&t.method===e.method)throw Error(`Invalid service config: duplicate name ${t.service}/${t.method}`);r.push(t)}return t}function p(e){if(!("serviceConfig"in e))throw Error("Invalid service config choice: missing service config");let t={serviceConfig:f(e.serviceConfig)};if("clientLanguage"in e)if(Array.isArray(e.clientLanguage))for(let r of(t.clientLanguage=[],e.clientLanguage))if("string"==typeof r)t.clientLanguage.push(r);else throw Error("Invalid service config choice: invalid clientLanguage");else throw Error("Invalid service config choice: invalid clientLanguage");if("clientHostname"in e)if(Array.isArray(e.clientHostname))for(let r of(t.clientHostname=[],e.clientHostname))if("string"==typeof r)t.clientHostname.push(r);else throw Error("Invalid service config choice: invalid clientHostname");else throw Error("Invalid service config choice: invalid clientHostname");if("percentage"in e)if("number"==typeof e.percentage&&0<=e.percentage&&e.percentage<=100)t.percentage=e.percentage;else throw Error("Invalid service config choice: invalid percentage");let r=["clientLanguage","percentage","clientHostname","serviceConfig"];for(let t in e)if(!r.includes(t))throw Error(`Invalid service config choice: unexpected field ${t}`);return t}function m(e,t){if(!Array.isArray(e))throw Error("Invalid service config list");for(let r of e){let e=p(r);if("number"!=typeof e.percentage||!(t>e.percentage)){if(Array.isArray(e.clientHostname)){let t=!1;for(let r of e.clientHostname)r===n.hostname()&&(t=!0);if(!t)continue}if(Array.isArray(e.clientLanguage)){let t=!1;for(let r of e.clientLanguage)r===o&&(t=!0);if(!t)continue}return e.serviceConfig}}throw Error("No matching service config found")}r.validateRetryThrottling=d,r.validateServiceConfig=f,r.extractAndSelectServiceConfig=function(e,t){for(let r of e)if(r.length>0&&r[0].startsWith("grpc_config="))return m(JSON.parse(r.join("").substring(12)),t);return null}},7541,(e,t,r)=>{"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0}),r.ConnectivityState=void 0,function(e){e[e.IDLE=0]="IDLE",e[e.CONNECTING=1]="CONNECTING",e[e.READY=2]="READY",e[e.TRANSIENT_FAILURE=3]="TRANSIENT_FAILURE",e[e.SHUTDOWN=4]="SHUTDOWN"}(n||(r.ConnectivityState=n={}))},84848,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.uriToString=r.splitHostPort=r.parseUri=void 0;let n=/^(?:([A-Za-z0-9+.-]+):)?(?:\/\/([^/]*)\/)?(.+)$/;r.parseUri=function(e){let t=n.exec(e);return null===t?null:{scheme:t[1],authority:t[2],path:t[3]}};let i=/^\d+$/;r.splitHostPort=function(e){if(e.startsWith("[")){let t=e.indexOf("]");if(-1===t)return null;let r=e.substring(1,t);if(-1===r.indexOf(":"))return null;if(!(e.length>t+1))return{host:r};if(":"!==e[t+1])return null;{let n=e.substring(t+2);return i.test(n)?{host:r,port:+n}:null}}{let t=e.split(":");return 2!==t.length?{host:e}:i.test(t[1])?{host:t[0],port:+t[1]}:null}},r.uriToString=function(e){let t="";return void 0!==e.scheme&&(t+=e.scheme+":"),void 0!==e.authority&&(t+="//"+e.authority+"/"),t+=e.path}},14507,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.mapUriDefaultScheme=r.getDefaultAuthority=r.createResolver=r.registerDefaultScheme=r.registerResolver=void 0;let n=e.r(84848),i={},s=null;r.registerResolver=function(e,t){i[e]=t},r.registerDefaultScheme=function(e){s=e},r.createResolver=function(e,t,r){if(void 0!==e.scheme&&e.scheme in i)return new i[e.scheme](e,t,r);throw Error(`No resolver could be created for target ${(0,n.uriToString)(e)}`)},r.getDefaultAuthority=function(e){if(void 0!==e.scheme&&e.scheme in i)return i[e.scheme].getDefaultAuthority(e);throw Error(`Invalid target ${(0,n.uriToString)(e)}`)},r.mapUriDefaultScheme=function(e){if(void 0===e.scheme||!(e.scheme in i))if(null!==s)return{scheme:s,authority:void 0,path:(0,n.uriToString)(e)};else return null;return e}},90551,(e,t,r)=>{"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0}),r.QueuePicker=r.UnavailablePicker=r.PickResultType=void 0;let i=e.r(64346),s=e.r(33278);!function(e){e[e.COMPLETE=0]="COMPLETE",e[e.QUEUE=1]="QUEUE",e[e.TRANSIENT_FAILURE=2]="TRANSIENT_FAILURE",e[e.DROP=3]="DROP"}(n||(r.PickResultType=n={}));class a{constructor(e){this.status=Object.assign({code:s.Status.UNAVAILABLE,details:"No connection established",metadata:new i.Metadata},e)}pick(e){return{pickResultType:n.TRANSIENT_FAILURE,subchannel:null,status:this.status,onCallStarted:null,onCallEnded:null}}}r.UnavailablePicker=a;class o{constructor(e){this.loadBalancer=e,this.calledExitIdle=!1}pick(e){return this.calledExitIdle||(process.nextTick(()=>{this.loadBalancer.exitIdle()}),this.calledExitIdle=!0),{pickResultType:n.QUEUE,subchannel:null,status:null,onCallStarted:null,onCallEnded:null}}}r.QueuePicker=o},70016,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.BackoffTimeout=void 0;let n=1e3,i=1.6,s=12e4,a=.2;function o(e,t){return Math.random()*(t-e)+e}class l{constructor(e,t){this.callback=e,this.initialDelay=n,this.multiplier=i,this.maxDelay=s,this.jitter=a,this.running=!1,this.hasRef=!0,this.startTime=new Date,this.endTime=new Date,t&&(t.initialDelay&&(this.initialDelay=t.initialDelay),t.multiplier&&(this.multiplier=t.multiplier),t.jitter&&(this.jitter=t.jitter),t.maxDelay&&(this.maxDelay=t.maxDelay)),this.nextDelay=this.initialDelay,this.timerId=setTimeout(()=>{},0),clearTimeout(this.timerId)}runTimer(e){var t,r;this.endTime=this.startTime,this.endTime.setMilliseconds(this.endTime.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),this.timerId=setTimeout(()=>{this.callback(),this.running=!1},e),this.hasRef||null==(r=(t=this.timerId).unref)||r.call(t)}runOnce(){this.running=!0,this.startTime=new Date,this.runTimer(this.nextDelay);let e=Math.min(this.nextDelay*this.multiplier,this.maxDelay),t=e*this.jitter;this.nextDelay=e+o(-t,t)}stop(){clearTimeout(this.timerId),this.running=!1}reset(){if(this.nextDelay=this.initialDelay,this.running){let e=new Date,t=this.startTime;t.setMilliseconds(t.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),e<t?this.runTimer(t.getTime()-e.getTime()):this.running=!1}}isRunning(){return this.running}ref(){var e,t;this.hasRef=!0,null==(t=(e=this.timerId).ref)||t.call(e)}unref(){var e,t;this.hasRef=!1,null==(t=(e=this.timerId).unref)||t.call(e)}getEndTime(){return this.endTime}}r.BackoffTimeout=l},64947,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ChildLoadBalancerHandler=void 0;let n=e.r(1291),i=e.r(7541),s="child_load_balancer_helper";class a{constructor(e){this.channelControlHelper=e,this.currentChild=null,this.pendingChild=null,this.latestConfig=null,this.ChildPolicyHelper=class{constructor(e){this.parent=e,this.child=null}createSubchannel(e,t){return this.parent.channelControlHelper.createSubchannel(e,t)}updateState(e,t){var r;if(this.calledByPendingChild()){if(e===i.ConnectivityState.CONNECTING)return;null==(r=this.parent.currentChild)||r.destroy(),this.parent.currentChild=this.parent.pendingChild,this.parent.pendingChild=null}else if(!this.calledByCurrentChild())return;this.parent.channelControlHelper.updateState(e,t)}requestReresolution(){var e;let t=null!=(e=this.parent.pendingChild)?e:this.parent.currentChild;this.child===t&&this.parent.channelControlHelper.requestReresolution()}setChild(e){this.child=e}addChannelzChild(e){this.parent.channelControlHelper.addChannelzChild(e)}removeChannelzChild(e){this.parent.channelControlHelper.removeChannelzChild(e)}calledByPendingChild(){return this.child===this.parent.pendingChild}calledByCurrentChild(){return this.child===this.parent.currentChild}}}configUpdateRequiresNewPolicyInstance(e,t){return e.getLoadBalancerName()!==t.getLoadBalancerName()}updateAddressList(e,t,r){let i;if(null===this.currentChild||null===this.latestConfig||this.configUpdateRequiresNewPolicyInstance(this.latestConfig,t)){let e=new this.ChildPolicyHelper(this),r=(0,n.createLoadBalancer)(t,e);e.setChild(r),null===this.currentChild?(this.currentChild=r,i=this.currentChild):(this.pendingChild&&this.pendingChild.destroy(),this.pendingChild=r,i=this.pendingChild)}else i=null===this.pendingChild?this.currentChild:this.pendingChild;this.latestConfig=t,i.updateAddressList(e,t,r)}exitIdle(){this.currentChild&&(this.currentChild.exitIdle(),this.pendingChild&&this.pendingChild.exitIdle())}resetBackoff(){this.currentChild&&(this.currentChild.resetBackoff(),this.pendingChild&&this.pendingChild.resetBackoff())}destroy(){this.currentChild&&(this.currentChild.destroy(),this.currentChild=null),this.pendingChild&&(this.pendingChild.destroy(),this.pendingChild=null)}getTypeName(){return s}}r.ChildLoadBalancerHandler=a},14905,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ResolvingLoadBalancer=void 0;let n=e.r(1291),i=e.r(4924),s=e.r(7541),a=e.r(14507),o=e.r(90551),l=e.r(70016),u=e.r(33278),c=e.r(64346),h=e.r(82702),d=e.r(33278),f=e.r(84848),p=e.r(64947),m="resolving_load_balancer";function g(e){h.trace(d.LogVerbosity.DEBUG,m,e)}let y=["SERVICE_AND_METHOD","SERVICE","EMPTY"];function v(e,t,r,n){for(let i of r.name)switch(n){case"EMPTY":if(!i.service&&!i.method)return!0;break;case"SERVICE":if(i.service===e&&!i.method)return!0;break;case"SERVICE_AND_METHOD":if(i.service===e&&i.method===t)return!0}return!1}function b(e,t,r,n){for(let i of r)if(v(e,t,i,n))return i;return null}function S(e){return function(t,r){var n,i;let s=t.split("/").filter(e=>e.length>0),a=null!=(n=s[0])?n:"",o=null!=(i=s[1])?i:"";if(e&&e.methodConfig)for(let t of y){let r=b(a,o,e.methodConfig,t);if(r)return{methodConfig:r,pickInformation:{},status:u.Status.OK,dynamicFilterFactories:[]}}return{methodConfig:{name:[]},pickInformation:{},status:u.Status.OK,dynamicFilterFactories:[]}}}class w{constructor(e,t,r,h,d){this.target=e,this.channelControlHelper=t,this.onSuccessfulResolution=h,this.onFailedResolution=d,this.latestChildState=s.ConnectivityState.IDLE,this.latestChildPicker=new o.QueuePicker(this),this.currentState=s.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1,r["grpc.service_config"]?this.defaultServiceConfig=(0,i.validateServiceConfig)(JSON.parse(r["grpc.service_config"])):this.defaultServiceConfig={loadBalancingConfig:[],methodConfig:[]},this.updateState(s.ConnectivityState.IDLE,new o.QueuePicker(this)),this.childLoadBalancer=new p.ChildLoadBalancerHandler({createSubchannel:t.createSubchannel.bind(t),requestReresolution:()=>{this.backoffTimeout.isRunning()?(g("requestReresolution delayed by backoff timer until "+this.backoffTimeout.getEndTime().toISOString()),this.continueResolving=!0):this.updateResolution()},updateState:(e,t)=>{this.latestChildState=e,this.latestChildPicker=t,this.updateState(e,t)},addChannelzChild:t.addChannelzChild.bind(t),removeChannelzChild:t.removeChannelzChild.bind(t)}),this.innerResolver=(0,a.createResolver)(e,{onSuccessfulResolution:(e,t,r,i,s)=>{var a;this.backoffTimeout.stop(),this.backoffTimeout.reset();let o=null;null===t?null===r?(this.previousServiceConfig=null,o=this.defaultServiceConfig):null===this.previousServiceConfig?this.handleResolutionFailure(r):o=this.previousServiceConfig:(o=t,this.previousServiceConfig=t);let l=null!=(a=null==o?void 0:o.loadBalancingConfig)?a:[],h=(0,n.getFirstUsableConfig)(l,!0);if(null===h)return void this.handleResolutionFailure({code:u.Status.UNAVAILABLE,details:"All load balancer options in service config are not compatible",metadata:new c.Metadata});this.childLoadBalancer.updateAddressList(e,h,s);let d=null!=o?o:this.defaultServiceConfig;this.onSuccessfulResolution(d,null!=i?i:S(d))},onError:e=>{this.handleResolutionFailure(e)}},r);const f={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new l.BackoffTimeout(()=>{this.continueResolving?(this.updateResolution(),this.continueResolving=!1):this.updateState(this.latestChildState,this.latestChildPicker)},f),this.backoffTimeout.unref()}updateResolution(){this.innerResolver.updateResolution(),this.currentState===s.ConnectivityState.IDLE&&this.updateState(s.ConnectivityState.CONNECTING,new o.QueuePicker(this)),this.backoffTimeout.runOnce()}updateState(e,t){g((0,f.uriToString)(this.target)+" "+s.ConnectivityState[this.currentState]+" -> "+s.ConnectivityState[e]),e===s.ConnectivityState.IDLE&&(t=new o.QueuePicker(this)),this.currentState=e,this.channelControlHelper.updateState(e,t)}handleResolutionFailure(e){this.latestChildState===s.ConnectivityState.IDLE&&(this.updateState(s.ConnectivityState.TRANSIENT_FAILURE,new o.UnavailablePicker(e)),this.onFailedResolution(e))}exitIdle(){(this.currentState===s.ConnectivityState.IDLE||this.currentState===s.ConnectivityState.TRANSIENT_FAILURE)&&(this.backoffTimeout.isRunning()?this.continueResolving=!0:this.updateResolution()),this.childLoadBalancer.exitIdle()}updateAddressList(e,t){throw Error("updateAddressList not supported on ResolvingLoadBalancer")}resetBackoff(){this.backoffTimeout.reset(),this.childLoadBalancer.resetBackoff()}destroy(){this.childLoadBalancer.destroy(),this.innerResolver.destroy(),this.backoffTimeout.reset(),this.backoffTimeout.stop(),this.latestChildState=s.ConnectivityState.IDLE,this.latestChildPicker=new o.QueuePicker(this),this.currentState=s.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1}getTypeName(){return"resolving_load_balancer"}}r.ResolvingLoadBalancer=w},3112,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.channelOptionsEqual=r.recognizedOptions=void 0,r.recognizedOptions={"grpc.ssl_target_name_override":!0,"grpc.primary_user_agent":!0,"grpc.secondary_user_agent":!0,"grpc.default_authority":!0,"grpc.keepalive_time_ms":!0,"grpc.keepalive_timeout_ms":!0,"grpc.keepalive_permit_without_calls":!0,"grpc.service_config":!0,"grpc.max_concurrent_streams":!0,"grpc.initial_reconnect_backoff_ms":!0,"grpc.max_reconnect_backoff_ms":!0,"grpc.use_local_subchannel_pool":!0,"grpc.max_send_message_length":!0,"grpc.max_receive_message_length":!0,"grpc.enable_http_proxy":!0,"grpc.enable_channelz":!0,"grpc.dns_min_time_between_resolutions_ms":!0,"grpc.enable_retries":!0,"grpc.per_rpc_retry_buffer_size":!0,"grpc.retry_buffer_size":!0,"grpc.max_connection_age_ms":!0,"grpc.max_connection_age_grace_ms":!0,"grpc-node.max_session_memory":!0,"grpc.service_config_disable_resolution":!0,"grpc.client_idle_timeout_ms":!0,"grpc-node.tls_enable_trace":!0},r.channelOptionsEqual=function(e,t){let r=Object.keys(e).sort(),n=Object.keys(t).sort();if(r.length!==n.length)return!1;for(let i=0;i<r.length;i+=1)if(r[i]!==n[i]||e[r[i]]!==t[n[i]])return!1;return!0}},76005,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.stringToSubchannelAddress=r.subchannelAddressToString=r.subchannelAddressEqual=r.isTcpSubchannelAddress=void 0;let n=e.r(4446);function i(e){return"port"in e}r.isTcpSubchannelAddress=i,r.subchannelAddressEqual=function(e,t){return!e&&!t||!!e&&!!t&&(i(e)?i(t)&&e.host===t.host&&e.port===t.port:!i(t)&&e.path===t.path)},r.subchannelAddressToString=function(e){return i(e)?e.host+":"+e.port:e.path};let s=443;r.stringToSubchannelAddress=function(e,t){return(0,n.isIP)(e)?{host:e,port:null!=t?t:s}:{path:e}}},78560,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.addAdminServicesToServer=r.registerAdminService=void 0;let n=[];r.registerAdminService=function(e,t){n.push({getServiceDefinition:e,getHandlers:t})},r.addAdminServicesToServer=function(e){for(let{getServiceDefinition:t,getHandlers:r}of n)e.addService(t(),r())}},96041,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ClientDuplexStreamImpl=r.ClientWritableStreamImpl=r.ClientReadableStreamImpl=r.ClientUnaryCallImpl=r.callErrorFromStatus=void 0;let n=e.r(27699),i=e.r(88947),s=e.r(33278);r.callErrorFromStatus=function(e,t){let r=`${e.code} ${s.Status[e.code]}: ${e.details}`,n=Error(r),i=`${n.stack}
for call at
${t}`;return Object.assign(Error(r),e,{stack:i})};class a extends n.EventEmitter{constructor(){super()}cancel(){var e;null==(e=this.call)||e.cancelWithStatus(s.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return null!=(t=null==(e=this.call)?void 0:e.getPeer())?t:"unknown"}}r.ClientUnaryCallImpl=a;class o extends i.Readable{constructor(e){super({objectMode:!0}),this.deserialize=e}cancel(){var e;null==(e=this.call)||e.cancelWithStatus(s.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return null!=(t=null==(e=this.call)?void 0:e.getPeer())?t:"unknown"}_read(e){var t;null==(t=this.call)||t.startRead()}}r.ClientReadableStreamImpl=o;class l extends i.Writable{constructor(e){super({objectMode:!0}),this.serialize=e}cancel(){var e;null==(e=this.call)||e.cancelWithStatus(s.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return null!=(t=null==(e=this.call)?void 0:e.getPeer())?t:"unknown"}_write(e,t,r){var n;let i={callback:r},s=Number(t);Number.isNaN(s)||(i.flags=s),null==(n=this.call)||n.sendMessageWithContext(i,e)}_final(e){var t;null==(t=this.call)||t.halfClose(),e()}}r.ClientWritableStreamImpl=l;class u extends i.Duplex{constructor(e,t){super({objectMode:!0}),this.serialize=e,this.deserialize=t}cancel(){var e;null==(e=this.call)||e.cancelWithStatus(s.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return null!=(t=null==(e=this.call)?void 0:e.getPeer())?t:"unknown"}_read(e){var t;null==(t=this.call)||t.startRead()}_write(e,t,r){var n;let i={callback:r},s=Number(t);Number.isNaN(s)||(i.flags=s),null==(n=this.call)||n.sendMessageWithContext(i,e)}_final(e){var t;null==(t=this.call)||t.halfClose(),e()}}r.ClientDuplexStreamImpl=u},92472,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.InterceptingListenerImpl=r.isInterceptingListener=void 0,r.isInterceptingListener=function(e){return void 0!==e.onReceiveMetadata&&1===e.onReceiveMetadata.length};class n{constructor(e,t){this.listener=e,this.nextListener=t,this.processingMetadata=!1,this.hasPendingMessage=!1,this.processingMessage=!1,this.pendingStatus=null}processPendingMessage(){this.hasPendingMessage&&(this.nextListener.onReceiveMessage(this.pendingMessage),this.pendingMessage=null,this.hasPendingMessage=!1)}processPendingStatus(){this.pendingStatus&&this.nextListener.onReceiveStatus(this.pendingStatus)}onReceiveMetadata(e){this.processingMetadata=!0,this.listener.onReceiveMetadata(e,e=>{this.processingMetadata=!1,this.nextListener.onReceiveMetadata(e),this.processPendingMessage(),this.processPendingStatus()})}onReceiveMessage(e){this.processingMessage=!0,this.listener.onReceiveMessage(e,e=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessage=e,this.hasPendingMessage=!0):(this.nextListener.onReceiveMessage(e),this.processPendingStatus())})}onReceiveStatus(e){this.listener.onReceiveStatus(e,e=>{this.processingMetadata||this.processingMessage?this.pendingStatus=e:this.nextListener.onReceiveStatus(e)})}}r.InterceptingListenerImpl=n},88831,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getInterceptingCall=r.InterceptingCall=r.RequesterBuilder=r.ListenerBuilder=r.InterceptorConfigurationError=void 0;let n=e.r(64346),i=e.r(92472),s=e.r(33278),a=e.r(14325);class o extends Error{constructor(e){super(e),this.name="InterceptorConfigurationError",Error.captureStackTrace(this,o)}}r.InterceptorConfigurationError=o;class l{constructor(){this.metadata=void 0,this.message=void 0,this.status=void 0}withOnReceiveMetadata(e){return this.metadata=e,this}withOnReceiveMessage(e){return this.message=e,this}withOnReceiveStatus(e){return this.status=e,this}build(){return{onReceiveMetadata:this.metadata,onReceiveMessage:this.message,onReceiveStatus:this.status}}}r.ListenerBuilder=l;class u{constructor(){this.start=void 0,this.message=void 0,this.halfClose=void 0,this.cancel=void 0}withStart(e){return this.start=e,this}withSendMessage(e){return this.message=e,this}withHalfClose(e){return this.halfClose=e,this}withCancel(e){return this.cancel=e,this}build(){return{start:this.start,sendMessage:this.message,halfClose:this.halfClose,cancel:this.cancel}}}r.RequesterBuilder=u;let c=(e,t)=>{t(e)},h=(e,t)=>{t(e)},d=(e,t)=>{t(e)},f={start:(e,t,r)=>{r(e,t)},sendMessage:(e,t)=>{t(e)},halfClose:e=>{e()},cancel:e=>{e()}};class p{constructor(e,t){var r,n,i,s;this.nextCall=e,this.processingMetadata=!1,this.pendingMessageContext=null,this.processingMessage=!1,this.pendingHalfClose=!1,t?this.requester={start:null!=(r=t.start)?r:f.start,sendMessage:null!=(n=t.sendMessage)?n:f.sendMessage,halfClose:null!=(i=t.halfClose)?i:f.halfClose,cancel:null!=(s=t.cancel)?s:f.cancel}:this.requester=f}cancelWithStatus(e,t){this.requester.cancel(()=>{this.nextCall.cancelWithStatus(e,t)})}getPeer(){return this.nextCall.getPeer()}processPendingMessage(){this.pendingMessageContext&&(this.nextCall.sendMessageWithContext(this.pendingMessageContext,this.pendingMessage),this.pendingMessageContext=null,this.pendingMessage=null)}processPendingHalfClose(){this.pendingHalfClose&&this.nextCall.halfClose()}start(e,t){var r,n,s,a,o,l;let u={onReceiveMetadata:null!=(n=null==(r=null==t?void 0:t.onReceiveMetadata)?void 0:r.bind(t))?n:e=>{},onReceiveMessage:null!=(a=null==(s=null==t?void 0:t.onReceiveMessage)?void 0:s.bind(t))?a:e=>{},onReceiveStatus:null!=(l=null==(o=null==t?void 0:t.onReceiveStatus)?void 0:o.bind(t))?l:e=>{}};this.processingMetadata=!0,this.requester.start(e,u,(e,t)=>{var r,n,s;let a;if(this.processingMetadata=!1,(0,i.isInterceptingListener)(t))a=t;else{let e={onReceiveMetadata:null!=(r=t.onReceiveMetadata)?r:c,onReceiveMessage:null!=(n=t.onReceiveMessage)?n:h,onReceiveStatus:null!=(s=t.onReceiveStatus)?s:d};a=new i.InterceptingListenerImpl(e,u)}this.nextCall.start(e,a),this.processPendingMessage(),this.processPendingHalfClose()})}sendMessageWithContext(e,t){this.processingMessage=!0,this.requester.sendMessage(t,r=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessageContext=e,this.pendingMessage=t):(this.nextCall.sendMessageWithContext(e,r),this.processPendingHalfClose())})}sendMessage(e){this.sendMessageWithContext({},e)}startRead(){this.nextCall.startRead()}halfClose(){this.requester.halfClose(()=>{this.processingMetadata||this.processingMessage?this.pendingHalfClose=!0:this.nextCall.halfClose()})}}function m(e,t,r){var n,i;let s=null!=(n=r.deadline)?n:1/0,a=r.host,o=null!=(i=r.parent)?i:null,l=r.propagate_flags,u=r.credentials,c=e.createCall(t,s,a,o,l);return u&&c.setCredentials(u),c}r.InterceptingCall=p;class g{constructor(e,t){this.call=e,this.methodDefinition=t}cancelWithStatus(e,t){this.call.cancelWithStatus(e,t)}getPeer(){return this.call.getPeer()}sendMessageWithContext(e,t){let r;try{r=this.methodDefinition.requestSerialize(t)}catch(e){this.call.cancelWithStatus(s.Status.INTERNAL,`Request message serialization failure: ${(0,a.getErrorMessage)(e)}`);return}this.call.sendMessageWithContext(e,r)}sendMessage(e){this.sendMessageWithContext({},e)}start(e,t){let r=null;this.call.start(e,{onReceiveMetadata:e=>{var r;null==(r=null==t?void 0:t.onReceiveMetadata)||r.call(t,e)},onReceiveMessage:e=>{var i;let o;try{o=this.methodDefinition.responseDeserialize(e)}catch(e){r={code:s.Status.INTERNAL,details:`Response message parsing error: ${(0,a.getErrorMessage)(e)}`,metadata:new n.Metadata},this.call.cancelWithStatus(r.code,r.details);return}null==(i=null==t?void 0:t.onReceiveMessage)||i.call(t,o)},onReceiveStatus:e=>{var n,i;r?null==(n=null==t?void 0:t.onReceiveStatus)||n.call(t,r):null==(i=null==t?void 0:t.onReceiveStatus)||i.call(t,e)}})}startRead(){this.call.startRead()}halfClose(){this.call.halfClose()}}class y extends g{constructor(e,t){super(e,t)}start(e,t){var r,n;let i=!1,s={onReceiveMetadata:null!=(n=null==(r=null==t?void 0:t.onReceiveMetadata)?void 0:r.bind(t))?n:e=>{},onReceiveMessage:e=>{var r;i=!0,null==(r=null==t?void 0:t.onReceiveMessage)||r.call(t,e)},onReceiveStatus:e=>{var r,n;i||null==(r=null==t?void 0:t.onReceiveMessage)||r.call(t,null),null==(n=null==t?void 0:t.onReceiveStatus)||n.call(t,e)}};super.start(e,s),this.call.startRead()}}class v extends g{}function b(e,t,r){let n=m(e,r.path,t);return r.responseStream?new v(n,r):new y(n,r)}r.getInterceptingCall=function(e,t,r,n){if(e.clientInterceptors.length>0&&e.clientInterceptorProviders.length>0)throw new o("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(e.callInterceptors.length>0&&e.callInterceptorProviders.length>0)throw new o("Both interceptors and interceptor_providers were passed as call options. Only one of these is allowed.");let i=[];i=e.callInterceptors.length>0||e.callInterceptorProviders.length>0?[].concat(e.callInterceptors,e.callInterceptorProviders.map(e=>e(t))).filter(e=>e):[].concat(e.clientInterceptors,e.clientInterceptorProviders.map(e=>e(t))).filter(e=>e);let s=Object.assign({},r,{method_definition:t});return i.reduceRight((e,t)=>r=>t(r,e),e=>b(n,e,t))(s)}},18656,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Client=void 0;let n=e.r(96041),i=e.r(79675),s=e.r(7541),a=e.r(33278),o=e.r(64346),l=e.r(88831),u=Symbol(),c=Symbol(),h=Symbol(),d=Symbol();function f(e){return"function"==typeof e}function p(e){return e.stack.split("\n").slice(1).join("\n")}class m{constructor(e,t,r={}){var n,s;if(r=Object.assign({},r),this[c]=null!=(n=r.interceptors)?n:[],delete r.interceptors,this[h]=null!=(s=r.interceptor_providers)?s:[],delete r.interceptor_providers,this[c].length>0&&this[h].length>0)throw Error("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(this[d]=r.callInvocationTransformer,delete r.callInvocationTransformer,r.channelOverride)this[u]=r.channelOverride;else if(r.channelFactoryOverride){const n=r.channelFactoryOverride;delete r.channelFactoryOverride,this[u]=n(e,t,r)}else this[u]=new i.ChannelImplementation(e,t,r)}close(){this[u].close()}getChannel(){return this[u]}waitForReady(e,t){let r=n=>{let i;if(n)return void t(Error("Failed to connect before the deadline"));try{i=this[u].getConnectivityState(!0)}catch(e){t(Error("The channel has been closed"));return}if(i===s.ConnectivityState.READY)t();else try{this[u].watchConnectivityState(i,e,r)}catch(e){t(Error("The channel has been closed"))}};setImmediate(r)}checkOptionalUnaryResponseArguments(e,t,r){if(f(e))return{metadata:new o.Metadata,options:{},callback:e};if(f(t))if(e instanceof o.Metadata)return{metadata:e,options:{},callback:t};else return{metadata:new o.Metadata,options:e,callback:t};if(!(e instanceof o.Metadata&&t instanceof Object&&f(r)))throw Error("Incorrect arguments passed");return{metadata:e,options:t,callback:r}}makeUnaryRequest(e,t,r,i,s,o,f){var m,g;let y=this.checkOptionalUnaryResponseArguments(s,o,f),v={path:e,requestStream:!1,responseStream:!1,requestSerialize:t,responseDeserialize:r},b={argument:i,metadata:y.metadata,call:new n.ClientUnaryCallImpl,channel:this[u],methodDefinition:v,callOptions:y.options,callback:y.callback};this[d]&&(b=this[d](b));let S=b.call,w={clientInterceptors:this[c],clientInterceptorProviders:this[h],callInterceptors:null!=(m=b.callOptions.interceptors)?m:[],callInterceptorProviders:null!=(g=b.callOptions.interceptor_providers)?g:[]},C=(0,l.getInterceptingCall)(w,b.methodDefinition,b.callOptions,b.channel);S.call=C;let T=null,E=!1,_=Error();return C.start(b.metadata,{onReceiveMetadata:e=>{S.emit("metadata",e)},onReceiveMessage(e){null!==T&&C.cancelWithStatus(a.Status.INTERNAL,"Too many responses received"),T=e},onReceiveStatus(e){if(!E){if(E=!0,e.code===a.Status.OK)if(null===T){let t=p(_);b.callback((0,n.callErrorFromStatus)({code:a.Status.INTERNAL,details:"No message received",metadata:e.metadata},t))}else b.callback(null,T);else{let t=p(_);b.callback((0,n.callErrorFromStatus)(e,t))}_=null,S.emit("status",e)}}}),C.sendMessage(i),C.halfClose(),S}makeClientStreamRequest(e,t,r,i,s,o){var f,m;let g=this.checkOptionalUnaryResponseArguments(i,s,o),y={path:e,requestStream:!0,responseStream:!1,requestSerialize:t,responseDeserialize:r},v={metadata:g.metadata,call:new n.ClientWritableStreamImpl(t),channel:this[u],methodDefinition:y,callOptions:g.options,callback:g.callback};this[d]&&(v=this[d](v));let b=v.call,S={clientInterceptors:this[c],clientInterceptorProviders:this[h],callInterceptors:null!=(f=v.callOptions.interceptors)?f:[],callInterceptorProviders:null!=(m=v.callOptions.interceptor_providers)?m:[]},w=(0,l.getInterceptingCall)(S,v.methodDefinition,v.callOptions,v.channel);b.call=w;let C=null,T=!1,E=Error();return w.start(v.metadata,{onReceiveMetadata:e=>{b.emit("metadata",e)},onReceiveMessage(e){null!==C&&w.cancelWithStatus(a.Status.INTERNAL,"Too many responses received"),C=e},onReceiveStatus(e){if(!T){if(T=!0,e.code===a.Status.OK)if(null===C){let t=p(E);v.callback((0,n.callErrorFromStatus)({code:a.Status.INTERNAL,details:"No message received",metadata:e.metadata},t))}else v.callback(null,C);else{let t=p(E);v.callback((0,n.callErrorFromStatus)(e,t))}E=null,b.emit("status",e)}}}),b}checkMetadataAndOptions(e,t){let r,n;return e instanceof o.Metadata?(r=e,n=t||{}):(n=e||{},r=new o.Metadata),{metadata:r,options:n}}makeServerStreamRequest(e,t,r,i,s,o){var f,m;let g=this.checkMetadataAndOptions(s,o),y={path:e,requestStream:!1,responseStream:!0,requestSerialize:t,responseDeserialize:r},v={argument:i,metadata:g.metadata,call:new n.ClientReadableStreamImpl(r),channel:this[u],methodDefinition:y,callOptions:g.options};this[d]&&(v=this[d](v));let b=v.call,S={clientInterceptors:this[c],clientInterceptorProviders:this[h],callInterceptors:null!=(f=v.callOptions.interceptors)?f:[],callInterceptorProviders:null!=(m=v.callOptions.interceptor_providers)?m:[]},w=(0,l.getInterceptingCall)(S,v.methodDefinition,v.callOptions,v.channel);b.call=w;let C=!1,T=Error();return w.start(v.metadata,{onReceiveMetadata(e){b.emit("metadata",e)},onReceiveMessage(e){b.push(e)},onReceiveStatus(e){if(!C){if(C=!0,b.push(null),e.code!==a.Status.OK){let t=p(T);b.emit("error",(0,n.callErrorFromStatus)(e,t))}T=null,b.emit("status",e)}}}),w.sendMessage(i),w.halfClose(),b}makeBidiStreamRequest(e,t,r,i,s){var o,f;let m=this.checkMetadataAndOptions(i,s),g={path:e,requestStream:!0,responseStream:!0,requestSerialize:t,responseDeserialize:r},y={metadata:m.metadata,call:new n.ClientDuplexStreamImpl(t,r),channel:this[u],methodDefinition:g,callOptions:m.options};this[d]&&(y=this[d](y));let v=y.call,b={clientInterceptors:this[c],clientInterceptorProviders:this[h],callInterceptors:null!=(o=y.callOptions.interceptors)?o:[],callInterceptorProviders:null!=(f=y.callOptions.interceptor_providers)?f:[]},S=(0,l.getInterceptingCall)(b,y.methodDefinition,y.callOptions,y.channel);v.call=S;let w=!1,C=Error();return S.start(y.metadata,{onReceiveMetadata(e){v.emit("metadata",e)},onReceiveMessage(e){v.push(e)},onReceiveStatus(e){if(!w){if(w=!0,v.push(null),e.code!==a.Status.OK){let t=p(C);v.emit("error",(0,n.callErrorFromStatus)(e,t))}C=null,v.emit("status",e)}}}),v}}r.Client=m},76273,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.loadPackageDefinition=r.makeClientConstructor=void 0;let n=e.r(18656),i={unary:n.Client.prototype.makeUnaryRequest,server_stream:n.Client.prototype.makeServerStreamRequest,client_stream:n.Client.prototype.makeClientStreamRequest,bidi:n.Client.prototype.makeBidiStreamRequest};function s(e){return["__proto__","prototype","constructor"].includes(e)}function a(e,t,r){r||(r={});class a extends n.Client{}return Object.keys(e).forEach(t=>{let r;if(s(t))return;let n=e[t];if("string"==typeof t&&"$"===t.charAt(0))throw Error("Method names cannot start with $");r=n.requestStream?n.responseStream?"bidi":"client_stream":n.responseStream?"server_stream":"unary";let l=n.requestSerialize,u=n.responseDeserialize,c=o(i[r],n.path,l,u);a.prototype[t]=c,Object.assign(a.prototype[t],n),n.originalName&&!s(n.originalName)&&(a.prototype[n.originalName]=a.prototype[t])}),a.service=e,a.serviceName=t,a}function o(e,t,r,n){return function(...i){return e.call(this,t,r,n,...i)}}function l(e){return"format"in e}r.makeClientConstructor=a,r.loadPackageDefinition=function(e){let t={};for(let r in e)if(Object.prototype.hasOwnProperty.call(e,r)){let n=e[r],i=r.split(".");if(i.some(e=>s(e)))continue;let o=i[i.length-1],u=t;for(let e of i.slice(0,-1))u[e]||(u[e]={}),u=u[e];l(n)?u[o]=n:u[o]=a(n,o,{})}return t}},3590,(e,t,r)=>{var n=1/0,i="[object Symbol]",s=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,a=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,o="\ud800-\udfff",l="\\u0300-\\u036f\\ufe20-\\ufe23",u="\\u20d0-\\u20f0",c="\\u2700-\\u27bf",h="a-z\\xdf-\\xf6\\xf8-\\xff",d="A-Z\\xc0-\\xd6\\xd8-\\xde",f="\\ufe0e\\ufe0f",p="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",m="['â€™]",g="["+o+"]",y="["+p+"]",v="["+l+u+"]",b="\\d+",S="["+c+"]",w="["+h+"]",C="[^"+o+p+b+c+h+d+"]",T="\ud83c[\udffb-\udfff]",E="[^"+o+"]",_="(?:\ud83c[\udde6-\uddff]){2}",I="[\ud800-\udbff][\udc00-\udfff]",k="["+d+"]",x="\\u200d",R="(?:"+w+"|"+C+")",D="(?:"+k+"|"+C+")",A="(?:"+m+"(?:d|ll|m|re|s|t|ve))?",O="(?:"+m+"(?:D|LL|M|RE|S|T|VE))?",N="(?:"+v+"|"+T+")?",P="["+f+"]?",M="(?:"+x+"(?:"+[E,_,I].join("|")+")"+P+N+")*",L=P+N+M,B="(?:"+[S,_,I].join("|")+")"+L,F="(?:"+[E+v+"?",v,_,I,g].join("|")+")",j=RegExp(m,"g"),V=RegExp(v,"g"),z=RegExp(T+"(?="+T+")|"+F+L,"g"),q=RegExp([k+"?"+w+"+"+A+"(?="+[y,k,"$"].join("|")+")",D+"+"+O+"(?="+[y,k+R,"$"].join("|")+")",k+"?"+R+"+"+A,k+"+"+O,b,B].join("|"),"g"),U=RegExp("["+x+o+l+u+f+"]"),$=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,K={Ã€:"A",Ã:"A",Ã‚:"A",Ãƒ:"A",Ã„:"A",Ã…:"A",Ã :"a",Ã¡:"a",Ã¢:"a",Ã£:"a",Ã¤:"a",Ã¥:"a",Ã‡:"C",Ã§:"c",Ã:"D",Ã°:"d",Ãˆ:"E",Ã‰:"E",ÃŠ:"E",Ã‹:"E",Ã¨:"e",Ã©:"e",Ãª:"e",Ã«:"e",ÃŒ:"I",Ã:"I",ÃŽ:"I",Ã:"I",Ã¬:"i",Ã­:"i",Ã®:"i",Ã¯:"i",Ã‘:"N",Ã±:"n",Ã’:"O",Ã“:"O",Ã”:"O",Ã•:"O",Ã–:"O",Ã˜:"O",Ã²:"o",Ã³:"o",Ã´:"o",Ãµ:"o",Ã¶:"o",Ã¸:"o",Ã™:"U",Ãš:"U",Ã›:"U",Ãœ:"U",Ã¹:"u",Ãº:"u",Ã»:"u",Ã¼:"u",Ã:"Y",Ã½:"y",Ã¿:"y",Ã†:"Ae",Ã¦:"ae",Ãž:"Th",Ã¾:"th",ÃŸ:"ss",Ä€:"A",Ä‚:"A",Ä„:"A",Ä:"a",Äƒ:"a",Ä…:"a",Ä†:"C",Äˆ:"C",ÄŠ:"C",ÄŒ:"C",Ä‡:"c",Ä‰:"c",Ä‹:"c",Ä:"c",ÄŽ:"D",Ä:"D",Ä:"d",Ä‘:"d",Ä’:"E",Ä”:"E",Ä–:"E",Ä˜:"E",Äš:"E",Ä“:"e",Ä•:"e",Ä—:"e",Ä™:"e",Ä›:"e",Äœ:"G",Äž:"G",Ä :"G",Ä¢:"G",Ä:"g",ÄŸ:"g",Ä¡:"g",Ä£:"g",Ä¤:"H",Ä¦:"H",Ä¥:"h",Ä§:"h",Ä¨:"I",Äª:"I",Ä¬:"I",Ä®:"I",Ä°:"I",Ä©:"i",Ä«:"i",Ä­:"i",Ä¯:"i",Ä±:"i",Ä´:"J",Äµ:"j",Ä¶:"K",Ä·:"k",Ä¸:"k",Ä¹:"L",Ä»:"L",Ä½:"L",Ä¿:"L",Å:"L",Äº:"l",Ä¼:"l",Ä¾:"l",Å€:"l",Å‚:"l",Åƒ:"N",Å…:"N",Å‡:"N",ÅŠ:"N",Å„:"n",Å†:"n",Åˆ:"n",Å‹:"n",ÅŒ:"O",ÅŽ:"O",Å:"O",Å:"o",Å:"o",Å‘:"o",Å”:"R",Å–:"R",Å˜:"R",Å•:"r",Å—:"r",Å™:"r",Åš:"S",Åœ:"S",Åž:"S",Å :"S",Å›:"s",Å:"s",ÅŸ:"s",Å¡:"s",Å¢:"T",Å¤:"T",Å¦:"T",Å£:"t",Å¥:"t",Å§:"t",Å¨:"U",Åª:"U",Å¬:"U",Å®:"U",Å°:"U",Å²:"U",Å©:"u",Å«:"u",Å­:"u",Å¯:"u",Å±:"u",Å³:"u",Å´:"W",Åµ:"w",Å¶:"Y",Å·:"y",Å¸:"Y",Å¹:"Z",Å»:"Z",Å½:"Z",Åº:"z",Å¼:"z",Å¾:"z",Ä²:"IJ",Ä³:"ij",Å’:"Oe",Å“:"oe",Å‰:"'n",Å¿:"ss"},W=e.g&&e.g.Object===Object&&e.g,G="object"==typeof self&&self&&self.Object===Object&&self,H=W||G||Function("return this")();function Q(e,t,r,n){var i=-1,s=e?e.length:0;for(n&&s&&(r=e[++i]);++i<s;)r=t(r,e[i],i,e);return r}function J(e){return e.split("")}function Y(e){return e.match(s)||[]}var X=function(e){return function(t){return null==e?void 0:e[t]}}(K);function Z(e){return U.test(e)}function ee(e){return $.test(e)}function et(e){return Z(e)?er(e):J(e)}function er(e){return e.match(z)||[]}function en(e){return e.match(q)||[]}var ei=Object.prototype.toString,es=H.Symbol,ea=es?es.prototype:void 0,eo=ea?ea.toString:void 0;function el(e,t,r){var n=-1,i=e.length;t<0&&(t=-t>i?0:i+t),(r=r>i?i:r)<0&&(r+=i),i=t>r?0:r-t>>>0,t>>>=0;for(var s=Array(i);++n<i;)s[n]=e[n+t];return s}function eu(e){if("string"==typeof e)return e;if(ef(e))return eo?eo.call(e):"";var t=e+"";return"0"==t&&1/e==-n?"-0":t}function ec(e,t,r){var n=e.length;return r=void 0===r?n:r,!t&&r>=n?e:el(e,t,r)}function eh(e){return function(t){var r=Z(t=ep(t))?et(t):void 0,n=r?r[0]:t.charAt(0),i=r?ec(r,1).join(""):t.slice(1);return n[e]()+i}}function ed(e){return!!e&&"object"==typeof e}function ef(e){return"symbol"==typeof e||ed(e)&&ei.call(e)==i}function ep(e){return null==e?"":eu(e)}var em=function(e){return function(t){return Q(eb(ey(t).replace(j,"")),e,"")}}(function(e,t,r){return t=t.toLowerCase(),e+(r?eg(t):t)});function eg(e){return ev(ep(e).toLowerCase())}function ey(e){return(e=ep(e))&&e.replace(a,X).replace(V,"")}var ev=eh("toUpperCase");function eb(e,t,r){return(e=ep(e),void 0===(t=r?void 0:t))?ee(e)?en(e):Y(e):e.match(t)||[]}t.exports=em},98488,(e,t,r)=>{"use strict";t.exports=function e(e,t){for(var r=Array(arguments.length-1),n=0,i=2,s=!0;i<arguments.length;)r[n++]=arguments[i++];return new Promise(function(i,a){r[n]=function(e){if(s)if(s=!1,e)a(e);else{for(var t=Array(arguments.length-1),r=0;r<t.length;)t[r++]=arguments[r];i.apply(null,t)}};try{e.apply(t||null,r)}catch(e){s&&(s=!1,a(e))}})}},2802,(e,t,r)=>{"use strict";var n=r;n.length=function(e){var t=e.length;if(!t)return 0;for(var r=0;--t%4>1&&"="===e.charAt(t);)++r;return Math.ceil(3*e.length)/4-r};for(var i=Array(64),s=Array(123),a=0;a<64;)s[i[a]=a<26?a+65:a<52?a+71:a<62?a-4:a-59|43]=a++;n.encode=function(e,t,r){for(var n,s=null,a=[],o=0,l=0;t<r;){var u=e[t++];switch(l){case 0:a[o++]=i[u>>2],n=(3&u)<<4,l=1;break;case 1:a[o++]=i[n|u>>4],n=(15&u)<<2,l=2;break;case 2:a[o++]=i[n|u>>6],a[o++]=i[63&u],l=0}o>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,a)),o=0)}return(l&&(a[o++]=i[n],a[o++]=61,1===l&&(a[o++]=61)),s)?(o&&s.push(String.fromCharCode.apply(String,a.slice(0,o))),s.join("")):String.fromCharCode.apply(String,a.slice(0,o))};var o="invalid encoding";n.decode=function(e,t,r){for(var n,i=r,a=0,l=0;l<e.length;){var u=e.charCodeAt(l++);if(61===u&&a>1)break;if(void 0===(u=s[u]))throw Error(o);switch(a){case 0:n=u,a=1;break;case 1:t[r++]=n<<2|(48&u)>>4,n=u,a=2;break;case 2:t[r++]=(15&n)<<4|(60&u)>>2,n=u,a=3;break;case 3:t[r++]=(3&n)<<6|u,a=0}}if(1===a)throw Error(o);return r-i},n.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}},62540,(e,t,r)=>{"use strict";function n(){this._listeners={}}t.exports=n,n.prototype.on=function(e,t,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:r||this}),this},n.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var r=this._listeners[e],n=0;n<r.length;)r[n].fn===t?r.splice(n,1):++n;return this},n.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var r=[],n=1;n<arguments.length;)r.push(arguments[n++]);for(n=0;n<t.length;)t[n].fn.apply(t[n++].ctx,r)}return this}},35400,(e,t,r)=>{"use strict";function n(e){return"undefined"!=typeof Float32Array?!function(){var t=new Float32Array([-0]),r=new Uint8Array(t.buffer),n=128===r[3];function i(e,n,i){t[0]=e,n[i]=r[0],n[i+1]=r[1],n[i+2]=r[2],n[i+3]=r[3]}function s(e,n,i){t[0]=e,n[i]=r[3],n[i+1]=r[2],n[i+2]=r[1],n[i+3]=r[0]}function a(e,n){return r[0]=e[n],r[1]=e[n+1],r[2]=e[n+2],r[3]=e[n+3],t[0]}function o(e,n){return r[3]=e[n],r[2]=e[n+1],r[1]=e[n+2],r[0]=e[n+3],t[0]}e.writeFloatLE=n?i:s,e.writeFloatBE=n?s:i,e.readFloatLE=n?a:o,e.readFloatBE=n?o:a}():!function(){function t(e,t,r,n){var i=+(t<0);if(i&&(t=-t),0===t)e(1/t>0?0:0x80000000,r,n);else if(isNaN(t))e(0x7fc00000,r,n);else if(t>34028234663852886e22)e((i<<31|0x7f800000)>>>0,r,n);else if(t<11754943508222875e-54)e((i<<31|Math.round(t/1401298464324817e-60))>>>0,r,n);else{var s=Math.floor(Math.log(t)/Math.LN2),a=8388607&Math.round(t*Math.pow(2,-s)*8388608);e((i<<31|s+127<<23|a)>>>0,r,n)}}function r(e,t,r){var n=e(t,r),i=(n>>31)*2+1,s=n>>>23&255,a=8388607&n;return 255===s?a?NaN:1/0*i:0===s?1401298464324817e-60*i*a:i*Math.pow(2,s-150)*(a+8388608)}e.writeFloatLE=t.bind(null,i),e.writeFloatBE=t.bind(null,s),e.readFloatLE=r.bind(null,a),e.readFloatBE=r.bind(null,o)}(),"undefined"!=typeof Float64Array?!function(){var t=new Float64Array([-0]),r=new Uint8Array(t.buffer),n=128===r[7];function i(e,n,i){t[0]=e,n[i]=r[0],n[i+1]=r[1],n[i+2]=r[2],n[i+3]=r[3],n[i+4]=r[4],n[i+5]=r[5],n[i+6]=r[6],n[i+7]=r[7]}function s(e,n,i){t[0]=e,n[i]=r[7],n[i+1]=r[6],n[i+2]=r[5],n[i+3]=r[4],n[i+4]=r[3],n[i+5]=r[2],n[i+6]=r[1],n[i+7]=r[0]}function a(e,n){return r[0]=e[n],r[1]=e[n+1],r[2]=e[n+2],r[3]=e[n+3],r[4]=e[n+4],r[5]=e[n+5],r[6]=e[n+6],r[7]=e[n+7],t[0]}function o(e,n){return r[7]=e[n],r[6]=e[n+1],r[5]=e[n+2],r[4]=e[n+3],r[3]=e[n+4],r[2]=e[n+5],r[1]=e[n+6],r[0]=e[n+7],t[0]}e.writeDoubleLE=n?i:s,e.writeDoubleBE=n?s:i,e.readDoubleLE=n?a:o,e.readDoubleBE=n?o:a}():!function(){function t(e,t,r,n,i,s){var a,o=+(n<0);if(o&&(n=-n),0===n)e(0,i,s+t),e(1/n>0?0:0x80000000,i,s+r);else if(isNaN(n))e(0,i,s+t),e(0x7ff80000,i,s+r);else if(n>17976931348623157e292)e(0,i,s+t),e((o<<31|0x7ff00000)>>>0,i,s+r);else if(n<22250738585072014e-324)e((a=n/5e-324)>>>0,i,s+t),e((o<<31|a/0x100000000)>>>0,i,s+r);else{var l=Math.floor(Math.log(n)/Math.LN2);1024===l&&(l=1023),e(0x10000000000000*(a=n*Math.pow(2,-l))>>>0,i,s+t),e((o<<31|l+1023<<20|1048576*a&1048575)>>>0,i,s+r)}}function r(e,t,r,n,i){var s=e(n,i+t),a=e(n,i+r),o=(a>>31)*2+1,l=a>>>20&2047,u=0x100000000*(1048575&a)+s;return 2047===l?u?NaN:1/0*o:0===l?5e-324*o*u:o*Math.pow(2,l-1075)*(u+0x10000000000000)}e.writeDoubleLE=t.bind(null,i,0,4),e.writeDoubleBE=t.bind(null,s,4,0),e.readDoubleLE=r.bind(null,a,0,4),e.readDoubleBE=r.bind(null,o,4,0)}(),e}function i(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}function s(e,t,r){t[r]=e>>>24,t[r+1]=e>>>16&255,t[r+2]=e>>>8&255,t[r+3]=255&e}function a(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function o(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}t.exports=n(n)},12477,(__turbopack_context__,module,exports)=>{"use strict";function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}module.exports=inquire},22964,(e,t,r)=>{"use strict";var n=r;n.length=function(e){for(var t=0,r=0,n=0;n<e.length;++n)(r=e.charCodeAt(n))<128?t+=1:r<2048?t+=2:(64512&r)==55296&&(64512&e.charCodeAt(n+1))==56320?(++n,t+=4):t+=3;return t},n.read=function(e,t,r){if(r-t<1)return"";for(var n,i=null,s=[],a=0;t<r;)(n=e[t++])<128?s[a++]=n:n>191&&n<224?s[a++]=(31&n)<<6|63&e[t++]:n>239&&n<365?(n=((7&n)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,s[a++]=55296+(n>>10),s[a++]=56320+(1023&n)):s[a++]=(15&n)<<12|(63&e[t++])<<6|63&e[t++],a>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,s)),a=0);return i?(a&&i.push(String.fromCharCode.apply(String,s.slice(0,a))),i.join("")):String.fromCharCode.apply(String,s.slice(0,a))},n.write=function(e,t,r){for(var n,i,s=r,a=0;a<e.length;++a)(n=e.charCodeAt(a))<128?t[r++]=n:(n<2048?t[r++]=n>>6|192:((64512&n)==55296&&(64512&(i=e.charCodeAt(a+1)))==56320?(n=65536+((1023&n)<<10)+(1023&i),++a,t[r++]=n>>18|240,t[r++]=n>>12&63|128):t[r++]=n>>12|224,t[r++]=n>>6&63|128),t[r++]=63&n|128);return r-s}},96351,(e,t,r)=>{"use strict";t.exports=function e(e,t,r){var n=r||8192,i=n>>>1,s=null,a=n;return function(r){if(r<1||r>i)return e(r);a+r>n&&(s=e(n),a=0);var o=t.call(s,a,a+=r);return 7&a&&(a=(7|a)+1),o}}},56145,(e,t,r)=>{"use strict";t.exports=i;var n=e.r(64172);function i(e,t){this.lo=e>>>0,this.hi=t>>>0}var s=i.zero=new i(0,0);s.toNumber=function(){return 0},s.zzEncode=s.zzDecode=function(){return this},s.length=function(){return 1};var a=i.zeroHash="\0\0\0\0\0\0\0\0";i.fromNumber=function(e){if(0===e)return s;var t=e<0;t&&(e=-e);var r=e>>>0,n=(e-r)/0x100000000>>>0;return t&&(n=~n>>>0,r=~r>>>0,++r>0xffffffff&&(r=0,++n>0xffffffff&&(n=0))),new i(r,n)},i.from=function(e){if("number"==typeof e)return i.fromNumber(e);if(n.isString(e))if(!n.Long)return i.fromNumber(parseInt(e,10));else e=n.Long.fromString(e);return e.low||e.high?new i(e.low>>>0,e.high>>>0):s},i.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=~this.lo+1>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+0x100000000*r)}return this.lo+0x100000000*this.hi},i.prototype.toLong=function(e){return n.Long?new n.Long(0|this.lo,0|this.hi,!!e):{low:0|this.lo,high:0|this.hi,unsigned:!!e}};var o=String.prototype.charCodeAt;i.fromHash=function(e){return e===a?s:new i((o.call(e,0)|o.call(e,1)<<8|o.call(e,2)<<16|o.call(e,3)<<24)>>>0,(o.call(e,4)|o.call(e,5)<<8|o.call(e,6)<<16|o.call(e,7)<<24)>>>0)},i.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},i.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},i.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},i.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return 0===r?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10}},64172,(e,t,r)=>{"use strict";var n=r;function i(e,t,r){for(var n=Object.keys(t),i=0;i<n.length;++i)void 0!==e[n[i]]&&r||(e[n[i]]=t[n[i]]);return e}function s(e){function t(e,r){if(!(this instanceof t))return new t(e,r);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:Error().stack||""}),r&&i(this,r)}return t.prototype=Object.create(Error.prototype,{constructor:{value:t,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return e},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),t}n.asPromise=e.r(98488),n.base64=e.r(2802),n.EventEmitter=e.r(62540),n.float=e.r(35400),n.inquire=e.r(12477),n.utf8=e.r(22964),n.pool=e.r(96351),n.LongBits=e.r(56145),n.isNode=!!(e.g&&e.g.process&&e.g.process.versions&&e.g.process.versions.node),n.global=n.isNode&&e.g||"undefined"!=typeof self&&self||e.e,n.emptyArray=Object.freeze?Object.freeze([]):[],n.emptyObject=Object.freeze?Object.freeze({}):{},n.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},n.isString=function(e){return"string"==typeof e||e instanceof String},n.isObject=function(e){return e&&"object"==typeof e},n.isset=n.isSet=function(e,t){var r=e[t];return!!(null!=r&&e.hasOwnProperty(t))&&("object"!=typeof r||(Array.isArray(r)?r.length:Object.keys(r).length)>0)},n.Buffer=function(){try{var e=n.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),n._Buffer_from=null,n._Buffer_allocUnsafe=null,n.newBuffer=function(e){return"number"==typeof e?n.Buffer?n._Buffer_allocUnsafe(e):new n.Array(e):n.Buffer?n._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},n.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,n.Long=n.global.dcodeIO&&n.global.dcodeIO.Long||n.global.Long||n.inquire("long"),n.key2Re=/^true|false|0|1$/,n.key32Re=/^-?(?:0|[1-9][0-9]*)$/,n.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,n.longToHash=function(e){return e?n.LongBits.from(e).toHash():n.LongBits.zeroHash},n.longFromHash=function(e,t){var r=n.LongBits.fromHash(e);return n.Long?n.Long.fromBits(r.lo,r.hi,t):r.toNumber(!!t)},n.merge=i,n.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},n.newError=s,n.ProtocolError=s("ProtocolError"),n.oneOfGetter=function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var e=Object.keys(this),r=e.length-1;r>-1;--r)if(1===t[e[r]]&&void 0!==this[e[r]]&&null!==this[e[r]])return e[r]}},n.oneOfSetter=function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}},n.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},n._configure=function(){var e=n.Buffer;if(!e){n._Buffer_from=n._Buffer_allocUnsafe=null;return}n._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,r){return new e(t,r)},n._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}}},19089,(e,t,r)=>{"use strict";t.exports={}},54517,(e,t,r)=>{"use strict";function n(e,t){"string"==typeof e&&(t=e,e=void 0);var r=[];function i(e){if("string"!=typeof e){var t=s();if(n.verbose&&console.log("codegen: "+t),t="return "+t,e){for(var a=Object.keys(e),o=Array(a.length+1),l=Array(a.length),u=0;u<a.length;)o[u]=a[u],l[u]=e[a[u++]];return o[u]=t,Function.apply(null,o).apply(null,l)}return Function(t)()}for(var c=Array(arguments.length-1),h=0;h<c.length;)c[h]=arguments[++h];if(h=0,e=e.replace(/%([%dfijs])/g,function(e,t){var r=c[h++];switch(t){case"d":case"f":return String(Number(r));case"i":return String(Math.floor(r));case"j":return JSON.stringify(r);case"s":return String(r)}return"%"}),h!==c.length)throw Error("parameter count mismatch");return r.push(e),i}function s(n){return"function "+(n||t||"")+"("+(e&&e.join(",")||"")+"){\n  "+r.join("\n  ")+"\n}"}return i.toString=s,i}t.exports=n,n.verbose=!1},65257,(e,t,r)=>{"use strict";t.exports=s;var n=e.r(98488),i=e.r(12477)("fs");function s(e,t,r){return("function"==typeof t?(r=t,t={}):t||(t={}),r)?!t.xhr&&i&&i.readFile?i.readFile(e,function(n,i){return n&&"undefined"!=typeof XMLHttpRequest?s.xhr(e,t,r):n?r(n):r(null,t.binary?i:i.toString("utf8"))}):s.xhr(e,t,r):n(s,this,e,t)}s.xhr=function(e,t,r){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(4===n.readyState){if(0!==n.status&&200!==n.status)return r(Error("status "+n.status));if(t.binary){var e=n.response;if(!e){e=[];for(var i=0;i<n.responseText.length;++i)e.push(255&n.responseText.charCodeAt(i))}return r(null,"undefined"!=typeof Uint8Array?new Uint8Array(e):e)}return r(null,n.responseText)}},t.binary&&("overrideMimeType"in n&&n.overrideMimeType("text/plain; charset=x-user-defined"),n.responseType="arraybuffer"),n.open("GET",e),n.send()}},62400,(e,t,r)=>{"use strict";var n=r,i=n.isAbsolute=function(e){return/^(?:\/|\w+:)/.test(e)},s=n.normalize=function(e){var t=(e=e.replace(/\\/g,"/").replace(/\/{2,}/g,"/")).split("/"),r=i(e),n="";r&&(n=t.shift()+"/");for(var s=0;s<t.length;)".."===t[s]?s>0&&".."!==t[s-1]?t.splice(--s,2):r?t.splice(s,1):++s:"."===t[s]?t.splice(s,1):++s;return n+t.join("/")};n.resolve=function(e,t,r){return(r||(t=s(t)),i(t))?t:(r||(e=s(e)),(e=e.replace(/(?:\/|^)[^/]+$/,"")).length?s(e+"/"+t):t)}},51313,(e,t,r)=>{"use strict";t.exports=h;var n,i,s,a=e.r(41684);((h.prototype=Object.create(a.prototype)).constructor=h).className="Namespace";var o=e.r(7963),l=e.r(92382),u=e.r(60633);function c(e,t){if(e&&e.length){for(var r={},n=0;n<e.length;++n)r[e[n].name]=e[n].toJSON(t);return r}}function h(e,t){a.call(this,e,t),this.nested=void 0,this._nestedArray=null,this._lookupCache={},this._needsRecursiveFeatureResolution=!0,this._needsRecursiveResolve=!0}function d(e){e._nestedArray=null,e._lookupCache={};for(var t=e;t=t.parent;)t._lookupCache={};return e}h.fromJSON=function(e,t){return new h(e,t.options).addJSON(t.nested)},h.arrayToJSON=c,h.isReservedId=function(e,t){if(e){for(var r=0;r<e.length;++r)if("string"!=typeof e[r]&&e[r][0]<=t&&e[r][1]>t)return!0}return!1},h.isReservedName=function(e,t){if(e){for(var r=0;r<e.length;++r)if(e[r]===t)return!0}return!1},Object.defineProperty(h.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=l.toArray(this.nested))}}),h.prototype.toJSON=function(e){return l.toObject(["options",this.options,"nested",c(this.nestedArray,e)])},h.prototype.addJSON=function(e){var t=this;if(e)for(var r,a=Object.keys(e),l=0;l<a.length;++l)r=e[a[l]],t.add((void 0!==r.fields?n.fromJSON:void 0!==r.values?s.fromJSON:void 0!==r.methods?i.fromJSON:void 0!==r.id?o.fromJSON:h.fromJSON)(a[l],r));return this},h.prototype.get=function(e){return this.nested&&this.nested[e]||null},h.prototype.getEnum=function(e){if(this.nested&&this.nested[e]instanceof s)return this.nested[e].values;throw Error("no such enum: "+e)},h.prototype.add=function(e){if(!(e instanceof o&&void 0!==e.extend||e instanceof n||e instanceof u||e instanceof s||e instanceof i||e instanceof h))throw TypeError("object must be a valid nested object");if(this.nested){var t=this.get(e.name);if(t)if(t instanceof h&&e instanceof h&&!(t instanceof n||t instanceof i)){for(var r=t.nestedArray,a=0;a<r.length;++a)e.add(r[a]);this.remove(t),this.nested||(this.nested={}),e.setOptions(t.options,!0)}else throw Error("duplicate name '"+e.name+"' in "+this)}else this.nested={};this.nested[e.name]=e,this instanceof n||this instanceof i||this instanceof s||this instanceof o||e._edition||(e._edition=e._defaultEdition),this._needsRecursiveFeatureResolution=!0,this._needsRecursiveResolve=!0;for(var l=this;l=l.parent;)l._needsRecursiveFeatureResolution=!0,l._needsRecursiveResolve=!0;return e.onAdd(this),d(this)},h.prototype.remove=function(e){if(!(e instanceof a))throw TypeError("object must be a ReflectionObject");if(e.parent!==this)throw Error(e+" is not a member of "+this);return delete this.nested[e.name],Object.keys(this.nested).length||(this.nested=void 0),e.onRemove(this),d(this)},h.prototype.define=function(e,t){if(l.isString(e))e=e.split(".");else if(!Array.isArray(e))throw TypeError("illegal path");if(e&&e.length&&""===e[0])throw Error("path must be relative");for(var r=this;e.length>0;){var n=e.shift();if(r.nested&&r.nested[n]){if(!((r=r.nested[n])instanceof h))throw Error("path conflicts with non-namespace objects")}else r.add(r=new h(n))}return t&&r.addJSON(t),r},h.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;this._resolveFeaturesRecursive(this._edition);var e=this.nestedArray,t=0;for(this.resolve();t<e.length;)e[t]instanceof h?e[t++].resolveAll():e[t++].resolve();return this._needsRecursiveResolve=!1,this},h.prototype._resolveFeaturesRecursive=function(e){return this._needsRecursiveFeatureResolution&&(this._needsRecursiveFeatureResolution=!1,e=this._edition||e,a.prototype._resolveFeaturesRecursive.call(this,e),this.nestedArray.forEach(t=>{t._resolveFeaturesRecursive(e)})),this},h.prototype.lookup=function(e,t,r){if("boolean"==typeof t?(r=t,t=void 0):t&&!Array.isArray(t)&&(t=[t]),l.isString(e)&&e.length){if("."===e)return this.root;e=e.split(".")}else if(!e.length)return this;var n=e.join(".");if(""===e[0])return this.root.lookup(e.slice(1),t);var i=this.root._fullyQualifiedObjects&&this.root._fullyQualifiedObjects["."+n];if(i&&(!t||t.indexOf(i.constructor)>-1)||(i=this._lookupImpl(e,n))&&(!t||t.indexOf(i.constructor)>-1))return i;if(r)return null;for(var s=this;s.parent;){if((i=s.parent._lookupImpl(e,n))&&(!t||t.indexOf(i.constructor)>-1))return i;s=s.parent}return null},h.prototype._lookupImpl=function(e,t){if(Object.prototype.hasOwnProperty.call(this._lookupCache,t))return this._lookupCache[t];var r=this.get(e[0]),n=null;if(r)1===e.length?n=r:r instanceof h&&(e=e.slice(1),n=r._lookupImpl(e,e.join(".")));else for(var i=0;i<this.nestedArray.length;++i)this._nestedArray[i]instanceof h&&(r=this._nestedArray[i]._lookupImpl(e,t))&&(n=r);return this._lookupCache[t]=n,n},h.prototype.lookupType=function(e){var t=this.lookup(e,[n]);if(!t)throw Error("no such type: "+e);return t},h.prototype.lookupEnum=function(e){var t=this.lookup(e,[s]);if(!t)throw Error("no such Enum '"+e+"' in "+this);return t},h.prototype.lookupTypeOrEnum=function(e){var t=this.lookup(e,[n,s]);if(!t)throw Error("no such Type or Enum '"+e+"' in "+this);return t},h.prototype.lookupService=function(e){var t=this.lookup(e,[i]);if(!t)throw Error("no such Service '"+e+"' in "+this);return t},h._configure=function(e,t,r){n=e,i=t,s=r}},49854,(e,t,r)=>{"use strict";t.exports=a;var n=e.r(7963);((a.prototype=Object.create(n.prototype)).constructor=a).className="MapField";var i=e.r(4178),s=e.r(92382);function a(e,t,r,i,a,o){if(n.call(this,e,t,i,void 0,void 0,a,o),!s.isString(r))throw TypeError("keyType must be a string");this.keyType=r,this.resolvedKeyType=null,this.map=!0}a.fromJSON=function(e,t){return new a(e,t.id,t.keyType,t.type,t.options,t.comment)},a.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return s.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])},a.prototype.resolve=function(){if(this.resolved)return this;if(void 0===i.mapKey[this.keyType])throw Error("invalid key type: "+this.keyType);return n.prototype.resolve.call(this)},a.d=function(e,t,r){return"function"==typeof r?r=s.decorateType(r).name:r&&"object"==typeof r&&(r=s.decorateEnum(r).name),function(n,i){s.decorateType(n.constructor).add(new a(i,e,t,r))}}},78966,(e,t,r)=>{"use strict";t.exports=s;var n=e.r(41684);((s.prototype=Object.create(n.prototype)).constructor=s).className="Method";var i=e.r(92382);function s(e,t,r,s,a,o,l,u,c){if(i.isObject(a)?(l=a,a=o=void 0):i.isObject(o)&&(l=o,o=void 0),!(void 0===t||i.isString(t)))throw TypeError("type must be a string");if(!i.isString(r))throw TypeError("requestType must be a string");if(!i.isString(s))throw TypeError("responseType must be a string");n.call(this,e,l),this.type=t||"rpc",this.requestType=r,this.requestStream=!!a||void 0,this.responseType=s,this.responseStream=!!o||void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=u,this.parsedOptions=c}s.fromJSON=function(e,t){return new s(e,t.type,t.requestType,t.responseType,t.requestStream,t.responseStream,t.options,t.comment,t.parsedOptions)},s.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return i.toObject(["type","rpc"!==this.type&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",t?this.comment:void 0,"parsedOptions",this.parsedOptions])},s.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),n.prototype.resolve.call(this))}},34807,(e,t,r)=>{"use strict";t.exports=i;var n=e.r(64172);function i(e,t,r){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");n.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=!!t,this.responseDelimited=!!r}(i.prototype=Object.create(n.EventEmitter.prototype)).constructor=i,i.prototype.rpcCall=function e(t,r,i,s,a){if(!s)throw TypeError("request must be specified");var o=this;if(!a)return n.asPromise(e,o,t,r,i,s);if(!o.rpcImpl)return void setTimeout(function(){a(Error("already ended"))},0);try{return o.rpcImpl(t,r[o.requestDelimited?"encodeDelimited":"encode"](s).finish(),function(e,r){if(e)return o.emit("error",e,t),a(e);if(null===r)return void o.end(!0);if(!(r instanceof i))try{r=i[o.responseDelimited?"decodeDelimited":"decode"](r)}catch(e){return o.emit("error",e,t),a(e)}return o.emit("data",r,t),a(null,r)})}catch(e){o.emit("error",e,t),setTimeout(function(){a(e)},0);return}},i.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},31116,(e,t,r)=>{"use strict";r.Service=e.r(34807)},50244,(e,t,r)=>{"use strict";t.exports=o;var n=e.r(51313);((o.prototype=Object.create(n.prototype)).constructor=o).className="Service";var i=e.r(78966),s=e.r(92382),a=e.r(31116);function o(e,t){n.call(this,e,t),this.methods={},this._methodsArray=null}function l(e){return e._methodsArray=null,e}o.fromJSON=function(e,t){var r=new o(e,t.options);if(t.methods)for(var n=Object.keys(t.methods),s=0;s<n.length;++s)r.add(i.fromJSON(n[s],t.methods[n[s]]));return t.nested&&r.addJSON(t.nested),t.edition&&(r._edition=t.edition),r.comment=t.comment,r._defaultEdition="proto3",r},o.prototype.toJSON=function(e){var t=n.prototype.toJSON.call(this,e),r=!!e&&!!e.keepComments;return s.toObject(["edition",this._editionToJSON(),"options",t&&t.options||void 0,"methods",n.arrayToJSON(this.methodsArray,e)||{},"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])},Object.defineProperty(o.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=s.toArray(this.methods))}}),o.prototype.get=function(e){return this.methods[e]||n.prototype.get.call(this,e)},o.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;n.prototype.resolve.call(this);for(var e=this.methodsArray,t=0;t<e.length;++t)e[t].resolve();return this},o.prototype._resolveFeaturesRecursive=function(e){return this._needsRecursiveFeatureResolution&&(e=this._edition||e,n.prototype._resolveFeaturesRecursive.call(this,e),this.methodsArray.forEach(t=>{t._resolveFeaturesRecursive(e)})),this},o.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);return e instanceof i?(this.methods[e.name]=e,e.parent=this,l(this)):n.prototype.add.call(this,e)},o.prototype.remove=function(e){if(e instanceof i){if(this.methods[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.methods[e.name],e.parent=null,l(this)}return n.prototype.remove.call(this,e)},o.prototype.create=function(e,t,r){for(var n,i=new a.Service(e,t,r),o=0;o<this.methodsArray.length;++o){var l=s.lcFirst((n=this._methodsArray[o]).resolve().name).replace(/[^$\w_]/g,"");i[l]=s.codegen(["r","c"],s.isReserved(l)?l+"_":l)("return this.rpcCall(m,q,s,r,c)")({m:n,q:n.resolvedRequestType.ctor,s:n.resolvedResponseType.ctor})}return i}},57750,(e,t,r)=>{"use strict";t.exports=i;var n=e.r(64172);function i(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)this[t[r]]=e[t[r]]}i.create=function(e){return this.$type.create(e)},i.encode=function(e,t){return this.$type.encode(e,t)},i.encodeDelimited=function(e,t){return this.$type.encodeDelimited(e,t)},i.decode=function(e){return this.$type.decode(e)},i.decodeDelimited=function(e){return this.$type.decodeDelimited(e)},i.verify=function(e){return this.$type.verify(e)},i.fromObject=function(e){return this.$type.fromObject(e)},i.toObject=function(e,t){return this.$type.toObject(e,t)},i.prototype.toJSON=function(){return this.$type.toObject(this,n.toJSONOptions)}},65379,(e,t,r)=>{"use strict";t.exports=l;var n,i=e.r(64172),s=i.LongBits,a=i.utf8;function o(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function l(e){this.buf=e,this.pos=0,this.len=e.length}var u="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new l(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new l(e);throw Error("illegal buffer")},c=function(){return i.Buffer?function(e){return(l.create=function(e){return i.Buffer.isBuffer(e)?new n(e):u(e)})(e)}:u};function h(){var e=new s(0,0),t=0;if(this.len-this.pos>4){for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;t=0}else{for(;t<3;++t){if(this.pos>=this.len)throw o(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}if(this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw o(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function d(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function f(){if(this.pos+8>this.len)throw o(this,8);return new s(d(this.buf,this.pos+=4),d(this.buf,this.pos+=4))}l.create=c(),l.prototype._slice=i.Array.prototype.subarray||i.Array.prototype.slice,l.prototype.uint32=function(){var e=0xffffffff;return function(){if(e=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128||(e=(e|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,o(this,10);return e}}(),l.prototype.int32=function(){return 0|this.uint32()},l.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)},l.prototype.bool=function(){return 0!==this.uint32()},l.prototype.fixed32=function(){if(this.pos+4>this.len)throw o(this,4);return d(this.buf,this.pos+=4)},l.prototype.sfixed32=function(){if(this.pos+4>this.len)throw o(this,4);return 0|d(this.buf,this.pos+=4)},l.prototype.float=function(){if(this.pos+4>this.len)throw o(this,4);var e=i.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},l.prototype.double=function(){if(this.pos+8>this.len)throw o(this,4);var e=i.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},l.prototype.bytes=function(){var e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw o(this,e);if(this.pos+=e,Array.isArray(this.buf))return this.buf.slice(t,r);if(t===r){var n=i.Buffer;return n?n.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,t,r)},l.prototype.string=function(){var e=this.bytes();return a.read(e,0,e.length)},l.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw o(this,e);this.pos+=e}else do if(this.pos>=this.len)throw o(this);while(128&this.buf[this.pos++])return this},l.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},l._configure=function(e){n=e,l.create=c(),n._configure();var t=i.Long?"toLong":"toNumber";i.merge(l.prototype,{int64:function(){return h.call(this)[t](!1)},uint64:function(){return h.call(this)[t](!0)},sint64:function(){return h.call(this).zzDecode()[t](!1)},fixed64:function(){return f.call(this)[t](!0)},sfixed64:function(){return f.call(this)[t](!1)}})}},75624,(e,t,r)=>{"use strict";t.exports=h;var n,i=e.r(64172),s=i.LongBits,a=i.base64,o=i.utf8;function l(e,t,r){this.fn=e,this.len=t,this.next=void 0,this.val=r}function u(){}function c(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function h(){this.len=0,this.head=new l(u,0,0),this.tail=this.head,this.states=null}var d=function(){return i.Buffer?function(){return(h.create=function(){return new n})()}:function(){return new h}};function f(e,t,r){t[r]=255&e}function p(e,t,r){for(;e>127;)t[r++]=127&e|128,e>>>=7;t[r]=e}function m(e,t){this.len=e,this.next=void 0,this.val=t}function g(e,t,r){for(;e.hi;)t[r++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=127&e.lo|128,e.lo=e.lo>>>7;t[r++]=e.lo}function y(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}h.create=d(),h.alloc=function(e){return new i.Array(e)},i.Array!==Array&&(h.alloc=i.pool(h.alloc,i.Array.prototype.subarray)),h.prototype._push=function(e,t,r){return this.tail=this.tail.next=new l(e,t,r),this.len+=t,this},m.prototype=Object.create(l.prototype),m.prototype.fn=p,h.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new m((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<0x10000000?4:5,e)).len,this},h.prototype.int32=function(e){return e<0?this._push(g,10,s.fromNumber(e)):this.uint32(e)},h.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},h.prototype.uint64=function(e){var t=s.from(e);return this._push(g,t.length(),t)},h.prototype.int64=h.prototype.uint64,h.prototype.sint64=function(e){var t=s.from(e).zzEncode();return this._push(g,t.length(),t)},h.prototype.bool=function(e){return this._push(f,1,+!!e)},h.prototype.fixed32=function(e){return this._push(y,4,e>>>0)},h.prototype.sfixed32=h.prototype.fixed32,h.prototype.fixed64=function(e){var t=s.from(e);return this._push(y,4,t.lo)._push(y,4,t.hi)},h.prototype.sfixed64=h.prototype.fixed64,h.prototype.float=function(e){return this._push(i.float.writeFloatLE,4,e)},h.prototype.double=function(e){return this._push(i.float.writeDoubleLE,8,e)};var v=i.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(var n=0;n<e.length;++n)t[r+n]=e[n]};h.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(f,1,0);if(i.isString(e)){var r=h.alloc(t=a.length(e));a.decode(e,r,0),e=r}return this.uint32(t)._push(v,t,e)},h.prototype.string=function(e){var t=o.length(e);return t?this.uint32(t)._push(o.write,t,e):this._push(f,1,0)},h.prototype.fork=function(){return this.states=new c(this),this.head=this.tail=new l(u,0,0),this.len=0,this},h.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new l(u,0,0),this.len=0),this},h.prototype.ldelim=function(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this},h.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t},h._configure=function(e){n=e,h.create=d(),n._configure()}},98569,(e,t,r)=>{"use strict";t.exports=o;var n=e.r(73041),i=e.r(4178),s=e.r(92382);function a(e){return"missing required '"+e.name+"'"}function o(e){for(var t=s.codegen(["r","l","e"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter(function(e){return e.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()")("if(t===e)")("break")("switch(t>>>3){"),r=0;r<e.fieldsArray.length;++r){var o=e._fieldsArray[r].resolve(),l=o.resolvedType instanceof n?"int32":o.type,u="m"+s.safeProp(o.name);t("case %i: {",o.id),o.map?(t("if(%s===util.emptyObject)",u)("%s={}",u)("var c2 = r.uint32()+r.pos"),void 0!==i.defaults[o.keyType]?t("k=%j",i.defaults[o.keyType]):t("k=null"),void 0!==i.defaults[l]?t("value=%j",i.defaults[l]):t("value=null"),t("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",o.keyType)("case 2:"),void 0===i.basic[l]?t("value=types[%i].decode(r,r.uint32())",r):t("value=r.%s()",l),t("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),void 0!==i.long[o.keyType]?t('%s[typeof k==="object"?util.longToHash(k):k]=value',u):t("%s[k]=value",u)):o.repeated?(t("if(!(%s&&%s.length))",u,u)("%s=[]",u),void 0!==i.packed[l]&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",u,l)("}else"),void 0===i.basic[l]?t(o.delimited?"%s.push(types[%i].decode(r,undefined,((t&~7)|4)))":"%s.push(types[%i].decode(r,r.uint32()))",u,r):t("%s.push(r.%s())",u,l)):void 0===i.basic[l]?t(o.delimited?"%s=types[%i].decode(r,undefined,((t&~7)|4))":"%s=types[%i].decode(r,r.uint32())",u,r):t("%s=r.%s()",u,l),t("break")("}")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),r=0;r<e._fieldsArray.length;++r){var c=e._fieldsArray[r];c.required&&t("if(!m.hasOwnProperty(%j))",c.name)("throw util.ProtocolError(%j,{instance:m})",a(c))}return t("return m")}},36670,(e,t,r)=>{"use strict";t.exports=l;var n=e.r(73041),i=e.r(92382);function s(e,t){return e.name+": "+t+(e.repeated&&"array"!==t?"[]":e.map&&"object"!==t?"{k:"+e.keyType+"}":"")+" expected"}function a(e,t,r,i){if(t.resolvedType)if(t.resolvedType instanceof n){e("switch(%s){",i)("default:")("return%j",s(t,"enum value"));for(var a=Object.keys(t.resolvedType.values),o=0;o<a.length;++o)e("case %i:",t.resolvedType.values[a[o]]);e("break")("}")}else e("{")("var e=types[%i].verify(%s);",r,i)("if(e)")("return%j+e",t.name+".")("}");else switch(t.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":e("if(!util.isInteger(%s))",i)("return%j",s(t,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":e("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",i,i,i,i)("return%j",s(t,"integer|Long"));break;case"float":case"double":e('if(typeof %s!=="number")',i)("return%j",s(t,"number"));break;case"bool":e('if(typeof %s!=="boolean")',i)("return%j",s(t,"boolean"));break;case"string":e("if(!util.isString(%s))",i)("return%j",s(t,"string"));break;case"bytes":e('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',i,i,i)("return%j",s(t,"buffer"))}return e}function o(e,t,r){switch(t.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":e("if(!util.key32Re.test(%s))",r)("return%j",s(t,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":e("if(!util.key64Re.test(%s))",r)("return%j",s(t,"integer|Long key"));break;case"bool":e("if(!util.key2Re.test(%s))",r)("return%j",s(t,"boolean key"))}return e}function l(e){var t=i.codegen(["m"],e.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),r=e.oneofsArray,n={};r.length&&t("var p={}");for(var l=0;l<e.fieldsArray.length;++l){var u=e._fieldsArray[l].resolve(),c="m"+i.safeProp(u.name);if(u.optional&&t("if(%s!=null&&m.hasOwnProperty(%j)){",c,u.name),u.map)t("if(!util.isObject(%s))",c)("return%j",s(u,"object"))("var k=Object.keys(%s)",c)("for(var i=0;i<k.length;++i){"),o(t,u,"k[i]"),a(t,u,l,c+"[k[i]]")("}");else if(u.repeated)t("if(!Array.isArray(%s))",c)("return%j",s(u,"array"))("for(var i=0;i<%s.length;++i){",c),a(t,u,l,c+"[i]")("}");else{if(u.partOf){var h=i.safeProp(u.partOf.name);1===n[u.partOf.name]&&t("if(p%s===1)",h)("return%j",u.partOf.name+": multiple values"),n[u.partOf.name]=1,t("p%s=1",h)}a(t,u,l,c)}u.optional&&t("}")}return t("return null")}},5734,(e,t,r)=>{"use strict";var n=r,i=e.r(73041),s=e.r(92382);function a(e,t,r,n){var s=!1;if(t.resolvedType)if(t.resolvedType instanceof i){e("switch(d%s){",n);for(var a=t.resolvedType.values,o=Object.keys(a),l=0;l<o.length;++l)a[o[l]]!==t.typeDefault||s||(e("default:")('if(typeof(d%s)==="number"){m%s=d%s;break}',n,n,n),t.repeated||e("break"),s=!0),e("case%j:",o[l])("case %i:",a[o[l]])("m%s=%j",n,a[o[l]])("break");e("}")}else e('if(typeof d%s!=="object")',n)("throw TypeError(%j)",t.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",n,r,n);else{var u=!1;switch(t.type){case"double":case"float":e("m%s=Number(d%s)",n,n);break;case"uint32":case"fixed32":e("m%s=d%s>>>0",n,n);break;case"int32":case"sint32":case"sfixed32":e("m%s=d%s|0",n,n);break;case"uint64":u=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":e("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",n,n,u)('else if(typeof d%s==="string")',n)("m%s=parseInt(d%s,10)",n,n)('else if(typeof d%s==="number")',n)("m%s=d%s",n,n)('else if(typeof d%s==="object")',n)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",n,n,n,u?"true":"");break;case"bytes":e('if(typeof d%s==="string")',n)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",n,n,n)("else if(d%s.length >= 0)",n)("m%s=d%s",n,n);break;case"string":e("m%s=String(d%s)",n,n);break;case"bool":e("m%s=Boolean(d%s)",n,n)}}return e}function o(e,t,r,n){if(t.resolvedType)t.resolvedType instanceof i?e("d%s=o.enums===String?(types[%i].values[m%s]===undefined?m%s:types[%i].values[m%s]):m%s",n,r,n,n,r,n,n):e("d%s=types[%i].toObject(m%s,o)",n,r,n);else{var s=!1;switch(t.type){case"double":case"float":e("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",n,n,n,n);break;case"uint64":s=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":e('if(typeof m%s==="number")',n)("d%s=o.longs===String?String(m%s):m%s",n,n,n)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",n,n,n,n,s?"true":"",n);break;case"bytes":e("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",n,n,n,n,n);break;default:e("d%s=m%s",n,n)}}return e}n.fromObject=function(e){var t=e.fieldsArray,r=s.codegen(["d"],e.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!t.length)return r("return new this.ctor");r("var m=new this.ctor");for(var n=0;n<t.length;++n){var o=t[n].resolve(),l=s.safeProp(o.name);o.map?(r("if(d%s){",l)('if(typeof d%s!=="object")',l)("throw TypeError(%j)",o.fullName+": object expected")("m%s={}",l)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",l),a(r,o,n,l+"[ks[i]]")("}")("}")):o.repeated?(r("if(d%s){",l)("if(!Array.isArray(d%s))",l)("throw TypeError(%j)",o.fullName+": array expected")("m%s=[]",l)("for(var i=0;i<d%s.length;++i){",l),a(r,o,n,l+"[i]")("}")("}")):(o.resolvedType instanceof i||r("if(d%s!=null){",l),a(r,o,n,l),o.resolvedType instanceof i||r("}"))}return r("return m")},n.toObject=function(e){var t=e.fieldsArray.slice().sort(s.compareFieldsById);if(!t.length)return s.codegen()("return {}");for(var r=s.codegen(["m","o"],e.name+"$toObject")("if(!o)")("o={}")("var d={}"),n=[],a=[],l=[],u=0;u<t.length;++u)t[u].partOf||(t[u].resolve().repeated?n:t[u].map?a:l).push(t[u]);if(n.length){for(r("if(o.arrays||o.defaults){"),u=0;u<n.length;++u)r("d%s=[]",s.safeProp(n[u].name));r("}")}if(a.length){for(r("if(o.objects||o.defaults){"),u=0;u<a.length;++u)r("d%s={}",s.safeProp(a[u].name));r("}")}if(l.length){for(r("if(o.defaults){"),u=0;u<l.length;++u){var c=l[u],h=s.safeProp(c.name);if(c.resolvedType instanceof i)r("d%s=o.enums===String?%j:%j",h,c.resolvedType.valuesById[c.typeDefault],c.typeDefault);else if(c.long)r("if(util.Long){")("var n=new util.Long(%i,%i,%j)",c.typeDefault.low,c.typeDefault.high,c.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",h)("}else")("d%s=o.longs===String?%j:%i",h,c.typeDefault.toString(),c.typeDefault.toNumber());else if(c.bytes){var d="["+Array.prototype.slice.call(c.typeDefault).join(",")+"]";r("if(o.bytes===String)d%s=%j",h,String.fromCharCode.apply(String,c.typeDefault))("else{")("d%s=%s",h,d)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",h,h)("}")}else r("d%s=%j",h,c.typeDefault)}r("}")}var f=!1;for(u=0;u<t.length;++u){var c=t[u],p=e._fieldsArray.indexOf(c),h=s.safeProp(c.name);c.map?(f||(f=!0,r("var ks2")),r("if(m%s&&(ks2=Object.keys(m%s)).length){",h,h)("d%s={}",h)("for(var j=0;j<ks2.length;++j){"),o(r,c,p,h+"[ks2[j]]")("}")):c.repeated?(r("if(m%s&&m%s.length){",h,h)("d%s=[]",h)("for(var j=0;j<m%s.length;++j){",h),o(r,c,p,h+"[j]")("}")):(r("if(m%s!=null&&m.hasOwnProperty(%j)){",h,c.name),o(r,c,p,h),c.partOf&&r("if(o.oneofs)")("d%s=%j",s.safeProp(c.partOf.name),c.name)),r("}")}return r("return d")}},58946,(e,t,r)=>{"use strict";var n=r,i=e.r(57750);n[".google.protobuf.Any"]={fromObject:function(e){if(e&&e["@type"]){var t=e["@type"].substring(e["@type"].lastIndexOf("/")+1),r=this.lookup(t);if(r){var n="."===e["@type"].charAt(0)?e["@type"].slice(1):e["@type"];return -1===n.indexOf("/")&&(n="/"+n),this.create({type_url:n,value:r.encode(r.fromObject(e)).finish()})}}return this.fromObject(e)},toObject:function(e,t){var r="type.googleapis.com/",n="",s="";if(t&&t.json&&e.type_url&&e.value){s=e.type_url.substring(e.type_url.lastIndexOf("/")+1),n=e.type_url.substring(0,e.type_url.lastIndexOf("/")+1);var a=this.lookup(s);a&&(e=a.decode(e.value))}if(!(e instanceof this.ctor)&&e instanceof i){var o=e.$type.toObject(e,t),l="."===e.$type.fullName[0]?e.$type.fullName.slice(1):e.$type.fullName;return""===n&&(n=r),s=n+l,o["@type"]=s,o}return this.toObject(e,t)}}},41949,(e,t,r)=>{"use strict";t.exports=v;var n=e.r(51313);((v.prototype=Object.create(n.prototype)).constructor=v).className="Type";var i=e.r(73041),s=e.r(60633),a=e.r(7963),o=e.r(49854),l=e.r(50244),u=e.r(57750),c=e.r(65379),h=e.r(75624),d=e.r(92382),f=e.r(88336),p=e.r(98569),m=e.r(36670),g=e.r(5734),y=e.r(58946);function v(e,t){n.call(this,e,t),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}function b(e){return e._fieldsById=e._fieldsArray=e._oneofsArray=null,delete e.encode,delete e.decode,delete e.verify,e}Object.defineProperties(v.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var e=Object.keys(this.fields),t=0;t<e.length;++t){var r=this.fields[e[t]],n=r.id;if(this._fieldsById[n])throw Error("duplicate id "+n+" in "+this);this._fieldsById[n]=r}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=d.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=d.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=v.generateConstructor(this)())},set:function(e){var t=e.prototype;t instanceof u||((e.prototype=new u).constructor=e,d.merge(e.prototype,t)),e.$type=e.prototype.$type=this,d.merge(e,u,!0),this._ctor=e;for(var r=0;r<this.fieldsArray.length;++r)this._fieldsArray[r].resolve();var n={};for(r=0;r<this.oneofsArray.length;++r)n[this._oneofsArray[r].resolve().name]={get:d.oneOfGetter(this._oneofsArray[r].oneof),set:d.oneOfSetter(this._oneofsArray[r].oneof)};r&&Object.defineProperties(e.prototype,n)}}}),v.generateConstructor=function(e){for(var t,r=d.codegen(["p"],e.name),n=0;n<e.fieldsArray.length;++n)(t=e._fieldsArray[n]).map?r("this%s={}",d.safeProp(t.name)):t.repeated&&r("this%s=[]",d.safeProp(t.name));return r("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")},v.fromJSON=function(e,t){var r=new v(e,t.options);r.extensions=t.extensions,r.reserved=t.reserved;for(var u=Object.keys(t.fields),c=0;c<u.length;++c)r.add((void 0!==t.fields[u[c]].keyType?o.fromJSON:a.fromJSON)(u[c],t.fields[u[c]]));if(t.oneofs)for(u=Object.keys(t.oneofs),c=0;c<u.length;++c)r.add(s.fromJSON(u[c],t.oneofs[u[c]]));if(t.nested)for(u=Object.keys(t.nested),c=0;c<u.length;++c){var h=t.nested[u[c]];r.add((void 0!==h.id?a.fromJSON:void 0!==h.fields?v.fromJSON:void 0!==h.values?i.fromJSON:void 0!==h.methods?l.fromJSON:n.fromJSON)(u[c],h))}return t.extensions&&t.extensions.length&&(r.extensions=t.extensions),t.reserved&&t.reserved.length&&(r.reserved=t.reserved),t.group&&(r.group=!0),t.comment&&(r.comment=t.comment),t.edition&&(r._edition=t.edition),r._defaultEdition="proto3",r},v.prototype.toJSON=function(e){var t=n.prototype.toJSON.call(this,e),r=!!e&&!!e.keepComments;return d.toObject(["edition",this._editionToJSON(),"options",t&&t.options||void 0,"oneofs",n.arrayToJSON(this.oneofsArray,e),"fields",n.arrayToJSON(this.fieldsArray.filter(function(e){return!e.declaringField}),e)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])},v.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;n.prototype.resolveAll.call(this);var e=this.oneofsArray;for(r=0;r<e.length;)e[r++].resolve();for(var t=this.fieldsArray,r=0;r<t.length;)t[r++].resolve();return this},v.prototype._resolveFeaturesRecursive=function(e){return this._needsRecursiveFeatureResolution&&(e=this._edition||e,n.prototype._resolveFeaturesRecursive.call(this,e),this.oneofsArray.forEach(t=>{t._resolveFeatures(e)}),this.fieldsArray.forEach(t=>{t._resolveFeatures(e)})),this},v.prototype.get=function(e){return this.fields[e]||this.oneofs&&this.oneofs[e]||this.nested&&this.nested[e]||null},v.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);if(e instanceof a&&void 0===e.extend){if(this._fieldsById?this._fieldsById[e.id]:this.fieldsById[e.id])throw Error("duplicate id "+e.id+" in "+this);if(this.isReservedId(e.id))throw Error("id "+e.id+" is reserved in "+this);if(this.isReservedName(e.name))throw Error("name '"+e.name+"' is reserved in "+this);return e.parent&&e.parent.remove(e),this.fields[e.name]=e,e.message=this,e.onAdd(this),b(this)}return e instanceof s?(this.oneofs||(this.oneofs={}),this.oneofs[e.name]=e,e.onAdd(this),b(this)):n.prototype.add.call(this,e)},v.prototype.remove=function(e){if(e instanceof a&&void 0===e.extend){if(!this.fields||this.fields[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.fields[e.name],e.parent=null,e.onRemove(this),b(this)}if(e instanceof s){if(!this.oneofs||this.oneofs[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.oneofs[e.name],e.parent=null,e.onRemove(this),b(this)}return n.prototype.remove.call(this,e)},v.prototype.isReservedId=function(e){return n.isReservedId(this.reserved,e)},v.prototype.isReservedName=function(e){return n.isReservedName(this.reserved,e)},v.prototype.create=function(e){return new this.ctor(e)},v.prototype.setup=function(){for(var e=this.fullName,t=[],r=0;r<this.fieldsArray.length;++r)t.push(this._fieldsArray[r].resolve().resolvedType);this.encode=f(this)({Writer:h,types:t,util:d}),this.decode=p(this)({Reader:c,types:t,util:d}),this.verify=m(this)({types:t,util:d}),this.fromObject=g.fromObject(this)({types:t,util:d}),this.toObject=g.toObject(this)({types:t,util:d});var n=y[e];if(n){var i=Object.create(this);i.fromObject=this.fromObject,this.fromObject=n.fromObject.bind(i),i.toObject=this.toObject,this.toObject=n.toObject.bind(i)}return this},v.prototype.encode=function(e,t){return this.setup().encode(e,t)},v.prototype.encodeDelimited=function(e,t){return this.encode(e,t&&t.len?t.fork():t).ldelim()},v.prototype.decode=function(e,t){return this.setup().decode(e,t)},v.prototype.decodeDelimited=function(e){return e instanceof c||(e=c.create(e)),this.decode(e,e.uint32())},v.prototype.verify=function(e){return this.setup().verify(e)},v.prototype.fromObject=function(e){return this.setup().fromObject(e)},v.prototype.toObject=function(e,t){return this.setup().toObject(e,t)},v.d=function(e){return function(t){d.decorateType(t,e)}}},56536,(e,t,r)=>{"use strict";t.exports=h;var n,i,s,a=e.r(51313);((h.prototype=Object.create(a.prototype)).constructor=h).className="Root";var o=e.r(7963),l=e.r(73041),u=e.r(60633),c=e.r(92382);function h(e){a.call(this,"",e),this.deferred=[],this.files=[],this._edition="proto2",this._fullyQualifiedObjects={}}function d(){}h.fromJSON=function(e,t){return t||(t=new h),e.options&&t.setOptions(e.options),t.addJSON(e.nested).resolveAll()},h.prototype.resolvePath=c.path.resolve,h.prototype.fetch=c.fetch,h.prototype.load=function e(t,r,n){"function"==typeof r&&(n=r,r=void 0);var a=this;if(!n)return c.asPromise(e,a,t,r);var o=n===d;function l(e,t){if(n){if(o)throw e;t&&t.resolveAll();var r=n;n=null,r(e,t)}}function u(e){var t=e.lastIndexOf("google/protobuf/");if(t>-1){var r=e.substring(t);if(r in s)return r}return null}function h(e,t){try{if(c.isString(t)&&"{"===t.charAt(0)&&(t=JSON.parse(t)),c.isString(t)){i.filename=e;var n,s=i(t,a,r),h=0;if(s.imports)for(;h<s.imports.length;++h)(n=u(s.imports[h])||a.resolvePath(e,s.imports[h]))&&f(n);if(s.weakImports)for(h=0;h<s.weakImports.length;++h)(n=u(s.weakImports[h])||a.resolvePath(e,s.weakImports[h]))&&f(n,!0)}else a.setOptions(t.options).addJSON(t.nested)}catch(e){l(e)}o||p||l(null,a)}function f(e,t){if(e=u(e)||e,!(a.files.indexOf(e)>-1)){if(a.files.push(e),e in s)return void(o?h(e,s[e]):(++p,setTimeout(function(){--p,h(e,s[e])})));if(o){var r;try{r=c.fs.readFileSync(e).toString("utf8")}catch(e){t||l(e);return}h(e,r)}else++p,a.fetch(e,function(r,i){if(--p,n){if(r)return void(t?p||l(null,a):l(r));h(e,i)}})}}var p=0;c.isString(t)&&(t=[t]);for(var m,g=0;g<t.length;++g)(m=a.resolvePath("",t[g]))&&f(m);return o?a.resolveAll():p||l(null,a),a},h.prototype.loadSync=function(e,t){if(!c.isNode)throw Error("not supported");return this.load(e,t,d)},h.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(e){return"'extend "+e.extend+"' in "+e.parent.fullName}).join(", "));return a.prototype.resolveAll.call(this)};var f=/^[A-Z]/;function p(e,t){var r=t.parent.lookup(t.extend);if(r){var n=new o(t.fullName,t.id,t.type,t.rule,void 0,t.options);return!!r.get(n.name)||(n.declaringField=t,t.extensionField=n,r.add(n),!0)}return!1}h.prototype._handleAdd=function(e){if(e instanceof o)void 0===e.extend||e.extensionField||p(this,e)||this.deferred.push(e);else if(e instanceof l)f.test(e.name)&&(e.parent[e.name]=e.values);else if(!(e instanceof u)){if(e instanceof n)for(var t=0;t<this.deferred.length;)p(this,this.deferred[t])?this.deferred.splice(t,1):++t;for(var r=0;r<e.nestedArray.length;++r)this._handleAdd(e._nestedArray[r]);f.test(e.name)&&(e.parent[e.name]=e)}(e instanceof n||e instanceof l||e instanceof o)&&(this._fullyQualifiedObjects[e.fullName]=e)},h.prototype._handleRemove=function(e){if(e instanceof o){if(void 0!==e.extend)if(e.extensionField)e.extensionField.parent.remove(e.extensionField),e.extensionField=null;else{var t=this.deferred.indexOf(e);t>-1&&this.deferred.splice(t,1)}}else if(e instanceof l)f.test(e.name)&&delete e.parent[e.name];else if(e instanceof a){for(var r=0;r<e.nestedArray.length;++r)this._handleRemove(e._nestedArray[r]);f.test(e.name)&&delete e.parent[e.name]}delete this._fullyQualifiedObjects[e.fullName]},h._configure=function(e,t,r){n=e,i=t,s=r}},92382,(e,t,r)=>{"use strict";var n,i,s=t.exports=e.r(64172),a=e.r(19089);s.codegen=e.r(54517),s.fetch=e.r(65257),s.path=e.r(62400),s.fs=s.inquire("fs"),s.toArray=function(e){if(e){for(var t=Object.keys(e),r=Array(t.length),n=0;n<t.length;)r[n]=e[t[n++]];return r}return[]},s.toObject=function(e){for(var t={},r=0;r<e.length;){var n=e[r++],i=e[r++];void 0!==i&&(t[n]=i)}return t};var o=/\\/g,l=/"/g;s.isReserved=function(e){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(e)},s.safeProp=function(e){return!/^[$\w_]+$/.test(e)||s.isReserved(e)?'["'+e.replace(o,"\\\\").replace(l,'\\"')+'"]':"."+e},s.ucFirst=function(e){return e.charAt(0).toUpperCase()+e.substring(1)};var u=/_([a-z])/g;s.camelCase=function(e){return e.substring(0,1)+e.substring(1).replace(u,function(e,t){return t.toUpperCase()})},s.compareFieldsById=function(e,t){return e.id-t.id},s.decorateType=function(t,r){if(t.$type)return r&&t.$type.name!==r&&(s.decorateRoot.remove(t.$type),t.$type.name=r,s.decorateRoot.add(t.$type)),t.$type;n||(n=e.r(41949));var i=new n(r||t.name);return s.decorateRoot.add(i),i.ctor=t,Object.defineProperty(t,"$type",{value:i,enumerable:!1}),Object.defineProperty(t.prototype,"$type",{value:i,enumerable:!1}),i};var c=0;s.decorateEnum=function(t){if(t.$type)return t.$type;i||(i=e.r(73041));var r=new i("Enum"+c++,t);return s.decorateRoot.add(r),Object.defineProperty(t,"$type",{value:r,enumerable:!1}),r},s.setProperty=function(e,t,r,n){function i(e,t,r){var s=t.shift();if("__proto__"===s||"prototype"===s)return e;if(t.length>0)e[s]=i(e[s]||{},t,r);else{var a=e[s];if(a&&n)return e;a&&(r=[].concat(a).concat(r)),e[s]=r}return e}if("object"!=typeof e)throw TypeError("dst must be an object");if(!t)throw TypeError("path must be specified");return i(e,t=t.split("."),r)},Object.defineProperty(s,"decorateRoot",{get:function(){return a.decorated||(a.decorated=new(e.r(56536)))}})},4178,(e,t,r)=>{"use strict";var n=r,i=e.r(92382),s=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function a(e,t){var r=0,n={};for(t|=0;r<e.length;)n[s[r+t]]=e[r++];return n}n.basic=a([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]),n.defaults=a([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",i.emptyArray,null]),n.long=a([0,0,0,1,1],7),n.mapKey=a([0,0,0,5,5,0,0,0,1,1,0,2],2),n.packed=a([1,5,0,0,0,5,5,0,0,0,1,1,0])},7963,(e,t,r)=>{"use strict";t.exports=u;var n,i=e.r(41684);((u.prototype=Object.create(i.prototype)).constructor=u).className="Field";var s=e.r(73041),a=e.r(4178),o=e.r(92382),l=/^required|optional|repeated$/;function u(e,t,r,n,s,u,c){if(o.isObject(n)?(c=s,u=n,n=s=void 0):o.isObject(s)&&(c=u,u=s,s=void 0),i.call(this,e,u),!o.isInteger(t)||t<0)throw TypeError("id must be a non-negative integer");if(!o.isString(r))throw TypeError("type must be a string");if(void 0!==n&&!l.test(n=n.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(void 0!==s&&!o.isString(s))throw TypeError("extend must be a string");"proto3_optional"===n&&(n="optional"),this.rule=n&&"optional"!==n?n:void 0,this.type=r,this.id=t,this.extend=s||void 0,this.repeated="repeated"===n,this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=!!o.Long&&void 0!==a.long[r],this.bytes="bytes"===r,this.resolvedType=null,this.extensionField=null,this.declaringField=null,this.comment=c}u.fromJSON=function(e,t){var r=new u(e,t.id,t.type,t.rule,t.extend,t.options,t.comment);return t.edition&&(r._edition=t.edition),r._defaultEdition="proto3",r},Object.defineProperty(u.prototype,"required",{get:function(){return"LEGACY_REQUIRED"===this._features.field_presence}}),Object.defineProperty(u.prototype,"optional",{get:function(){return!this.required}}),Object.defineProperty(u.prototype,"delimited",{get:function(){return this.resolvedType instanceof n&&"DELIMITED"===this._features.message_encoding}}),Object.defineProperty(u.prototype,"packed",{get:function(){return"PACKED"===this._features.repeated_field_encoding}}),Object.defineProperty(u.prototype,"hasPresence",{get:function(){return!this.repeated&&!this.map&&(this.partOf||this.declaringField||this.extensionField||"IMPLICIT"!==this._features.field_presence)}}),u.prototype.setOption=function(e,t,r){return i.prototype.setOption.call(this,e,t,r)},u.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return o.toObject(["edition",this._editionToJSON(),"rule","optional"!==this.rule&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])},u.prototype.resolve=function(){if(this.resolved)return this;if(void 0===(this.typeDefault=a.defaults[this.type])?(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof n?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]):this.options&&this.options.proto3_optional&&(this.typeDefault=null),this.options&&null!=this.options.default&&(this.typeDefault=this.options.default,this.resolvedType instanceof s&&"string"==typeof this.typeDefault&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&(void 0===this.options.packed||!this.resolvedType||this.resolvedType instanceof s||delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=o.Long.fromNumber(this.typeDefault,"u"===this.type.charAt(0)),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&"string"==typeof this.typeDefault){var e;o.base64.test(this.typeDefault)?o.base64.decode(this.typeDefault,e=o.newBuffer(o.base64.length(this.typeDefault)),0):o.utf8.write(this.typeDefault,e=o.newBuffer(o.utf8.length(this.typeDefault)),0),this.typeDefault=e}return this.map?this.defaultValue=o.emptyObject:this.repeated?this.defaultValue=o.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof n&&(this.parent.ctor.prototype[this.name]=this.defaultValue),i.prototype.resolve.call(this)},u.prototype._inferLegacyProtoFeatures=function(e){if("proto2"!==e&&"proto3"!==e)return{};var t={};if("required"===this.rule&&(t.field_presence="LEGACY_REQUIRED"),this.parent&&void 0===a.defaults[this.type]){var r=this.parent.get(this.type.split(".").pop());r&&r instanceof n&&r.group&&(t.message_encoding="DELIMITED")}return!0===this.getOption("packed")?t.repeated_field_encoding="PACKED":!1===this.getOption("packed")&&(t.repeated_field_encoding="EXPANDED"),t},u.prototype._resolveFeatures=function(e){return i.prototype._resolveFeatures.call(this,this._edition||e)},u.d=function(e,t,r,n){return"function"==typeof t?t=o.decorateType(t).name:t&&"object"==typeof t&&(t=o.decorateEnum(t).name),function(i,s){o.decorateType(i.constructor).add(new u(s,e,t,r,{default:n}))}},u._configure=function(e){n=e}},60633,(e,t,r)=>{"use strict";t.exports=a;var n=e.r(41684);((a.prototype=Object.create(n.prototype)).constructor=a).className="OneOf";var i=e.r(7963),s=e.r(92382);function a(e,t,r,i){if(Array.isArray(t)||(r=t,t=void 0),n.call(this,e,r),!(void 0===t||Array.isArray(t)))throw TypeError("fieldNames must be an Array");this.oneof=t||[],this.fieldsArray=[],this.comment=i}function o(e){if(e.parent)for(var t=0;t<e.fieldsArray.length;++t)e.fieldsArray[t].parent||e.parent.add(e.fieldsArray[t])}a.fromJSON=function(e,t){return new a(e,t.oneof,t.options,t.comment)},a.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return s.toObject(["options",this.options,"oneof",this.oneof,"comment",t?this.comment:void 0])},a.prototype.add=function(e){if(!(e instanceof i))throw TypeError("field must be a Field");return e.parent&&e.parent!==this.parent&&e.parent.remove(e),this.oneof.push(e.name),this.fieldsArray.push(e),e.partOf=this,o(this),this},a.prototype.remove=function(e){if(!(e instanceof i))throw TypeError("field must be a Field");var t=this.fieldsArray.indexOf(e);if(t<0)throw Error(e+" is not a member of "+this);return this.fieldsArray.splice(t,1),(t=this.oneof.indexOf(e.name))>-1&&this.oneof.splice(t,1),e.partOf=null,this},a.prototype.onAdd=function(e){n.prototype.onAdd.call(this,e);for(var t=this,r=0;r<this.oneof.length;++r){var i=e.get(this.oneof[r]);i&&!i.partOf&&(i.partOf=t,t.fieldsArray.push(i))}o(this)},a.prototype.onRemove=function(e){for(var t,r=0;r<this.fieldsArray.length;++r)(t=this.fieldsArray[r]).parent&&t.parent.remove(t);n.prototype.onRemove.call(this,e)},Object.defineProperty(a.prototype,"isProto3Optional",{get:function(){if(null==this.fieldsArray||1!==this.fieldsArray.length)return!1;var e=this.fieldsArray[0];return null!=e.options&&!0===e.options.proto3_optional}}),a.d=function(){for(var e=Array(arguments.length),t=0;t<arguments.length;)e[t]=arguments[t++];return function(t,r){s.decorateType(t.constructor).add(new a(r,e)),Object.defineProperty(t,r,{get:s.oneOfGetter(e),set:s.oneOfSetter(e)})}}},41684,(e,t,r)=>{"use strict";t.exports=u,u.className="ReflectionObject";let n=e.r(60633);var i,s=e.r(92382),a={enum_type:"OPEN",field_presence:"EXPLICIT",json_format:"ALLOW",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"PACKED",utf8_validation:"VERIFY"},o={enum_type:"CLOSED",field_presence:"EXPLICIT",json_format:"LEGACY_BEST_EFFORT",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"EXPANDED",utf8_validation:"NONE"},l={enum_type:"OPEN",field_presence:"IMPLICIT",json_format:"ALLOW",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"PACKED",utf8_validation:"VERIFY"};function u(e,t){if(!s.isString(e))throw TypeError("name must be a string");if(t&&!s.isObject(t))throw TypeError("options must be an object");this.options=t,this.parsedOptions=null,this.name=e,this._edition=null,this._defaultEdition="proto2",this._features={},this._featuresResolved=!1,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(u.prototype,{root:{get:function(){for(var e=this;null!==e.parent;)e=e.parent;return e}},fullName:{get:function(){for(var e=[this.name],t=this.parent;t;)e.unshift(t.name),t=t.parent;return e.join(".")}}}),u.prototype.toJSON=function(){throw Error()},u.prototype.onAdd=function(e){this.parent&&this.parent!==e&&this.parent.remove(this),this.parent=e,this.resolved=!1;var t=e.root;t instanceof i&&t._handleAdd(this)},u.prototype.onRemove=function(e){var t=e.root;t instanceof i&&t._handleRemove(this),this.parent=null,this.resolved=!1},u.prototype.resolve=function(){return this.resolved||this.root instanceof i&&(this.resolved=!0),this},u.prototype._resolveFeaturesRecursive=function(e){return this._resolveFeatures(this._edition||e)},u.prototype._resolveFeatures=function(e){if(!this._featuresResolved){var t={};if(!e)throw Error("Unknown edition for "+this.fullName);var r=Object.assign(this.options?Object.assign({},this.options.features):{},this._inferLegacyProtoFeatures(e));if(this._edition){if("proto2"===e)t=Object.assign({},o);else if("proto3"===e)t=Object.assign({},l);else if("2023"===e)t=Object.assign({},a);else throw Error("Unknown edition: "+e);this._features=Object.assign(t,r||{}),this._featuresResolved=!0;return}if(this.partOf instanceof n){var i=Object.assign({},this.partOf._features);this._features=Object.assign(i,r||{})}else if(this.declaringField);else if(this.parent){var s=Object.assign({},this.parent._features);this._features=Object.assign(s,r||{})}else throw Error("Unable to find a parent for "+this.fullName);this.extensionField&&(this.extensionField._features=this._features),this._featuresResolved=!0}},u.prototype._inferLegacyProtoFeatures=function(){return{}},u.prototype.getOption=function(e){if(this.options)return this.options[e]},u.prototype.setOption=function(e,t,r){return this.options||(this.options={}),/^features\./.test(e)?s.setProperty(this.options,e,t,r):r&&void 0!==this.options[e]||(this.getOption(e)!==t&&(this.resolved=!1),this.options[e]=t),this},u.prototype.setParsedOption=function(e,t,r){this.parsedOptions||(this.parsedOptions=[]);var n=this.parsedOptions;if(r){var i=n.find(function(t){return Object.prototype.hasOwnProperty.call(t,e)});if(i){var a=i[e];s.setProperty(a,r,t)}else(i={})[e]=s.setProperty({},r,t),n.push(i)}else{var o={};o[e]=t,n.push(o)}return this},u.prototype.setOptions=function(e,t){if(e)for(var r=Object.keys(e),n=0;n<r.length;++n)this.setOption(r[n],e[r[n]],t);return this},u.prototype.toString=function(){var e=this.constructor.className,t=this.fullName;return t.length?e+" "+t:e},u.prototype._editionToJSON=function(){if(this._edition&&"proto3"!==this._edition)return this._edition},u._configure=function(e){i=e}},73041,(e,t,r)=>{"use strict";t.exports=a;var n=e.r(41684);((a.prototype=Object.create(n.prototype)).constructor=a).className="Enum";var i=e.r(51313),s=e.r(92382);function a(e,t,r,i,s,a){if(n.call(this,e,r),t&&"object"!=typeof t)throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=i,this.comments=s||{},this.valuesOptions=a,this._valuesFeatures={},this.reserved=void 0,t)for(var o=Object.keys(t),l=0;l<o.length;++l)"number"==typeof t[o[l]]&&(this.valuesById[this.values[o[l]]=t[o[l]]]=o[l])}a.prototype._resolveFeatures=function(e){return e=this._edition||e,n.prototype._resolveFeatures.call(this,e),Object.keys(this.values).forEach(e=>{var t=Object.assign({},this._features);this._valuesFeatures[e]=Object.assign(t,this.valuesOptions&&this.valuesOptions[e]&&this.valuesOptions[e].features)}),this},a.fromJSON=function(e,t){var r=new a(e,t.values,t.options,t.comment,t.comments);return r.reserved=t.reserved,t.edition&&(r._edition=t.edition),r._defaultEdition="proto3",r},a.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return s.toObject(["edition",this._editionToJSON(),"options",this.options,"valuesOptions",this.valuesOptions,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",t?this.comment:void 0,"comments",t?this.comments:void 0])},a.prototype.add=function(e,t,r,n){if(!s.isString(e))throw TypeError("name must be a string");if(!s.isInteger(t))throw TypeError("id must be an integer");if(void 0!==this.values[e])throw Error("duplicate name '"+e+"' in "+this);if(this.isReservedId(t))throw Error("id "+t+" is reserved in "+this);if(this.isReservedName(e))throw Error("name '"+e+"' is reserved in "+this);if(void 0!==this.valuesById[t]){if(!(this.options&&this.options.allow_alias))throw Error("duplicate id "+t+" in "+this);this.values[e]=t}else this.valuesById[this.values[e]=t]=e;return n&&(void 0===this.valuesOptions&&(this.valuesOptions={}),this.valuesOptions[e]=n||null),this.comments[e]=r||null,this},a.prototype.remove=function(e){if(!s.isString(e))throw TypeError("name must be a string");var t=this.values[e];if(null==t)throw Error("name '"+e+"' does not exist in "+this);return delete this.valuesById[t],delete this.values[e],delete this.comments[e],this.valuesOptions&&delete this.valuesOptions[e],this},a.prototype.isReservedId=function(e){return i.isReservedId(this.reserved,e)},a.prototype.isReservedName=function(e){return i.isReservedName(this.reserved,e)}},88336,(e,t,r)=>{"use strict";t.exports=o;var n=e.r(73041),i=e.r(4178),s=e.r(92382);function a(e,t,r,n){return t.delimited?e("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",r,n,(t.id<<3|3)>>>0,(t.id<<3|4)>>>0):e("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",r,n,(t.id<<3|2)>>>0)}function o(e){for(var t,r,o=s.codegen(["m","w"],e.name+"$encode")("if(!w)")("w=Writer.create()"),l=e.fieldsArray.slice().sort(s.compareFieldsById),t=0;t<l.length;++t){var u=l[t].resolve(),c=e._fieldsArray.indexOf(u),h=u.resolvedType instanceof n?"int32":u.type,d=i.basic[h];r="m"+s.safeProp(u.name),u.map?(o("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",r,u.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",r)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(u.id<<3|2)>>>0,8|i.mapKey[u.keyType],u.keyType),void 0===d?o("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",c,r):o(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|d,h,r),o("}")("}")):u.repeated?(o("if(%s!=null&&%s.length){",r,r),u.packed&&void 0!==i.packed[h]?o("w.uint32(%i).fork()",(u.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",r)("w.%s(%s[i])",h,r)("w.ldelim()"):(o("for(var i=0;i<%s.length;++i)",r),void 0===d?a(o,u,c,r+"[i]"):o("w.uint32(%i).%s(%s[i])",(u.id<<3|d)>>>0,h,r)),o("}")):(u.optional&&o("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",r,u.name),void 0===d?a(o,u,c,r):o("w.uint32(%i).%s(%s)",(u.id<<3|d)>>>0,h,r))}return o("return w")}},32885,(e,t,r)=>{"use strict";t.exports=s;var n=e.r(75624);(s.prototype=Object.create(n.prototype)).constructor=s;var i=e.r(64172);function s(){n.call(this)}function a(e,t,r){e.length<40?i.utf8.write(e,t,r):t.utf8Write?t.utf8Write(e,r):t.write(e,r)}s._configure=function(){s.alloc=i._Buffer_allocUnsafe,s.writeBytesBuffer=i.Buffer&&i.Buffer.prototype instanceof Uint8Array&&"set"===i.Buffer.prototype.set.name?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var n=0;n<e.length;)t[r++]=e[n++]}},s.prototype.bytes=function(e){i.isString(e)&&(e=i._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(s.writeBytesBuffer,t,e),this},s.prototype.string=function(e){var t=i.Buffer.byteLength(e);return this.uint32(t),t&&this._push(a,t,e),this},s._configure()},37299,(e,t,r)=>{"use strict";t.exports=s;var n=e.r(65379);(s.prototype=Object.create(n.prototype)).constructor=s;var i=e.r(64172);function s(e){n.call(this,e)}s._configure=function(){i.Buffer&&(s.prototype._slice=i.Buffer.prototype.slice)},s.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},s._configure()},51288,(e,t,r)=>{"use strict";var n=r;function i(){n.util._configure(),n.Writer._configure(n.BufferWriter),n.Reader._configure(n.BufferReader)}n.build="minimal",n.Writer=e.r(75624),n.BufferWriter=e.r(32885),n.Reader=e.r(65379),n.BufferReader=e.r(37299),n.util=e.r(64172),n.rpc=e.r(31116),n.roots=e.r(19089),n.configure=i,i()},28134,(e,t,r)=>{"use strict";var n=t.exports=e.r(51288);function i(e,t,r){return"function"==typeof t?(r=t,t=new n.Root):t||(t=new n.Root),t.load(e,r)}function s(e,t){return t||(t=new n.Root),t.loadSync(e)}n.build="light",n.load=i,n.loadSync=s,n.encoder=e.r(88336),n.decoder=e.r(98569),n.verifier=e.r(36670),n.converter=e.r(5734),n.ReflectionObject=e.r(41684),n.Namespace=e.r(51313),n.Root=e.r(56536),n.Enum=e.r(73041),n.Type=e.r(41949),n.Field=e.r(7963),n.OneOf=e.r(60633),n.MapField=e.r(49854),n.Service=e.r(50244),n.Method=e.r(78966),n.Message=e.r(57750),n.wrappers=e.r(58946),n.types=e.r(4178),n.util=e.r(92382),n.ReflectionObject._configure(n.Root),n.Namespace._configure(n.Type,n.Service,n.Enum),n.Root._configure(n.Type),n.Field._configure(n.Type)},17503,(e,t,r)=>{"use strict";t.exports=f;var n=/[\s{}=;:[\],'"()<>]/g,i=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,s=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,a=/^ *[*/]+ */,o=/^\s*\*?\/*/,l=/\n/g,u=/\s/,c=/\\(.?)/g,h={0:"\0",r:"\r",n:"\n",t:"	"};function d(e){return e.replace(c,function(e,t){switch(t){case"\\":case"":return t;default:return h[t]||""}})}function f(e,t){e=e.toString();var r=0,c=e.length,h=1,f=0,p={},m=[],g=null;function y(e){return Error("illegal "+e+" (line "+h+")")}function v(){var t="'"===g?s:i;t.lastIndex=r-1;var n=t.exec(e);if(!n)throw y("string");return r=t.lastIndex,E(g),g=null,d(n[1])}function b(t){return e.charAt(t)}function S(r,n,i){var s,u={type:e.charAt(r++),lineEmpty:!1,leading:i},c=r-(t?2:3);do if(--c<0||"\n"===(s=e.charAt(c))){u.lineEmpty=!0;break}while(" "===s||"	"===s)for(var d=e.substring(r,n).split(l),m=0;m<d.length;++m)d[m]=d[m].replace(t?o:a,"").trim();u.text=d.join("\n").trim(),p[h]=u,f=h}function w(t){var r=C(t),n=e.substring(t,r);return/^\s*\/\//.test(n)}function C(e){for(var t=e;t<c&&"\n"!==b(t);)t++;return t}function T(){if(m.length>0)return m.shift();if(g)return v();var i,s,a,o,l,d=0===r;do{if(r===c)return null;for(i=!1;u.test(a=b(r));)if("\n"===a&&(d=!0,++h),++r===c)return null;if("/"===b(r)){if(++r===c)throw y("comment");if("/"===b(r))if(t){if(o=r,l=!1,w(r-1)){l=!0;do if((r=C(r))===c||(r++,!d))break;while(w(r))}else r=Math.min(c,C(r)+1);l&&(S(o,r,d),d=!0),h++,i=!0}else{for(l="/"===b(o=r+1);"\n"!==b(++r);)if(r===c)return null;++r,l&&(S(o,r-1,d),d=!0),++h,i=!0}else{if("*"!==(a=b(r)))return"/";o=r+1,l=t||"*"===b(o);do{if("\n"===a&&++h,++r===c)throw y("comment");s=a,a=b(r)}while("*"!==s||"/"!==a)++r,l&&(S(o,r-2,d),d=!0),i=!0}}}while(i)var f=r;if(n.lastIndex=0,!n.test(b(f++)))for(;f<c&&!n.test(b(f));)++f;var p=e.substring(r,r=f);return('"'===p||"'"===p)&&(g=p),p}function E(e){m.push(e)}function _(){if(!m.length){var e=T();if(null===e)return null;E(e)}return m[0]}function I(e,t){var r=_();if(r===e)return T(),!0;if(!t)throw y("token '"+r+"', '"+e+"' expected");return!1}function k(e){var r,n=null;return void 0===e?(r=p[h-1],delete p[h-1],r&&(t||"*"===r.type||r.lineEmpty)&&(n=r.leading?r.text:null)):(f<e&&_(),r=p[e],delete p[e],r&&!r.lineEmpty&&(t||"/"===r.type)&&(n=r.leading?null:r.text)),n}return Object.defineProperty({next:T,peek:_,push:E,skip:I,cmnt:k},"line",{get:function(){return h}})}f.unescape=d},32479,(e,t,r)=>{"use strict";t.exports=E,E.filename=null,E.defaults={keepCase:!1};var n=e.r(17503),i=e.r(56536),s=e.r(41949),a=e.r(7963),o=e.r(49854),l=e.r(60633),u=e.r(73041),c=e.r(50244),h=e.r(78966),d=e.r(41684),f=e.r(4178),p=e.r(92382),m=/^[1-9][0-9]*$/,g=/^-?[1-9][0-9]*$/,y=/^0[x][0-9a-fA-F]+$/,v=/^-?0[x][0-9a-fA-F]+$/,b=/^0[0-7]+$/,S=/^-?0[0-7]+$/,w=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,C=/^[a-zA-Z_][a-zA-Z_0-9]*$/,T=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/;function E(e,t,r){t instanceof i||(r=t,t=new i),r||(r=E.defaults);var _,I,k,x,R=r.preferTrailingComment||!1,D=n(e,r.alternateCommentMode||!1),A=D.next,O=D.push,N=D.peek,P=D.skip,M=D.cmnt,L=!0,B="proto2",F=t,j=[],V={},z=r.keepCase?function(e){return e}:p.camelCase;function q(){j.forEach(e=>{e._edition=B,Object.keys(V).forEach(t=>{void 0===e.getOption(t)&&e.setOption(t,V[t],!0)})})}function U(e,t,r){var n=E.filename;return r||(E.filename=null),Error("illegal "+(t||"token")+" '"+e+"' ("+(n?n+", ":"")+"line "+D.line+")")}function $(){var e,t=[];do{if('"'!==(e=A())&&"'"!==e)throw U(e);t.push(A()),P(e),e=N()}while('"'===e||"'"===e)return t.join("")}function K(e){var t=A();switch(t){case"'":case'"':return O(t),$();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return G(t,!0)}catch(r){if(e&&T.test(t))return t;throw U(t,"value")}}function W(e,t){do if(t&&('"'===(r=N())||"'"===r)){var r,n,i=$();if(e.push(i),B>=2023)throw U(i,"id")}else try{e.push([n=H(A()),P("to",!0)?H(A()):n])}catch(n){if(t&&T.test(r)&&B>=2023)e.push(r);else throw n}while(P(",",!0))var s={options:void 0};s.setOption=function(e,t){void 0===this.options&&(this.options={}),this.options[e]=t},ee(s,function(e){if("option"===e)el(s,e),P(";");else throw U(e)},function(){ed(s)})}function G(e,t){var r=1;switch("-"===e.charAt(0)&&(r=-1,e=e.substring(1)),e){case"inf":case"INF":case"Inf":return 1/0*r;case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(m.test(e))return r*parseInt(e,10);if(y.test(e))return r*parseInt(e,16);if(b.test(e))return r*parseInt(e,8);if(w.test(e))return r*parseFloat(e);throw U(e,"number",t)}function H(e,t){switch(e){case"max":case"MAX":case"Max":return 0x1fffffff;case"0":return 0}if(!t&&"-"===e.charAt(0))throw U(e,"id");if(g.test(e))return parseInt(e,10);if(v.test(e))return parseInt(e,16);if(S.test(e))return parseInt(e,8);throw U(e,"id")}function Q(){if(void 0!==I)throw U("package");if(I=A(),!T.test(I))throw U(I,"name");F=F.define(I),P(";")}function J(){var e,t=N();switch(t){case"weak":e=x||(x=[]),A();break;case"public":A();default:e=k||(k=[])}t=$(),P(";"),e.push(t)}function Y(){if(P("="),(B=$())<2023)throw U(B,"syntax");P(";")}function X(){if(P("="),!["2023"].includes(B=$()))throw U(B,"edition");P(";")}function Z(e,t){switch(t){case"option":return el(e,t),P(";"),!0;case"message":return et(e,t),!0;case"enum":return ea(e,t),!0;case"service":return ef(e,t),!0;case"extend":return em(e,t),!0}return!1}function ee(e,t,r){var n,i=D.line;if(e&&("string"!=typeof e.comment&&(e.comment=M()),e.filename=E.filename),P("{",!0)){for(;"}"!==(n=A());)t(n);P(";",!0)}else r&&r(),P(";"),e&&("string"!=typeof e.comment||R)&&(e.comment=M(i)||e.comment)}function et(e,t){if(!C.test(t=A()))throw U(t,"type name");var r=new s(t);ee(r,function(e){if(!Z(r,e))switch(e){case"map":ei(r,e);break;case"required":if("proto2"!==B)throw U(e);case"repeated":er(r,e);break;case"optional":if("proto3"===B)er(r,"proto3_optional");else if("proto2"!==B)throw U(e);else er(r,"optional");break;case"oneof":es(r,e);break;case"extensions":W(r.extensions||(r.extensions=[]));break;case"reserved":W(r.reserved||(r.reserved=[]),!0);break;default:if("proto2"===B||!T.test(e))throw U(e);O(e),er(r,"optional")}}),e.add(r),e===F&&j.push(r)}function er(e,t,r){var n=A();if("group"===n)return void en(e,t);for(;n.endsWith(".")||N().startsWith(".");)n+=A();if(!T.test(n))throw U(n,"type");var i=A();if(!C.test(i))throw U(i,"name");i=z(i),P("=");var s=new a(i,H(A()),n,t,r);if(ee(s,function(e){if("option"===e)el(s,e),P(";");else throw U(e)},function(){ed(s)}),"proto3_optional"===t){var o=new l("_"+i);s.setOption("proto3_optional",!0),o.add(s),e.add(o)}else e.add(s);e===F&&j.push(s)}function en(e,t){if(B>=2023)throw U("group");var r=A();if(!C.test(r))throw U(r,"name");var n=p.lcFirst(r);r===n&&(r=p.ucFirst(r)),P("=");var i=H(A()),o=new s(r);o.group=!0;var l=new a(n,i,r,t);l.filename=E.filename,ee(o,function(e){switch(e){case"option":el(o,e),P(";");break;case"required":case"repeated":er(o,e);break;case"optional":"proto3"===B?er(o,"proto3_optional"):er(o,"optional");break;case"message":et(o,e);break;case"enum":ea(o,e);break;case"reserved":W(o.reserved||(o.reserved=[]),!0);break;default:throw U(e)}}),e.add(o).add(l)}function ei(e){P("<");var t=A();if(void 0===f.mapKey[t])throw U(t,"type");P(",");var r=A();if(!T.test(r))throw U(r,"type");P(">");var n=A();if(!C.test(n))throw U(n,"name");P("=");var i=new o(z(n),H(A()),t,r);ee(i,function(e){if("option"===e)el(i,e),P(";");else throw U(e)},function(){ed(i)}),e.add(i)}function es(e,t){if(!C.test(t=A()))throw U(t,"name");var r=new l(z(t));ee(r,function(e){"option"===e?(el(r,e),P(";")):(O(e),er(r,"optional"))}),e.add(r)}function ea(e,t){if(!C.test(t=A()))throw U(t,"name");var r=new u(t);ee(r,function(e){switch(e){case"option":el(r,e),P(";");break;case"reserved":W(r.reserved||(r.reserved=[]),!0),void 0===r.reserved&&(r.reserved=[]);break;default:eo(r,e)}}),e.add(r),e===F&&j.push(r)}function eo(e,t){if(!C.test(t))throw U(t,"name");P("=");var r=H(A(),!0),n={options:void 0};n.getOption=function(e){return this.options[e]},n.setOption=function(e,t){d.prototype.setOption.call(n,e,t)},n.setParsedOption=function(){},ee(n,function(e){if("option"===e)el(n,e),P(";");else throw U(e)},function(){ed(n)}),e.add(t,r,n.comment,n.parsedOptions||n.options)}function el(e,t){var r,n,i=!0;for("option"===t&&(t=A());"="!==t;){if("("===t){var s=A();P(")"),t="("+s+")"}if(i){if(i=!1,t.includes(".")&&!t.includes("(")){var a=t.split(".");r=a[0]+".",t=a[1];continue}r=t}else n=n?n+=t:t;t=A()}var o=eu(e,n?r.concat(n):r);n=n&&"."===n[0]?n.slice(1):n,eh(e,r=r&&"."===r[r.length-1]?r.slice(0,-1):r,o,n)}function eu(e,t){if(P("{",!0)){for(var r={};!P("}",!0);){if(!C.test(_=A()))throw U(_,"name");if(null===_)throw U(_,"end of input");var n,i,s=_;if(P(":",!0),"{"===N())n=eu(e,t+"."+_);else if("["===N()){if(n=[],P("[",!0)){do i=K(!0),n.push(i);while(P(",",!0))P("]"),void 0!==i&&ec(e,t+"."+_,i)}}else n=K(!0),ec(e,t+"."+_,n);var a=r[s];a&&(n=[].concat(a).concat(n)),r[s]=n,P(",",!0),P(";",!0)}return r}var o=K(!0);return ec(e,t,o),o}function ec(e,t,r){if(F===e&&/^features\./.test(t)){V[t]=r;return}e.setOption&&e.setOption(t,r)}function eh(e,t,r,n){e.setParsedOption&&e.setParsedOption(t,r,n)}function ed(e){if(P("[",!0)){do el(e,"option");while(P(",",!0))P("]")}return e}function ef(e,t){if(!C.test(t=A()))throw U(t,"service name");var r=new c(t);ee(r,function(e){if(!Z(r,e))if("rpc"===e)ep(r,e);else throw U(e)}),e.add(r),e===F&&j.push(r)}function ep(e,t){var r=M(),n=t;if(!C.test(t=A()))throw U(t,"name");var i,s,a,o,l=t;if(P("("),P("stream",!0)&&(s=!0),!T.test(t=A())||(i=t,P(")"),P("returns"),P("("),P("stream",!0)&&(o=!0),!T.test(t=A())))throw U(t);a=t,P(")");var u=new h(l,n,i,a,s,o);u.comment=r,ee(u,function(e){if("option"===e)el(u,e),P(";");else throw U(e)}),e.add(u)}function em(e,t){if(!T.test(t=A()))throw U(t,"reference");var r=t;ee(null,function(t){switch(t){case"required":case"repeated":er(e,t,r);break;case"optional":"proto3"===B?er(e,"proto3_optional",r):er(e,"optional",r);break;default:if("proto2"===B||!T.test(t))throw U(t);O(t),er(e,"optional",r)}})}for(;null!==(_=A());)switch(_){case"package":if(!L)throw U(_);Q();break;case"import":if(!L)throw U(_);J();break;case"syntax":if(!L)throw U(_);Y();break;case"edition":if(!L)throw U(_);X();break;case"option":el(F,_),P(";",!0);break;default:if(Z(F,_)){L=!1;continue}throw U(_)}return q(),E.filename=null,{package:I,imports:k,weakImports:x,root:t}}},94315,(e,t,r)=>{"use strict";t.exports=s;var n,i=/\/|\./;function s(e,t){i.test(e)||(e="google/protobuf/"+e+".proto",t={nested:{google:{nested:{protobuf:{nested:t}}}}}),s[e]=t}s("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}}),s("duration",{Duration:n={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}}),s("timestamp",{Timestamp:n}),s("empty",{Empty:{fields:{}}}),s("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}}),s("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}}),s("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}}),s.get=function(e){return s[e]||null}},94899,(e,t,r)=>{"use strict";var n=t.exports=e.r(28134);n.build="full",n.tokenize=e.r(17503),n.parse=e.r(32479),n.common=e.r(94315),n.Root._configure(n.Type,n.parse,n.common)},30669,(e,t,r)=>{"use strict";t.exports=e.r(94899)},92648,(e,t,r)=>{"use strict";var n=e.r(30669);t.exports=r=n.descriptor=n.Root.fromJSON(e.r(66700)).lookup(".google.protobuf");var i=n.Namespace,s=n.Root,a=n.Enum,o=n.Type,l=n.Field,u=n.MapField,c=n.OneOf,h=n.Service,d=n.Method;function f(e,t,n){var u=r.FileDescriptorProto.create({name:e.filename||(e.fullName.substring(1).replace(/\./g,"_")||"root")+".proto"});D(n,u),e instanceof s||(u.package=e.fullName.substring(1));for(var c,d=0;d<e.nestedArray.length;++d)(c=e._nestedArray[d])instanceof o?u.messageType.push(c.toDescriptor(n)):c instanceof a?u.enumType.push(c.toDescriptor()):c instanceof l?u.extension.push(c.toDescriptor(n)):c instanceof h?u.service.push(c.toDescriptor()):c instanceof i&&f(c,t,n);u.options=I(e.options,r.FileOptions),u.messageType.length+u.enumType.length+u.extension.length+u.service.length&&t.push(u)}s.fromDescriptor=function(e){"number"==typeof e.length&&(e=r.FileDescriptorSet.decode(e));var t=new s;if(e.file)for(var n,i,u,c=0;c<e.file.length;++c){i=t,(n=e.file[c]).package&&n.package.length&&(i=t.define(n.package));var d=R(n);if(n.name&&n.name.length&&t.files.push(i.filename=n.name),n.messageType)for(u=0;u<n.messageType.length;++u)i.add(o.fromDescriptor(n.messageType[u],d));if(n.enumType)for(u=0;u<n.enumType.length;++u)i.add(a.fromDescriptor(n.enumType[u],d));if(n.extension)for(u=0;u<n.extension.length;++u)i.add(l.fromDescriptor(n.extension[u],d));if(n.service)for(u=0;u<n.service.length;++u)i.add(h.fromDescriptor(n.service[u],d));var f=E(n.options,r.FileOptions);if(f){var p=Object.keys(f);for(u=0;u<p.length;++u)i.setOption(p[u],f[p[u]])}}return t.resolveAll()},s.prototype.toDescriptor=function(e){var t=r.FileDescriptorSet.create();return f(this,t.file,e),t};var p=0;o.fromDescriptor=function(e,t,n){"number"==typeof e.length&&(e=r.DescriptorProto.decode(e));var i,s=new o(e.name.length?e.name:"Type"+p++,E(e.options,r.MessageOptions));if(n||(s._edition=t),e.oneofDecl)for(i=0;i<e.oneofDecl.length;++i)s.add(c.fromDescriptor(e.oneofDecl[i]));if(e.field)for(i=0;i<e.field.length;++i){var u=l.fromDescriptor(e.field[i],t,!0);s.add(u),e.field[i].hasOwnProperty("oneofIndex")&&s.oneofsArray[e.field[i].oneofIndex].add(u)}if(e.extension)for(i=0;i<e.extension.length;++i)s.add(l.fromDescriptor(e.extension[i],t,!0));if(e.nestedType)for(i=0;i<e.nestedType.length;++i)s.add(o.fromDescriptor(e.nestedType[i],t,!0)),e.nestedType[i].options&&e.nestedType[i].options.mapEntry&&s.setOption("map_entry",!0);if(e.enumType)for(i=0;i<e.enumType.length;++i)s.add(a.fromDescriptor(e.enumType[i],t,!0));if(e.extensionRange&&e.extensionRange.length)for(i=0,s.extensions=[];i<e.extensionRange.length;++i)s.extensions.push([e.extensionRange[i].start,e.extensionRange[i].end]);if(e.reservedRange&&e.reservedRange.length||e.reservedName&&e.reservedName.length){if(s.reserved=[],e.reservedRange)for(i=0;i<e.reservedRange.length;++i)s.reserved.push([e.reservedRange[i].start,e.reservedRange[i].end]);if(e.reservedName)for(i=0;i<e.reservedName.length;++i)s.reserved.push(e.reservedName[i])}return s},o.prototype.toDescriptor=function(e){var t,n,i=r.DescriptorProto.create({name:this.name});for(n=0;n<this.fieldsArray.length;++n)if(i.field.push(t=this._fieldsArray[n].toDescriptor(e)),this._fieldsArray[n]instanceof u){var s=C(this._fieldsArray[n].keyType,this._fieldsArray[n].resolvedKeyType,!1),c=C(this._fieldsArray[n].type,this._fieldsArray[n].resolvedType,!1),h=11===c||14===c?this._fieldsArray[n].resolvedType&&k(this.parent,this._fieldsArray[n].resolvedType)||this._fieldsArray[n].type:void 0;i.nestedType.push(r.DescriptorProto.create({name:t.typeName,field:[r.FieldDescriptorProto.create({name:"key",number:1,label:1,type:s}),r.FieldDescriptorProto.create({name:"value",number:2,label:1,type:c,typeName:h})],options:r.MessageOptions.create({mapEntry:!0})}))}for(n=0;n<this.oneofsArray.length;++n)i.oneofDecl.push(this._oneofsArray[n].toDescriptor());for(n=0;n<this.nestedArray.length;++n)this._nestedArray[n]instanceof l?i.field.push(this._nestedArray[n].toDescriptor(e)):this._nestedArray[n]instanceof o?i.nestedType.push(this._nestedArray[n].toDescriptor(e)):this._nestedArray[n]instanceof a&&i.enumType.push(this._nestedArray[n].toDescriptor());if(this.extensions)for(n=0;n<this.extensions.length;++n)i.extensionRange.push(r.DescriptorProto.ExtensionRange.create({start:this.extensions[n][0],end:this.extensions[n][1]}));if(this.reserved)for(n=0;n<this.reserved.length;++n)"string"==typeof this.reserved[n]?i.reservedName.push(this.reserved[n]):i.reservedRange.push(r.DescriptorProto.ReservedRange.create({start:this.reserved[n][0],end:this.reserved[n][1]}));return i.options=I(this.options,r.MessageOptions),i};var m=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/;l.fromDescriptor=function(e,t,n){if("number"==typeof e.length&&(e=r.DescriptorProto.decode(e)),"number"!=typeof e.number)throw Error("missing field id");switch(i=e.typeName&&e.typeName.length?e.typeName:S(e.type),e.label){case 1:s=void 0;break;case 2:s="required";break;case 3:s="repeated";break;default:throw Error("illegal label: "+e.label)}var i,s,a=e.extendee;void 0!==e.extendee&&(a=a.length?a:void 0);var o=new l(e.name.length?e.name:"field"+e.number,e.number,i,s,a);if(n||(o._edition=t),o.options=E(e.options,r.FieldOptions),e.proto3_optional&&(o.options.proto3_optional=!0),e.defaultValue&&e.defaultValue.length){var u=e.defaultValue;switch(u){case"true":case"TRUE":u=!0;break;case"false":case"FALSE":u=!1;break;default:m.exec(u)&&(u=parseInt(u))}o.setOption("default",u)}return w(e.type)&&("proto3"===t?e.options&&!e.options.packed&&o.setOption("packed",!1):(!t||"proto2"===t)&&e.options&&e.options.packed&&o.setOption("packed",!0)),o},l.prototype.toDescriptor=function(e){var t=r.FieldDescriptorProto.create({name:this.name,number:this.id});if(this.map)t.type=11,t.typeName=n.util.ucFirst(this.name),t.label=3;else{switch(t.type=C(this.type,this.resolve().resolvedType,this.delimited)){case 10:case 11:case 14:t.typeName=this.resolvedType?k(this.parent,this.resolvedType):this.type}"repeated"===this.rule?t.label=3:this.required&&"proto2"===e?t.label=2:t.label=1}if(t.extendee=this.extensionField?this.extensionField.parent.fullName:this.extend,this.partOf&&(t.oneofIndex=this.parent.oneofsArray.indexOf(this.partOf))<0)throw Error("missing oneof");return this.options&&(t.options=I(this.options,r.FieldOptions),null!=this.options.default&&(t.defaultValue=String(this.options.default)),this.options.proto3_optional&&(t.proto3_optional=!0)),"proto3"===e?this.packed||((t.options||(t.options=r.FieldOptions.create())).packed=!1):(!e||"proto2"===e)&&this.packed&&((t.options||(t.options=r.FieldOptions.create())).packed=!0),t};var g=0;a.fromDescriptor=function(e,t,n){"number"==typeof e.length&&(e=r.EnumDescriptorProto.decode(e));var i={};if(e.value)for(var s=0;s<e.value.length;++s){var o=e.value[s].name,l=e.value[s].number||0;i[o&&o.length?o:"NAME"+l]=l}var u=new a(e.name&&e.name.length?e.name:"Enum"+g++,i,E(e.options,r.EnumOptions));return n||(u._edition=t),u},a.prototype.toDescriptor=function(){for(var e=[],t=0,n=Object.keys(this.values);t<n.length;++t)e.push(r.EnumValueDescriptorProto.create({name:n[t],number:this.values[n[t]]}));return r.EnumDescriptorProto.create({name:this.name,value:e,options:I(this.options,r.EnumOptions)})};var y=0;c.fromDescriptor=function(e){return"number"==typeof e.length&&(e=r.OneofDescriptorProto.decode(e)),new c(e.name&&e.name.length?e.name:"oneof"+y++)},c.prototype.toDescriptor=function(){return r.OneofDescriptorProto.create({name:this.name})};var v=0;h.fromDescriptor=function(e,t,n){"number"==typeof e.length&&(e=r.ServiceDescriptorProto.decode(e));var i=new h(e.name&&e.name.length?e.name:"Service"+v++,E(e.options,r.ServiceOptions));if(n||(i._edition=t),e.method)for(var s=0;s<e.method.length;++s)i.add(d.fromDescriptor(e.method[s]));return i},h.prototype.toDescriptor=function(){for(var e=[],t=0;t<this.methodsArray.length;++t)e.push(this._methodsArray[t].toDescriptor());return r.ServiceDescriptorProto.create({name:this.name,method:e,options:I(this.options,r.ServiceOptions)})};var b=0;function S(e){switch(e){case 1:return"double";case 2:return"float";case 3:return"int64";case 4:return"uint64";case 5:return"int32";case 6:return"fixed64";case 7:return"fixed32";case 8:return"bool";case 9:return"string";case 12:return"bytes";case 13:return"uint32";case 15:return"sfixed32";case 16:return"sfixed64";case 17:return"sint32";case 18:return"sint64"}throw Error("illegal type: "+e)}function w(e){switch(e){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 13:case 14:case 15:case 16:case 17:case 18:return!0}return!1}function C(e,t,r){switch(e){case"double":return 1;case"float":return 2;case"int64":return 3;case"uint64":return 4;case"int32":return 5;case"fixed64":return 6;case"fixed32":return 7;case"bool":return 8;case"string":return 9;case"bytes":return 12;case"uint32":return 13;case"sfixed32":return 15;case"sfixed64":return 16;case"sint32":return 17;case"sint64":return 18}if(t instanceof a)return 14;if(t instanceof o)return r?10:11;throw Error("illegal type: "+e)}function T(e,t){for(var r,n,i={},s=0;s<t.fieldsArray.length;++s)if("uninterpretedOption"!==(n=(r=t._fieldsArray[s]).name)&&Object.prototype.hasOwnProperty.call(e,n)){var l=x(n);r.resolvedType instanceof o?i[l]=T(e[n],r.resolvedType):r.resolvedType instanceof a?i[l]=r.resolvedType.valuesById[e[n]]:i[l]=e[n]}return i}function E(e,t){if(e)return T(t.toObject(e),t)}function _(e,t){for(var r={},i=Object.keys(e),s=0;s<i.length;++s){var a=i[s],l=n.util.camelCase(a);if(Object.prototype.hasOwnProperty.call(t.fields,l)){var u=t.fields[l];u.resolvedType instanceof o?r[l]=_(e[a],u.resolvedType):r[l]=e[a],u.repeated&&!Array.isArray(r[l])&&(r[l]=[r[l]])}}return r}function I(e,t){if(e)return t.fromObject(_(e,t))}function k(e,t){var r=e.fullName.split("."),n=t.fullName.split("."),a=0,o=0,l=n.length-1;if(!(e instanceof s)&&t instanceof i)for(;a<r.length&&o<l&&r[a]===n[o];){var u=t.lookup(r[a++],!0);if(null!==u&&u!==t)break;++o}else for(;a<r.length&&o<l&&r[a]===n[o];++a,++o);return n.slice(o).join(".")}function x(e){return e.substring(0,1)+e.substring(1).replace(/([A-Z])(?=[a-z]|$)/g,function(e,t){return"_"+t.toLowerCase()})}function R(e){if("editions"===e.syntax)if(e.edition===r.Edition.EDITION_2023)return"2023";else throw Error("Unsupported edition "+e.edition);return"proto3"===e.syntax?"proto3":"proto2"}function D(e,t){if(e)if("proto2"===e||"proto3"===e)t.syntax=e;else if(t.syntax="editions","2023"===e)t.edition=r.Edition.EDITION_2023;else throw Error("Unsupported edition "+e)}d.fromDescriptor=function(e){return"number"==typeof e.length&&(e=r.MethodDescriptorProto.decode(e)),new d(e.name&&e.name.length?e.name:"Method"+b++,"rpc",e.inputType,e.outputType,!!e.clientStreaming,!!e.serverStreaming,E(e.options,r.MethodOptions))},d.prototype.toDescriptor=function(){return r.MethodDescriptorProto.create({name:this.name,inputType:this.resolvedRequestType?this.resolvedRequestType.fullName:this.requestType,outputType:this.resolvedResponseType?this.resolvedResponseType.fullName:this.responseType,clientStreaming:this.requestStream,serverStreaming:this.responseStream,options:I(this.options,r.MethodOptions)})}},31733,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.addCommonProtos=r.loadProtosWithOptionsSync=r.loadProtosWithOptions=void 0;let n=e.r(22734),i=e.r(14747),s=e.r(30669);function a(e,t){let r=e.resolvePath;e.resolvePath=(e,s)=>{if(i.isAbsolute(s))return s;for(let e of t){let t=i.join(e,s);try{return n.accessSync(t,n.constants.R_OK),t}catch(e){continue}}return process.emitWarning(`${s} not found in any of the include paths ${t}`),r(e,s)}}r.loadProtosWithOptions=async function(e,t){let r=new s.Root;if((t=t||{}).includeDirs){if(!Array.isArray(t.includeDirs))return Promise.reject(Error("The includeDirs option must be an array"));a(r,t.includeDirs)}let n=await r.load(e,t);return n.resolveAll(),n},r.loadProtosWithOptionsSync=function(e,t){let r=new s.Root;if((t=t||{}).includeDirs){if(!Array.isArray(t.includeDirs))throw Error("The includeDirs option must be an array");a(r,t.includeDirs)}let n=r.loadSync(e,t);return n.resolveAll(),n},r.addCommonProtos=function(){let t=e.r(74786),r=e.r(66700),n=e.r(89217),i=e.r(60181);s.common("api",t.nested.google.nested.protobuf.nested),s.common("descriptor",r.nested.google.nested.protobuf.nested),s.common("source_context",n.nested.google.nested.protobuf.nested),s.common("type",i.nested.google.nested.protobuf.nested)}},53352,(e,t,r)=>{!function(n,i){function s(e){return e.default||e}if("function"==typeof define&&define.amd){let t;void 0!==(t=function(){var e={};return i(e),s(e)}())&&e.v(t)}else i(r),t.exports=s(r)}("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:e.e,function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t=null;try{t=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function r(e,t,r){this.low=0|e,this.high=0|t,this.unsigned=!!r}function n(e){return!0===(e&&e.__isLong__)}function i(e){var t=Math.clz32(e&-e);return e?31-t:t}r.prototype.__isLong__,Object.defineProperty(r.prototype,"__isLong__",{value:!0}),r.isLong=n;var s={},a={};function o(e,t){var r,n,i;if(t)return(e>>>=0,(i=0<=e&&e<256)&&(n=a[e]))?n:(r=u(e,0,!0),i&&(a[e]=r),r);return(e|=0,(i=-128<=e&&e<128)&&(n=s[e]))?n:(r=u(e,e<0?-1:0,!1),i&&(s[e]=r),r)}function l(e,t){if(isNaN(e))return t?v:y;if(t){if(e<0)return v;if(e>=p)return T}else{if(e<=-m)return E;if(e+1>=m)return C}return e<0?l(-e,t).neg():u(e%f|0,e/f|0,t)}function u(e,t,n){return new r(e,t,n)}r.fromInt=o,r.fromNumber=l,r.fromBits=u;var c=Math.pow;function h(e,t,r){if(0===e.length)throw Error("empty string");if("number"==typeof t?(r=t,t=!1):t=!!t,"NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return t?v:y;if((r=r||10)<2||36<r)throw RangeError("radix");if((n=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===n)return h(e.substring(1),t,r).neg();for(var n,i=l(c(r,8)),s=y,a=0;a<e.length;a+=8){var o=Math.min(8,e.length-a),u=parseInt(e.substring(a,a+o),r);if(o<8){var d=l(c(r,o));s=s.mul(d).add(l(u))}else s=(s=s.mul(i)).add(l(u))}return s.unsigned=t,s}function d(e,t){return"number"==typeof e?l(e,t):"string"==typeof e?h(e,t):u(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}r.fromString=h,r.fromValue=d;var f=0x100000000,p=0xffffffffffffffff,m=0x8000000000000000,g=o(0x1000000),y=o(0);r.ZERO=y;var v=o(0,!0);r.UZERO=v;var b=o(1);r.ONE=b;var S=o(1,!0);r.UONE=S;var w=o(-1);r.NEG_ONE=w;var C=u(-1,0x7fffffff,!1);r.MAX_VALUE=C;var T=u(-1,-1,!0);r.MAX_UNSIGNED_VALUE=T;var E=u(0,-0x80000000,!1);r.MIN_VALUE=E;var _=r.prototype;_.toInt=function(){return this.unsigned?this.low>>>0:this.low},_.toNumber=function(){return this.unsigned?(this.high>>>0)*f+(this.low>>>0):this.high*f+(this.low>>>0)},_.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(!this.eq(E))return"-"+this.neg().toString(e);else{var t=l(e),r=this.div(t),n=r.mul(t).sub(this);return r.toString(e)+n.toInt().toString(e)}for(var i=l(c(e,6),this.unsigned),s=this,a="";;){var o=s.div(i),u=(s.sub(o.mul(i)).toInt()>>>0).toString(e);if((s=o).isZero())return u+a;for(;u.length<6;)u="0"+u;a=""+u+a}},_.getHighBits=function(){return this.high},_.getHighBitsUnsigned=function(){return this.high>>>0},_.getLowBits=function(){return this.low},_.getLowBitsUnsigned=function(){return this.low>>>0},_.getNumBitsAbs=function(){if(this.isNegative())return this.eq(E)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return 0!=this.high?t+33:t+1},_.isSafeInteger=function(){var e=this.high>>21;return!e||!this.unsigned&&-1===e&&(0!==this.low||-2097152!==this.high)},_.isZero=function(){return 0===this.high&&0===this.low},_.eqz=_.isZero,_.isNegative=function(){return!this.unsigned&&this.high<0},_.isPositive=function(){return this.unsigned||this.high>=0},_.isOdd=function(){return(1&this.low)==1},_.isEven=function(){return(1&this.low)==0},_.equals=function(e){return n(e)||(e=d(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low},_.eq=_.equals,_.notEquals=function(e){return!this.eq(e)},_.neq=_.notEquals,_.ne=_.notEquals,_.lessThan=function(e){return 0>this.comp(e)},_.lt=_.lessThan,_.lessThanOrEqual=function(e){return 0>=this.comp(e)},_.lte=_.lessThanOrEqual,_.le=_.lessThanOrEqual,_.greaterThan=function(e){return this.comp(e)>0},_.gt=_.greaterThan,_.greaterThanOrEqual=function(e){return this.comp(e)>=0},_.gte=_.greaterThanOrEqual,_.ge=_.greaterThanOrEqual,_.compare=function(e){if(n(e)||(e=d(e)),this.eq(e))return 0;var t=this.isNegative(),r=e.isNegative();return t&&!r?-1:!t&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},_.comp=_.compare,_.negate=function(){return!this.unsigned&&this.eq(E)?E:this.not().add(b)},_.neg=_.negate,_.add=function(e){n(e)||(e=d(e));var t,r,i=this.high>>>16,s=65535&this.high,a=this.low>>>16,o=65535&this.low,l=e.high>>>16,c=65535&e.high,h=e.low>>>16,f=65535&e.low,p=0,m=0;return t=0+((r=0+(o+f))>>>16),r&=65535,t+=a+h,m+=t>>>16,t&=65535,m+=s+c,p+=m>>>16,m&=65535,p+=i+l,u(t<<16|r,(p&=65535)<<16|m,this.unsigned)},_.subtract=function(e){return n(e)||(e=d(e)),this.add(e.neg())},_.sub=_.subtract,_.multiply=function(e){if(this.isZero())return this;if(n(e)||(e=d(e)),t)return u(t.mul(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned);if(e.isZero())return this.unsigned?v:y;if(this.eq(E))return e.isOdd()?E:y;if(e.eq(E))return this.isOdd()?E:y;if(this.isNegative())if(e.isNegative())return this.neg().mul(e.neg());else return this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(g)&&e.lt(g))return l(this.toNumber()*e.toNumber(),this.unsigned);var r,i,s=this.high>>>16,a=65535&this.high,o=this.low>>>16,c=65535&this.low,h=e.high>>>16,f=65535&e.high,p=e.low>>>16,m=65535&e.low,b=0,S=0;return r=0+((i=0+c*m)>>>16),i&=65535,r+=o*m,S+=r>>>16,r&=65535,r+=c*p,S+=r>>>16,r&=65535,S+=a*m,b+=S>>>16,S&=65535,S+=o*p,b+=S>>>16,S&=65535,S+=c*f,b+=S>>>16,S&=65535,b+=s*m+a*p+o*f+c*h,u(r<<16|i,(b&=65535)<<16|S,this.unsigned)},_.mul=_.multiply,_.divide=function(e){if(n(e)||(e=d(e)),e.isZero())throw Error("division by zero");if(t){var r,i,s;return this.unsigned||-0x80000000!==this.high||-1!==e.low||-1!==e.high?u((this.unsigned?t.div_u:t.div_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this}if(this.isZero())return this.unsigned?v:y;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return v;if(e.gt(this.shru(1)))return S;s=v}else{if(this.eq(E))if(e.eq(b)||e.eq(w))return E;else return e.eq(E)?b:(r=this.shr(1).div(e).shl(1)).eq(y)?e.isNegative()?b:w:(i=this.sub(e.mul(r)),s=r.add(i.div(e)));if(e.eq(E))return this.unsigned?v:y;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();s=y}for(i=this;i.gte(e);){for(var a=Math.ceil(Math.log(r=Math.max(1,Math.floor(i.toNumber()/e.toNumber())))/Math.LN2),o=a<=48?1:c(2,a-48),h=l(r),f=h.mul(e);f.isNegative()||f.gt(i);)r-=o,f=(h=l(r,this.unsigned)).mul(e);h.isZero()&&(h=b),s=s.add(h),i=i.sub(f)}return s},_.div=_.divide,_.modulo=function(e){return(n(e)||(e=d(e)),t)?u((this.unsigned?t.rem_u:t.rem_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},_.mod=_.modulo,_.rem=_.modulo,_.not=function(){return u(~this.low,~this.high,this.unsigned)},_.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},_.clz=_.countLeadingZeros,_.countTrailingZeros=function(){return this.low?i(this.low):i(this.high)+32},_.ctz=_.countTrailingZeros,_.and=function(e){return n(e)||(e=d(e)),u(this.low&e.low,this.high&e.high,this.unsigned)},_.or=function(e){return n(e)||(e=d(e)),u(this.low|e.low,this.high|e.high,this.unsigned)},_.xor=function(e){return n(e)||(e=d(e)),u(this.low^e.low,this.high^e.high,this.unsigned)},_.shiftLeft=function(e){return(n(e)&&(e=e.toInt()),0==(e&=63))?this:e<32?u(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):u(0,this.low<<e-32,this.unsigned)},_.shl=_.shiftLeft,_.shiftRight=function(e){return(n(e)&&(e=e.toInt()),0==(e&=63))?this:e<32?u(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):u(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},_.shr=_.shiftRight,_.shiftRightUnsigned=function(e){return(n(e)&&(e=e.toInt()),0==(e&=63))?this:e<32?u(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):32===e?u(this.high,0,this.unsigned):u(this.high>>>e-32,0,this.unsigned)},_.shru=_.shiftRightUnsigned,_.shr_u=_.shiftRightUnsigned,_.rotateLeft=function(e){var t;return(n(e)&&(e=e.toInt()),0==(e&=63))?this:32===e?u(this.high,this.low,this.unsigned):e<32?(t=32-e,u(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned)):(e-=32,t=32-e,u(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned))},_.rotl=_.rotateLeft,_.rotateRight=function(e){var t;return(n(e)&&(e=e.toInt()),0==(e&=63))?this:32===e?u(this.high,this.low,this.unsigned):e<32?(t=32-e,u(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned)):(e-=32,t=32-e,u(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned))},_.rotr=_.rotateRight,_.toSigned=function(){return this.unsigned?u(this.low,this.high,!1):this},_.toUnsigned=function(){return this.unsigned?this:u(this.low,this.high,!0)},_.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},_.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},_.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},r.fromBytes=function(e,t,n){return n?r.fromBytesLE(e,t):r.fromBytesBE(e,t)},r.fromBytesLE=function(e,t){return new r(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},r.fromBytesBE=function(e,t){return new r(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)},"function"==typeof BigInt&&(r.fromBigInt=function(e,t){return u(Number(BigInt.asIntN(32,e)),Number(BigInt.asIntN(32,e>>BigInt(32))),t)},r.fromValue=function(e,t){return"bigint"==typeof e?r.fromBigInt(e,t):d(e,t)},_.toBigInt=function(){var e=BigInt(this.low>>>0);return BigInt(this.unsigned?this.high>>>0:this.high)<<BigInt(32)|e}),e.default=r})},19573,(e,t,r)=>{"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0}),r.loadFileDescriptorSetFromObject=r.loadFileDescriptorSetFromBuffer=r.fromJSON=r.loadSync=r.load=r.IdempotencyLevel=r.isAnyExtension=r.Long=void 0;let i=e.r(3590),s=e.r(30669),a=e.r(92648),o=e.r(31733);r.Long=e.r(53352),r.isAnyExtension=function(e){return"@type"in e&&"string"==typeof e["@type"]},function(e){e.IDEMPOTENCY_UNKNOWN="IDEMPOTENCY_UNKNOWN",e.NO_SIDE_EFFECTS="NO_SIDE_EFFECTS",e.IDEMPOTENT="IDEMPOTENT"}(n=r.IdempotencyLevel||(r.IdempotencyLevel={}));let l={longs:String,enums:String,bytes:String,defaults:!0,oneofs:!0,json:!0};function u(e,t){return""===e?t:e+"."+t}function c(e){return e instanceof s.Service||e instanceof s.Type||e instanceof s.Enum}function h(e){return e instanceof s.Namespace||e instanceof s.Root}function d(e,t){let r=u(t,e.name);return c(e)?[[r,e]]:h(e)&&void 0!==e.nested?Object.keys(e.nested).map(t=>d(e.nested[t],r)).reduce((e,t)=>e.concat(t),[]):[]}function f(e,t){return function(r){return e.toObject(e.decode(r),t)}}function p(e){return function(t){if(Array.isArray(t))throw Error(`Failed to serialize message: expected object with ${e.name} structure, got array instead`);let r=e.fromObject(t);return e.encode(r).finish()}}function m(e){return(e||[]).reduce((e,t)=>{for(let[r,n]of Object.entries(t))"uninterpreted_option"===r?e.uninterpreted_option.push(t.uninterpreted_option):e[r]=n;return e},{deprecated:!1,idempotency_level:n.IDEMPOTENCY_UNKNOWN,uninterpreted_option:[]})}function g(e,t,r,n){let s=e.resolvedRequestType,a=e.resolvedResponseType;return{path:"/"+t+"/"+e.name,requestStream:!!e.requestStream,responseStream:!!e.responseStream,requestSerialize:p(s),requestDeserialize:f(s,r),responseSerialize:p(a),responseDeserialize:f(a,r),originalName:i(e.name),requestType:v(s,n),responseType:v(a,n),options:m(e.parsedOptions)}}function y(e,t,r,n){let i={};for(let s of e.methodsArray)i[s.name]=g(s,t,r,n);return i}function v(e,t){let r=e.toDescriptor("proto3");return{format:"Protocol Buffer 3 DescriptorProto",type:r.$type.toObject(r,l),fileDescriptorProtos:t}}function b(e,t){let r=e.toDescriptor("proto3");return{format:"Protocol Buffer 3 EnumDescriptorProto",type:r.$type.toObject(r,l),fileDescriptorProtos:t}}function S(e,t,r,n){if(e instanceof s.Service)return y(e,t,r,n);if(e instanceof s.Type)return v(e,n);if(e instanceof s.Enum)return b(e,n);throw Error("Type mismatch in reflection object handling")}function w(e,t){let r={};e.resolveAll();let n=e.toDescriptor("proto3").file.map(e=>Buffer.from(a.FileDescriptorProto.encode(e).finish()));for(let[i,s]of d(e,""))r[i]=S(s,i,t,n);return r}function C(e,t){t=t||{};let r=s.Root.fromDescriptor(e);return r.resolveAll(),w(r,t)}r.load=function(e,t){return(0,o.loadProtosWithOptions)(e,t).then(e=>w(e,t))},r.loadSync=function(e,t){return w((0,o.loadProtosWithOptionsSync)(e,t),t)},r.fromJSON=function(e,t){t=t||{};let r=s.Root.fromJSON(e);return r.resolveAll(),w(r,t)},r.loadFileDescriptorSetFromBuffer=function(e,t){return C(a.FileDescriptorSet.decode(e),t)},r.loadFileDescriptorSetFromObject=function(e,t){return C(a.FileDescriptorSet.fromObject(e),t)},(0,o.addCommonProtos)()},86039,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.setup=r.getChannelzServiceDefinition=r.getChannelzHandlers=r.unregisterChannelzRef=r.registerChannelzSocket=r.registerChannelzServer=r.registerChannelzSubchannel=r.registerChannelzChannel=r.ChannelzCallTracker=r.ChannelzChildrenTracker=r.ChannelzTrace=void 0;let n=e.r(4446),i=e.r(7541),s=e.r(33278),a=e.r(76005),o=e.r(78560),l=e.r(76273);function u(e){return{channel_id:e.id,name:e.name}}function c(e){return{subchannel_id:e.id,name:e.name}}function h(e){return{server_id:e.id}}function d(e){return{socket_id:e.id,name:e.name}}let f=32;class p{constructor(){this.events=[],this.eventsLogged=0,this.creationTimestamp=new Date}addTrace(e,t,r){let n=new Date;this.events.push({description:t,severity:e,timestamp:n,childChannel:(null==r?void 0:r.kind)==="channel"?r:void 0,childSubchannel:(null==r?void 0:r.kind)==="subchannel"?r:void 0}),this.events.length>=2*f&&(this.events=this.events.slice(f)),this.eventsLogged+=1}getTraceMessage(){return{creation_timestamp:k(this.creationTimestamp),num_events_logged:this.eventsLogged,events:this.events.map(e=>({description:e.description,severity:e.severity,timestamp:k(e.timestamp),channel_ref:e.childChannel?u(e.childChannel):null,subchannel_ref:e.childSubchannel?c(e.childSubchannel):null}))}}}r.ChannelzTrace=p;class m{constructor(){this.channelChildren=new Map,this.subchannelChildren=new Map,this.socketChildren=new Map}refChild(e){var t,r,n;switch(e.kind){case"channel":{let r=null!=(t=this.channelChildren.get(e.id))?t:{ref:e,count:0};r.count+=1,this.channelChildren.set(e.id,r);break}case"subchannel":{let t=null!=(r=this.subchannelChildren.get(e.id))?r:{ref:e,count:0};t.count+=1,this.subchannelChildren.set(e.id,t);break}case"socket":{let t=null!=(n=this.socketChildren.get(e.id))?n:{ref:e,count:0};t.count+=1,this.socketChildren.set(e.id,t)}}}unrefChild(e){switch(e.kind){case"channel":{let t=this.channelChildren.get(e.id);void 0!==t&&(t.count-=1,0===t.count?this.channelChildren.delete(e.id):this.channelChildren.set(e.id,t));break}case"subchannel":{let t=this.subchannelChildren.get(e.id);void 0!==t&&(t.count-=1,0===t.count?this.subchannelChildren.delete(e.id):this.subchannelChildren.set(e.id,t));break}case"socket":{let t=this.socketChildren.get(e.id);void 0!==t&&(t.count-=1,0===t.count?this.socketChildren.delete(e.id):this.socketChildren.set(e.id,t))}}}getChildLists(){let e=[];for(let{ref:t}of this.channelChildren.values())e.push(t);let t=[];for(let{ref:e}of this.subchannelChildren.values())t.push(e);let r=[];for(let{ref:e}of this.socketChildren.values())r.push(e);return{channels:e,subchannels:t,sockets:r}}}r.ChannelzChildrenTracker=m;class g{constructor(){this.callsStarted=0,this.callsSucceeded=0,this.callsFailed=0,this.lastCallStartedTimestamp=null}addCallStarted(){this.callsStarted+=1,this.lastCallStartedTimestamp=new Date}addCallSucceeded(){this.callsSucceeded+=1}addCallFailed(){this.callsFailed+=1}}r.ChannelzCallTracker=g;let y=1;function v(){return y++}let b=[],S=[],w=[],C=[];function T(e){let t=Number.parseInt(e,16);return[t/256|0,t%256]}function E(e){return""===e?[]:[].concat(...e.split(":").map(e=>T(e)))}function _(e){if((0,n.isIPv4)(e))return Buffer.from(Uint8Array.from(e.split(".").map(e=>Number.parseInt(e))));if(!(0,n.isIPv6)(e))return null;{let t,r,n=e.indexOf("::");-1===n?(t=e,r=""):(t=e.substring(0,n),r=e.substring(n+2));let i=Buffer.from(E(t)),s=Buffer.from(E(r)),a=Buffer.alloc(16-i.length-s.length,0);return Buffer.concat([i,a,s])}}function I(e){switch(e){case i.ConnectivityState.CONNECTING:return{state:"CONNECTING"};case i.ConnectivityState.IDLE:return{state:"IDLE"};case i.ConnectivityState.READY:return{state:"READY"};case i.ConnectivityState.SHUTDOWN:return{state:"SHUTDOWN"};case i.ConnectivityState.TRANSIENT_FAILURE:return{state:"TRANSIENT_FAILURE"};default:return{state:"UNKNOWN"}}}function k(e){if(!e)return null;let t=e.getTime();return{seconds:t/1e3|0,nanos:t%1e3*1e6}}function x(e){let t=e.getInfo();return{ref:u(e.ref),data:{target:t.target,state:I(t.state),calls_started:t.callTracker.callsStarted,calls_succeeded:t.callTracker.callsSucceeded,calls_failed:t.callTracker.callsFailed,last_call_started_timestamp:k(t.callTracker.lastCallStartedTimestamp),trace:t.trace.getTraceMessage()},channel_ref:t.children.channels.map(e=>u(e)),subchannel_ref:t.children.subchannels.map(e=>c(e))}}function R(e,t){let r=Number.parseInt(e.request.channel_id),n=b[r];void 0===n?t({code:s.Status.NOT_FOUND,details:"No channel data found for id "+r}):t(null,{channel:x(n)})}function D(e,t){let r=Number.parseInt(e.request.max_results),n=[],i=Number.parseInt(e.request.start_channel_id);for(;i<b.length;i++){let e=b[i];if(void 0!==e&&(n.push(x(e)),n.length>=r))break}t(null,{channel:n,end:i>=w.length})}function A(e){let t=e.getInfo();return{ref:h(e.ref),data:{calls_started:t.callTracker.callsStarted,calls_succeeded:t.callTracker.callsSucceeded,calls_failed:t.callTracker.callsFailed,last_call_started_timestamp:k(t.callTracker.lastCallStartedTimestamp),trace:t.trace.getTraceMessage()},listen_socket:t.listenerChildren.sockets.map(e=>d(e))}}function O(e,t){let r=Number.parseInt(e.request.server_id),n=w[r];void 0===n?t({code:s.Status.NOT_FOUND,details:"No server data found for id "+r}):t(null,{server:A(n)})}function N(e,t){let r=Number.parseInt(e.request.max_results),n=[],i=Number.parseInt(e.request.start_server_id);for(;i<w.length;i++){let e=w[i];if(void 0!==e&&(n.push(A(e)),n.length>=r))break}t(null,{server:n,end:i>=w.length})}function P(e,t){let r=Number.parseInt(e.request.subchannel_id),n=S[r];if(void 0===n)return void t({code:s.Status.NOT_FOUND,details:"No subchannel data found for id "+r});let i=n.getInfo();t(null,{subchannel:{ref:c(n.ref),data:{target:i.target,state:I(i.state),calls_started:i.callTracker.callsStarted,calls_succeeded:i.callTracker.callsSucceeded,calls_failed:i.callTracker.callsFailed,last_call_started_timestamp:k(i.callTracker.lastCallStartedTimestamp),trace:i.trace.getTraceMessage()},socket_ref:i.children.sockets.map(e=>d(e))}})}function M(e){var t;return(0,a.isTcpSubchannelAddress)(e)?{address:"tcpip_address",tcpip_address:{ip_address:null!=(t=_(e.host))?t:void 0,port:e.port}}:{address:"uds_address",uds_address:{filename:e.path}}}function L(e,t){var r,n,i,a,o;let l=Number.parseInt(e.request.socket_id),u=C[l];if(void 0===u)return void t({code:s.Status.NOT_FOUND,details:"No socket data found for id "+l});let c=u.getInfo(),h=c.security?{model:"tls",tls:{cipher_suite:c.security.cipherSuiteStandardName?"standard_name":"other_name",standard_name:null!=(r=c.security.cipherSuiteStandardName)?r:void 0,other_name:null!=(n=c.security.cipherSuiteOtherName)?n:void 0,local_certificate:null!=(i=c.security.localCertificate)?i:void 0,remote_certificate:null!=(a=c.security.remoteCertificate)?a:void 0}}:null;t(null,{socket:{ref:d(u.ref),local:c.localAddress?M(c.localAddress):null,remote:c.remoteAddress?M(c.remoteAddress):null,remote_name:null!=(o=c.remoteName)?o:void 0,security:h,data:{keep_alives_sent:c.keepAlivesSent,streams_started:c.streamsStarted,streams_succeeded:c.streamsSucceeded,streams_failed:c.streamsFailed,last_local_stream_created_timestamp:k(c.lastLocalStreamCreatedTimestamp),last_remote_stream_created_timestamp:k(c.lastRemoteStreamCreatedTimestamp),messages_received:c.messagesReceived,messages_sent:c.messagesSent,last_message_received_timestamp:k(c.lastMessageReceivedTimestamp),last_message_sent_timestamp:k(c.lastMessageSentTimestamp),local_flow_control_window:c.localFlowControlWindow?{value:c.localFlowControlWindow}:null,remote_flow_control_window:c.remoteFlowControlWindow?{value:c.remoteFlowControlWindow}:null}}})}function B(e,t){let r=Number.parseInt(e.request.server_id),n=w[r];if(void 0===n)return void t({code:s.Status.NOT_FOUND,details:"No server data found for id "+r});let i=Number.parseInt(e.request.start_socket_id),a=Number.parseInt(e.request.max_results),o=n.getInfo().sessionChildren.sockets.sort((e,t)=>e.id-t.id),l=[],u=0;for(;u<o.length&&(!(o[u].id>=i)||(l.push(d(o[u])),!(l.length>=a)));u++);t(null,{socket_ref:l,end:u>=o.length})}function F(){return{GetChannel:R,GetTopChannels:D,GetServer:O,GetServers:N,GetSubchannel:P,GetSocket:L,GetServerSockets:B}}r.registerChannelzChannel=function(e,t,r){let n=v(),i={id:n,name:e,kind:"channel"};return r&&(b[n]={ref:i,getInfo:t}),i},r.registerChannelzSubchannel=function(e,t,r){let n=v(),i={id:n,name:e,kind:"subchannel"};return r&&(S[n]={ref:i,getInfo:t}),i},r.registerChannelzServer=function(e,t){let r=v(),n={id:r,kind:"server"};return t&&(w[r]={ref:n,getInfo:e}),n},r.registerChannelzSocket=function(e,t,r){let n=v(),i={id:n,name:e,kind:"socket"};return r&&(C[n]={ref:i,getInfo:t}),i},r.unregisterChannelzRef=function(e){switch(e.kind){case"channel":delete b[e.id];return;case"subchannel":delete S[e.id];return;case"server":delete w[e.id];return;case"socket":delete C[e.id];return}},r.getChannelzHandlers=F;let j=null;function V(){if(j)return j;let t=(0,e.r(19573).loadSync)("channelz.proto",{keepCase:!0,longs:String,enums:String,defaults:!0,oneofs:!0,includeDirs:[`/ROOT/Desktop/Proje Klos\xf6r\xfc/React/flagship/node_modules/@grpc/grpc-js/build/src/../../proto`]});return j=(0,l.loadPackageDefinition)(t).grpc.channelz.v1.Channelz.service}r.getChannelzServiceDefinition=V,r.setup=function(){(0,o.registerAdminService)(V,F)}},60253,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Subchannel=void 0;let n=e.r(7541),i=e.r(70016),s=e.r(82702),a=e.r(33278),o=e.r(84848),l=e.r(76005),u=e.r(86039),c="subchannel",h=0x7fffffff;class d{constructor(e,t,r,s,a){var o;this.channelTarget=e,this.subchannelAddress=t,this.options=r,this.credentials=s,this.connector=a,this.connectivityState=n.ConnectivityState.IDLE,this.transport=null,this.continueConnecting=!1,this.stateListeners=new Set,this.refcount=0,this.channelzEnabled=!0,this.callTracker=new u.ChannelzCallTracker,this.childrenTracker=new u.ChannelzChildrenTracker,this.streamTracker=new u.ChannelzCallTracker;const c={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new i.BackoffTimeout(()=>{this.handleBackoffTimer()},c),this.backoffTimeout.unref(),this.subchannelAddressString=(0,l.subchannelAddressToString)(t),this.keepaliveTime=null!=(o=r["grpc.keepalive_time_ms"])?o:-1,0===r["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzTrace=new u.ChannelzTrace,this.channelzRef=(0,u.registerChannelzSubchannel)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Subchannel created"),this.trace("Subchannel constructed with options "+JSON.stringify(r,void 0,2))}getChannelzInfo(){return{state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists(),target:this.subchannelAddressString}}trace(e){s.trace(a.LogVerbosity.DEBUG,c,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}refTrace(e){s.trace(a.LogVerbosity.DEBUG,"subchannel_refcount","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}handleBackoffTimer(){this.continueConnecting?this.transitionToState([n.ConnectivityState.TRANSIENT_FAILURE],n.ConnectivityState.CONNECTING):this.transitionToState([n.ConnectivityState.TRANSIENT_FAILURE],n.ConnectivityState.IDLE)}startBackoff(){this.backoffTimeout.runOnce()}stopBackoff(){this.backoffTimeout.stop(),this.backoffTimeout.reset()}startConnectingInternal(){let e=this.options;if(e["grpc.keepalive_time_ms"]){let t=Math.min(this.keepaliveTime,h);e=Object.assign(Object.assign({},e),{"grpc.keepalive_time_ms":t})}this.connector.connect(this.subchannelAddress,this.credentials,e).then(e=>{this.transitionToState([n.ConnectivityState.CONNECTING],n.ConnectivityState.READY)?(this.transport=e,this.channelzEnabled&&this.childrenTracker.refChild(e.getChannelzRef()),e.addDisconnectListener(e=>{this.transitionToState([n.ConnectivityState.READY],n.ConnectivityState.IDLE),e&&this.keepaliveTime>0&&(this.keepaliveTime*=2,s.log(a.LogVerbosity.ERROR,`Connection to ${(0,o.uriToString)(this.channelTarget)} at ${this.subchannelAddressString} rejected by server because of excess pings. Increasing ping interval to ${this.keepaliveTime} ms`))})):e.shutdown()},e=>{this.transitionToState([n.ConnectivityState.CONNECTING],n.ConnectivityState.TRANSIENT_FAILURE,`${e}`)})}transitionToState(e,t,r){var i,s;if(-1===e.indexOf(this.connectivityState))return!1;this.trace(n.ConnectivityState[this.connectivityState]+" -> "+n.ConnectivityState[t]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+n.ConnectivityState[t]);let a=this.connectivityState;switch(this.connectivityState=t,t){case n.ConnectivityState.READY:this.stopBackoff();break;case n.ConnectivityState.CONNECTING:this.startBackoff(),this.startConnectingInternal(),this.continueConnecting=!1;break;case n.ConnectivityState.TRANSIENT_FAILURE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),null==(i=this.transport)||i.shutdown(),this.transport=null,this.backoffTimeout.isRunning()||process.nextTick(()=>{this.handleBackoffTimer()});break;case n.ConnectivityState.IDLE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),null==(s=this.transport)||s.shutdown(),this.transport=null;break;default:throw Error(`Invalid state: unknown ConnectivityState ${t}`)}for(let e of this.stateListeners)e(this,a,t,this.keepaliveTime,r);return!0}ref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount+1)),this.refcount+=1}unref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount-1)),this.refcount-=1,0===this.refcount&&(this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Shutting down"),this.channelzEnabled&&(0,u.unregisterChannelzRef)(this.channelzRef),process.nextTick(()=>{this.transitionToState([n.ConnectivityState.CONNECTING,n.ConnectivityState.READY],n.ConnectivityState.IDLE)}))}unrefIfOneRef(){return 1===this.refcount&&(this.unref(),!0)}createCall(e,t,r,n){let i;if(!this.transport)throw Error("Cannot create call, subchannel not READY");return this.channelzEnabled?(this.callTracker.addCallStarted(),this.streamTracker.addCallStarted(),i={onCallEnd:e=>{e.code===a.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}}):i={},this.transport.createCall(e,t,r,n,i)}startConnecting(){process.nextTick(()=>{this.transitionToState([n.ConnectivityState.IDLE],n.ConnectivityState.CONNECTING)||this.connectivityState!==n.ConnectivityState.TRANSIENT_FAILURE||(this.continueConnecting=!0)})}getConnectivityState(){return this.connectivityState}addConnectivityStateListener(e){this.stateListeners.add(e)}removeConnectivityStateListener(e){this.stateListeners.delete(e)}resetBackoff(){process.nextTick(()=>{this.backoffTimeout.reset(),this.transitionToState([n.ConnectivityState.TRANSIENT_FAILURE],n.ConnectivityState.CONNECTING)})}getAddress(){return this.subchannelAddressString}getChannelzRef(){return this.channelzRef}getRealSubchannel(){return this}realSubchannelEquals(e){return e.getRealSubchannel()===this}throttleKeepalive(e){e>this.keepaliveTime&&(this.keepaliveTime=e)}}r.Subchannel=d},75808,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.setup=r.DEFAULT_PORT=void 0;let n=e.r(14507),i=e.r(79594),s=e.r(24361),a=e.r(4924),o=e.r(33278),l=e.r(64346),u=e.r(82702),c=e.r(33278),h=e.r(84848),d=e.r(4446),f=e.r(70016),p="dns_resolver";function m(e){u.trace(c.LogVerbosity.DEBUG,p,e)}r.DEFAULT_PORT=443;let g=3e4,y=s.promisify(i.resolveTxt),v=s.promisify(i.lookup);function b(...e){let t=[];for(let r=0;r<Math.max.apply(null,e.map(e=>e.length));r++)for(let n of e)r<n.length&&t.push(n[r]);return t}class S{constructor(e,t,n){var i,s,a;this.target=e,this.listener=t,this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.continueResolving=!1,this.isNextResolutionTimerRunning=!1,this.isServiceConfigEnabled=!0,this.returnedIpResult=!1,m("Resolver constructed for target "+(0,h.uriToString)(e));const u=(0,h.splitHostPort)(e.path);null===u?(this.ipResult=null,this.dnsHostname=null,this.port=null):(0,d.isIPv4)(u.host)||(0,d.isIPv6)(u.host)?(this.ipResult=[{host:u.host,port:null!=(i=u.port)?i:r.DEFAULT_PORT}],this.dnsHostname=null,this.port=null):(this.ipResult=null,this.dnsHostname=u.host,this.port=null!=(s=u.port)?s:r.DEFAULT_PORT),this.percentage=100*Math.random(),1===n["grpc.service_config_disable_resolution"]&&(this.isServiceConfigEnabled=!1),this.defaultResolutionError={code:o.Status.UNAVAILABLE,details:`Name resolution failed for target ${(0,h.uriToString)(this.target)}`,metadata:new l.Metadata};const c={initialDelay:n["grpc.initial_reconnect_backoff_ms"],maxDelay:n["grpc.max_reconnect_backoff_ms"]};this.backoff=new f.BackoffTimeout(()=>{this.continueResolving&&this.startResolutionWithBackoff()},c),this.backoff.unref(),this.minTimeBetweenResolutionsMs=null!=(a=n["grpc.dns_min_time_between_resolutions_ms"])?a:g,this.nextResolutionTimer=setTimeout(()=>{},0),clearTimeout(this.nextResolutionTimer)}startResolution(){if(null!==this.ipResult){this.returnedIpResult||(m("Returning IP address for target "+(0,h.uriToString)(this.target)),setImmediate(()=>{this.listener.onSuccessfulResolution(this.ipResult,null,null,null,{})}),this.returnedIpResult=!0),this.backoff.stop(),this.backoff.reset(),this.stopNextResolutionTimer();return}if(null===this.dnsHostname)m("Failed to parse DNS address "+(0,h.uriToString)(this.target)),setImmediate(()=>{this.listener.onError({code:o.Status.UNAVAILABLE,details:`Failed to parse DNS address ${(0,h.uriToString)(this.target)}`,metadata:new l.Metadata})}),this.stopNextResolutionTimer();else{if(null!==this.pendingLookupPromise)return;m("Looking up DNS hostname "+this.dnsHostname),this.latestLookupResult=null;let e=this.dnsHostname;this.pendingLookupPromise=v(e,{all:!0}),this.pendingLookupPromise.then(e=>{if(null===this.pendingLookupPromise)return;this.pendingLookupPromise=null,this.backoff.reset(),this.backoff.stop();let t=e.filter(e=>4===e.family),r=e.filter(e=>6===e.family);this.latestLookupResult=b(r,t).map(e=>({host:e.address,port:+this.port}));let n="["+this.latestLookupResult.map(e=>e.host+":"+e.port).join(",")+"]";(m("Resolved addresses for target "+(0,h.uriToString)(this.target)+": "+n),0===this.latestLookupResult.length)?this.listener.onError(this.defaultResolutionError):this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})},e=>{null!==this.pendingLookupPromise&&(m("Resolution error for target "+(0,h.uriToString)(this.target)+": "+e.message),this.pendingLookupPromise=null,this.stopNextResolutionTimer(),this.listener.onError(this.defaultResolutionError))}),this.isServiceConfigEnabled&&null===this.pendingTxtPromise&&(this.pendingTxtPromise=y(e),this.pendingTxtPromise.then(e=>{if(null!==this.pendingTxtPromise){this.pendingTxtPromise=null;try{this.latestServiceConfig=(0,a.extractAndSelectServiceConfig)(e,this.percentage)}catch(e){this.latestServiceConfigError={code:o.Status.UNAVAILABLE,details:`Parsing service config failed with error ${e.message}`,metadata:new l.Metadata}}null!==this.latestLookupResult&&this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})}},e=>{}))}}startNextResolutionTimer(){var e,t;clearTimeout(this.nextResolutionTimer),this.nextResolutionTimer=null==(t=(e=setTimeout(()=>{this.stopNextResolutionTimer(),this.continueResolving&&this.startResolutionWithBackoff()},this.minTimeBetweenResolutionsMs)).unref)?void 0:t.call(e),this.isNextResolutionTimerRunning=!0}stopNextResolutionTimer(){clearTimeout(this.nextResolutionTimer),this.isNextResolutionTimerRunning=!1}startResolutionWithBackoff(){null===this.pendingLookupPromise&&(this.continueResolving=!1,this.backoff.runOnce(),this.startNextResolutionTimer(),this.startResolution())}updateResolution(){null===this.pendingLookupPromise&&(this.isNextResolutionTimerRunning||this.backoff.isRunning()?(this.isNextResolutionTimerRunning?m('resolution update delayed by "min time between resolutions" rate limit'):m("resolution update delayed by backoff timer until "+this.backoff.getEndTime().toISOString()),this.continueResolving=!0):this.startResolutionWithBackoff())}destroy(){this.continueResolving=!1,this.backoff.reset(),this.backoff.stop(),this.stopNextResolutionTimer(),this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.returnedIpResult=!1}static getDefaultAuthority(e){return e.path}}r.setup=function(){(0,n.registerResolver)("dns",S),(0,n.registerDefaultScheme)("dns")}},83841,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getProxiedConnection=r.mapProxyName=void 0;let n=e.r(82702),i=e.r(33278),s=e.r(14507),a=e.r(21517),o=e.r(55004),l=e.r(82702),u=e.r(76005),c=e.r(84848),h=e.r(92509),d=e.r(75808),f="proxy";function p(e){l.trace(i.LogVerbosity.DEBUG,f,e)}function m(){let e,t="",r="";if(process.env.grpc_proxy)r="grpc_proxy",t=process.env.grpc_proxy;else if(process.env.https_proxy)r="https_proxy",t=process.env.https_proxy;else{if(!process.env.http_proxy)return{};r="http_proxy",t=process.env.http_proxy}try{e=new h.URL(t)}catch(e){return(0,n.log)(i.LogVerbosity.ERROR,`cannot parse value of "${r}" env var`),{}}if("http:"!==e.protocol)return(0,n.log)(i.LogVerbosity.ERROR,`"${e.protocol}" scheme not supported in proxy URI`),{};let s=null;e.username&&(e.password?((0,n.log)(i.LogVerbosity.INFO,"userinfo found in proxy URI"),s=`${e.username}:${e.password}`):s=e.username);let a=e.hostname,o=e.port;""===o&&(o="80");let l={address:`${a}:${o}`};return s&&(l.creds=s),p("Proxy server "+l.address+" set by environment variable "+r),l}function g(){let e=process.env.no_grpc_proxy,t="no_grpc_proxy";return(e||(e=process.env.no_proxy,t="no_proxy"),e)?(p("No proxy server list set by environment variable "+t),e.split(",")):[]}r.mapProxyName=function(e,t){var r;let n={target:e,extraOptions:{}};if((null!=(r=t["grpc.enable_http_proxy"])?r:1)===0||"unix"===e.scheme)return n;let i=m();if(!i.address)return n;let s=(0,c.splitHostPort)(e.path);if(!s)return n;let a=s.host;for(let t of g())if(t===a)return p("Not using proxy for target in no_proxy list: "+(0,c.uriToString)(e)),n;let o={"grpc.http_connect_target":(0,c.uriToString)(e)};return i.creds&&(o["grpc.http_connect_creds"]=i.creds),{target:{scheme:"dns",path:i.address},extraOptions:o}},r.getProxiedConnection=function(e,t,r){var l;if(!("grpc.http_connect_target"in t))return Promise.resolve({});let h=t["grpc.http_connect_target"],f=(0,c.parseUri)(h);if(null===f)return Promise.resolve({});let m=(0,c.splitHostPort)(f.path);if(null===m)return Promise.resolve({});let g=`${m.host}:${null!=(l=m.port)?l:d.DEFAULT_PORT}`,y={method:"CONNECT",path:g},v={Host:g};(0,u.isTcpSubchannelAddress)(e)?(y.host=e.host,y.port=e.port):y.socketPath=e.path,"grpc.http_connect_creds"in t&&(v["Proxy-Authorization"]="Basic "+Buffer.from(t["grpc.http_connect_creds"]).toString("base64")),y.headers=v;let b=(0,u.subchannelAddressToString)(e);return p("Using proxy "+b+" to connect to "+y.path),new Promise((e,t)=>{let l=a.request(y);l.once("connect",(a,u,h)=>{var d;if(l.removeAllListeners(),u.removeAllListeners(),200===a.statusCode)if(p("Successfully connected to "+y.path+" through proxy "+b),"secureContext"in r){let n=(0,s.getDefaultAuthority)(f),i=(0,c.splitHostPort)(n),a=null!=(d=null==i?void 0:i.host)?d:n,l=o.connect(Object.assign({host:a,servername:a,socket:u},r),()=>{p("Successfully established a TLS connection to "+y.path+" through proxy "+b),e({socket:l,realTarget:f})});l.on("error",e=>{p("Failed to establish a TLS connection to "+y.path+" through proxy "+b+" with error "+e.message),t()})}else p("Successfully established a plaintext connection to "+y.path+" through proxy "+b),e({socket:u,realTarget:f});else(0,n.log)(i.LogVerbosity.ERROR,"Failed to connect to "+y.path+" through proxy "+b+" with status "+a.statusCode),t()}),l.once("error",e=>{l.removeAllListeners(),(0,n.log)(i.LogVerbosity.ERROR,"Failed to connect to proxy "+b+" with error "+e.message),t()}),l.end()})}},41034,(e,t,r)=>{"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0}),r.StreamDecoder=void 0,function(e){e[e.NO_DATA=0]="NO_DATA",e[e.READING_SIZE=1]="READING_SIZE",e[e.READING_MESSAGE=2]="READING_MESSAGE"}(n||(n={}));class i{constructor(e){this.maxReadMessageLength=e,this.readState=n.NO_DATA,this.readCompressFlag=Buffer.alloc(1),this.readPartialSize=Buffer.alloc(4),this.readSizeRemaining=4,this.readMessageSize=0,this.readPartialMessage=[],this.readMessageRemaining=0}write(e){let t,r=0,i=[];for(;r<e.length;)switch(this.readState){case n.NO_DATA:this.readCompressFlag=e.slice(r,r+1),r+=1,this.readState=n.READING_SIZE,this.readPartialSize.fill(0),this.readSizeRemaining=4,this.readMessageSize=0,this.readMessageRemaining=0,this.readPartialMessage=[];break;case n.READING_SIZE:if(t=Math.min(e.length-r,this.readSizeRemaining),e.copy(this.readPartialSize,4-this.readSizeRemaining,r,r+t),this.readSizeRemaining-=t,r+=t,0===this.readSizeRemaining){if(this.readMessageSize=this.readPartialSize.readUInt32BE(0),-1!==this.maxReadMessageLength&&this.readMessageSize>this.maxReadMessageLength)throw Error(`Received message larger than max (${this.readMessageSize} vs ${this.maxReadMessageLength})`);if(this.readMessageRemaining=this.readMessageSize,this.readMessageRemaining>0)this.readState=n.READING_MESSAGE;else{let e=Buffer.concat([this.readCompressFlag,this.readPartialSize],5);this.readState=n.NO_DATA,i.push(e)}}break;case n.READING_MESSAGE:if(t=Math.min(e.length-r,this.readMessageRemaining),this.readPartialMessage.push(e.slice(r,r+t)),this.readMessageRemaining-=t,r+=t,0===this.readMessageRemaining){let e=[this.readCompressFlag,this.readPartialSize].concat(this.readPartialMessage),t=Buffer.concat(e,this.readMessageSize+5);this.readState=n.NO_DATA,i.push(t)}break;default:throw Error("Unexpected read state")}return i}}r.StreamDecoder=i},44226,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Http2SubchannelCall=void 0;let n=e.r(25328),i=e.r(46786),s=e.r(33278),a=e.r(64346),o=e.r(41034),l=e.r(82702),u=e.r(33278),c="subchannel_call";function h(e){for(let[t,r]of Object.entries(i.constants.errno))if(r===e)return t;return"Unknown system error "+e}class d{constructor(e,t,r,i,l){var u;this.http2Stream=e,this.callEventTracker=t,this.listener=r,this.transport=i,this.callId=l,this.isReadFilterPending=!1,this.isPushPending=!1,this.canPush=!1,this.readsClosed=!1,this.statusOutput=!1,this.unpushedReadMessages=[],this.mappedStatusCode=s.Status.UNKNOWN,this.finalStatus=null,this.internalError=null;const c=null!=(u=i.getOptions()["grpc.max_receive_message_length"])?u:s.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH;this.decoder=new o.StreamDecoder(c),e.on("response",(e,t)=>{let r="";for(let t of Object.keys(e))r+="		"+t+": "+e[t]+"\n";switch(this.trace("Received server headers:\n"+r),e[":status"]){case 400:this.mappedStatusCode=s.Status.INTERNAL;break;case 401:this.mappedStatusCode=s.Status.UNAUTHENTICATED;break;case 403:this.mappedStatusCode=s.Status.PERMISSION_DENIED;break;case 404:this.mappedStatusCode=s.Status.UNIMPLEMENTED;break;case 429:case 502:case 503:case 504:this.mappedStatusCode=s.Status.UNAVAILABLE;break;default:this.mappedStatusCode=s.Status.UNKNOWN}if(t&n.constants.NGHTTP2_FLAG_END_STREAM)this.handleTrailers(e);else{let t;try{t=a.Metadata.fromHttp2Headers(e)}catch(e){this.endCall({code:s.Status.UNKNOWN,details:e.message,metadata:new a.Metadata});return}this.listener.onReceiveMetadata(t)}}),e.on("trailers",e=>{this.handleTrailers(e)}),e.on("data",e=>{let t;if(!this.statusOutput){this.trace("receive HTTP/2 data frame of length "+e.length);try{t=this.decoder.write(e)}catch(e){this.cancelWithStatus(s.Status.RESOURCE_EXHAUSTED,e.message);return}for(let e of t)this.trace("parsed message of length "+e.length),this.callEventTracker.addMessageReceived(),this.tryPush(e)}}),e.on("end",()=>{this.readsClosed=!0,this.maybeOutputStatus()}),e.on("close",()=>{process.nextTick(()=>{var t;let r;if(this.trace("HTTP/2 stream closed with code "+e.rstCode),(null==(t=this.finalStatus)?void 0:t.code)===s.Status.OK)return;let i="";switch(e.rstCode){case n.constants.NGHTTP2_NO_ERROR:if(null!==this.finalStatus)return;r=s.Status.INTERNAL,i=`Received RST_STREAM with code ${e.rstCode}`;break;case n.constants.NGHTTP2_REFUSED_STREAM:r=s.Status.UNAVAILABLE,i="Stream refused by server";break;case n.constants.NGHTTP2_CANCEL:r=s.Status.CANCELLED,i="Call cancelled";break;case n.constants.NGHTTP2_ENHANCE_YOUR_CALM:r=s.Status.RESOURCE_EXHAUSTED,i="Bandwidth exhausted or memory limit exceeded";break;case n.constants.NGHTTP2_INADEQUATE_SECURITY:r=s.Status.PERMISSION_DENIED,i="Protocol not secure enough";break;case n.constants.NGHTTP2_INTERNAL_ERROR:r=s.Status.INTERNAL,null===this.internalError?i=`Received RST_STREAM with code ${e.rstCode} (Internal server error)`:"ECONNRESET"===this.internalError.code||"ETIMEDOUT"===this.internalError.code?(r=s.Status.UNAVAILABLE,i=this.internalError.message):i=`Received RST_STREAM with code ${e.rstCode} triggered by internal client error: ${this.internalError.message}`;break;default:r=s.Status.INTERNAL,i=`Received RST_STREAM with code ${e.rstCode}`}this.endCall({code:r,details:i,metadata:new a.Metadata,rstCode:e.rstCode})})}),e.on("error",e=>{"ERR_HTTP2_STREAM_ERROR"!==e.code&&(this.trace("Node error event: message="+e.message+" code="+e.code+" errno="+h(e.errno)+" syscall="+e.syscall),this.internalError=e),this.callEventTracker.onStreamEnd(!1)})}onDisconnect(){this.endCall({code:s.Status.UNAVAILABLE,details:"Connection dropped",metadata:new a.Metadata})}outputStatus(){this.statusOutput||(this.statusOutput=!0,this.trace("ended with status: code="+this.finalStatus.code+' details="'+this.finalStatus.details+'"'),this.callEventTracker.onCallEnd(this.finalStatus),process.nextTick(()=>{this.listener.onReceiveStatus(this.finalStatus)}),this.http2Stream.resume())}trace(e){l.trace(u.LogVerbosity.DEBUG,c,"["+this.callId+"] "+e)}endCall(e){(null===this.finalStatus||this.finalStatus.code===s.Status.OK)&&(this.finalStatus=e,this.maybeOutputStatus()),this.destroyHttp2Stream()}maybeOutputStatus(){null===this.finalStatus||this.finalStatus.code===s.Status.OK&&(!this.readsClosed||0!==this.unpushedReadMessages.length||this.isReadFilterPending||this.isPushPending)||this.outputStatus()}push(e){this.trace("pushing to reader message of length "+(e instanceof Buffer?e.length:null)),this.canPush=!1,this.isPushPending=!0,process.nextTick(()=>{this.isPushPending=!1,this.statusOutput||(this.listener.onReceiveMessage(e),this.maybeOutputStatus())})}tryPush(e){this.canPush?(this.http2Stream.pause(),this.push(e)):(this.trace("unpushedReadMessages.push message of length "+e.length),this.unpushedReadMessages.push(e))}handleTrailers(e){let t;this.callEventTracker.onStreamEnd(!0);let r="";for(let t of Object.keys(e))r+="		"+t+": "+e[t]+"\n";this.trace("Received server trailers:\n"+r);try{t=a.Metadata.fromHttp2Headers(e)}catch(e){t=new a.Metadata}let n=t.getMap(),i=this.mappedStatusCode;if(i===s.Status.UNKNOWN&&"string"==typeof n["grpc-status"]){let e=Number(n["grpc-status"]);e in s.Status&&(i=e,this.trace("received status code "+e+" from server")),t.remove("grpc-status")}let o="";if("string"==typeof n["grpc-message"]){try{o=decodeURI(n["grpc-message"])}catch(e){o=n["grpc-message"]}t.remove("grpc-message"),this.trace('received status details string "'+o+'" from server')}let l={code:i,details:o,metadata:t};this.endCall(l)}destroyHttp2Stream(){var e;if(!this.http2Stream.destroyed){let t;t=(null==(e=this.finalStatus)?void 0:e.code)===s.Status.OK?n.constants.NGHTTP2_NO_ERROR:n.constants.NGHTTP2_CANCEL,this.trace("close http2 stream with code "+t),this.http2Stream.close(t)}}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.endCall({code:e,details:t,metadata:new a.Metadata})}getStatus(){return this.finalStatus}getPeer(){return this.transport.getPeerName()}getCallNumber(){return this.callId}startRead(){if(null!==this.finalStatus&&this.finalStatus.code!==s.Status.OK){this.readsClosed=!0,this.maybeOutputStatus();return}if(this.canPush=!0,this.unpushedReadMessages.length>0){let e=this.unpushedReadMessages.shift();this.push(e);return}this.http2Stream.resume()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length);let r=t=>{process.nextTick(()=>{var r;let n=s.Status.UNAVAILABLE;(null==t?void 0:t.code)==="ERR_STREAM_WRITE_AFTER_END"&&(n=s.Status.INTERNAL),t&&this.cancelWithStatus(n,`Write error: ${t.message}`),null==(r=e.callback)||r.call(e)})};this.trace("sending data chunk of length "+t.length),this.callEventTracker.addMessageSent();try{this.http2Stream.write(t,r)}catch(e){this.endCall({code:s.Status.UNAVAILABLE,details:`Write failed with error ${e.message}`,metadata:new a.Metadata})}}halfClose(){this.trace("end() called"),this.trace("calling end() on HTTP/2 stream"),this.http2Stream.end()}}r.Http2SubchannelCall=d},43721,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getNextCallNumber=void 0;let n=0;r.getNextCallNumber=function(){return n++}},89475,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Http2SubchannelConnector=void 0;let n=e.r(25328),i=e.r(55004),s=e.r(86039),a=e.r(33278),o=e.r(83841),l=e.r(82702),u=e.r(14507),c=e.r(76005),h=e.r(84848),d=e.r(4446),f=e.r(44226),p=e.r(43721),m="transport",g="transport_flowctrl",y=e.r(53347).version,{HTTP2_HEADER_AUTHORITY:v,HTTP2_HEADER_CONTENT_TYPE:b,HTTP2_HEADER_METHOD:S,HTTP2_HEADER_PATH:w,HTTP2_HEADER_TE:C,HTTP2_HEADER_USER_AGENT:T}=n.constants,E=2e4,_=Buffer.from("too_many_pings","ascii");class I{constructor(e,t,r,i){this.session=e,this.options=r,this.remoteName=i,this.keepaliveTimeMs=-1,this.keepaliveTimeoutMs=E,this.keepaliveTimerId=null,this.pendingSendKeepalivePing=!1,this.keepaliveTimeoutId=null,this.keepaliveWithoutCalls=!1,this.activeCalls=new Set,this.disconnectListeners=[],this.disconnectHandled=!1,this.channelzEnabled=!0,this.streamTracker=new s.ChannelzCallTracker,this.keepalivesSent=0,this.messagesSent=0,this.messagesReceived=0,this.lastMessageSentTimestamp=null,this.lastMessageReceivedTimestamp=null,this.subchannelAddressString=(0,c.subchannelAddressToString)(t),0===r["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzRef=(0,s.registerChannelzSocket)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.userAgent=[r["grpc.primary_user_agent"],`grpc-node-js/${y}`,r["grpc.secondary_user_agent"]].filter(e=>e).join(" "),"grpc.keepalive_time_ms"in r&&(this.keepaliveTimeMs=r["grpc.keepalive_time_ms"]),"grpc.keepalive_timeout_ms"in r&&(this.keepaliveTimeoutMs=r["grpc.keepalive_timeout_ms"]),"grpc.keepalive_permit_without_calls"in r?this.keepaliveWithoutCalls=1===r["grpc.keepalive_permit_without_calls"]:this.keepaliveWithoutCalls=!1,e.once("close",()=>{this.trace("session closed"),this.stopKeepalivePings(),this.handleDisconnect()}),e.once("goaway",(e,t,r)=>{let i=!1;e===n.constants.NGHTTP2_ENHANCE_YOUR_CALM&&r&&r.equals(_)&&(i=!0),this.trace("connection closed by GOAWAY with code "+e+" and data "+(null==r?void 0:r.toString())),this.reportDisconnectToOwner(i)}),e.once("error",e=>{this.trace("connection closed with error "+e.message)}),l.isTracerEnabled(m)&&(e.on("remoteSettings",t=>{this.trace("new settings received"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(t))}),e.on("localSettings",t=>{this.trace("local settings acknowledged by remote"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(t))})),this.keepaliveWithoutCalls&&this.maybeStartKeepalivePingTimer()}getChannelzInfo(){var e,t,r;let n,i=this.session.socket,s=i.remoteAddress?(0,c.stringToSubchannelAddress)(i.remoteAddress,i.remotePort):null,a=i.localAddress?(0,c.stringToSubchannelAddress)(i.localAddress,i.localPort):null;if(this.session.encrypted){let t=i,r=t.getCipher(),s=t.getCertificate(),a=t.getPeerCertificate();n={cipherSuiteStandardName:null!=(e=r.standardName)?e:null,cipherSuiteOtherName:r.standardName?null:r.name,localCertificate:s&&"raw"in s?s.raw:null,remoteCertificate:a&&"raw"in a?a.raw:null}}else n=null;return{remoteAddress:s,localAddress:a,security:n,remoteName:this.remoteName,streamsStarted:this.streamTracker.callsStarted,streamsSucceeded:this.streamTracker.callsSucceeded,streamsFailed:this.streamTracker.callsFailed,messagesSent:this.messagesSent,messagesReceived:this.messagesReceived,keepAlivesSent:this.keepalivesSent,lastLocalStreamCreatedTimestamp:this.streamTracker.lastCallStartedTimestamp,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:this.lastMessageSentTimestamp,lastMessageReceivedTimestamp:this.lastMessageReceivedTimestamp,localFlowControlWindow:null!=(t=this.session.state.localWindowSize)?t:null,remoteFlowControlWindow:null!=(r=this.session.state.remoteWindowSize)?r:null}}trace(e){l.trace(a.LogVerbosity.DEBUG,m,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}keepaliveTrace(e){l.trace(a.LogVerbosity.DEBUG,"keepalive","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}flowControlTrace(e){l.trace(a.LogVerbosity.DEBUG,g,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}internalsTrace(e){l.trace(a.LogVerbosity.DEBUG,"transport_internals","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}reportDisconnectToOwner(e){this.disconnectHandled||(this.disconnectHandled=!0,this.disconnectListeners.forEach(t=>t(e)))}handleDisconnect(){this.reportDisconnectToOwner(!1),setImmediate(()=>{for(let e of this.activeCalls)e.onDisconnect()})}addDisconnectListener(e){this.disconnectListeners.push(e)}clearKeepaliveTimer(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null)}clearKeepaliveTimeout(){this.keepaliveTimeoutId&&(clearTimeout(this.keepaliveTimeoutId),this.keepaliveTimeoutId=null)}canSendPing(){return this.keepaliveTimeMs>0&&(this.keepaliveWithoutCalls||this.activeCalls.size>0)}maybeSendPing(){var e,t;if(this.clearKeepaliveTimer(),!this.canSendPing()){this.pendingSendKeepalivePing=!0;return}this.channelzEnabled&&(this.keepalivesSent+=1),this.keepaliveTrace("Sending ping with timeout "+this.keepaliveTimeoutMs+"ms"),this.keepaliveTimeoutId||(this.keepaliveTimeoutId=setTimeout(()=>{this.keepaliveTrace("Ping timeout passed without response"),this.handleDisconnect()},this.keepaliveTimeoutMs),null==(t=(e=this.keepaliveTimeoutId).unref)||t.call(e));try{this.session.ping((e,t,r)=>{e&&(this.keepaliveTrace("Ping failed with error "+e.message),this.handleDisconnect()),this.keepaliveTrace("Received ping response"),this.clearKeepaliveTimeout(),this.maybeStartKeepalivePingTimer()})}catch(e){this.handleDisconnect()}}maybeStartKeepalivePingTimer(){var e,t;this.canSendPing()&&(this.pendingSendKeepalivePing?(this.pendingSendKeepalivePing=!1,this.maybeSendPing()):this.keepaliveTimerId||this.keepaliveTimeoutId||(this.keepaliveTrace("Starting keepalive timer for "+this.keepaliveTimeMs+"ms"),this.keepaliveTimerId=null==(t=(e=setTimeout(()=>{this.maybeSendPing()},this.keepaliveTimeMs)).unref)?void 0:t.call(e)))}stopKeepalivePings(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null),this.clearKeepaliveTimeout()}removeActiveCall(e){this.activeCalls.delete(e),0===this.activeCalls.size&&this.session.unref()}addActiveCall(e){this.activeCalls.add(e),1===this.activeCalls.size&&(this.session.ref(),this.keepaliveWithoutCalls||this.maybeStartKeepalivePingTimer())}createCall(e,t,r,n,i){let s,a,o,l=e.toHttp2Headers();l[v]=t,l[T]=this.userAgent,l[b]="application/grpc",l[S]="POST",l[w]=r,l[C]="trailers";try{s=this.session.request(l)}catch(e){throw this.handleDisconnect(),e}return this.flowControlTrace("local window size: "+this.session.state.localWindowSize+" remote window size: "+this.session.state.remoteWindowSize),this.internalsTrace("session.closed="+this.session.closed+" session.destroyed="+this.session.destroyed+" session.socket.destroyed="+this.session.socket.destroyed),this.channelzEnabled?(this.streamTracker.addCallStarted(),a={addMessageSent:()=>{var e;this.messagesSent+=1,this.lastMessageSentTimestamp=new Date,null==(e=i.addMessageSent)||e.call(i)},addMessageReceived:()=>{var e;this.messagesReceived+=1,this.lastMessageReceivedTimestamp=new Date,null==(e=i.addMessageReceived)||e.call(i)},onCallEnd:e=>{var t;null==(t=i.onCallEnd)||t.call(i,e),this.removeActiveCall(o)},onStreamEnd:e=>{var t;e?this.streamTracker.addCallSucceeded():this.streamTracker.addCallFailed(),null==(t=i.onStreamEnd)||t.call(i,e)}}):a={addMessageSent:()=>{var e;null==(e=i.addMessageSent)||e.call(i)},addMessageReceived:()=>{var e;null==(e=i.addMessageReceived)||e.call(i)},onCallEnd:e=>{var t;null==(t=i.onCallEnd)||t.call(i,e),this.removeActiveCall(o)},onStreamEnd:e=>{var t;null==(t=i.onStreamEnd)||t.call(i,e)}},o=new f.Http2SubchannelCall(s,a,n,this,(0,p.getNextCallNumber)()),this.addActiveCall(o),o}getChannelzRef(){return this.channelzRef}getPeerName(){return this.subchannelAddressString}getOptions(){return this.options}shutdown(){this.session.close(),(0,s.unregisterChannelzRef)(this.channelzRef)}}class k{constructor(e){this.channelTarget=e,this.session=null,this.isShutdown=!1}trace(e){l.trace(a.LogVerbosity.DEBUG,m,(0,h.uriToString)(this.channelTarget)+" "+e)}createSession(e,t,r,s){return this.isShutdown?Promise.reject():new Promise((a,o)=>{var l,f,p;let m;s.realTarget?(m=(0,h.uriToString)(s.realTarget),this.trace("creating HTTP/2 session through proxy to "+(0,h.uriToString)(s.realTarget))):(m=null,this.trace("creating HTTP/2 session to "+(0,c.subchannelAddressToString)(e)));let g=(0,u.getDefaultAuthority)(null!=(l=s.realTarget)?l:this.channelTarget),y=t._getConnectionOptions()||{};y.maxSendHeaderBlockLength=Number.MAX_SAFE_INTEGER,"grpc-node.max_session_memory"in r?y.maxSessionMemory=r["grpc-node.max_session_memory"]:y.maxSessionMemory=Number.MAX_SAFE_INTEGER;let v="http://";if("secureContext"in y){if(v="https://",r["grpc.ssl_target_name_override"]){let e=r["grpc.ssl_target_name_override"];y.checkServerIdentity=(t,r)=>(0,i.checkServerIdentity)(e,r),y.servername=e}else{let e=null!=(p=null==(f=(0,h.splitHostPort)(g))?void 0:f.host)?p:"localhost";y.servername=e}s.socket&&(y.createConnection=(e,t)=>s.socket)}else y.createConnection=(t,r)=>s.socket?s.socket:d.connect(e);y=Object.assign(Object.assign(Object.assign({},y),e),{enableTrace:1===r["grpc-node.tls_enable_trace"]});let b=n.connect(v+g,y);this.session=b;let S="Failed to connect";b.unref(),b.once("connect",()=>{b.removeAllListeners(),a(new I(b,e,r,m)),this.session=null}),b.once("close",()=>{this.session=null,setImmediate(()=>{o(`${S} (${new Date().toISOString()})`)})}),b.once("error",e=>{S=e.message,this.trace("connection failed with error "+S)})})}connect(e,t,r){var n,s;if(this.isShutdown)return Promise.reject();let a=t._getConnectionOptions()||{};if("secureContext"in a){if(a.ALPNProtocols=["h2"],r["grpc.ssl_target_name_override"]){let e=r["grpc.ssl_target_name_override"];a.checkServerIdentity=(t,r)=>(0,i.checkServerIdentity)(e,r),a.servername=e}else if("grpc.http_connect_target"in r){let e=(0,u.getDefaultAuthority)(null!=(n=(0,h.parseUri)(r["grpc.http_connect_target"]))?n:{path:"localhost"}),t=(0,h.splitHostPort)(e);a.servername=null!=(s=null==t?void 0:t.host)?s:e}r["grpc-node.tls_enable_trace"]&&(a.enableTrace=!0)}return(0,o.getProxiedConnection)(e,r,a).then(n=>this.createSession(e,t,r,n))}shutdown(){var e;this.isShutdown=!0,null==(e=this.session)||e.close(),this.session=null}}r.Http2SubchannelConnector=k},9028,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getSubchannelPool=r.SubchannelPool=void 0;let n=e.r(3112),i=e.r(60253),s=e.r(76005),a=e.r(84848),o=e.r(89475),l=1e4;class u{constructor(){this.pool=Object.create(null),this.cleanupTimer=null}unrefUnusedSubchannels(){let e=!0;for(let t in this.pool){let r=this.pool[t].filter(e=>!e.subchannel.unrefIfOneRef());r.length>0&&(e=!1),this.pool[t]=r}e&&null!==this.cleanupTimer&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null)}ensureCleanupTask(){var e,t;null===this.cleanupTimer&&(this.cleanupTimer=setInterval(()=>{this.unrefUnusedSubchannels()},l),null==(t=(e=this.cleanupTimer).unref)||t.call(e))}getOrCreateSubchannel(e,t,r,l){this.ensureCleanupTask();let u=(0,a.uriToString)(e);if(u in this.pool){for(let e of this.pool[u])if((0,s.subchannelAddressEqual)(t,e.subchannelAddress)&&(0,n.channelOptionsEqual)(r,e.channelArguments)&&l._equals(e.channelCredentials))return e.subchannel}let c=new i.Subchannel(e,t,r,l,new o.Http2SubchannelConnector(e));return u in this.pool||(this.pool[u]=[]),this.pool[u].push({subchannelAddress:t,channelArguments:r,channelCredentials:l,subchannel:c}),c.ref(),c}}r.SubchannelPool=u;let c=new u;r.getSubchannelPool=function(e){return e?c:new u}},25747,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.FilterStackFactory=r.FilterStack=void 0;class n{constructor(e){this.filters=e}sendMetadata(e){let t=e;for(let e=0;e<this.filters.length;e++)t=this.filters[e].sendMetadata(t);return t}receiveMetadata(e){let t=e;for(let e=this.filters.length-1;e>=0;e--)t=this.filters[e].receiveMetadata(t);return t}sendMessage(e){let t=e;for(let e=0;e<this.filters.length;e++)t=this.filters[e].sendMessage(t);return t}receiveMessage(e){let t=e;for(let e=this.filters.length-1;e>=0;e--)t=this.filters[e].receiveMessage(t);return t}receiveTrailers(e){let t=e;for(let e=this.filters.length-1;e>=0;e--)t=this.filters[e].receiveTrailers(t);return t}push(e){this.filters.unshift(...e)}getFilters(){return this.filters}}r.FilterStack=n;class i{constructor(e){this.factories=e}push(e){this.factories.unshift(...e)}clone(){return new i([...this.factories])}createFilter(){return new n(this.factories.map(e=>e.createFilter()))}}r.FilterStackFactory=i},5868,(e,t,r)=>{"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0}),r.CompressionAlgorithms=void 0,function(e){e[e.identity=0]="identity",e[e.deflate=1]="deflate",e[e.gzip=2]="gzip"}(n||(r.CompressionAlgorithms=n={}))},96612,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.BaseFilter=void 0;class n{async sendMetadata(e){return e}receiveMetadata(e){return e}async sendMessage(e){return e}async receiveMessage(e){return e}receiveTrailers(e){return e}}r.BaseFilter=n},53145,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.CompressionFilterFactory=r.CompressionFilter=void 0;let n=e.r(6461),i=e.r(5868),s=e.r(33278),a=e.r(96612),o=e.r(82702),l=e=>"number"==typeof e&&"string"==typeof i.CompressionAlgorithms[e];class u{async writeMessage(e,t){let r=e;t&&(r=await this.compressMessage(r));let n=Buffer.allocUnsafe(r.length+5);return n.writeUInt8(+!!t,0),n.writeUInt32BE(r.length,1),r.copy(n,5),n}async readMessage(e){let t=1===e.readUInt8(0),r=e.slice(5);return t&&(r=await this.decompressMessage(r)),r}}class c extends u{async compressMessage(e){return e}async writeMessage(e,t){let r=Buffer.allocUnsafe(e.length+5);return r.writeUInt8(0,0),r.writeUInt32BE(e.length,1),e.copy(r,5),r}decompressMessage(e){return Promise.reject(Error('Received compressed message but "grpc-encoding" header was identity'))}}class h extends u{constructor(e){super(),this.maxRecvMessageLength=e}compressMessage(e){return new Promise((t,r)=>{n.deflate(e,(e,n)=>{e?r(e):t(n)})})}decompressMessage(e){return new Promise((t,r)=>{let i=0,a=[],o=n.createInflate();o.on("data",e=>{a.push(e),i+=e.byteLength,-1!==this.maxRecvMessageLength&&i>this.maxRecvMessageLength&&(o.destroy(),r({code:s.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),o.on("end",()=>{t(Buffer.concat(a))}),o.write(e),o.end()})}}class d extends u{constructor(e){super(),this.maxRecvMessageLength=e}compressMessage(e){return new Promise((t,r)=>{n.gzip(e,(e,n)=>{e?r(e):t(n)})})}decompressMessage(e){return new Promise((t,r)=>{let i=0,a=[],o=n.createGunzip();o.on("data",e=>{a.push(e),i+=e.byteLength,-1!==this.maxRecvMessageLength&&i>this.maxRecvMessageLength&&(o.destroy(),r({code:s.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),o.on("end",()=>{t(Buffer.concat(a))}),o.write(e),o.end()})}}class f extends u{constructor(e){super(),this.compressionName=e}compressMessage(e){return Promise.reject(Error(`Received message compressed with unsupported compression method ${this.compressionName}`))}decompressMessage(e){return Promise.reject(Error(`Compression method not supported: ${this.compressionName}`))}}function p(e,t){switch(e){case"identity":return new c;case"deflate":return new h(t);case"gzip":return new d(t);default:return new f(e)}}class m extends a.BaseFilter{constructor(e,t){var r,n;super(),this.sharedFilterConfig=t,this.sendCompression=new c,this.receiveCompression=new c,this.currentCompressionAlgorithm="identity";const a=e["grpc.default_compression_algorithm"];if(this.maxReceiveMessageLength=null!=(r=e["grpc.max_receive_message_length"])?r:s.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,void 0!==a)if(l(a)){const e=i.CompressionAlgorithms[a],r=null==(n=t.serverSupportedEncodingHeader)?void 0:n.split(",");(!r||r.includes(e))&&(this.currentCompressionAlgorithm=e,this.sendCompression=p(this.currentCompressionAlgorithm,-1))}else o.log(s.LogVerbosity.ERROR,`Invalid value provided for grpc.default_compression_algorithm option: ${a}`)}async sendMetadata(e){let t=await e;return t.set("grpc-accept-encoding","identity,deflate,gzip"),t.set("accept-encoding","identity"),"identity"===this.currentCompressionAlgorithm?t.remove("grpc-encoding"):t.set("grpc-encoding",this.currentCompressionAlgorithm),t}receiveMetadata(e){let t=e.get("grpc-encoding");if(t.length>0){let e=t[0];"string"==typeof e&&(this.receiveCompression=p(e,this.maxReceiveMessageLength))}e.remove("grpc-encoding");let r=e.get("grpc-accept-encoding")[0];return r&&(this.sharedFilterConfig.serverSupportedEncodingHeader=r,r.split(",").includes(this.currentCompressionAlgorithm)||(this.sendCompression=new c,this.currentCompressionAlgorithm="identity")),e.remove("grpc-accept-encoding"),e}async sendMessage(e){var t;let r,n=await e;return r=!(this.sendCompression instanceof c)&&((null!=(t=n.flags)?t:0)&2)==0,{message:await this.sendCompression.writeMessage(n.message,r),flags:n.flags}}async receiveMessage(e){return this.receiveCompression.readMessage(await e)}}r.CompressionFilter=m;class g{constructor(e,t){this.options=t,this.sharedFilterConfig={}}createFilter(){return new m(this.options,this.sharedFilterConfig)}}r.CompressionFilterFactory=g},39149,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.deadlineToString=r.getRelativeTimeout=r.getDeadlineTimeoutString=r.minDeadline=void 0,r.minDeadline=function(...e){let t=1/0;for(let r of e){let e=r instanceof Date?r.getTime():r;e<t&&(t=e)}return t};let n=[["m",1],["S",1e3],["M",6e4],["H",36e5]];r.getDeadlineTimeoutString=function(e){let t=new Date().getTime();e instanceof Date&&(e=e.getTime());let r=Math.max(e-t,0);for(let[e,t]of n){let n=r/t;if(n<1e8)return String(Math.ceil(n))+e}throw Error("Deadline is too far in the future")};let i=0x7fffffff;r.getRelativeTimeout=function(e){let t=(e instanceof Date?e.getTime():e)-new Date().getTime();return t<0?0:t>i?1/0:t},r.deadlineToString=function(e){if(e instanceof Date)return e.toISOString();{let t=new Date(e);return Number.isNaN(t.getTime())?""+e:t.toISOString()}}},46920,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.restrictControlPlaneStatusCode=void 0;let n=e.r(33278),i=[n.Status.OK,n.Status.INVALID_ARGUMENT,n.Status.NOT_FOUND,n.Status.ALREADY_EXISTS,n.Status.FAILED_PRECONDITION,n.Status.ABORTED,n.Status.OUT_OF_RANGE,n.Status.DATA_LOSS];r.restrictControlPlaneStatusCode=function(e,t){return i.includes(e)?{code:n.Status.INTERNAL,details:`Invalid status from control plane: ${e} ${n.Status[e]} ${t}`}:{code:e,details:t}}},2646,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.LoadBalancingCall=void 0;let n=e.r(7541),i=e.r(33278),s=e.r(39149),a=e.r(64346),o=e.r(90551),l=e.r(84848),u=e.r(82702),c=e.r(46920),h=e.r(25328),d="load_balancing_call";class f{constructor(e,t,r,n,i,s,a){var o,u;this.channel=e,this.callConfig=t,this.methodName=r,this.host=n,this.credentials=i,this.deadline=s,this.callNumber=a,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.metadata=null,this.listener=null,this.onCallEnded=null;const c=this.methodName.split("/");let h="";c.length>=2&&(h=c[1]);const d=null!=(u=null==(o=(0,l.splitHostPort)(this.host))?void 0:o.host)?u:"localhost";this.serviceUrl=`https://${d}/${h}`}trace(e){u.trace(i.LogVerbosity.DEBUG,d,"["+this.callNumber+"] "+e)}outputStatus(e,t){var r,n;if(!this.ended){this.ended=!0,this.trace("ended with status: code="+e.code+' details="'+e.details+'"');let i=Object.assign(Object.assign({},e),{progress:t});null==(r=this.listener)||r.onReceiveStatus(i),null==(n=this.onCallEnded)||n.call(this,i.code)}}doPick(){var e,t;if(this.ended)return;if(!this.metadata)throw Error("doPick called before start");this.trace("Pick called");let r=this.channel.doPick(this.metadata,this.callConfig.pickInformation),l=r.subchannel?"("+r.subchannel.getChannelzRef().id+") "+r.subchannel.getAddress():""+r.subchannel;switch(this.trace("Pick result: "+o.PickResultType[r.pickResultType]+" subchannel: "+l+" status: "+(null==(e=r.status)?void 0:e.code)+" "+(null==(t=r.status)?void 0:t.details)),r.pickResultType){case o.PickResultType.COMPLETE:this.credentials.generateMetadata({service_url:this.serviceUrl}).then(e=>{var t,o,u;if(this.ended)return void this.trace("Credentials metadata generation finished after call ended");let c=this.metadata.clone();if(c.merge(e),c.get("authorization").length>1&&this.outputStatus({code:i.Status.INTERNAL,details:'"authorization" metadata cannot have multiple values',metadata:new a.Metadata},"PROCESSED"),r.subchannel.getConnectivityState()!==n.ConnectivityState.READY){this.trace("Picked subchannel "+l+" has state "+n.ConnectivityState[r.subchannel.getConnectivityState()]+" after getting credentials metadata. Retrying pick"),this.doPick();return}this.deadline!==1/0&&c.set("grpc-timeout",(0,s.getDeadlineTimeoutString)(this.deadline));try{this.child=r.subchannel.getRealSubchannel().createCall(c,this.host,this.methodName,{onReceiveMetadata:e=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(e)},onReceiveMessage:e=>{this.trace("Received message"),this.listener.onReceiveMessage(e)},onReceiveStatus:e=>{this.trace("Received status"),e.rstCode===h.constants.NGHTTP2_REFUSED_STREAM?this.outputStatus(e,"REFUSED"):this.outputStatus(e,"PROCESSED")}})}catch(e){this.trace("Failed to start call on picked subchannel "+l+" with error "+e.message),this.outputStatus({code:i.Status.INTERNAL,details:"Failed to start HTTP/2 stream with error "+e.message,metadata:new a.Metadata},"NOT_STARTED");return}null==(o=(t=this.callConfig).onCommitted)||o.call(t),null==(u=r.onCallStarted)||u.call(r),this.onCallEnded=r.onCallEnded,this.trace("Created child call ["+this.child.getCallNumber()+"]"),this.readPending&&this.child.startRead(),this.pendingMessage&&this.child.sendMessageWithContext(this.pendingMessage.context,this.pendingMessage.message),this.pendingHalfClose&&this.child.halfClose()},e=>{let{code:t,details:r}=(0,c.restrictControlPlaneStatusCode)("number"==typeof e.code?e.code:i.Status.UNKNOWN,`Getting metadata from plugin failed with error: ${e.message}`);this.outputStatus({code:t,details:r,metadata:new a.Metadata},"PROCESSED")});break;case o.PickResultType.DROP:let{code:u,details:d}=(0,c.restrictControlPlaneStatusCode)(r.status.code,r.status.details);setImmediate(()=>{this.outputStatus({code:u,details:d,metadata:r.status.metadata},"DROP")});break;case o.PickResultType.TRANSIENT_FAILURE:if(this.metadata.getOptions().waitForReady)this.channel.queueCallForPick(this);else{let{code:e,details:t}=(0,c.restrictControlPlaneStatusCode)(r.status.code,r.status.details);setImmediate(()=>{this.outputStatus({code:e,details:t,metadata:r.status.metadata},"PROCESSED")})}break;case o.PickResultType.QUEUE:this.channel.queueCallForPick(this)}}cancelWithStatus(e,t){var r;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),null==(r=this.child)||r.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new a.Metadata},"PROCESSED")}getPeer(){var e,t;return null!=(t=null==(e=this.child)?void 0:e.getPeer())?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.listener=t,this.metadata=e,this.doPick()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.child.sendMessageWithContext(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){throw Error("Method not implemented.")}getCallNumber(){return this.callNumber}}r.LoadBalancingCall=f},95636,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ResolvingCall=void 0;let n=e.r(33278),i=e.r(39149),s=e.r(64346),a=e.r(82702),o=e.r(46920),l="resolving_call";class u{constructor(e,t,r,s,a,o){this.channel=e,this.method=t,this.filterStackFactory=s,this.credentials=a,this.callNumber=o,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.readFilterPending=!1,this.writeFilterPending=!1,this.pendingChildStatus=null,this.metadata=null,this.listener=null,this.statusWatchers=[],this.deadlineTimer=setTimeout(()=>{},0),this.filterStack=null,this.deadline=r.deadline,this.host=r.host,r.parentCall&&(r.flags&n.Propagate.CANCELLATION&&r.parentCall.on("cancelled",()=>{this.cancelWithStatus(n.Status.CANCELLED,"Cancelled by parent call")}),r.flags&n.Propagate.DEADLINE&&(this.trace("Propagating deadline from parent: "+r.parentCall.getDeadline()),this.deadline=(0,i.minDeadline)(this.deadline,r.parentCall.getDeadline()))),this.trace("Created"),this.runDeadlineTimer()}trace(e){a.trace(n.LogVerbosity.DEBUG,l,"["+this.callNumber+"] "+e)}runDeadlineTimer(){clearTimeout(this.deadlineTimer),this.trace("Deadline: "+(0,i.deadlineToString)(this.deadline));let e=(0,i.getRelativeTimeout)(this.deadline);if(e!==1/0){this.trace("Deadline will be reached in "+e+"ms");let t=()=>{this.cancelWithStatus(n.Status.DEADLINE_EXCEEDED,"Deadline exceeded")};e<=0?process.nextTick(t):this.deadlineTimer=setTimeout(t,e)}}outputStatus(e){if(!this.ended){this.ended=!0,this.filterStack||(this.filterStack=this.filterStackFactory.createFilter()),clearTimeout(this.deadlineTimer);let t=this.filterStack.receiveTrailers(e);this.trace("ended with status: code="+t.code+' details="'+t.details+'"'),this.statusWatchers.forEach(e=>e(t)),process.nextTick(()=>{var e;null==(e=this.listener)||e.onReceiveStatus(t)})}}sendMessageOnChild(e,t){if(!this.child)throw Error("sendMessageonChild called with child not populated");let r=this.child;this.writeFilterPending=!0,this.filterStack.sendMessage(Promise.resolve({message:t,flags:e.flags})).then(t=>{this.writeFilterPending=!1,r.sendMessageWithContext(e,t.message),this.pendingHalfClose&&r.halfClose()},e=>{this.cancelWithStatus(e.code,e.details)})}getConfig(){if(this.ended)return;if(!this.metadata||!this.listener)throw Error("getConfig called before start");let e=this.channel.getConfig(this.method,this.metadata);if("NONE"===e.type)return void this.channel.queueCallForConfig(this);if("ERROR"===e.type)return void(this.metadata.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e.error));let t=e.config;if(t.status!==n.Status.OK){let{code:e,details:r}=(0,o.restrictControlPlaneStatusCode)(t.status,"Failed to route call to method "+this.method);this.outputStatus({code:e,details:r,metadata:new s.Metadata});return}if(t.methodConfig.timeout){let e=new Date;e.setSeconds(e.getSeconds()+t.methodConfig.timeout.seconds),e.setMilliseconds(e.getMilliseconds()+t.methodConfig.timeout.nanos/1e6),this.deadline=(0,i.minDeadline)(this.deadline,e),this.runDeadlineTimer()}this.filterStackFactory.push(t.dynamicFilterFactories),this.filterStack=this.filterStackFactory.createFilter(),this.filterStack.sendMetadata(Promise.resolve(this.metadata)).then(e=>{this.child=this.channel.createInnerCall(t,this.method,this.host,this.credentials,this.deadline),this.trace("Created child ["+this.child.getCallNumber()+"]"),this.child.start(e,{onReceiveMetadata:e=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(this.filterStack.receiveMetadata(e))},onReceiveMessage:e=>{this.trace("Received message"),this.readFilterPending=!0,this.filterStack.receiveMessage(e).then(e=>{this.trace("Finished filtering received message"),this.readFilterPending=!1,this.listener.onReceiveMessage(e),this.pendingChildStatus&&this.outputStatus(this.pendingChildStatus)},e=>{this.cancelWithStatus(e.code,e.details)})},onReceiveStatus:e=>{this.trace("Received status"),this.readFilterPending?this.pendingChildStatus=e:this.outputStatus(e)}}),this.readPending&&this.child.startRead(),this.pendingMessage?this.sendMessageOnChild(this.pendingMessage.context,this.pendingMessage.message):this.pendingHalfClose&&this.child.halfClose()},e=>{this.outputStatus(e)})}reportResolverError(e){var t;(null==(t=this.metadata)?void 0:t.getOptions().waitForReady)?this.channel.queueCallForConfig(this):this.outputStatus(e)}cancelWithStatus(e,t){var r;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),null==(r=this.child)||r.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new s.Metadata})}getPeer(){var e,t;return null!=(t=null==(e=this.child)?void 0:e.getPeer())?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.metadata=e.clone(),this.listener=t,this.getConfig()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.sendMessageOnChild(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child&&!this.writeFilterPending?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){this.credentials=this.credentials.compose(e)}addStatusWatcher(e){this.statusWatchers.push(e)}getCallNumber(){return this.callNumber}}r.ResolvingCall=u},42997,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.RetryingCall=r.MessageBufferTracker=r.RetryThrottler=void 0;let n=e.r(33278),i=e.r(64346),s=e.r(82702),a="retrying_call";class o{constructor(e,t,r){this.maxTokens=e,this.tokenRatio=t,r?this.tokens=r.tokens*(e/r.maxTokens):this.tokens=e}addCallSucceeded(){this.tokens=Math.max(this.tokens+this.tokenRatio,this.maxTokens)}addCallFailed(){this.tokens=Math.min(this.tokens-1,0)}canRetryCall(){return this.tokens>this.maxTokens/2}}r.RetryThrottler=o;class l{constructor(e,t){this.totalLimit=e,this.limitPerCall=t,this.totalAllocated=0,this.allocatedPerCall=new Map}allocate(e,t){var r;let n=null!=(r=this.allocatedPerCall.get(t))?r:0;return!(this.limitPerCall-n<e)&&!(this.totalLimit-this.totalAllocated<e)&&(this.allocatedPerCall.set(t,n+e),this.totalAllocated+=e,!0)}free(e,t){var r;if(this.totalAllocated<e)throw Error(`Invalid buffer allocation state: call ${t} freed ${e} > total allocated ${this.totalAllocated}`);this.totalAllocated-=e;let n=null!=(r=this.allocatedPerCall.get(t))?r:0;if(n<e)throw Error(`Invalid buffer allocation state: call ${t} freed ${e} > allocated for call ${n}`);this.allocatedPerCall.set(t,n-e)}freeAll(e){var t;let r=null!=(t=this.allocatedPerCall.get(e))?t:0;if(this.totalAllocated<r)throw Error(`Invalid buffer allocation state: call ${e} allocated ${r} > total allocated ${this.totalAllocated}`);this.totalAllocated-=r,this.allocatedPerCall.delete(e)}}r.MessageBufferTracker=l;let u="grpc-previous-rpc-attempts";class c{constructor(e,t,r,n,i,s,a,o,l){if(this.channel=e,this.callConfig=t,this.methodName=r,this.host=n,this.credentials=i,this.deadline=s,this.callNumber=a,this.bufferTracker=o,this.retryThrottler=l,this.listener=null,this.initialMetadata=null,this.underlyingCalls=[],this.writeBuffer=[],this.writeBufferOffset=0,this.readStarted=!1,this.transparentRetryUsed=!1,this.attempts=0,this.hedgingTimer=null,this.committedCallIndex=null,this.initialRetryBackoffSec=0,this.nextRetryBackoffSec=0,t.methodConfig.retryPolicy){this.state="RETRY";const e=t.methodConfig.retryPolicy;this.nextRetryBackoffSec=this.initialRetryBackoffSec=Number(e.initialBackoff.substring(0,e.initialBackoff.length-1))}else t.methodConfig.hedgingPolicy?this.state="HEDGING":this.state="TRANSPARENT_ONLY"}getCallNumber(){return this.callNumber}trace(e){s.trace(n.LogVerbosity.DEBUG,a,"["+this.callNumber+"] "+e)}reportStatus(e){this.trace("ended with status: code="+e.code+' details="'+e.details+'"'),this.bufferTracker.freeAll(this.callNumber),this.writeBufferOffset=this.writeBufferOffset+this.writeBuffer.length,this.writeBuffer=[],process.nextTick(()=>{var t;null==(t=this.listener)||t.onReceiveStatus({code:e.code,details:e.details,metadata:e.metadata})})}cancelWithStatus(e,t){for(let{call:r}of(this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.reportStatus({code:e,details:t,metadata:new i.Metadata}),this.underlyingCalls))r.cancelWithStatus(e,t)}getPeer(){return null!==this.committedCallIndex?this.underlyingCalls[this.committedCallIndex].call.getPeer():"unknown"}getBufferEntry(e){var t;return null!=(t=this.writeBuffer[e-this.writeBufferOffset])?t:{entryType:"FREED",allocated:!1}}getNextBufferIndex(){return this.writeBufferOffset+this.writeBuffer.length}clearSentMessages(){if("COMMITTED"!==this.state)return;let e=this.underlyingCalls[this.committedCallIndex].nextMessageToSend;for(let t=this.writeBufferOffset;t<e;t++){let e=this.getBufferEntry(t);e.allocated&&this.bufferTracker.free(e.message.message.length,this.callNumber)}this.writeBuffer=this.writeBuffer.slice(e-this.writeBufferOffset),this.writeBufferOffset=e}commitCall(e){if("COMMITTED"!==this.state&&"COMPLETED"!==this.underlyingCalls[e].state){this.trace("Committing call ["+this.underlyingCalls[e].call.getCallNumber()+"] at index "+e),this.state="COMMITTED",this.committedCallIndex=e;for(let t=0;t<this.underlyingCalls.length;t++)t!==e&&"COMPLETED"!==this.underlyingCalls[t].state&&(this.underlyingCalls[t].state="COMPLETED",this.underlyingCalls[t].call.cancelWithStatus(n.Status.CANCELLED,"Discarded in favor of other hedged attempt"));this.clearSentMessages()}}commitCallWithMostMessages(){if("COMMITTED"===this.state)return;let e=-1,t=-1;for(let[r,n]of this.underlyingCalls.entries())"ACTIVE"===n.state&&n.nextMessageToSend>e&&(e=n.nextMessageToSend,t=r);-1===t?this.state="TRANSPARENT_ONLY":this.commitCall(t)}isStatusCodeInList(e,t){return e.some(e=>e===t||e.toString().toLowerCase()===n.Status[t].toLowerCase())}getNextRetryBackoffMs(){var e;let t=null==(e=this.callConfig)?void 0:e.methodConfig.retryPolicy;if(!t)return 0;let r=Math.random()*this.nextRetryBackoffSec*1e3,n=Number(t.maxBackoff.substring(0,t.maxBackoff.length-1));return this.nextRetryBackoffSec=Math.min(this.nextRetryBackoffSec*t.backoffMultiplier,n),r}maybeRetryCall(e,t){let r;if("RETRY"!==this.state)return void t(!1);let n=this.callConfig.methodConfig.retryPolicy;if(this.attempts>=Math.min(n.maxAttempts,5))return void t(!1);if(null===e)r=this.getNextRetryBackoffMs();else if(e<0){this.state="TRANSPARENT_ONLY",t(!1);return}else r=e,this.nextRetryBackoffSec=this.initialRetryBackoffSec;setTimeout(()=>{var e,r;"RETRY"!==this.state?t(!1):(null==(r=null==(e=this.retryThrottler)?void 0:e.canRetryCall())||r)&&(t(!0),this.attempts+=1,this.startNewAttempt())},r)}countActiveCalls(){let e=0;for(let t of this.underlyingCalls)(null==t?void 0:t.state)==="ACTIVE"&&(e+=1);return e}handleProcessedStatus(e,t,r){var n,i,s;switch(this.state){case"COMMITTED":case"TRANSPARENT_ONLY":this.commitCall(t),this.reportStatus(e);break;case"HEDGING":if(this.isStatusCodeInList(null!=(n=this.callConfig.methodConfig.hedgingPolicy.nonFatalStatusCodes)?n:[],e.code)){let n;if(null==(i=this.retryThrottler)||i.addCallFailed(),null===r)n=0;else if(r<0){this.state="TRANSPARENT_ONLY",this.commitCall(t),this.reportStatus(e);return}else n=r;setTimeout(()=>{this.maybeStartHedgingAttempt(),0===this.countActiveCalls()&&(this.commitCall(t),this.reportStatus(e))},n)}else this.commitCall(t),this.reportStatus(e);break;case"RETRY":this.isStatusCodeInList(this.callConfig.methodConfig.retryPolicy.retryableStatusCodes,e.code)?(null==(s=this.retryThrottler)||s.addCallFailed(),this.maybeRetryCall(r,r=>{r||(this.commitCall(t),this.reportStatus(e))})):(this.commitCall(t),this.reportStatus(e))}}getPushback(e){let t=e.get("grpc-retry-pushback-ms");if(0===t.length)return null;try{return parseInt(t[0])}catch(e){return -1}}handleChildStatus(e,t){var r;if("COMPLETED"===this.underlyingCalls[t].state)return;if(this.trace("state="+this.state+" handling status with progress "+e.progress+" from child ["+this.underlyingCalls[t].call.getCallNumber()+"] in state "+this.underlyingCalls[t].state),this.underlyingCalls[t].state="COMPLETED",e.code===n.Status.OK){null==(r=this.retryThrottler)||r.addCallSucceeded(),this.commitCall(t),this.reportStatus(e);return}if("COMMITTED"===this.state)return void this.reportStatus(e);let i=this.getPushback(e.metadata);switch(e.progress){case"NOT_STARTED":this.startNewAttempt();break;case"REFUSED":this.transparentRetryUsed?this.handleProcessedStatus(e,t,i):(this.transparentRetryUsed=!0,this.startNewAttempt());break;case"DROP":this.commitCall(t),this.reportStatus(e);break;case"PROCESSED":this.handleProcessedStatus(e,t,i)}}maybeStartHedgingAttempt(){if("HEDGING"!==this.state||!this.callConfig.methodConfig.hedgingPolicy)return;let e=this.callConfig.methodConfig.hedgingPolicy;this.attempts>=Math.min(e.maxAttempts,5)||(this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer())}maybeStartHedgingTimer(){var e,t,r;if(this.hedgingTimer&&clearTimeout(this.hedgingTimer),"HEDGING"!==this.state||!this.callConfig.methodConfig.hedgingPolicy)return;let n=this.callConfig.methodConfig.hedgingPolicy;if(this.attempts>=Math.min(n.maxAttempts,5))return;let i=null!=(e=n.hedgingDelay)?e:"0s",s=Number(i.substring(0,i.length-1));this.hedgingTimer=setTimeout(()=>{this.maybeStartHedgingAttempt()},1e3*s),null==(r=(t=this.hedgingTimer).unref)||r.call(t)}startNewAttempt(){let e=this.channel.createLoadBalancingCall(this.callConfig,this.methodName,this.host,this.credentials,this.deadline);this.trace("Created child call ["+e.getCallNumber()+"] for attempt "+this.attempts);let t=this.underlyingCalls.length;this.underlyingCalls.push({state:"ACTIVE",call:e,nextMessageToSend:0});let r=this.attempts-1,n=this.initialMetadata.clone();r>0&&n.set(u,`${r}`);let i=!1;e.start(n,{onReceiveMetadata:n=>{this.trace("Received metadata from child ["+e.getCallNumber()+"]"),this.commitCall(t),i=!0,r>0&&n.set(u,`${r}`),"ACTIVE"===this.underlyingCalls[t].state&&this.listener.onReceiveMetadata(n)},onReceiveMessage:r=>{this.trace("Received message from child ["+e.getCallNumber()+"]"),this.commitCall(t),"ACTIVE"===this.underlyingCalls[t].state&&this.listener.onReceiveMessage(r)},onReceiveStatus:n=>{this.trace("Received status from child ["+e.getCallNumber()+"]"),!i&&r>0&&n.metadata.set(u,`${r}`),this.handleChildStatus(n,t)}}),this.sendNextChildMessage(t),this.readStarted&&e.startRead()}start(e,t){this.trace("start called"),this.listener=t,this.initialMetadata=e,this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer()}handleChildWriteCompleted(e){var t,r;let n=this.underlyingCalls[e],i=n.nextMessageToSend;null==(r=(t=this.getBufferEntry(i)).callback)||r.call(t),this.clearSentMessages(),n.nextMessageToSend+=1,this.sendNextChildMessage(e)}sendNextChildMessage(e){let t=this.underlyingCalls[e];if("COMPLETED"!==t.state&&this.getBufferEntry(t.nextMessageToSend)){let r=this.getBufferEntry(t.nextMessageToSend);switch(r.entryType){case"MESSAGE":t.call.sendMessageWithContext({callback:t=>{this.handleChildWriteCompleted(e)}},r.message.message);break;case"HALF_CLOSE":t.nextMessageToSend+=1,t.call.halfClose()}}}sendMessageWithContext(e,t){var r;this.trace("write() called with message of length "+t.length);let n={message:t,flags:e.flags},i=this.getNextBufferIndex(),s={entryType:"MESSAGE",message:n,allocated:this.bufferTracker.allocate(t.length,this.callNumber)};if(this.writeBuffer.push(s),s.allocated)for(let[n,s]of(null==(r=e.callback)||r.call(e),this.underlyingCalls.entries()))"ACTIVE"===s.state&&s.nextMessageToSend===i&&s.call.sendMessageWithContext({callback:e=>{this.handleChildWriteCompleted(n)}},t);else{if(this.commitCallWithMostMessages(),null===this.committedCallIndex)return;let r=this.underlyingCalls[this.committedCallIndex];s.callback=e.callback,"ACTIVE"===r.state&&r.nextMessageToSend===i&&r.call.sendMessageWithContext({callback:e=>{this.handleChildWriteCompleted(this.committedCallIndex)}},t)}}startRead(){for(let e of(this.trace("startRead called"),this.readStarted=!0,this.underlyingCalls))(null==e?void 0:e.state)==="ACTIVE"&&e.call.startRead()}halfClose(){this.trace("halfClose called");let e=this.getNextBufferIndex();for(let t of(this.writeBuffer.push({entryType:"HALF_CLOSE",allocated:!1}),this.underlyingCalls))(null==t?void 0:t.state)==="ACTIVE"&&t.nextMessageToSend===e&&(t.nextMessageToSend+=1,t.call.halfClose())}setCredentials(e){throw Error("Method not implemented.")}getMethod(){return this.methodName}getHost(){return this.host}}r.RetryingCall=c},52176,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.BaseSubchannelWrapper=void 0;class n{constructor(e){this.child=e}getConnectivityState(){return this.child.getConnectivityState()}addConnectivityStateListener(e){this.child.addConnectivityStateListener(e)}removeConnectivityStateListener(e){this.child.removeConnectivityStateListener(e)}startConnecting(){this.child.startConnecting()}getAddress(){return this.child.getAddress()}throttleKeepalive(e){this.child.throttleKeepalive(e)}ref(){this.child.ref()}unref(){this.child.unref()}getChannelzRef(){return this.child.getChannelzRef()}getRealSubchannel(){return this.child.getRealSubchannel()}realSubchannelEquals(e){return this.getRealSubchannel()===e.getRealSubchannel()}}r.BaseSubchannelWrapper=n},20616,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.InternalChannel=void 0;let n=e.r(91698),i=e.r(14905),s=e.r(9028),a=e.r(90551),o=e.r(33278),l=e.r(25747),u=e.r(53145),c=e.r(14507),h=e.r(82702),d=e.r(83841),f=e.r(84848),p=e.r(7541),m=e.r(86039),g=e.r(2646),y=e.r(39149),v=e.r(95636),b=e.r(43721),S=e.r(46920),w=e.r(42997),C=e.r(52176),T=0x7fffffff,E=1e3,_=18e5,I=new Map,k=0x1000000,x=1048576;class R extends C.BaseSubchannelWrapper{constructor(e,t){super(e),this.channel=t,this.refCount=0,this.subchannelStateListener=(e,r,n,i)=>{t.throttleKeepalive(i)},e.addConnectivityStateListener(this.subchannelStateListener)}ref(){this.child.ref(),this.refCount+=1}unref(){this.child.unref(),this.refCount-=1,this.refCount<=0&&(this.child.removeConnectivityStateListener(this.subchannelStateListener),this.channel.removeWrappedSubchannel(this))}}class D{constructor(e,t,r){var g,y,v,b,C,D,A,O;if(this.credentials=t,this.options=r,this.connectivityState=p.ConnectivityState.IDLE,this.currentPicker=new a.UnavailablePicker,this.configSelectionQueue=[],this.pickQueue=[],this.connectivityStateWatchers=[],this.configSelector=null,this.currentResolutionError=null,this.wrappedSubchannels=new Set,this.callCount=0,this.idleTimer=null,this.channelzEnabled=!0,this.callTracker=new m.ChannelzCallTracker,this.childrenTracker=new m.ChannelzChildrenTracker,"string"!=typeof e)throw TypeError("Channel target must be a string");if(!(t instanceof n.ChannelCredentials))throw TypeError("Channel credentials must be a ChannelCredentials object");if(r&&"object"!=typeof r)throw TypeError("Channel options must be an object");this.originalTarget=e;const N=(0,f.parseUri)(e);if(null===N)throw Error(`Could not parse target name "${e}"`);const P=(0,c.mapUriDefaultScheme)(N);if(null===P)throw Error(`Could not find a default scheme for target name "${e}"`);this.callRefTimer=setInterval(()=>{},T),null==(y=(g=this.callRefTimer).unref)||y.call(g),0===this.options["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzTrace=new m.ChannelzTrace,this.channelzRef=(0,m.registerChannelzChannel)(e,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Channel created"),this.options["grpc.default_authority"]?this.defaultAuthority=this.options["grpc.default_authority"]:this.defaultAuthority=(0,c.getDefaultAuthority)(P);const M=(0,d.mapProxyName)(P,r);this.target=M.target,this.options=Object.assign({},this.options,M.extraOptions),this.subchannelPool=(0,s.getSubchannelPool)((null!=(v=r["grpc.use_local_subchannel_pool"])?v:0)===0),this.retryBufferTracker=new w.MessageBufferTracker(null!=(b=r["grpc.retry_buffer_size"])?b:k,null!=(C=r["grpc.per_rpc_retry_buffer_size"])?C:x),this.keepaliveTime=null!=(D=r["grpc.keepalive_time_ms"])?D:-1,this.idleTimeoutMs=Math.max(null!=(A=r["grpc.client_idle_timeout_ms"])?A:_,E);const L={createSubchannel:(e,t)=>{let r=this.subchannelPool.getOrCreateSubchannel(this.target,e,Object.assign({},this.options,t),this.credentials);r.throttleKeepalive(this.keepaliveTime),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Created subchannel or used existing subchannel",r.getChannelzRef());let n=new R(r,this);return this.wrappedSubchannels.add(n),n},updateState:(e,t)=>{this.currentPicker=t;let r=this.pickQueue.slice();for(let e of(this.pickQueue=[],r.length>0&&this.callRefTimerUnref(),r))e.doPick();this.updateState(e)},requestReresolution:()=>{throw Error("Resolving load balancer should never call requestReresolution")},addChannelzChild:e=>{this.channelzEnabled&&this.childrenTracker.refChild(e)},removeChannelzChild:e=>{this.channelzEnabled&&this.childrenTracker.unrefChild(e)}};this.resolvingLoadBalancer=new i.ResolvingLoadBalancer(this.target,L,r,(e,t)=>{e.retryThrottling?I.set(this.getTarget(),new w.RetryThrottler(e.retryThrottling.maxTokens,e.retryThrottling.tokenRatio,I.get(this.getTarget()))):I.delete(this.getTarget()),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Address resolution succeeded"),this.configSelector=t,this.currentResolutionError=null,process.nextTick(()=>{let e=this.configSelectionQueue;for(let t of(this.configSelectionQueue=[],e.length>0&&this.callRefTimerUnref(),e))t.getConfig()})},e=>{this.channelzEnabled&&this.channelzTrace.addTrace("CT_WARNING","Address resolution failed with code "+e.code+' and details "'+e.details+'"'),this.configSelectionQueue.length>0&&this.trace("Name resolution failed with calls queued for config selection"),null===this.configSelector&&(this.currentResolutionError=Object.assign(Object.assign({},(0,S.restrictControlPlaneStatusCode)(e.code,e.details)),{metadata:e.metadata}));let t=this.configSelectionQueue;for(let r of(this.configSelectionQueue=[],t.length>0&&this.callRefTimerUnref(),t))r.reportResolverError(e)}),this.filterStackFactory=new l.FilterStackFactory([new u.CompressionFilterFactory(this,this.options)]),this.trace("Channel constructed with options "+JSON.stringify(r,void 0,2));const B=Error();(0,h.trace)(o.LogVerbosity.DEBUG,"channel_stacktrace","("+this.channelzRef.id+") Channel constructed \n"+(null==(O=B.stack)?void 0:O.substring(B.stack.indexOf("\n")+1))),this.lastActivityTimestamp=new Date}getChannelzInfo(){return{target:this.originalTarget,state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists()}}trace(e,t){(0,h.trace)(null!=t?t:o.LogVerbosity.DEBUG,"channel","("+this.channelzRef.id+") "+(0,f.uriToString)(this.target)+" "+e)}callRefTimerRef(){var e,t,r,n;(null==(t=(e=this.callRefTimer).hasRef)?void 0:t.call(e))||(this.trace("callRefTimer.ref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),null==(n=(r=this.callRefTimer).ref)||n.call(r))}callRefTimerUnref(){var e,t;(!this.callRefTimer.hasRef||this.callRefTimer.hasRef())&&(this.trace("callRefTimer.unref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),null==(t=(e=this.callRefTimer).unref)||t.call(e))}removeConnectivityStateWatcher(e){let t=this.connectivityStateWatchers.findIndex(t=>t===e);t>=0&&this.connectivityStateWatchers.splice(t,1)}updateState(e){for(let t of((0,h.trace)(o.LogVerbosity.DEBUG,"connectivity_state","("+this.channelzRef.id+") "+(0,f.uriToString)(this.target)+" "+p.ConnectivityState[this.connectivityState]+" -> "+p.ConnectivityState[e]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+p.ConnectivityState[e]),this.connectivityState=e,this.connectivityStateWatchers.slice()))e!==t.currentState&&(t.timer&&clearTimeout(t.timer),this.removeConnectivityStateWatcher(t),t.callback());e!==p.ConnectivityState.TRANSIENT_FAILURE&&(this.currentResolutionError=null)}throttleKeepalive(e){if(e>this.keepaliveTime)for(let t of(this.keepaliveTime=e,this.wrappedSubchannels))t.throttleKeepalive(e)}removeWrappedSubchannel(e){this.wrappedSubchannels.delete(e)}doPick(e,t){return this.currentPicker.pick({metadata:e,extraPickInfo:t})}queueCallForPick(e){this.pickQueue.push(e),this.callRefTimerRef()}getConfig(e,t){return(this.resolvingLoadBalancer.exitIdle(),this.configSelector)?{type:"SUCCESS",config:this.configSelector(e,t)}:this.currentResolutionError?{type:"ERROR",error:this.currentResolutionError}:{type:"NONE"}}queueCallForConfig(e){this.configSelectionQueue.push(e),this.callRefTimerRef()}enterIdle(){this.resolvingLoadBalancer.destroy(),this.updateState(p.ConnectivityState.IDLE),this.currentPicker=new a.QueuePicker(this.resolvingLoadBalancer),this.idleTimer&&(clearTimeout(this.idleTimer),this.idleTimer=null)}startIdleTimeout(e){var t,r;this.idleTimer=setTimeout(()=>{if(this.callCount>0)return void this.startIdleTimeout(this.idleTimeoutMs);let e=new Date().valueOf()-this.lastActivityTimestamp.valueOf();e>=this.idleTimeoutMs?(this.trace("Idle timer triggered after "+this.idleTimeoutMs+"ms of inactivity"),this.enterIdle()):this.startIdleTimeout(this.idleTimeoutMs-e)},e),null==(r=(t=this.idleTimer).unref)||r.call(t)}maybeStartIdleTimer(){this.connectivityState===p.ConnectivityState.SHUTDOWN||this.idleTimer||this.startIdleTimeout(this.idleTimeoutMs)}onCallStart(){this.channelzEnabled&&this.callTracker.addCallStarted(),this.callCount+=1}onCallEnd(e){this.channelzEnabled&&(e.code===o.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()),this.callCount-=1,this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()}createLoadBalancingCall(e,t,r,n,i){let s=(0,b.getNextCallNumber)();return this.trace("createLoadBalancingCall ["+s+'] method="'+t+'"'),new g.LoadBalancingCall(this,e,t,r,n,i,s)}createRetryingCall(e,t,r,n,i){let s=(0,b.getNextCallNumber)();return this.trace("createRetryingCall ["+s+'] method="'+t+'"'),new w.RetryingCall(this,e,t,r,n,i,s,this.retryBufferTracker,I.get(this.getTarget()))}createInnerCall(e,t,r,n,i){return 0===this.options["grpc.enable_retries"]?this.createLoadBalancingCall(e,t,r,n,i):this.createRetryingCall(e,t,r,n,i)}createResolvingCall(e,t,r,n,i){let s=(0,b.getNextCallNumber)();this.trace("createResolvingCall ["+s+'] method="'+e+'", deadline='+(0,y.deadlineToString)(t));let a={deadline:t,flags:null!=i?i:o.Propagate.DEFAULTS,host:null!=r?r:this.defaultAuthority,parentCall:n},l=new v.ResolvingCall(this,e,a,this.filterStackFactory.clone(),this.credentials._getCallCredentials(),s);return this.onCallStart(),l.addStatusWatcher(e=>{this.onCallEnd(e)}),l}close(){this.resolvingLoadBalancer.destroy(),this.updateState(p.ConnectivityState.SHUTDOWN),clearInterval(this.callRefTimer),this.idleTimer&&clearTimeout(this.idleTimer),this.channelzEnabled&&(0,m.unregisterChannelzRef)(this.channelzRef),this.subchannelPool.unrefUnusedSubchannels()}getTarget(){return(0,f.uriToString)(this.target)}getConnectivityState(e){let t=this.connectivityState;return e&&(this.resolvingLoadBalancer.exitIdle(),this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()),t}watchConnectivityState(e,t,r){if(this.connectivityState===p.ConnectivityState.SHUTDOWN)throw Error("Channel has been shut down");let n=null;if(t!==1/0){let e=t instanceof Date?t:new Date(t),s=new Date;if(t===-1/0||e<=s)return void process.nextTick(r,Error("Deadline passed without connectivity state change"));n=setTimeout(()=>{this.removeConnectivityStateWatcher(i),r(Error("Deadline passed without connectivity state change"))},e.getTime()-s.getTime())}let i={currentState:e,callback:r,timer:n};this.connectivityStateWatchers.push(i)}getChannelzRef(){return this.channelzRef}createCall(e,t,r,n,i){if("string"!=typeof e)throw TypeError("Channel#createCall: method must be a string");if(!("number"==typeof t||t instanceof Date))throw TypeError("Channel#createCall: deadline must be a number or Date");if(this.connectivityState===p.ConnectivityState.SHUTDOWN)throw Error("Channel has been shut down");return this.createResolvingCall(e,t,r,n,i)}}r.InternalChannel=D},79675,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ChannelImplementation=void 0;let n=e.r(91698),i=e.r(20616);class s{constructor(e,t,r){if("string"!=typeof e)throw TypeError("Channel target must be a string");if(!(t instanceof n.ChannelCredentials))throw TypeError("Channel credentials must be a ChannelCredentials object");if(r&&"object"!=typeof r)throw TypeError("Channel options must be an object");this.internalChannel=new i.InternalChannel(e,t,r)}close(){this.internalChannel.close()}getTarget(){return this.internalChannel.getTarget()}getConnectivityState(e){return this.internalChannel.getConnectivityState(e)}watchConnectivityState(e,t,r){this.internalChannel.watchConnectivityState(e,t,r)}getChannelzRef(){return this.internalChannel.getChannelzRef()}createCall(e,t,r,n,i){if("string"!=typeof e)throw TypeError("Channel#createCall: method must be a string");if(!("number"==typeof t||t instanceof Date))throw TypeError("Channel#createCall: deadline must be a number or Date");return this.internalChannel.createCall(e,t,r,n,i)}}r.ChannelImplementation=s},22590,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Http2ServerCallStream=r.ServerDuplexStreamImpl=r.ServerWritableStreamImpl=r.ServerReadableStreamImpl=r.ServerUnaryCallImpl=void 0;let n=e.r(27699),i=e.r(25328),s=e.r(88947),a=e.r(6461),o=e.r(33278),l=e.r(64346),u=e.r(41034),c=e.r(82702),h=e.r(14325),d="server_call";function f(e){c.trace(o.LogVerbosity.DEBUG,d,e)}let p="grpc-message",m="grpc-status",g="grpc-timeout",y=/(\d{1,8})\s*([HMSmun])/,v={H:36e5,M:6e4,S:1e3,m:1,u:.001,n:1e-6},b={"grpc-accept-encoding":"identity,deflate,gzip","grpc-encoding":"identity"},S={[i.constants.HTTP2_HEADER_STATUS]:i.constants.HTTP_STATUS_OK,[i.constants.HTTP2_HEADER_CONTENT_TYPE]:"application/grpc+proto"},w={waitForTrailers:!0};class C extends n.EventEmitter{constructor(e,t,r){super(),this.call=e,this.metadata=t,this.request=r,this.cancelled=!1,this.call.setupSurfaceCall(this)}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}}r.ServerUnaryCallImpl=C;class T extends s.Readable{constructor(e,t,r,n){super({objectMode:!0}),this.call=e,this.metadata=t,this.deserialize=r,this.cancelled=!1,this.call.setupSurfaceCall(this),this.call.setupReadable(this,n)}_read(e){this.call.consumeUnpushedMessages(this)&&this.call.resume()}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}}r.ServerReadableStreamImpl=T;class E extends s.Writable{constructor(e,t,r,n){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=r,this.request=n,this.cancelled=!1,this.trailingMetadata=new l.Metadata,this.call.setupSurfaceCall(this),this.on("error",e=>{this.call.sendError(e),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}_write(e,t,r){try{let t=this.call.serializeMessage(e);if(!this.call.write(t))return void this.call.once("drain",r)}catch(e){this.emit("error",{details:(0,h.getErrorMessage)(e),code:o.Status.INTERNAL})}r()}_final(e){this.call.sendStatus({code:o.Status.OK,details:"OK",metadata:this.trailingMetadata}),e(null)}end(e){return e&&(this.trailingMetadata=e),super.end()}}r.ServerWritableStreamImpl=E;class _ extends s.Duplex{constructor(e,t,r,n,i){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=r,this.deserialize=n,this.cancelled=!1,this.trailingMetadata=new l.Metadata,this.call.setupSurfaceCall(this),this.call.setupReadable(this,i),this.on("error",e=>{this.call.sendError(e),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}end(e){return e&&(this.trailingMetadata=e),super.end()}}r.ServerDuplexStreamImpl=_,_.prototype._read=T.prototype._read,_.prototype._write=E.prototype._write,_.prototype._final=E.prototype._final;class I extends n.EventEmitter{constructor(e,t,r){super(),this.stream=e,this.handler=t,this.cancelled=!1,this.deadlineTimer=null,this.statusSent=!1,this.deadline=1/0,this.wantTrailers=!1,this.metadataSent=!1,this.canPush=!1,this.isPushPending=!1,this.bufferedMessages=[],this.messagesToPush=[],this.maxSendMessageSize=o.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=o.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,this.stream.once("error",e=>{}),this.stream.once("close",()=>{var e;f("Request to method "+(null==(e=this.handler)?void 0:e.path)+" stream closed with rstCode "+this.stream.rstCode),!this.statusSent&&(this.cancelled=!0,this.emit("cancelled","cancelled"),this.emit("streamEnd",!1),this.sendStatus({code:o.Status.CANCELLED,details:"Cancelled by client",metadata:null}),this.deadlineTimer&&clearTimeout(this.deadlineTimer))}),this.stream.on("drain",()=>{this.emit("drain")}),"grpc.max_send_message_length"in r&&(this.maxSendMessageSize=r["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in r&&(this.maxReceiveMessageSize=r["grpc.max_receive_message_length"])}checkCancelled(){return(this.stream.destroyed||this.stream.closed)&&(this.cancelled=!0),this.cancelled}getDecompressedMessage(e,t){let r=e.subarray(5);if("identity"===t)return r;if("deflate"!==t&&"gzip"!==t)return Promise.reject({code:o.Status.UNIMPLEMENTED,details:`Received message compressed with unsupported encoding "${t}"`});{let e;return e="deflate"===t?a.createInflate():a.createGunzip(),new Promise((t,n)=>{let i=0,s=[];e.on("data",t=>{s.push(t),i+=t.byteLength,-1!==this.maxReceiveMessageSize&&i>this.maxReceiveMessageSize&&(e.destroy(),n({code:o.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxReceiveMessageSize}`}))}),e.on("end",()=>{t(Buffer.concat(s))}),e.write(r),e.end()})}}sendMetadata(e){if(this.checkCancelled()||this.metadataSent)return;this.metadataSent=!0;let t=e?e.toHttp2Headers():null,r=Object.assign(Object.assign(Object.assign({},S),b),t);this.stream.respond(r,w)}receiveMetadata(e){let t=l.Metadata.fromHttp2Headers(e);c.isTracerEnabled(d)&&f("Request to "+this.handler.path+" received headers "+JSON.stringify(t.toJSON()));let r=t.get(g);if(r.length>0){let e=r[0].toString().match(y);if(null===e){let e=Error("Invalid deadline");return e.code=o.Status.OUT_OF_RANGE,this.sendError(e),t}let n=e[1]*v[e[2]]|0,i=new Date;this.deadline=i.setMilliseconds(i.getMilliseconds()+n),this.deadlineTimer=setTimeout(k,n,this),t.remove(g)}return t.remove(i.constants.HTTP2_HEADER_ACCEPT_ENCODING),t.remove(i.constants.HTTP2_HEADER_TE),t.remove(i.constants.HTTP2_HEADER_CONTENT_TYPE),t.remove("grpc-accept-encoding"),t}receiveUnaryMessage(e){return new Promise((t,r)=>{let{stream:n}=this,i=0,s=this,a=[],l=this.maxReceiveMessageSize;function u(e){if(i+=e.byteLength,-1!==l&&i>l){n.removeListener("data",u),n.removeListener("end",c),n.removeListener("error",c),r({code:o.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${i} vs. ${l})`});return}a.push(e)}function c(l){if(n.removeListener("data",u),n.removeListener("end",c),n.removeListener("error",c),void 0!==l)return void r({code:o.Status.INTERNAL,details:l.message});if(0===i)return void r({code:o.Status.INTERNAL,details:"received empty unary message"});s.emit("receiveMessage");let h=Buffer.concat(a,i),d=1===h.readUInt8(0)?e:"identity",f=s.getDecompressedMessage(h,d);Buffer.isBuffer(f)?t(s.deserializeMessageWithInternalError(f)):f.then(e=>t(s.deserializeMessageWithInternalError(e)),t=>r(t.code?t:{code:o.Status.INTERNAL,details:`Received "grpc-encoding" header "${e}" but ${e} decompression failed`}))}this.stream.on("data",u),this.stream.on("end",c),this.stream.on("error",c)})}async deserializeMessageWithInternalError(e){try{return this.deserializeMessage(e)}catch(e){throw{details:(0,h.getErrorMessage)(e),code:o.Status.INTERNAL}}}serializeMessage(e){let t=this.handler.serialize(e),r=t.byteLength,n=Buffer.allocUnsafe(r+5);return n.writeUInt8(0,0),n.writeUInt32BE(r,1),t.copy(n,5),n}deserializeMessage(e){return this.handler.deserialize(e)}async sendUnaryMessage(e,t,r,n){if(!this.checkCancelled()){if(void 0===r&&(r=null),e){!Object.prototype.hasOwnProperty.call(e,"metadata")&&r&&(e.metadata=r),this.sendError(e);return}try{let e=this.serializeMessage(t);this.write(e),this.sendStatus({code:o.Status.OK,details:"OK",metadata:r})}catch(e){this.sendError({details:(0,h.getErrorMessage)(e),code:o.Status.INTERNAL})}}}sendStatus(e){var t,r;if(this.emit("callEnd",e.code),this.emit("streamEnd",e.code===o.Status.OK),!this.checkCancelled())if(f("Request to method "+(null==(t=this.handler)?void 0:t.path)+" ended with status code: "+o.Status[e.code]+" details: "+e.details),this.deadlineTimer&&clearTimeout(this.deadlineTimer),this.stream.headersSent)this.wantTrailers||(this.wantTrailers=!0,this.stream.once("wantTrailers",()=>{var t;let r=Object.assign({[m]:e.code,[p]:encodeURI(e.details)},null==(t=e.metadata)?void 0:t.toHttp2Headers());this.stream.sendTrailers(r),this.statusSent=!0}),this.stream.end());else{let t=Object.assign(Object.assign({[m]:e.code,[p]:encodeURI(e.details)},S),null==(r=e.metadata)?void 0:r.toHttp2Headers());this.stream.respond(t,{endStream:!0}),this.statusSent=!0}}sendError(e){let t={code:o.Status.UNKNOWN,details:"message"in e?e.message:"Unknown Error",metadata:"metadata"in e&&void 0!==e.metadata?e.metadata:null};"code"in e&&"number"==typeof e.code&&Number.isInteger(e.code)&&(t.code=e.code,"details"in e&&"string"==typeof e.details&&(t.details=e.details)),this.sendStatus(t)}write(e){if(!this.checkCancelled())return -1!==this.maxSendMessageSize&&e.length>this.maxSendMessageSize?void this.sendError({code:o.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${e.length} vs. ${this.maxSendMessageSize})`}):(this.sendMetadata(),this.emit("sendMessage"),this.stream.write(e))}resume(){this.stream.resume()}setupSurfaceCall(e){this.once("cancelled",t=>{e.cancelled=!0,e.emit("cancelled",t)}),this.once("callEnd",t=>e.emit("callEnd",t))}setupReadable(e,t){let r=new u.StreamDecoder(this.maxReceiveMessageSize),n=!1,i=!1,s=!1,a=async()=>{s||!n||i||(s=!0,await this.pushOrBufferMessage(e,null))};this.stream.on("data",async n=>{let s;try{s=r.write(n)}catch(e){this.sendError({code:o.Status.RESOURCE_EXHAUSTED,details:e.message});return}for(let r of(i=!0,this.stream.pause(),s)){let n;this.emit("receiveMessage");let i=1===r.readUInt8(0)?t:"identity";try{n=await this.getDecompressedMessage(r,i)}catch(e){this.sendError(e);return}if(!n)return;await this.pushOrBufferMessage(e,n)}i=!1,this.stream.resume(),await a()}),this.stream.once("end",async()=>{n=!0,await a()})}consumeUnpushedMessages(e){for(this.canPush=!0;this.messagesToPush.length>0;){let t=this.messagesToPush.shift(),r=e.push(t);if(null===t||!1===r){this.canPush=!1;break}}return this.canPush}async pushOrBufferMessage(e,t){this.isPushPending?this.bufferedMessages.push(t):await this.pushMessage(e,t)}async pushMessage(e,t){if(null===t){f("Received end of stream"),this.canPush?e.push(null):this.messagesToPush.push(null);return}f("Received message of length "+t.length),this.isPushPending=!0;try{let r=await this.deserializeMessage(t);this.canPush?e.push(r)||(this.canPush=!1,this.stream.pause()):this.messagesToPush.push(r)}catch(r){this.bufferedMessages.length=0;let t=(0,h.getErrorCode)(r);(null===t||t<o.Status.OK||t>o.Status.UNAUTHENTICATED)&&(t=o.Status.INTERNAL),e.emit("error",{details:(0,h.getErrorMessage)(r),code:t})}this.isPushPending=!1,this.bufferedMessages.length>0&&await this.pushMessage(e,this.bufferedMessages.shift())}getPeer(){var e;let t=null==(e=this.stream.session)?void 0:e.socket;return null!=t&&t.remoteAddress?t.remotePort?`${t.remoteAddress}:${t.remotePort}`:t.remoteAddress:"unknown"}getDeadline(){return this.deadline}getPath(){return this.handler.path}}function k(e){let t=Error("Deadline exceeded");t.code=o.Status.DEADLINE_EXCEEDED,e.sendError(t),e.cancelled=!0,e.emit("cancelled","deadline")}r.Http2ServerCallStream=I},86183,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ServerCredentials=void 0;let n=e.r(23522);class i{static createInsecure(){return new s}static createSsl(e,t,r=!1){if(null!==e&&!Buffer.isBuffer(e))throw TypeError("rootCerts must be null or a Buffer");if(!Array.isArray(t))throw TypeError("keyCertPairs must be an array");if("boolean"!=typeof r)throw TypeError("checkClientCertificate must be a boolean");let i=[],s=[];for(let e=0;e<t.length;e++){let r=t[e];if(null===r||"object"!=typeof r)throw TypeError(`keyCertPair[${e}] must be an object`);if(!Buffer.isBuffer(r.private_key))throw TypeError(`keyCertPair[${e}].private_key must be a Buffer`);if(!Buffer.isBuffer(r.cert_chain))throw TypeError(`keyCertPair[${e}].cert_chain must be a Buffer`);i.push(r.cert_chain),s.push(r.private_key)}return new a({ca:e||(0,n.getDefaultRootsData)()||void 0,cert:i,key:s,requestCert:r,ciphers:n.CIPHER_SUITES})}}r.ServerCredentials=i;class s extends i{_isSecure(){return!1}_getSettings(){return null}}class a extends i{constructor(e){super(),this.options=e}_isSecure(){return!0}_getSettings(){return this.options}}},79579,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Server=void 0;let n=e.r(25328),i=e.r(33278),s=e.r(22590),a=e.r(86183),o=e.r(14507),l=e.r(82702),u=e.r(76005),c=e.r(84848),h=e.r(86039),d=0x7fffffff,f=0x7fffffff,p=2e4,{HTTP2_HEADER_PATH:m}=n.constants,g="server";function y(){}function v(e){return{code:i.Status.UNIMPLEMENTED,details:`The server does not implement the method ${e}`}}function b(e,t){let r=v(t);switch(e){case"unary":return(e,t)=>{t(r,null)};case"clientStream":return(e,t)=>{t(r,null)};case"serverStream":return e=>{e.emit("error",r)};case"bidi":return e=>{e.emit("error",r)};default:throw Error(`Invalid handlerType ${e}`)}}class S{constructor(e){var t,r,n,i;this.http2ServerList=[],this.handlers=new Map,this.sessions=new Map,this.started=!1,this.shutdown=!1,this.serverAddressString="null",this.channelzEnabled=!0,this.channelzTrace=new h.ChannelzTrace,this.callTracker=new h.ChannelzCallTracker,this.listenerChildrenTracker=new h.ChannelzChildrenTracker,this.sessionChildrenTracker=new h.ChannelzChildrenTracker,this.options=null!=e?e:{},0===this.options["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzRef=(0,h.registerChannelzServer)(()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Server created"),this.maxConnectionAgeMs=null!=(t=this.options["grpc.max_connection_age_ms"])?t:d,this.maxConnectionAgeGraceMs=null!=(r=this.options["grpc.max_connection_age_grace_ms"])?r:d,this.keepaliveTimeMs=null!=(n=this.options["grpc.keepalive_time_ms"])?n:f,this.keepaliveTimeoutMs=null!=(i=this.options["grpc.keepalive_timeout_ms"])?i:p,this.trace("Server constructed")}getChannelzInfo(){return{trace:this.channelzTrace,callTracker:this.callTracker,listenerChildren:this.listenerChildrenTracker.getChildLists(),sessionChildren:this.sessionChildrenTracker.getChildLists()}}getChannelzSessionInfoGetter(e){return()=>{var t,r,n;let i,s=this.sessions.get(e),a=e.socket,o=a.remoteAddress?(0,u.stringToSubchannelAddress)(a.remoteAddress,a.remotePort):null,l=a.localAddress?(0,u.stringToSubchannelAddress)(a.localAddress,a.localPort):null;if(e.encrypted){let e=a,r=e.getCipher(),n=e.getCertificate(),s=e.getPeerCertificate();i={cipherSuiteStandardName:null!=(t=r.standardName)?t:null,cipherSuiteOtherName:r.standardName?null:r.name,localCertificate:n&&"raw"in n?n.raw:null,remoteCertificate:s&&"raw"in s?s.raw:null}}else i=null;return{remoteAddress:o,localAddress:l,security:i,remoteName:null,streamsStarted:s.streamTracker.callsStarted,streamsSucceeded:s.streamTracker.callsSucceeded,streamsFailed:s.streamTracker.callsFailed,messagesSent:s.messagesSent,messagesReceived:s.messagesReceived,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:s.streamTracker.lastCallStartedTimestamp,lastMessageSentTimestamp:s.lastMessageSentTimestamp,lastMessageReceivedTimestamp:s.lastMessageReceivedTimestamp,localFlowControlWindow:null!=(r=e.state.localWindowSize)?r:null,remoteFlowControlWindow:null!=(n=e.state.remoteWindowSize)?n:null}}}trace(e){l.trace(i.LogVerbosity.DEBUG,g,"("+this.channelzRef.id+") "+e)}addProtoService(){throw Error("Not implemented. Use addService() instead")}addService(e,t){if(null===e||"object"!=typeof e||null===t||"object"!=typeof t)throw Error("addService() requires two objects as arguments");let r=Object.keys(e);if(0===r.length)throw Error("Cannot add an empty service to a server");r.forEach(r=>{let n,i,s=e[r];n=s.requestStream?s.responseStream?"bidi":"clientStream":s.responseStream?"serverStream":"unary";let a=t[r];if(void 0===a&&"string"==typeof s.originalName&&(a=t[s.originalName]),i=void 0!==a?a.bind(t):b(n,r),!1===this.register(s.path,i,s.responseSerialize,s.requestDeserialize,n))throw Error(`Method handler for ${s.path} already provided.`)})}removeService(e){if(null===e||"object"!=typeof e)throw Error("removeService() requires object as argument");Object.keys(e).forEach(t=>{let r=e[t];this.unregister(r.path)})}bind(e,t){throw Error("Not implemented. Use bindAsync() instead")}bindAsync(e,t,r){if(!0===this.started)throw Error("server is already started");if(this.shutdown)throw Error("bindAsync called after shutdown");if("string"!=typeof e)throw TypeError("port must be a string");if(null===t||!(t instanceof a.ServerCredentials))throw TypeError("creds must be a ServerCredentials object");if("function"!=typeof r)throw TypeError("callback must be a function");let s=(0,c.parseUri)(e);if(null===s)throw Error(`Could not parse port "${e}"`);let d=(0,o.mapUriDefaultScheme)(s);if(null===d)throw Error(`Could not get a default scheme for port "${e}"`);let f={maxSendHeaderBlockLength:Number.MAX_SAFE_INTEGER};"grpc-node.max_session_memory"in this.options?f.maxSessionMemory=this.options["grpc-node.max_session_memory"]:f.maxSessionMemory=Number.MAX_SAFE_INTEGER,"grpc.max_concurrent_streams"in this.options&&(f.settings={maxConcurrentStreams:this.options["grpc.max_concurrent_streams"]});let p=(e,t)=>{process.nextTick(()=>r(e,t))},m=()=>{let e;if(t._isSecure()){let r=Object.assign(f,t._getSettings());r.enableTrace=1===this.options["grpc-node.tls_enable_trace"],(e=n.createSecureServer(r)).on("secureConnection",e=>{e.on("error",e=>{this.trace("An incoming TLS connection closed with error: "+e.message)})})}else e=n.createServer(f);return e.setTimeout(0,y),this._setupHandlers(e),e},g=(e,t,r)=>0===e.length?Promise.resolve({port:t,count:r}):Promise.all(e.map(e=>{let r;this.trace("Attempting to bind "+(0,u.subchannelAddressToString)(e)),r=(0,u.isTcpSubchannelAddress)(e)?{host:e.host,port:t}:e;let n=m();return new Promise((i,s)=>{let a=t=>{this.trace("Failed to bind "+(0,u.subchannelAddressToString)(e)+" with error "+t.message),i(t)};n.once("error",a),n.listen(r,()=>{let e;if(this.shutdown){n.close(),i(Error("bindAsync failed because server is shutdown"));return}let r=n.address();e="string"==typeof r?{path:r}:{host:r.address,port:r.port};let s=(0,h.registerChannelzSocket)((0,u.subchannelAddressToString)(e),()=>({localAddress:e,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(s),this.http2ServerList.push({server:n,channelzRef:s}),this.trace("Successfully bound "+(0,u.subchannelAddressToString)(e)),i("port"in e?e.port:t),n.removeListener("error",a)})})})).then(e=>{let n=0;for(let r of e)if("number"==typeof r&&(n+=1,r!==t))throw Error("Invalid state: multiple port numbers added from single address");return{port:t,count:n+r}}),v=e=>{if(0===e.length)return Promise.resolve({port:0,count:0});let t=e[0],r=m();return new Promise((n,i)=>{let s=r=>{this.trace("Failed to bind "+(0,u.subchannelAddressToString)(t)+" with error "+r.message),n(v(e.slice(1)))};r.once("error",s),r.listen(t,()=>{if(this.shutdown){r.close(),n({port:0,count:0});return}let t=r.address(),i={host:t.address,port:t.port},a=(0,h.registerChannelzSocket)((0,u.subchannelAddressToString)(i),()=>({localAddress:i,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(a),this.http2ServerList.push({server:r,channelzRef:a}),this.trace("Successfully bound "+(0,u.subchannelAddressToString)(i)),n(g(e.slice(1),t.port,1)),r.removeListener("error",s)})})},b={onSuccessfulResolution:(t,r,n)=>{let s;(b.onSuccessfulResolution=()=>{},this.shutdown&&p(Error("bindAsync failed because server is shutdown"),0),0===t.length)?p(Error(`No addresses resolved for port ${e}`),0):(s=(0,u.isTcpSubchannelAddress)(t[0])?0===t[0].port?v(t):g(t,t[0].port,0):g(t,1,0)).then(e=>{if(0===e.count){let e=`No address added out of total ${t.length} resolved`;l.log(i.LogVerbosity.ERROR,e),p(Error(e),0)}else e.count<t.length&&l.log(i.LogVerbosity.INFO,`WARNING Only ${e.count} addresses added out of total ${t.length} resolved`),p(null,e.port)},e=>{let r=`No address added out of total ${t.length} resolved`;l.log(i.LogVerbosity.ERROR,r),p(Error(r),0)})},onError:e=>{p(Error(e.details),0)}};(0,o.createResolver)(d,b,this.options).updateResolution()}forceShutdown(){for(let{server:e,channelzRef:t}of this.http2ServerList)e.listening&&e.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(t),(0,h.unregisterChannelzRef)(t))});this.started=!1,this.shutdown=!0,this.sessions.forEach((e,t)=>{t.destroy(n.constants.NGHTTP2_CANCEL)}),this.sessions.clear(),this.channelzEnabled&&(0,h.unregisterChannelzRef)(this.channelzRef)}register(e,t,r,n,i){return!this.handlers.has(e)&&(this.handlers.set(e,{func:t,serialize:r,deserialize:n,type:i,path:e}),!0)}unregister(e){return this.handlers.delete(e)}start(){if(0===this.http2ServerList.length||this.http2ServerList.every(({server:e})=>!0!==e.listening))throw Error("server must be bound in order to start");if(!0===this.started)throw Error("server is already started");this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Starting"),this.started=!0}tryShutdown(e){let t=t=>{this.channelzEnabled&&(0,h.unregisterChannelzRef)(this.channelzRef),e(t)},r=0;function n(){0==--r&&t()}for(let{server:e,channelzRef:t}of(this.started=!1,this.shutdown=!0,this.http2ServerList))e.listening&&(r++,e.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(t),(0,h.unregisterChannelzRef)(t)),n()}));this.sessions.forEach((e,t)=>{t.closed||(r+=1,t.close(n))}),0===r&&t()}addHttp2Port(){throw Error("Not yet implemented")}getChannelzRef(){return this.channelzRef}_verifyContentType(e,t){let r=t[n.constants.HTTP2_HEADER_CONTENT_TYPE];return"string"==typeof r&&!!r.startsWith("application/grpc")||(e.respond({[n.constants.HTTP2_HEADER_STATUS]:n.constants.HTTP_STATUS_UNSUPPORTED_MEDIA_TYPE},{endStream:!0}),!1)}_retrieveHandler(e){this.trace("Received call to method "+e+" at address "+this.serverAddressString);let t=this.handlers.get(e);return void 0===t?(this.trace("No handler registered for method "+e+". Sending UNIMPLEMENTED status."),null):t}_respondWithError(e,t,r=null){let n=new s.Http2ServerCallStream(t,null,this.options);void 0===e.code&&(e.code=i.Status.INTERNAL),this.channelzEnabled&&(this.callTracker.addCallFailed(),null==r||r.streamTracker.addCallFailed()),n.sendError(e)}_channelzHandler(e,t){let r=this.sessions.get(e.session);if(this.callTracker.addCallStarted(),null==r||r.streamTracker.addCallStarted(),!this._verifyContentType(e,t)){this.callTracker.addCallFailed(),null==r||r.streamTracker.addCallFailed();return}let n=t[m],a=this._retrieveHandler(n);if(!a)return void this._respondWithError(v(n),e,r);let o=new s.Http2ServerCallStream(e,a,this.options);o.once("callEnd",e=>{e===i.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}),r&&(o.once("streamEnd",e=>{e?r.streamTracker.addCallSucceeded():r.streamTracker.addCallFailed()}),o.on("sendMessage",()=>{r.messagesSent+=1,r.lastMessageSentTimestamp=new Date}),o.on("receiveMessage",()=>{r.messagesReceived+=1,r.lastMessageReceivedTimestamp=new Date})),this._runHandlerForCall(o,a,t)||(this.callTracker.addCallFailed(),null==r||r.streamTracker.addCallFailed(),o.sendError({code:i.Status.INTERNAL,details:`Unknown handler type: ${a.type}`}))}_streamHandler(e,t){if(!0!==this._verifyContentType(e,t))return;let r=t[m],n=this._retrieveHandler(r);if(!n)return void this._respondWithError(v(r),e,null);let a=new s.Http2ServerCallStream(e,n,this.options);this._runHandlerForCall(a,n,t)||a.sendError({code:i.Status.INTERNAL,details:`Unknown handler type: ${n.type}`})}_runHandlerForCall(e,t,r){var n;let i=e.receiveMetadata(r),s=null!=(n=i.get("grpc-encoding")[0])?n:"identity";i.remove("grpc-encoding");let{type:a}=t;if("unary"===a)w(e,t,i,s);else if("clientStream"===a)C(e,t,i,s);else if("serverStream"===a)T(e,t,i,s);else{if("bidi"!==a)return!1;E(e,t,i,s)}return!0}_setupHandlers(e){if(null===e)return;let t=e.address(),r="null";t&&(r="string"==typeof t?t:t.address+":"+t.port),this.serverAddressString=r;let i=this.channelzEnabled?this._channelzHandler:this._streamHandler;e.on("stream",i.bind(this)),e.on("session",e=>{var t,r,i,s,a;if(!this.started)return void e.destroy();let o=(0,h.registerChannelzSocket)(null!=(t=e.socket.remoteAddress)?t:"unknown",this.getChannelzSessionInfoGetter(e),this.channelzEnabled),l={ref:o,streamTracker:new h.ChannelzCallTracker,messagesSent:0,messagesReceived:0,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null};this.sessions.set(e,l);let u=e.socket.remoteAddress;this.channelzEnabled&&(this.channelzTrace.addTrace("CT_INFO","Connection established by client "+u),this.sessionChildrenTracker.refChild(o));let c=null,f=null,p=!1;if(this.maxConnectionAgeMs!==d){let t=this.maxConnectionAgeMs/10,s=Math.random()*t*2-t;c=null==(i=(r=setTimeout(()=>{var t,r;p=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by max connection age from "+u);try{e.goaway(n.constants.NGHTTP2_NO_ERROR,0x7fffffff,Buffer.from("max_age"))}catch(t){e.destroy();return}e.close(),this.maxConnectionAgeGraceMs!==d&&(f=null==(r=(t=setTimeout(()=>{e.destroy()},this.maxConnectionAgeGraceMs)).unref)?void 0:r.call(t))},this.maxConnectionAgeMs+s)).unref)?void 0:i.call(r)}let m=null==(a=(s=setInterval(()=>{var t,r;let n=null==(r=(t=setTimeout(()=>{p=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by keepalive timeout from "+u),e.close()},this.keepaliveTimeoutMs)).unref)?void 0:r.call(t);try{e.ping((e,t,r)=>{clearTimeout(n)})}catch(t){e.destroy()}},this.keepaliveTimeMs)).unref)?void 0:a.call(s);e.on("close",()=>{this.channelzEnabled&&(p||this.channelzTrace.addTrace("CT_INFO","Connection dropped by client "+u),this.sessionChildrenTracker.unrefChild(o),(0,h.unregisterChannelzRef)(o)),c&&clearTimeout(c),f&&clearTimeout(f),m&&clearTimeout(m),this.sessions.delete(e)})})}}async function w(e,t,r,n){try{let i=await e.receiveUnaryMessage(n);if(void 0===i||e.cancelled)return;let a=new s.ServerUnaryCallImpl(e,r,i);t.func(a,(t,r,n,i)=>{e.sendUnaryMessage(t,r,n,i)})}catch(t){e.sendError(t)}}function C(e,t,r,n){let i=new s.ServerReadableStreamImpl(e,r,t.deserialize,n);function a(t,r,n,s){i.destroy(),e.sendUnaryMessage(t,r,n,s)}e.cancelled||(i.on("error",a),t.func(i,a))}async function T(e,t,r,n){try{let i=await e.receiveUnaryMessage(n);if(void 0===i||e.cancelled)return;let a=new s.ServerWritableStreamImpl(e,r,t.serialize,i);t.func(a)}catch(t){e.sendError(t)}}function E(e,t,r,n){let i=new s.ServerDuplexStreamImpl(e,r,t.serialize,t.deserialize,n);e.cancelled||t.func(i)}r.Server=S},26427,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.StatusBuilder=void 0;class n{constructor(){this.code=null,this.details=null,this.metadata=null}withCode(e){return this.code=e,this}withDetails(e){return this.details=e,this}withMetadata(e){return this.metadata=e,this}build(){let e={};return null!==this.code&&(e.code=this.code),null!==this.details&&(e.details=this.details),null!==this.metadata&&(e.metadata=this.metadata),e}}r.StatusBuilder=n},73735,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.isDuration=r.durationToMs=r.msToDuration=void 0,r.msToDuration=function(e){return{seconds:e/1e3|0,nanos:e%1e3*1e6|0}},r.durationToMs=function(e){return 1e3*e.seconds+e.nanos/1e6|0},r.isDuration=function(e){return"number"==typeof e.seconds&&"number"==typeof e.nanos}},70701,(e,t,r)=>{"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0}),r.setup=r.OutlierDetectionLoadBalancer=r.OutlierDetectionLoadBalancingConfig=void 0;let i=e.r(7541),s=e.r(33278),a=e.r(73735),o=e.r(17860),l=e.r(1291),u=e.r(64947),c=e.r(90551),h=e.r(76005),d=e.r(52176),f=e.r(82702),p="outlier_detection";function m(e){f.trace(s.LogVerbosity.DEBUG,p,e)}let g="outlier_detection",y=(null!=(n=process.env.GRPC_EXPERIMENTAL_ENABLE_OUTLIER_DETECTION)?n:"true")==="true",v={stdev_factor:1900,enforcement_percentage:100,minimum_hosts:5,request_volume:100},b={threshold:85,enforcement_percentage:100,minimum_hosts:5,request_volume:50};function S(e,t,r,n){if(t in e&&typeof e[t]!==r){let i=n?`${n}.${t}`:t;throw Error(`outlier detection config ${i} parse error: expected ${r}, got ${typeof e[t]}`)}}function w(e,t,r){let n=r?`${r}.${t}`:t;if(t in e){if(!(0,a.isDuration)(e[t]))throw Error(`outlier detection config ${n} parse error: expected Duration, got ${typeof e[t]}`);if(!(e[t].seconds>=0&&e[t].seconds<=315576e6&&e[t].nanos>=0&&e[t].nanos<=0x3b9ac9ff))throw Error(`outlier detection config ${n} parse error: values out of range for non-negative Duaration`)}}function C(e,t,r){let n=r?`${r}.${t}`:t;if(S(e,t,"number",r),t in e&&!(e[t]>=0&&e[t]<=100))throw Error(`outlier detection config ${n} parse error: value out of range for percentage (0-100)`)}class T{constructor(e,t,r,n,i,s,a){if(this.childPolicy=a,a.length>0&&"pick_first"===a[0].getLoadBalancerName())throw Error("outlier_detection LB policy cannot have a pick_first child policy");this.intervalMs=null!=e?e:1e4,this.baseEjectionTimeMs=null!=t?t:3e4,this.maxEjectionTimeMs=null!=r?r:3e5,this.maxEjectionPercent=null!=n?n:10,this.successRateEjection=i?Object.assign(Object.assign({},v),i):null,this.failurePercentageEjection=s?Object.assign(Object.assign({},b),s):null}getLoadBalancerName(){return g}toJsonObject(){return{interval:(0,a.msToDuration)(this.intervalMs),base_ejection_time:(0,a.msToDuration)(this.baseEjectionTimeMs),max_ejection_time:(0,a.msToDuration)(this.maxEjectionTimeMs),max_ejection_percent:this.maxEjectionPercent,success_rate_ejection:this.successRateEjection,failure_percentage_ejection:this.failurePercentageEjection,child_policy:this.childPolicy.map(e=>e.toJsonObject())}}getIntervalMs(){return this.intervalMs}getBaseEjectionTimeMs(){return this.baseEjectionTimeMs}getMaxEjectionTimeMs(){return this.maxEjectionTimeMs}getMaxEjectionPercent(){return this.maxEjectionPercent}getSuccessRateEjectionConfig(){return this.successRateEjection}getFailurePercentageEjectionConfig(){return this.failurePercentageEjection}getChildPolicy(){return this.childPolicy}copyWithChildPolicy(e){return new T(this.intervalMs,this.baseEjectionTimeMs,this.maxEjectionTimeMs,this.maxEjectionPercent,this.successRateEjection,this.failurePercentageEjection,e)}static createFromJson(e){var t;if(w(e,"interval"),w(e,"base_ejection_time"),w(e,"max_ejection_time"),C(e,"max_ejection_percent"),"success_rate_ejection"in e){if("object"!=typeof e.success_rate_ejection)throw Error("outlier detection config success_rate_ejection must be an object");S(e.success_rate_ejection,"stdev_factor","number","success_rate_ejection"),C(e.success_rate_ejection,"enforcement_percentage","success_rate_ejection"),S(e.success_rate_ejection,"minimum_hosts","number","success_rate_ejection"),S(e.success_rate_ejection,"request_volume","number","success_rate_ejection")}if("failure_percentage_ejection"in e){if("object"!=typeof e.failure_percentage_ejection)throw Error("outlier detection config failure_percentage_ejection must be an object");C(e.failure_percentage_ejection,"threshold","failure_percentage_ejection"),C(e.failure_percentage_ejection,"enforcement_percentage","failure_percentage_ejection"),S(e.failure_percentage_ejection,"minimum_hosts","number","failure_percentage_ejection"),S(e.failure_percentage_ejection,"request_volume","number","failure_percentage_ejection")}return new T(e.interval?(0,a.durationToMs)(e.interval):null,e.base_ejection_time?(0,a.durationToMs)(e.base_ejection_time):null,e.max_ejection_time?(0,a.durationToMs)(e.max_ejection_time):null,null!=(t=e.max_ejection_percent)?t:null,e.success_rate_ejection,e.failure_percentage_ejection,e.child_policy.map(l.validateLoadBalancingConfig))}}r.OutlierDetectionLoadBalancingConfig=T;class E extends d.BaseSubchannelWrapper{constructor(e,t){super(e),this.mapEntry=t,this.stateListeners=[],this.ejected=!1,this.refCount=0,this.childSubchannelState=e.getConnectivityState(),e.addConnectivityStateListener((e,t,r,n)=>{if(this.childSubchannelState=r,!this.ejected)for(let e of this.stateListeners)e(this,t,r,n)})}getConnectivityState(){return this.ejected?i.ConnectivityState.TRANSIENT_FAILURE:this.childSubchannelState}addConnectivityStateListener(e){this.stateListeners.push(e)}removeConnectivityStateListener(e){let t=this.stateListeners.indexOf(e);t>-1&&this.stateListeners.splice(t,1)}ref(){this.child.ref(),this.refCount+=1}unref(){if(this.child.unref(),this.refCount-=1,this.refCount<=0&&this.mapEntry){let e=this.mapEntry.subchannelWrappers.indexOf(this);e>=0&&this.mapEntry.subchannelWrappers.splice(e,1)}}eject(){for(let e of(this.ejected=!0,this.stateListeners))e(this,this.childSubchannelState,i.ConnectivityState.TRANSIENT_FAILURE,-1)}uneject(){for(let e of(this.ejected=!1,this.stateListeners))e(this,i.ConnectivityState.TRANSIENT_FAILURE,this.childSubchannelState,-1)}getMapEntry(){return this.mapEntry}getWrappedSubchannel(){return this.child}}function _(){return{success:0,failure:0}}class I{constructor(){this.activeBucket=_(),this.inactiveBucket=_()}addSuccess(){this.activeBucket.success+=1}addFailure(){this.activeBucket.failure+=1}switchBuckets(){this.inactiveBucket=this.activeBucket,this.activeBucket=_()}getLastSuccesses(){return this.inactiveBucket.success}getLastFailures(){return this.inactiveBucket.failure}}class k{constructor(e,t){this.wrappedPicker=e,this.countCalls=t}pick(e){let t=this.wrappedPicker.pick(e);if(t.pickResultType!==c.PickResultType.COMPLETE)return t;{let e=t.subchannel,r=e.getMapEntry();if(!r)return Object.assign(Object.assign({},t),{subchannel:e.getWrappedSubchannel()});{let n=t.onCallEnded;return this.countCalls&&(n=e=>{var n;e===s.Status.OK?r.counter.addSuccess():r.counter.addFailure(),null==(n=t.onCallEnded)||n.call(t,e)}),Object.assign(Object.assign({},t),{subchannel:e.getWrappedSubchannel(),onCallEnded:n})}}}}class x{constructor(e){this.addressMap=new Map,this.latestConfig=null,this.timerStartTime=null,this.childBalancer=new u.ChildLoadBalancerHandler((0,o.createChildChannelControlHelper)(e,{createSubchannel:(t,r)=>{let n=e.createSubchannel(t,r),i=this.addressMap.get((0,h.subchannelAddressToString)(t)),s=new E(n,i);return(null==i?void 0:i.currentEjectionTimestamp)!==null&&s.eject(),null==i||i.subchannelWrappers.push(s),s},updateState:(t,r)=>{t===i.ConnectivityState.READY?e.updateState(t,new k(r,this.isCountingEnabled())):e.updateState(t,r)}})),this.ejectionTimer=setInterval(()=>{},0),clearInterval(this.ejectionTimer)}isCountingEnabled(){return null!==this.latestConfig&&(null!==this.latestConfig.getSuccessRateEjectionConfig()||null!==this.latestConfig.getFailurePercentageEjectionConfig())}getCurrentEjectionPercent(){let e=0;for(let t of this.addressMap.values())null!==t.currentEjectionTimestamp&&(e+=1);return 100*e/this.addressMap.size}runSuccessRateCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getSuccessRateEjectionConfig();if(!t)return;m("Running success rate check");let r=t.request_volume,n=0,i=[];for(let[e,t]of this.addressMap){let s=t.counter.getLastSuccesses(),a=t.counter.getLastFailures();m("Stats for "+e+": successes="+s+" failures="+a+" targetRequestVolume="+r),s+a>=r&&(n+=1,i.push(s/(s+a)))}if(m("Found "+n+" success rate candidates; currentEjectionPercent="+this.getCurrentEjectionPercent()+" successRates=["+i+"]"),n<t.minimum_hosts)return;let s=i.reduce((e,t)=>e+t)/i.length,a=0;for(let e of i){let t=e-s;a+=t*t}let o=Math.sqrt(a/i.length),l=s-o*(t.stdev_factor/1e3);for(let[n,i]of(m("stdev="+o+" ejectionThreshold="+l),this.addressMap.entries())){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let s=i.counter.getLastSuccesses(),a=i.counter.getLastFailures();if(s+a<r)continue;let o=s/(s+a);if(m("Checking candidate "+n+" successRate="+o),o<l){let r=100*Math.random();m("Candidate "+n+" randomNumber="+r+" enforcement_percentage="+t.enforcement_percentage),r<t.enforcement_percentage&&(m("Ejecting candidate "+n),this.eject(i,e))}}}runFailurePercentageCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getFailurePercentageEjectionConfig();if(!t)return;m("Running failure percentage check. threshold="+t.threshold+" request volume threshold="+t.request_volume);let r=0;for(let e of this.addressMap.values())e.counter.getLastSuccesses()+e.counter.getLastFailures()>=t.request_volume&&(r+=1);if(!(r<t.minimum_hosts))for(let[r,n]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let i=n.counter.getLastSuccesses(),s=n.counter.getLastFailures();if((m("Candidate successes="+i+" failures="+s),!(i+s<t.request_volume))&&100*s/(s+i)>t.threshold){let i=100*Math.random();m("Candidate "+r+" randomNumber="+i+" enforcement_percentage="+t.enforcement_percentage),i<t.enforcement_percentage&&(m("Ejecting candidate "+r),this.eject(n,e))}}}eject(e,t){for(let t of(e.currentEjectionTimestamp=new Date,e.ejectionTimeMultiplier+=1,e.subchannelWrappers))t.eject()}uneject(e){for(let t of(e.currentEjectionTimestamp=null,e.subchannelWrappers))t.uneject()}switchAllBuckets(){for(let e of this.addressMap.values())e.counter.switchBuckets()}startTimer(e){var t,r;this.ejectionTimer=setTimeout(()=>this.runChecks(),e),null==(r=(t=this.ejectionTimer).unref)||r.call(t)}runChecks(){let e=new Date;if(m("Ejection timer running"),this.switchAllBuckets(),this.latestConfig)for(let[t,r]of(this.timerStartTime=e,this.startTimer(this.latestConfig.getIntervalMs()),this.runSuccessRateCheck(e),this.runFailurePercentageCheck(e),this.addressMap.entries()))if(null===r.currentEjectionTimestamp)r.ejectionTimeMultiplier>0&&(r.ejectionTimeMultiplier-=1);else{let e=this.latestConfig.getBaseEjectionTimeMs(),n=this.latestConfig.getMaxEjectionTimeMs(),i=new Date(r.currentEjectionTimestamp.getTime());i.setMilliseconds(i.getMilliseconds()+Math.min(e*r.ejectionTimeMultiplier,Math.max(e,n))),i<new Date&&(m("Unejecting "+t),this.uneject(r))}}updateAddressList(e,t,r){if(!(t instanceof T))return;let n=new Set;for(let t of e)n.add((0,h.subchannelAddressToString)(t));for(let e of n)this.addressMap.has(e)||(m("Adding map entry for "+e),this.addressMap.set(e,{counter:new I,currentEjectionTimestamp:null,ejectionTimeMultiplier:0,subchannelWrappers:[]}));for(let e of this.addressMap.keys())n.has(e)||(m("Removing map entry for "+e),this.addressMap.delete(e));let i=(0,l.getFirstUsableConfig)(t.getChildPolicy(),!0);if(this.childBalancer.updateAddressList(e,i,r),t.getSuccessRateEjectionConfig()||t.getFailurePercentageEjectionConfig())if(this.timerStartTime){m("Previous timer existed. Replacing timer"),clearTimeout(this.ejectionTimer);let e=t.getIntervalMs()-(new Date().getTime()-this.timerStartTime.getTime());this.startTimer(e)}else m("Starting new timer"),this.timerStartTime=new Date,this.startTimer(t.getIntervalMs()),this.switchAllBuckets();else for(let e of(m("Counting disabled. Cancelling timer."),this.timerStartTime=null,clearTimeout(this.ejectionTimer),this.addressMap.values()))this.uneject(e),e.ejectionTimeMultiplier=0;this.latestConfig=t}exitIdle(){this.childBalancer.exitIdle()}resetBackoff(){this.childBalancer.resetBackoff()}destroy(){clearTimeout(this.ejectionTimer),this.childBalancer.destroy()}getTypeName(){return g}}r.OutlierDetectionLoadBalancer=x,r.setup=function(){y&&(0,o.registerLoadBalancerType)(g,x,T)}},17860,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.OutlierDetectionLoadBalancingConfig=r.BaseSubchannelWrapper=r.registerAdminService=r.FilterStackFactory=r.BaseFilter=r.PickResultType=r.QueuePicker=r.UnavailablePicker=r.ChildLoadBalancerHandler=r.subchannelAddressToString=r.validateLoadBalancingConfig=r.getFirstUsableConfig=r.registerLoadBalancerType=r.createChildChannelControlHelper=r.BackoffTimeout=r.durationToMs=r.uriToString=r.createResolver=r.registerResolver=r.log=r.trace=void 0;var n=e.r(82702);Object.defineProperty(r,"trace",{enumerable:!0,get:function(){return n.trace}}),Object.defineProperty(r,"log",{enumerable:!0,get:function(){return n.log}});var i=e.r(14507);Object.defineProperty(r,"registerResolver",{enumerable:!0,get:function(){return i.registerResolver}}),Object.defineProperty(r,"createResolver",{enumerable:!0,get:function(){return i.createResolver}});var s=e.r(84848);Object.defineProperty(r,"uriToString",{enumerable:!0,get:function(){return s.uriToString}});var a=e.r(73735);Object.defineProperty(r,"durationToMs",{enumerable:!0,get:function(){return a.durationToMs}});var o=e.r(70016);Object.defineProperty(r,"BackoffTimeout",{enumerable:!0,get:function(){return o.BackoffTimeout}});var l=e.r(1291);Object.defineProperty(r,"createChildChannelControlHelper",{enumerable:!0,get:function(){return l.createChildChannelControlHelper}}),Object.defineProperty(r,"registerLoadBalancerType",{enumerable:!0,get:function(){return l.registerLoadBalancerType}}),Object.defineProperty(r,"getFirstUsableConfig",{enumerable:!0,get:function(){return l.getFirstUsableConfig}}),Object.defineProperty(r,"validateLoadBalancingConfig",{enumerable:!0,get:function(){return l.validateLoadBalancingConfig}});var u=e.r(76005);Object.defineProperty(r,"subchannelAddressToString",{enumerable:!0,get:function(){return u.subchannelAddressToString}});var c=e.r(64947);Object.defineProperty(r,"ChildLoadBalancerHandler",{enumerable:!0,get:function(){return c.ChildLoadBalancerHandler}});var h=e.r(90551);Object.defineProperty(r,"UnavailablePicker",{enumerable:!0,get:function(){return h.UnavailablePicker}}),Object.defineProperty(r,"QueuePicker",{enumerable:!0,get:function(){return h.QueuePicker}}),Object.defineProperty(r,"PickResultType",{enumerable:!0,get:function(){return h.PickResultType}});var d=e.r(96612);Object.defineProperty(r,"BaseFilter",{enumerable:!0,get:function(){return d.BaseFilter}});var f=e.r(25747);Object.defineProperty(r,"FilterStackFactory",{enumerable:!0,get:function(){return f.FilterStackFactory}});var p=e.r(78560);Object.defineProperty(r,"registerAdminService",{enumerable:!0,get:function(){return p.registerAdminService}});var m=e.r(52176);Object.defineProperty(r,"BaseSubchannelWrapper",{enumerable:!0,get:function(){return m.BaseSubchannelWrapper}});var g=e.r(70701);Object.defineProperty(r,"OutlierDetectionLoadBalancingConfig",{enumerable:!0,get:function(){return g.OutlierDetectionLoadBalancingConfig}})},63294,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.setup=void 0;let n=e.r(14507);class i{constructor(e,t,r){let n;this.listener=t,this.addresses=[],this.hasReturnedResult=!1,n=""===e.authority?"/"+e.path:e.path,this.addresses=[{path:n}]}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(this.listener.onSuccessfulResolution,this.addresses,null,null,null,{}))}destroy(){}static getDefaultAuthority(e){return"localhost"}}r.setup=function(){(0,n.registerResolver)("unix",i)}},67053,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.setup=void 0;let n=e.r(4446),i=e.r(33278),s=e.r(64346),a=e.r(14507),o=e.r(84848),l=e.r(82702),u="ip_resolver";function c(e){l.trace(i.LogVerbosity.DEBUG,u,e)}let h="ipv4",d="ipv6",f=443;class p{constructor(e,t,r){var a;this.listener=t,this.addresses=[],this.error=null,this.hasReturnedResult=!1,c("Resolver constructed for target "+(0,o.uriToString)(e));const l=[];if(e.scheme!==h&&e.scheme!==d){this.error={code:i.Status.UNAVAILABLE,details:`Unrecognized scheme ${e.scheme} in IP resolver`,metadata:new s.Metadata};return}for(const t of e.path.split(",")){const r=(0,o.splitHostPort)(t);if(null===r||e.scheme===h&&!(0,n.isIPv4)(r.host)||e.scheme===d&&!(0,n.isIPv6)(r.host)){this.error={code:i.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${t}`,metadata:new s.Metadata};return}l.push({host:r.host,port:null!=(a=r.port)?a:f})}this.addresses=l,c("Parsed "+e.scheme+" address list "+this.addresses)}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(()=>{this.error?this.listener.onError(this.error):this.listener.onSuccessfulResolution(this.addresses,null,null,null,{})}))}destroy(){this.hasReturnedResult=!1}static getDefaultAuthority(e){return e.path.split(",")[0]}}r.setup=function(){(0,a.registerResolver)(h,p),(0,a.registerResolver)(d,p)}},98394,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.setup=r.PickFirstLoadBalancer=r.shuffled=r.PickFirstLoadBalancingConfig=void 0;let n=e.r(1291),i=e.r(7541),s=e.r(90551),a=e.r(82702),o=e.r(33278),l="pick_first";function u(e){a.trace(o.LogVerbosity.DEBUG,l,e)}let c="pick_first",h=250;class d{constructor(e){this.shuffleAddressList=e}getLoadBalancerName(){return c}toJsonObject(){return{[c]:{shuffleAddressList:this.shuffleAddressList}}}getShuffleAddressList(){return this.shuffleAddressList}static createFromJson(e){if("shuffleAddressList"in e&&"boolean"!=typeof e.shuffleAddressList)throw Error("pick_first config field shuffleAddressList must be a boolean if provided");return new d(!0===e.shuffleAddressList)}}r.PickFirstLoadBalancingConfig=d;class f{constructor(e){this.subchannel=e}pick(e){return{pickResultType:s.PickResultType.COMPLETE,subchannel:this.subchannel,status:null,onCallStarted:null,onCallEnded:null}}}function p(e){let t=e.slice();for(let e=t.length-1;e>1;e--){let r=Math.floor(Math.random()*(e+1)),n=t[e];t[e]=t[r],t[r]=n}return t}r.shuffled=p;class m{constructor(e){this.channelControlHelper=e,this.children=[],this.currentState=i.ConnectivityState.IDLE,this.currentSubchannelIndex=0,this.currentPick=null,this.subchannelStateListener=(e,t,r,n,i)=>{this.onSubchannelStateUpdate(e,t,r,i)},this.triedAllSubchannels=!1,this.stickyTransientFailureMode=!1,this.requestedResolutionSinceLastUpdate=!1,this.lastError=null,this.latestAddressList=null,this.connectionDelayTimeout=setTimeout(()=>{},0),clearTimeout(this.connectionDelayTimeout)}allChildrenHaveReportedTF(){return this.children.every(e=>e.hasReportedTransientFailure)}calculateAndReportNewState(){this.currentPick?this.updateState(i.ConnectivityState.READY,new f(this.currentPick)):0===this.children.length?this.updateState(i.ConnectivityState.IDLE,new s.QueuePicker(this)):this.stickyTransientFailureMode?this.updateState(i.ConnectivityState.TRANSIENT_FAILURE,new s.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(i.ConnectivityState.CONNECTING,new s.QueuePicker(this))}requestReresolution(){this.requestedResolutionSinceLastUpdate=!0,this.channelControlHelper.requestReresolution()}maybeEnterStickyTransientFailureMode(){if(this.allChildrenHaveReportedTF()&&(this.requestedResolutionSinceLastUpdate||this.requestReresolution(),!this.stickyTransientFailureMode)){for(let{subchannel:e}of(this.stickyTransientFailureMode=!0,this.children))e.startConnecting();this.calculateAndReportNewState()}}removeCurrentPick(){if(null!==this.currentPick){let e=this.currentPick;this.currentPick=null,e.unref(),e.removeConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.removeChannelzChild(e.getChannelzRef())}}onSubchannelStateUpdate(e,t,r,n){var s;if(null==(s=this.currentPick)?void 0:s.realSubchannelEquals(e)){r!==i.ConnectivityState.READY&&(this.removeCurrentPick(),this.calculateAndReportNewState(),this.requestReresolution());return}for(let[t,s]of this.children.entries())if(e.realSubchannelEquals(s.subchannel)){r===i.ConnectivityState.READY&&this.pickSubchannel(s.subchannel),r===i.ConnectivityState.TRANSIENT_FAILURE&&(s.hasReportedTransientFailure=!0,n&&(this.lastError=n),this.maybeEnterStickyTransientFailureMode(),t===this.currentSubchannelIndex&&this.startNextSubchannelConnecting(t+1)),s.subchannel.startConnecting();return}}startNextSubchannelConnecting(e){if(clearTimeout(this.connectionDelayTimeout),!this.triedAllSubchannels){for(let[t,r]of this.children.entries())if(t>=e){let e=r.subchannel.getConnectivityState();if(e===i.ConnectivityState.IDLE||e===i.ConnectivityState.CONNECTING)return void this.startConnecting(t)}this.triedAllSubchannels=!0,this.maybeEnterStickyTransientFailureMode()}}startConnecting(e){var t,r;clearTimeout(this.connectionDelayTimeout),this.currentSubchannelIndex=e,this.children[e].subchannel.getConnectivityState()===i.ConnectivityState.IDLE&&(u("Start connecting to subchannel with address "+this.children[e].subchannel.getAddress()),process.nextTick(()=>{var t;null==(t=this.children[e])||t.subchannel.startConnecting()})),this.connectionDelayTimeout=null==(r=(t=setTimeout(()=>{this.startNextSubchannelConnecting(e+1)},h)).unref)?void 0:r.call(t)}pickSubchannel(e){this.currentPick&&e.realSubchannelEquals(this.currentPick)||(u("Pick subchannel with address "+e.getAddress()),this.stickyTransientFailureMode=!1,null!==this.currentPick&&(this.currentPick.unref(),this.channelControlHelper.removeChannelzChild(this.currentPick.getChannelzRef()),this.currentPick.removeConnectivityStateListener(this.subchannelStateListener)),this.currentPick=e,e.ref(),this.channelControlHelper.addChannelzChild(e.getChannelzRef()),this.resetSubchannelList(),clearTimeout(this.connectionDelayTimeout),this.calculateAndReportNewState())}updateState(e,t){u(i.ConnectivityState[this.currentState]+" -> "+i.ConnectivityState[e]),this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.children)this.currentPick&&e.subchannel.realSubchannelEquals(this.currentPick)||e.subchannel.removeConnectivityStateListener(this.subchannelStateListener),e.subchannel.unref(),this.channelControlHelper.removeChannelzChild(e.subchannel.getChannelzRef());this.currentSubchannelIndex=0,this.children=[],this.triedAllSubchannels=!1,this.requestedResolutionSinceLastUpdate=!1}connectToAddressList(e){let t=e.map(e=>({subchannel:this.channelControlHelper.createSubchannel(e,{}),hasReportedTransientFailure:!1}));for(let{subchannel:e}of t)e.ref(),this.channelControlHelper.addChannelzChild(e.getChannelzRef());for(let{subchannel:e}of(this.resetSubchannelList(),this.children=t,this.children))if(e.addConnectivityStateListener(this.subchannelStateListener),e.getConnectivityState()===i.ConnectivityState.READY)return void this.pickSubchannel(e);for(let e of this.children)e.subchannel.getConnectivityState()===i.ConnectivityState.TRANSIENT_FAILURE&&(e.hasReportedTransientFailure=!0);this.startNextSubchannelConnecting(0),this.calculateAndReportNewState()}updateAddressList(e,t){t instanceof d&&(t.getShuffleAddressList()&&(e=p(e)),this.latestAddressList=e,this.connectToAddressList(e))}exitIdle(){this.currentState===i.ConnectivityState.IDLE&&this.latestAddressList&&this.connectToAddressList(this.latestAddressList)}resetBackoff(){}destroy(){this.resetSubchannelList(),this.removeCurrentPick()}getTypeName(){return c}}r.PickFirstLoadBalancer=m,r.setup=function(){(0,n.registerLoadBalancerType)(c,m,d),(0,n.registerDefaultLoadBalancerType)(c)}},29733,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.setup=r.RoundRobinLoadBalancer=void 0;let n=e.r(1291),i=e.r(7541),s=e.r(90551),a=e.r(76005),o=e.r(82702),l=e.r(33278),u="round_robin";function c(e){o.trace(l.LogVerbosity.DEBUG,u,e)}let h="round_robin";class d{getLoadBalancerName(){return h}constructor(){}toJsonObject(){return{[h]:{}}}static createFromJson(e){return new d}}class f{constructor(e,t=0){this.subchannelList=e,this.nextIndex=t}pick(e){let t=this.subchannelList[this.nextIndex];return this.nextIndex=(this.nextIndex+1)%this.subchannelList.length,{pickResultType:s.PickResultType.COMPLETE,subchannel:t,status:null,onCallStarted:null,onCallEnded:null}}peekNextSubchannel(){return this.subchannelList[this.nextIndex]}}class p{constructor(e){this.channelControlHelper=e,this.subchannels=[],this.currentState=i.ConnectivityState.IDLE,this.currentReadyPicker=null,this.lastError=null,this.subchannelStateListener=(e,t,r,n,s)=>{this.calculateAndUpdateState(),(r===i.ConnectivityState.TRANSIENT_FAILURE||r===i.ConnectivityState.IDLE)&&(s&&(this.lastError=s),this.channelControlHelper.requestReresolution(),e.startConnecting())}}countSubchannelsWithState(e){return this.subchannels.filter(t=>t.getConnectivityState()===e).length}calculateAndUpdateState(){if(this.countSubchannelsWithState(i.ConnectivityState.READY)>0){let e=this.subchannels.filter(e=>e.getConnectivityState()===i.ConnectivityState.READY),t=0;null!==this.currentReadyPicker&&(t=e.indexOf(this.currentReadyPicker.peekNextSubchannel()))<0&&(t=0),this.updateState(i.ConnectivityState.READY,new f(e,t))}else this.countSubchannelsWithState(i.ConnectivityState.CONNECTING)>0?this.updateState(i.ConnectivityState.CONNECTING,new s.QueuePicker(this)):this.countSubchannelsWithState(i.ConnectivityState.TRANSIENT_FAILURE)>0?this.updateState(i.ConnectivityState.TRANSIENT_FAILURE,new s.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(i.ConnectivityState.IDLE,new s.QueuePicker(this))}updateState(e,t){c(i.ConnectivityState[this.currentState]+" -> "+i.ConnectivityState[e]),e===i.ConnectivityState.READY?this.currentReadyPicker=t:this.currentReadyPicker=null,this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.subchannels)e.removeConnectivityStateListener(this.subchannelStateListener),e.unref(),this.channelControlHelper.removeChannelzChild(e.getChannelzRef());this.subchannels=[]}updateAddressList(e,t){for(let t of(this.resetSubchannelList(),c("Connect to address list "+e.map(e=>(0,a.subchannelAddressToString)(e))),this.subchannels=e.map(e=>this.channelControlHelper.createSubchannel(e,{})),this.subchannels)){t.ref(),t.addConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.addChannelzChild(t.getChannelzRef());let e=t.getConnectivityState();(e===i.ConnectivityState.IDLE||e===i.ConnectivityState.TRANSIENT_FAILURE)&&t.startConnecting()}this.calculateAndUpdateState()}exitIdle(){for(let e of this.subchannels)e.startConnecting()}resetBackoff(){}destroy(){this.resetSubchannelList()}getTypeName(){return h}}r.RoundRobinLoadBalancer=p,r.setup=function(){(0,n.registerLoadBalancerType)(h,p,d)}},61569,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.experimental=r.addAdminServicesToServer=r.getChannelzHandlers=r.getChannelzServiceDefinition=r.InterceptorConfigurationError=r.InterceptingCall=r.RequesterBuilder=r.ListenerBuilder=r.StatusBuilder=r.getClientChannel=r.ServerCredentials=r.Server=r.setLogVerbosity=r.setLogger=r.load=r.loadObject=r.CallCredentials=r.ChannelCredentials=r.waitForClientReady=r.closeClient=r.Channel=r.makeGenericClientConstructor=r.makeClientConstructor=r.loadPackageDefinition=r.Client=r.compressionAlgorithms=r.propagate=r.connectivityState=r.status=r.logVerbosity=r.Metadata=r.credentials=void 0;let n=e.r(68151);Object.defineProperty(r,"CallCredentials",{enumerable:!0,get:function(){return n.CallCredentials}});let i=e.r(79675);Object.defineProperty(r,"Channel",{enumerable:!0,get:function(){return i.ChannelImplementation}});let s=e.r(5868);Object.defineProperty(r,"compressionAlgorithms",{enumerable:!0,get:function(){return s.CompressionAlgorithms}});let a=e.r(7541);Object.defineProperty(r,"connectivityState",{enumerable:!0,get:function(){return a.ConnectivityState}});let o=e.r(91698);Object.defineProperty(r,"ChannelCredentials",{enumerable:!0,get:function(){return o.ChannelCredentials}});let l=e.r(18656);Object.defineProperty(r,"Client",{enumerable:!0,get:function(){return l.Client}});let u=e.r(33278);Object.defineProperty(r,"logVerbosity",{enumerable:!0,get:function(){return u.LogVerbosity}}),Object.defineProperty(r,"status",{enumerable:!0,get:function(){return u.Status}}),Object.defineProperty(r,"propagate",{enumerable:!0,get:function(){return u.Propagate}});let c=e.r(82702),h=e.r(76273);Object.defineProperty(r,"loadPackageDefinition",{enumerable:!0,get:function(){return h.loadPackageDefinition}}),Object.defineProperty(r,"makeClientConstructor",{enumerable:!0,get:function(){return h.makeClientConstructor}}),Object.defineProperty(r,"makeGenericClientConstructor",{enumerable:!0,get:function(){return h.makeClientConstructor}});let d=e.r(64346);Object.defineProperty(r,"Metadata",{enumerable:!0,get:function(){return d.Metadata}});let f=e.r(79579);Object.defineProperty(r,"Server",{enumerable:!0,get:function(){return f.Server}});let p=e.r(86183);Object.defineProperty(r,"ServerCredentials",{enumerable:!0,get:function(){return p.ServerCredentials}});let m=e.r(26427);Object.defineProperty(r,"StatusBuilder",{enumerable:!0,get:function(){return m.StatusBuilder}}),r.credentials={combineChannelCredentials:(e,...t)=>t.reduce((e,t)=>e.compose(t),e),combineCallCredentials:(e,...t)=>t.reduce((e,t)=>e.compose(t),e),createInsecure:o.ChannelCredentials.createInsecure,createSsl:o.ChannelCredentials.createSsl,createFromSecureContext:o.ChannelCredentials.createFromSecureContext,createFromMetadataGenerator:n.CallCredentials.createFromMetadataGenerator,createFromGoogleCredential:n.CallCredentials.createFromGoogleCredential,createEmpty:n.CallCredentials.createEmpty},r.closeClient=e=>e.close(),r.waitForClientReady=(e,t,r)=>e.waitForReady(t,r),r.loadObject=(e,t)=>{throw Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")},r.load=(e,t,r)=>{throw Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")},r.setLogger=e=>{c.setLogger(e)},r.setLogVerbosity=e=>{c.setLoggerVerbosity(e)},r.getClientChannel=e=>l.Client.prototype.getChannel.call(e);var g=e.r(88831);Object.defineProperty(r,"ListenerBuilder",{enumerable:!0,get:function(){return g.ListenerBuilder}}),Object.defineProperty(r,"RequesterBuilder",{enumerable:!0,get:function(){return g.RequesterBuilder}}),Object.defineProperty(r,"InterceptingCall",{enumerable:!0,get:function(){return g.InterceptingCall}}),Object.defineProperty(r,"InterceptorConfigurationError",{enumerable:!0,get:function(){return g.InterceptorConfigurationError}});var y=e.r(86039);Object.defineProperty(r,"getChannelzServiceDefinition",{enumerable:!0,get:function(){return y.getChannelzServiceDefinition}}),Object.defineProperty(r,"getChannelzHandlers",{enumerable:!0,get:function(){return y.getChannelzHandlers}});var v=e.r(78560);Object.defineProperty(r,"addAdminServicesToServer",{enumerable:!0,get:function(){return v.addAdminServicesToServer}}),r.experimental=e.r(17860);let b=e.r(75808),S=e.r(63294),w=e.r(67053),C=e.r(98394),T=e.r(29733),E=e.r(70701),_=e.r(86039);(()=>{b.setup(),S.setup(),w.setup(),C.setup(),T.setup(),E.setup(),_.setup()})()},41582,76683,44664,70474,3493,686,e=>{"use strict";let t,r,n=()=>void 0,i={NODE_CLIENT:!1},s=function(e){let t=[],r=0;for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);i<128?t[r++]=i:(i<2048?t[r++]=i>>6|192:((64512&i)==55296&&n+1<e.length&&(64512&e.charCodeAt(n+1))==56320?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++n)),t[r++]=i>>18|240,t[r++]=i>>12&63|128):t[r++]=i>>12|224,t[r++]=i>>6&63|128),t[r++]=63&i|128)}return t},a=function(e){let t=[],r=0,n=0;for(;r<e.length;){let i=e[r++];if(i<128)t[n++]=String.fromCharCode(i);else if(i>191&&i<224){let s=e[r++];t[n++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){let s=((7&i)<<18|(63&e[r++])<<12|(63&e[r++])<<6|63&e[r++])-65536;t[n++]=String.fromCharCode(55296+(s>>10)),t[n++]=String.fromCharCode(56320+(1023&s))}else{let s=e[r++],a=e[r++];t[n++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&a)}}return t.join("")},o={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let r=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let t=0;t<e.length;t+=3){let i=e[t],s=t+1<e.length,a=s?e[t+1]:0,o=t+2<e.length,l=o?e[t+2]:0,u=i>>2,c=(3&i)<<4|a>>4,h=(15&a)<<2|l>>6,d=63&l;!o&&(d=64,s||(h=64)),n.push(r[u],r[c],r[h],r[d])}return n.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(s(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):a(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let r=t?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let t=0;t<e.length;){let i=r[e.charAt(t++)],s=t<e.length?r[e.charAt(t)]:0,a=++t<e.length?r[e.charAt(t)]:64,o=++t<e.length?r[e.charAt(t)]:64;if(++t,null==i||null==s||null==a||null==o)throw new l;let u=i<<2|s>>4;if(n.push(u),64!==a){let e=s<<4&240|a>>2;if(n.push(e),64!==o){let e=a<<6&192|o;n.push(e)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class l extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let u=function(e){let t=s(e);return o.encodeByteArray(t,!0)},c=function(e){return u(e).replace(/\./g,"")},h=function(e){try{return o.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function d(){return"undefined"!=typeof self?self:e.g}let f=()=>d().__FIREBASE_DEFAULTS__,p=()=>{if("undefined"==typeof process||void 0===process.env)return;let e=process.env.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)},m=()=>{let e;if("undefined"==typeof document)return;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}let t=e&&h(e[1]);return t&&JSON.parse(t)},g=()=>{try{return n()||f()||p()||m()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},y=e=>g()?.emulatorHosts?.[e],v=e=>{let t=y(e);if(!t)return;let r=t.lastIndexOf(":");if(r<=0||r+1===t.length)throw Error(`Invalid host ${t} with no separate hostname and port!`);let n=parseInt(t.substring(r+1),10);return"["===t[0]?[t.substring(1,r-1),n]:[t.substring(0,r),n]},b=()=>g()?.config;class S{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,r))}}}function w(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch{return!1}}async function C(e){return(await fetch(e,{credentials:"include"})).ok}function T(e,t){if(e.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let r={alg:"none",type:"JWT"},n=t||"demo-project",i=e.iat||0,s=e.sub||e.user_id;if(!s)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let a={iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}},...e},o="";return[c(JSON.stringify(r)),c(JSON.stringify(a)),o].join(".")}function E(e,t){}function _(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function I(){return!1}function k(){let t=g()?.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(e.g.process)}catch(e){return!1}}function x(){return R()}function R(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function D(){return"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent}function A(){let e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function O(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function N(){let e=_();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function P(){return!k()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function M(){return!k()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function L(){try{return"object"==typeof indexedDB}catch(e){return!1}}function B(){return new Promise((e,t)=>{try{let r=!0,n="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(n);i.onsuccess=()=>{i.result.close(),r||self.indexedDB.deleteDatabase(n),e(!0)},i.onupgradeneeded=()=>{r=!1},i.onerror=()=>{t(i.error?.message||"")}}catch(e){t(e)}})}let F="FirebaseError";class j extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=F,Object.setPrototypeOf(this,j.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,V.prototype.create)}}class V{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){let r=t[0]||{},n=`${this.service}/${e}`,i=this.errors[e],s=i?z(i,r):"Error",a=`${this.serviceName}: ${s} (${n}).`;return new j(n,a,r)}}function z(e,t){return e.replace(q,(e,r)=>{let n=t[r];return null!=n?String(n):`<${r}?>`})}let q=/\{\$([^}]+)}/g;function U(e,t){if(e===t)return!0;let r=Object.keys(e),n=Object.keys(t);for(let i of r){if(!n.includes(i))return!1;let r=e[i],s=t[i];if($(r)&&$(s)){if(!U(r,s))return!1}else if(r!==s)return!1}for(let e of n)if(!r.includes(e))return!1;return!0}function $(e){return null!==e&&"object"==typeof e}function K(e){let t=[];for(let[r,n]of Object.entries(e))Array.isArray(n)?n.forEach(e=>{t.push(encodeURIComponent(r)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(r)+"="+encodeURIComponent(n));return t.length?"&"+t.join("&"):""}function W(e){let t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){let[r,n]=e.split("=");t[decodeURIComponent(r)]=decodeURIComponent(n)}}),t}function G(e){let t=e.indexOf("?");if(!t)return"";let r=e.indexOf("#",t);return e.substring(t,r>0?r:void 0)}function H(e,t){let r=new Q(e,t);return r.subscribe.bind(r)}class Q{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let n;if(void 0===e&&void 0===t&&void 0===r)throw Error("Missing Observer.");void 0===(n=J(e,["next","error","complete"])?e:{next:e,error:t,complete:r}).next&&(n.next=Y),void 0===n.error&&(n.error=Y),void 0===n.complete&&(n.complete=Y);let i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?n.error(this.finalError):n.complete()}catch(e){}}),this.observers.push(n),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function J(e,t){if("object"!=typeof e||null===e)return!1;for(let r of t)if(r in e&&"function"==typeof e[r])return!0;return!1}function Y(){}function X(e){return e&&e._delegate?e._delegate:e}i.NODE_CLIENT=!0,e.s(["Deferred",()=>S,"ErrorFactory",()=>V,"FirebaseError",()=>j,"base64Decode",()=>h,"base64urlEncodeWithoutPadding",()=>c,"createMockUserToken",()=>T,"createSubscribe",()=>H,"deepEqual",()=>U,"extractQuerystring",()=>G,"getDefaultAppConfig",()=>b,"getDefaultEmulatorHost",()=>y,"getDefaultEmulatorHostnameAndPort",()=>v,"getGlobal",()=>d,"getModularInstance",()=>X,"getUA",()=>_,"isBrowser",()=>x,"isBrowserExtension",()=>A,"isCloudWorkstation",()=>w,"isCloudflareWorker",()=>D,"isIE",()=>N,"isIndexedDBAvailable",()=>L,"isMobileCordova",()=>I,"isReactNative",()=>O,"isSafari",()=>P,"isSafariOrWebkit",()=>M,"isWebWorker",()=>R,"pingServer",()=>C,"querystring",()=>K,"querystringDecode",()=>W,"updateEmulatorBanner",()=>E,"validateIndexedDBOpenable",()=>B],76683);class Z{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}let ee="[DEFAULT]";class et{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let e=new S;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{let r=this.getOrInitializeService({instanceIdentifier:t});r&&e.resolve(r)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){let t=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(e){if(r)return null;throw e}if(r)return null;throw Error(`Service ${this.name} is not available`)}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(en(e))try{this.getOrInitializeService({instanceIdentifier:ee})}catch(e){}for(let[e,t]of this.instancesDeferred.entries()){let r=this.normalizeInstanceIdentifier(e);try{let e=this.getOrInitializeService({instanceIdentifier:r});t.resolve(e)}catch(e){}}}}clearInstance(e=ee){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=ee){return this.instances.has(e)}getOptions(e=ee){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let n=this.getOrInitializeService({instanceIdentifier:r,options:t});for(let[e,t]of this.instancesDeferred.entries())r===this.normalizeInstanceIdentifier(e)&&t.resolve(n);return n}onInit(e,t){let r=this.normalizeInstanceIdentifier(t),n=this.onInitCallbacks.get(r)??new Set;n.add(e),this.onInitCallbacks.set(r,n);let i=this.instances.get(r);return i&&e(i,r),()=>{n.delete(e)}}invokeOnInitCallbacks(e,t){let r=this.onInitCallbacks.get(t);if(r)for(let n of r)try{n(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:er(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=ee){return this.component?this.component.multipleInstances?e:ee:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}function er(e){return e===ee?void 0:e}function en(e){return"EAGER"===e.instantiationMode}class ei{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new et(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}e.s(["Component",()=>Z,"ComponentContainer",()=>ei],44664);let es=[];!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(tb||(tb={}));let ea={debug:tb.DEBUG,verbose:tb.VERBOSE,info:tb.INFO,warn:tb.WARN,error:tb.ERROR,silent:tb.SILENT},eo=tb.INFO,el={[tb.DEBUG]:"log",[tb.VERBOSE]:"log",[tb.INFO]:"info",[tb.WARN]:"warn",[tb.ERROR]:"error"},eu=(e,t,...r)=>{if(t<e.logLevel)return;let n=new Date().toISOString(),i=el[t];if(i)console[i](`[${n}]  ${e.name}:`,...r);else throw Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class ec{constructor(e){this.name=e,this._logLevel=eo,this._logHandler=eu,this._userLogHandler=null,es.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in tb))throw TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?ea[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,tb.DEBUG,...e),this._logHandler(this,tb.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,tb.VERBOSE,...e),this._logHandler(this,tb.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,tb.INFO,...e),this._logHandler(this,tb.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,tb.WARN,...e),this._logHandler(this,tb.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,tb.ERROR,...e),this._logHandler(this,tb.ERROR,...e)}}function eh(e){es.forEach(t=>{t.setLogLevel(e)})}function ed(e,t){for(let r of es){let n=null;t&&t.level&&(n=ea[t.level]),null===e?r.userLogHandler=null:r.userLogHandler=(t,r,...i)=>{let s=i.map(e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}}).filter(e=>e).join(" ");r>=(n??t.logLevel)&&e({level:tb[r].toLowerCase(),message:s,args:i,type:t.name})}}}e.s(["LogLevel",()=>tb,"Logger",()=>ec,"setLogLevel",()=>eh,"setUserLogHandler",()=>ed],70474);let ef=(e,t)=>t.some(t=>e instanceof t);function ep(){return t||(t=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function em(){return r||(r=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}let eg=new WeakMap,ey=new WeakMap,ev=new WeakMap,eb=new WeakMap,eS=new WeakMap;function ew(e){let t=new Promise((t,r)=>{let n=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(ek(e.result)),n()},s=()=>{r(e.error),n()};e.addEventListener("success",i),e.addEventListener("error",s)});return t.then(t=>{t instanceof IDBCursor&&eg.set(t,e)}).catch(()=>{}),eS.set(t,e),t}function eC(e){if(ey.has(e))return;let t=new Promise((t,r)=>{let n=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),n()},s=()=>{r(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)});ey.set(e,t)}let eT={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return ey.get(e);if("objectStoreNames"===t)return e.objectStoreNames||ev.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return ek(e[t])},set:(e,t,r)=>(e[t]=r,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function eE(e){eT=e(eT)}function e_(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?em().includes(e)?function(...t){return e.apply(ex(this),t),ek(eg.get(this))}:function(...t){return ek(e.apply(ex(this),t))}:function(t,...r){let n=e.call(ex(this),t,...r);return ev.set(n,t.sort?t.sort():[t]),ek(n)}}function eI(e){return"function"==typeof e?e_(e):(e instanceof IDBTransaction&&eC(e),ef(e,ep()))?new Proxy(e,eT):e}function ek(e){if(e instanceof IDBRequest)return ew(e);if(eb.has(e))return eb.get(e);let t=eI(e);return t!==e&&(eb.set(e,t),eS.set(t,e)),t}let ex=e=>eS.get(e);function eR(e,t,{blocked:r,upgrade:n,blocking:i,terminated:s}={}){let a=indexedDB.open(e,t),o=ek(a);return n&&a.addEventListener("upgradeneeded",e=>{n(ek(a.result),e.oldVersion,e.newVersion,ek(a.transaction),e)}),r&&a.addEventListener("blocked",e=>r(e.oldVersion,e.newVersion,e)),o.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),o}let eD=["get","getKey","getAll","getAllKeys","count"],eA=["put","add","delete","clear"],eO=new Map;function eN(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(eO.get(t))return eO.get(t);let r=t.replace(/FromIndex$/,""),n=t!==r,i=eA.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!(i||eD.includes(r)))return;let s=async function(e,...t){let s=this.transaction(e,i?"readwrite":"readonly"),a=s.store;return n&&(a=a.index(t.shift())),(await Promise.all([a[r](...t),i&&s.done]))[0]};return eO.set(t,s),s}eE(e=>({...e,get:(t,r,n)=>eN(t,r)||e.get(t,r,n),has:(t,r)=>!!eN(t,r)||e.has(t,r)}));class eP{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(!eM(e))return null;{let t=e.getImmediate();return`${t.library}/${t.version}`}}).filter(e=>e).join(" ")}}function eM(e){let t=e.getComponent();return t?.type==="VERSION"}let eL="@firebase/app",eB="0.14.6",eF=new ec("@firebase/app"),ej="12.6.0",eV="[DEFAULT]",ez={[eL]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/ai":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},eq=new Map,eU=new Map,e$=new Map;function eK(e,t){try{e.container.addComponent(t)}catch(r){eF.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,r)}}function eW(e,t){e.container.addOrOverwriteComponent(t)}function eG(e){let t=e.name;if(e$.has(t))return eF.debug(`There were multiple attempts to register component ${t}.`),!1;for(let r of(e$.set(t,e),eq.values()))eK(r,e);for(let t of eU.values())eK(t,e);return!0}function eH(e,t){let r=e.container.getProvider("heartbeat").getImmediate({optional:!0});return r&&r.triggerHeartbeat(),e.container.getProvider(t)}function eQ(e,t,r=eV){eH(e,t).clearInstance(r)}function eJ(e){return void 0!==e.options}function eY(e){return!eJ(e)&&("authIdToken"in e||"appCheckToken"in e||"releaseOnDeref"in e||"automaticDataCollectionEnabled"in e)}function eX(e){return null!=e&&void 0!==e.settings}function eZ(){e$.clear()}let e0=new V("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class e1{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Z("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw e0.create("app-deleted",{appName:this._name})}}function e2(e,t){let r=h(e.split(".")[1]);null===r?console.error(`FirebaseServerApp ${t} is invalid: second part could not be parsed.`):void 0===JSON.parse(r).exp?console.error(`FirebaseServerApp ${t} is invalid: expiration claim could not be parsed`):1e3*JSON.parse(r).exp-new Date().getTime()<=0&&console.error(`FirebaseServerApp ${t} is invalid: the token has expired.`)}class e3 extends e1{constructor(e,t,r,n){const i=void 0===t.automaticDataCollectionEnabled||t.automaticDataCollectionEnabled,s={name:r,automaticDataCollectionEnabled:i};void 0!==e.apiKey?super(e,s,n):super(e.options,s,n),this._serverConfig={automaticDataCollectionEnabled:i,...t},this._serverConfig.authIdToken&&e2(this._serverConfig.authIdToken,"authIdToken"),this._serverConfig.appCheckToken&&e2(this._serverConfig.appCheckToken,"appCheckToken"),this._finalizationRegistry=null,"undefined"!=typeof FinalizationRegistry&&(this._finalizationRegistry=new FinalizationRegistry(()=>{this.automaticCleanup()})),this._refCount=0,this.incRefCount(this._serverConfig.releaseOnDeref),this._serverConfig.releaseOnDeref=void 0,t.releaseOnDeref=void 0,te(eL,eB,"serverapp")}toJSON(){}get refCount(){return this._refCount}incRefCount(e){this.isDeleted||(this._refCount++,void 0!==e&&null!==this._finalizationRegistry&&this._finalizationRegistry.register(e,this))}decRefCount(){return this.isDeleted?0:--this._refCount}automaticCleanup(){e9(this)}get settings(){return this.checkDestroyed(),this._serverConfig}checkDestroyed(){if(this.isDeleted)throw e0.create("server-app-deleted")}}let e6=ej;function e4(e,t={}){let r=e;"object"!=typeof t&&(t={name:t});let n={name:eV,automaticDataCollectionEnabled:!0,...t},i=n.name;if("string"!=typeof i||!i)throw e0.create("bad-app-name",{appName:String(i)});if(r||(r=b()),!r)throw e0.create("no-options");let s=eq.get(i);if(s)if(U(r,s.options)&&U(n,s.config))return s;else throw e0.create("duplicate-app",{appName:i});let a=new ei(i);for(let e of e$.values())a.addComponent(e);let o=new e1(r,n,a);return eq.set(i,o),o}function e5(e,t={}){let r;if(x()&&!R())throw e0.create("invalid-server-app-environment");let n=t||{};if(e&&(eJ(e)?r=e.options:eY(e)?n=e:r=e),void 0===n.automaticDataCollectionEnabled&&(n.automaticDataCollectionEnabled=!0),r||(r=b()),!r)throw e0.create("no-options");let i={...n,...r};void 0!==i.releaseOnDeref&&delete i.releaseOnDeref;let s=e=>[...e].reduce((e,t)=>Math.imul(31,e)+t.charCodeAt(0)|0,0);if(void 0!==n.releaseOnDeref&&"undefined"==typeof FinalizationRegistry)throw e0.create("finalization-registry-not-supported",{});let a=""+s(JSON.stringify(i)),o=eU.get(a);if(o)return o.incRefCount(n.releaseOnDeref),o;let l=new ei(a);for(let e of e$.values())l.addComponent(e);let u=new e3(r,n,a,l);return eU.set(a,u),u}function e8(e=eV){let t=eq.get(e);if(!t&&e===eV&&b())return e4();if(!t)throw e0.create("no-app",{appName:e});return t}function e7(){return Array.from(eq.values())}async function e9(e){let t=!1,r=e.name;eq.has(r)?(t=!0,eq.delete(r)):eU.has(r)&&0>=e.decRefCount()&&(eU.delete(r),t=!0),t&&(await Promise.all(e.container.getProviders().map(e=>e.delete())),e.isDeleted=!0)}function te(e,t,r){let n=ez[e]??e;r&&(n+=`-${r}`);let i=n.match(/\s|\//),s=t.match(/\s|\//);if(i||s){let e=[`Unable to register library "${n}" with version "${t}":`];i&&e.push(`library name "${n}" contains illegal characters (whitespace or "/")`),i&&s&&e.push("and"),s&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),eF.warn(e.join(" "));return}eG(new Z(`${n}-version`,()=>({library:n,version:t}),"VERSION"))}function tt(e,t){if(null!==e&&"function"!=typeof e)throw e0.create("invalid-log-argument");ed(e,t)}function tr(e){eh(e)}let tn="firebase-heartbeat-database",ti=1,ts="firebase-heartbeat-store",ta=null;function to(){return ta||(ta=eR(tn,ti,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(ts)}catch(e){console.warn(e)}}}).catch(e=>{throw e0.create("idb-open",{originalErrorMessage:e.message})})),ta}async function tl(e){try{let t=(await to()).transaction(ts),r=await t.objectStore(ts).get(tc(e));return await t.done,r}catch(e){if(e instanceof j)eF.warn(e.message);else{let t=e0.create("idb-get",{originalErrorMessage:e?.message});eF.warn(t.message)}}}async function tu(e,t){try{let r=(await to()).transaction(ts,"readwrite"),n=r.objectStore(ts);await n.put(t,tc(e)),await r.done}catch(e){if(e instanceof j)eF.warn(e.message);else{let t=e0.create("idb-set",{originalErrorMessage:e?.message});eF.warn(t.message)}}}function tc(e){return`${e.name}!${e.options.appId}`}let th=1024,td=30;class tf{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new tg(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){try{let e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=tp();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===t||this._heartbeatsCache.heartbeats.some(e=>e.date===t))return;if(this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats.length>td){let e=tv(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){eF.warn(e)}}async getHeartbeatsHeader(){try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||0===this._heartbeatsCache.heartbeats.length)return"";let e=tp(),{heartbeatsToSend:t,unsentEntries:r}=tm(this._heartbeatsCache.heartbeats),n=c(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),n}catch(e){return eF.warn(e),""}}}function tp(){return new Date().toISOString().substring(0,10)}function tm(e,t=th){let r=[],n=e.slice();for(let i of e){let e=r.find(e=>e.agent===i.agent);if(e){if(e.dates.push(i.date),ty(r)>t){e.dates.pop();break}}else if(r.push({agent:i.agent,dates:[i.date]}),ty(r)>t){r.pop();break}n=n.slice(1)}return{heartbeatsToSend:r,unsentEntries:n}}class tg{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!L()&&B().then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};{let e=await tl(this.app);return e?.heartbeats?e:{heartbeats:[]}}}async overwrite(e){if(await this._canUseIndexedDBPromise){let t=await this.read();return tu(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){if(await this._canUseIndexedDBPromise){let t=await this.read();return tu(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:[...t.heartbeats,...e.heartbeats]})}}}function ty(e){return c(JSON.stringify({version:2,heartbeats:e})).length}function tv(e){if(0===e.length)return -1;let t=0,r=e[0].date;for(let n=1;n<e.length;n++)e[n].date<r&&(r=e[n].date,t=n);return t}(function(e){eG(new Z("platform-logger",e=>new eP(e),"PRIVATE")),eG(new Z("heartbeat",e=>new tf(e),"PRIVATE")),te(eL,eB,""),te(eL,eB,"esm2020"),te("fire-js","")})(""),e.s(["SDK_VERSION",()=>e6,"_DEFAULT_ENTRY_NAME",()=>eV,"_addComponent",()=>eK,"_addOrOverwriteComponent",()=>eW,"_apps",()=>eq,"_clearComponents",()=>eZ,"_components",()=>e$,"_getProvider",()=>eH,"_isFirebaseApp",()=>eJ,"_isFirebaseServerApp",()=>eX,"_isFirebaseServerAppSettings",()=>eY,"_registerComponent",()=>eG,"_removeServiceInstance",()=>eQ,"_serverApps",()=>eU,"deleteApp",()=>e9,"getApp",()=>e8,"getApps",()=>e7,"initializeApp",()=>e4,"initializeServerApp",()=>e5,"onLog",()=>tt,"registerVersion",()=>te,"setLogLevel",()=>tr],3493);var tb,tS,tw,tC,tT,tE=e.i(24361),t_="undefined"!=typeof globalThis?globalThis:e.g,tI={};(function(){function e(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.C=Array(this.blockSize),this.o=this.h=0,this.u()}function t(e,t,r){r||(r=0);let n=Array(16);if("string"==typeof t)for(var i=0;i<16;++i)n[i]=t.charCodeAt(r++)|t.charCodeAt(r++)<<8|t.charCodeAt(r++)<<16|t.charCodeAt(r++)<<24;else for(i=0;i<16;++i)n[i]=t[r++]|t[r++]<<8|t[r++]<<16|t[r++]<<24;t=e.g[0],r=e.g[1],i=e.g[2];let s=e.g[3],a;a=t+(s^r&(i^s))+n[0]+0xd76aa478|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[1]+0xe8c7b756|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[2]+0x242070db|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[3]+0xc1bdceee|0,a=t+(s^(r=i+(a<<22|a>>>10))&(i^s))+n[4]+0xf57c0faf|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[5]+0x4787c62a|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[6]+0xa8304613|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[7]+0xfd469501|0,a=t+(s^(r=i+(a<<22|a>>>10))&(i^s))+n[8]+0x698098d8|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[9]+0x8b44f7af|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[10]+0xffff5bb1|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[11]+0x895cd7be|0,a=t+(s^(r=i+(a<<22|a>>>10))&(i^s))+n[12]+0x6b901122|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[13]+0xfd987193|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[14]+0xa679438e|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[15]+0x49b40821|0,r=i+(a<<22|a>>>10),a=t+(i^s&(r^i))+n[1]+0xf61e2562|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[6]+0xc040b340|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[11]+0x265e5a51|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[0]+0xe9b6c7aa|0,r=i+(a<<20|a>>>12),a=t+(i^s&(r^i))+n[5]+0xd62f105d|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[10]+0x2441453|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[15]+0xd8a1e681|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[4]+0xe7d3fbc8|0,r=i+(a<<20|a>>>12),a=t+(i^s&(r^i))+n[9]+0x21e1cde6|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[14]+0xc33707d6|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[3]+0xf4d50d87|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[8]+0x455a14ed|0,r=i+(a<<20|a>>>12),a=t+(i^s&(r^i))+n[13]+0xa9e3e905|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[2]+0xfcefa3f8|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[7]+0x676f02d9|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[12]+0x8d2a4c8a|0,a=t+((r=i+(a<<20|a>>>12))^i^s)+n[5]+0xfffa3942|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[8]+0x8771f681|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[11]+0x6d9d6122|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[14]+0xfde5380c|0,a=t+((r=i+(a<<23|a>>>9))^i^s)+n[1]+0xa4beea44|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[4]+0x4bdecfa9|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[7]+0xf6bb4b60|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[10]+0xbebfbc70|0,a=t+((r=i+(a<<23|a>>>9))^i^s)+n[13]+0x289b7ec6|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[0]+0xeaa127fa|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[3]+0xd4ef3085|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[6]+0x4881d05|0,a=t+((r=i+(a<<23|a>>>9))^i^s)+n[9]+0xd9d4d039|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[12]+0xe6db99e5|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[15]+0x1fa27cf8|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[2]+0xc4ac5665|0,r=i+(a<<23|a>>>9),a=t+(i^(r|~s))+n[0]+0xf4292244|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[7]+0x432aff97|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[14]+0xab9423a7|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[5]+0xfc93a039|0,r=i+(a<<21|a>>>11),a=t+(i^(r|~s))+n[12]+0x655b59c3|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[3]+0x8f0ccc92|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[10]+0xffeff47d|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[1]+0x85845dd1|0,r=i+(a<<21|a>>>11),a=t+(i^(r|~s))+n[8]+0x6fa87e4f|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[15]+0xfe2ce6e0|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[6]+0xa3014314|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[13]+0x4e0811a1|0,r=i+(a<<21|a>>>11),a=t+(i^(r|~s))+n[4]+0xf7537e82|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[11]+0xbd3af235|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[2]+0x2ad7d2bb|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[9]+0xeb86d391|0,e.g[0]=e.g[0]+t|0,e.g[1]=e.g[1]+(i+(a<<21|a>>>11))|0,e.g[2]=e.g[2]+i|0,e.g[3]=e.g[3]+s|0}function r(e,t){var r=s;return Object.prototype.hasOwnProperty.call(r,e)?r[e]:r[e]=t(e)}function n(e,t){this.h=t;let r=[],n=!0;for(let i=e.length-1;i>=0;i--){let s=0|e[i];n&&s==t||(r[i]=s,n=!1)}this.g=r}(function(e,t){function r(){}r.prototype=t.prototype,e.F=t.prototype,e.prototype=new r,e.prototype.constructor=e,e.D=function(e,r,n){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[r].apply(e,i)}})(e,function(){this.blockSize=-1}),e.prototype.u=function(){this.g[0]=0x67452301,this.g[1]=0xefcdab89,this.g[2]=0x98badcfe,this.g[3]=0x10325476,this.o=this.h=0},e.prototype.v=function(e,r){void 0===r&&(r=e.length);let n=r-this.blockSize,i=this.C,s=this.h,a=0;for(;a<r;){if(0==s)for(;a<=n;)t(this,e,a),a+=this.blockSize;if("string"==typeof e){for(;a<r;)if(i[s++]=e.charCodeAt(a++),s==this.blockSize){t(this,i),s=0;break}}else for(;a<r;)if(i[s++]=e[a++],s==this.blockSize){t(this,i),s=0;break}}this.h=s,this.o+=r},e.prototype.A=function(){var e=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;t=8*this.o;for(var r=e.length-8;r<e.length;++r)e[r]=255&t,t/=256;for(this.v(e),e=Array(16),t=0,r=0;r<4;++r)for(let n=0;n<32;n+=8)e[t++]=this.g[r]>>>n&255;return e};var i,s={};function a(e){return -128<=e&&e<128?r(e,function(e){return new n([0|e],e<0?-1:0)}):new n([0|e],e<0?-1:0)}function o(e){if(isNaN(e)||!isFinite(e))return u;if(e<0)return p(o(-e));let t=[],r=1;for(let n=0;e>=r;n++)t[n]=e/r|0,r*=0x100000000;return new n(t,0)}function l(e,t){if(0==e.length)throw Error("number format error: empty string");if((t=t||10)<2||36<t)throw Error("radix out of range: "+t);if("-"==e.charAt(0))return p(l(e.substring(1),t));if(e.indexOf("-")>=0)throw Error('number format error: interior "-" character');let r=o(Math.pow(t,8)),n=u;for(let s=0;s<e.length;s+=8){var i=Math.min(8,e.length-s);let a=parseInt(e.substring(s,s+i),t);i<8?(i=o(Math.pow(t,i)),n=n.j(i).add(o(a))):n=(n=n.j(r)).add(o(a))}return n}var u=a(0),c=a(1),h=a(0x1000000);function d(e){if(0!=e.h)return!1;for(let t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function f(e){return -1==e.h}function p(e){let t=e.g.length,r=[];for(let n=0;n<t;n++)r[n]=~e.g[n];return new n(r,~e.h).add(c)}function m(e,t){return e.add(p(t))}function g(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function y(e,t){this.g=e,this.h=t}function v(e,t){if(d(t))throw Error("division by zero");if(d(e))return new y(u,u);if(f(e))return t=v(p(e),t),new y(p(t.g),p(t.h));if(f(t))return t=v(e,p(t)),new y(p(t.g),t.h);if(e.g.length>30){if(f(e)||f(t))throw Error("slowDivide_ only works with positive integers.");for(var r=c,n=t;0>=n.l(e);)r=b(r),n=b(n);var i=S(r,1),s=S(n,1);for(n=S(n,2),r=S(r,2);!d(n);){var a=s.add(n);0>=a.l(e)&&(i=i.add(r),s=a),n=S(n,1),r=S(r,1)}return t=m(e,i.j(t)),new y(i,t)}for(i=u;e.l(t)>=0;){for(n=(n=Math.ceil(Math.log(r=Math.max(1,Math.floor(e.m()/t.m())))/Math.LN2))<=48?1:Math.pow(2,n-48),a=(s=o(r)).j(t);f(a)||a.l(e)>0;)r-=n,a=(s=o(r)).j(t);d(s)&&(s=c),i=i.add(s),e=m(e,a)}return new y(i,e)}function b(e){let t=e.g.length+1,r=[];for(let n=0;n<t;n++)r[n]=e.i(n)<<1|e.i(n-1)>>>31;return new n(r,e.h)}function S(e,t){let r=t>>5;t%=32;let i=e.g.length-r,s=[];for(let n=0;n<i;n++)s[n]=t>0?e.i(n+r)>>>t|e.i(n+r+1)<<32-t:e.i(n+r);return new n(s,e.h)}(i=n.prototype).m=function(){if(f(this))return-p(this).m();let e=0,t=1;for(let r=0;r<this.g.length;r++){let n=this.i(r);e+=(n>=0?n:0x100000000+n)*t,t*=0x100000000}return e},i.toString=function(e){if((e=e||10)<2||36<e)throw Error("radix out of range: "+e);if(d(this))return"0";if(f(this))return"-"+p(this).toString(e);let t=o(Math.pow(e,6));var r=this;let n="";for(;;){let i=v(r,t).g,s=(((r=m(r,i.j(t))).g.length>0?r.g[0]:r.h)>>>0).toString(e);if(d(r=i))return s+n;for(;s.length<6;)s="0"+s;n=s+n}},i.i=function(e){return e<0?0:e<this.g.length?this.g[e]:this.h},i.l=function(e){return f(e=m(this,e))?-1:+!d(e)},i.abs=function(){return f(this)?p(this):this},i.add=function(e){let t=Math.max(this.g.length,e.g.length),r=[],i=0;for(let n=0;n<=t;n++){let t=i+(65535&this.i(n))+(65535&e.i(n)),s=(t>>>16)+(this.i(n)>>>16)+(e.i(n)>>>16);i=s>>>16,t&=65535,s&=65535,r[n]=s<<16|t}return new n(r,-0x80000000&r[r.length-1]?-1:0)},i.j=function(e){if(d(this)||d(e))return u;if(f(this))return f(e)?p(this).j(p(e)):p(p(this).j(e));if(f(e))return p(this.j(p(e)));if(0>this.l(h)&&0>e.l(h))return o(this.m()*e.m());let t=this.g.length+e.g.length,r=[];for(var i=0;i<2*t;i++)r[i]=0;for(i=0;i<this.g.length;i++)for(let t=0;t<e.g.length;t++){let n=this.i(i)>>>16,s=65535&this.i(i),a=e.i(t)>>>16,o=65535&e.i(t);r[2*i+2*t]+=s*o,g(r,2*i+2*t),r[2*i+2*t+1]+=n*o,g(r,2*i+2*t+1),r[2*i+2*t+1]+=s*a,g(r,2*i+2*t+1),r[2*i+2*t+2]+=n*a,g(r,2*i+2*t+2)}for(e=0;e<t;e++)r[e]=r[2*e+1]<<16|r[2*e];for(e=t;e<2*t;e++)r[e]=0;return new n(r,0)},i.B=function(e){return v(this,e).h},i.and=function(e){let t=Math.max(this.g.length,e.g.length),r=[];for(let n=0;n<t;n++)r[n]=this.i(n)&e.i(n);return new n(r,this.h&e.h)},i.or=function(e){let t=Math.max(this.g.length,e.g.length),r=[];for(let n=0;n<t;n++)r[n]=this.i(n)|e.i(n);return new n(r,this.h|e.h)},i.xor=function(e){let t=Math.max(this.g.length,e.g.length),r=[];for(let n=0;n<t;n++)r[n]=this.i(n)^e.i(n);return new n(r,this.h^e.h)},e.prototype.digest=e.prototype.A,e.prototype.reset=e.prototype.u,e.prototype.update=e.prototype.v,tw=tI.Md5=e,n.prototype.add=n.prototype.add,n.prototype.multiply=n.prototype.j,n.prototype.modulo=n.prototype.B,n.prototype.compare=n.prototype.l,n.prototype.toNumber=n.prototype.m,n.prototype.toString=n.prototype.toString,n.prototype.getBits=n.prototype.i,n.fromNumber=o,n.fromString=l,tS=tI.Integer=n}).apply(void 0!==t_?t_:"undefined"!=typeof self?self:{});var tk=e.i(54799),tx=e.i(61569),tR=e.i(19573);let tD="@firebase/firestore",tA="4.9.3";class tO{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}tO.UNAUTHENTICATED=new tO(null),tO.GOOGLE_CREDENTIALS=new tO("google-credentials-uid"),tO.FIRST_PARTY=new tO("first-party-uid"),tO.MOCK_USER=new tO("mock-user");let tN="12.7.0";function tP(e){tN=e}function tM(e){return(0,tE.inspect)(e,{depth:100})}let tL=new ec("@firebase/firestore");function tB(){return tL.logLevel}function tF(e){tL.setLogLevel(e)}function tj(e,...t){if(tL.logLevel<=tb.DEBUG){let r=t.map(tq);tL.debug(`Firestore (${tN}): ${e}`,...r)}}function tV(e,...t){if(tL.logLevel<=tb.ERROR){let r=t.map(tq);tL.error(`Firestore (${tN}): ${e}`,...r)}}function tz(e,...t){if(tL.logLevel<=tb.WARN){let r=t.map(tq);tL.warn(`Firestore (${tN}): ${e}`,...r)}}function tq(e){if("string"==typeof e)return e;try{return tM(e)}catch(t){return e}}function tU(e,t,r){let n="Unexpected state";"string"==typeof t?n=t:r=t,t$(e,n,r)}function t$(e,t,r){let n=`FIRESTORE (${tN}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==r)try{let e=JSON.stringify(r);n+=" CONTEXT: "+e}catch(e){n+=" CONTEXT: "+r}throw tV(n),Error(n)}function tK(e,t,r,n){let i="Unexpected state";"string"==typeof r?i=r:n=r,e||t$(t,i,n)}function tW(e,t){e||tU(57014,t)}function tG(e,t){return e}let tH="ok",tQ="cancelled",tJ="unknown",tY="invalid-argument",tX="deadline-exceeded",tZ="not-found",t0="already-exists",t1="permission-denied",t2="unauthenticated",t3="resource-exhausted",t6="failed-precondition",t4="aborted",t5="out-of-range",t8="unimplemented",t7="internal",t9="unavailable",re="data-loss";class rt extends j{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class rr{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class rn{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class ri{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(tO.UNAUTHENTICATED))}shutdown(){}}class rs{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class ra{constructor(e){this.authProvider=e,this.currentUser=tO.UNAUTHENTICATED,this.tokenCounter=0,this.forceRefresh=!1,this.auth=null}start(e,t){tK(void 0===this.tokenListener,42304);let r=this.tokenCounter,n=e=>this.tokenCounter!==r?(r=this.tokenCounter,t(e)):Promise.resolve(),i=new rr;this.tokenListener=()=>{this.tokenCounter++,this.currentUser=this.getUser(),i.resolve(),i=new rr,e.enqueueRetryable(()=>n(this.currentUser))};let s=()=>{let t=i;e.enqueueRetryable(async()=>{await t.promise,await n(this.currentUser)})},a=e=>{tj("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.tokenListener&&(this.auth.addAuthTokenListener(this.tokenListener),s())};this.authProvider.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){let e=this.authProvider.getImmediate({optional:!0});e?a(e):(tj("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new rr)}},0),s()}getToken(){let e=this.tokenCounter,t=this.forceRefresh;return(this.forceRefresh=!1,this.auth)?this.auth.getToken(t).then(t=>this.tokenCounter!==e?(tj("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(tK("string"==typeof t.accessToken,31837,{tokenData:t}),new rn(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.tokenListener&&this.auth.removeAuthTokenListener(this.tokenListener),this.tokenListener=void 0}getUser(){let e=this.auth&&this.auth.getUid();return tK(null===e||"string"==typeof e,2055,{currentUid:e}),new tO(e)}}class ro{constructor(e,t,r){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=r,this.type="FirstParty",this.user=tO.FIRST_PARTY,this._headers=new Map}getAuthToken(){return this.authTokenFactory?this.authTokenFactory():null}get headers(){this._headers.set("X-Goog-AuthUser",this.sessionIndex);let e=this.getAuthToken();return e&&this._headers.set("Authorization",e),this.iamToken&&this._headers.set("X-Goog-Iam-Authorization-Token",this.iamToken),this._headers}}class rl{constructor(e,t,r){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=r}getToken(){return Promise.resolve(new ro(this.sessionIndex,this.iamToken,this.authTokenFactory))}start(e,t){e.enqueueRetryable(()=>t(tO.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class ru{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class rc{constructor(e,t){this.appCheckProvider=t,this.forceRefresh=!1,this.appCheck=null,this.latestAppCheckToken=null,this.serverAppAppCheckToken=null,eX(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken)}start(e,t){tK(void 0===this.tokenListener,3512);let r=e=>{null!=e.error&&tj("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);let r=e.token!==this.latestAppCheckToken;return this.latestAppCheckToken=e.token,tj("FirebaseAppCheckTokenProvider",`Received ${r?"new":"existing"} token.`),r?t(e.token):Promise.resolve()};this.tokenListener=t=>{e.enqueueRetryable(()=>r(t))};let n=e=>{tj("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.tokenListener&&this.appCheck.addTokenListener(this.tokenListener)};this.appCheckProvider.onInit(e=>n(e)),setTimeout(()=>{if(!this.appCheck){let e=this.appCheckProvider.getImmediate({optional:!0});e?n(e):tj("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.serverAppAppCheckToken)return Promise.resolve(new ru(this.serverAppAppCheckToken));let e=this.forceRefresh;return(this.forceRefresh=!1,this.appCheck)?this.appCheck.getToken(e).then(e=>e?(tK("string"==typeof e.token,44558,{tokenResult:e}),this.latestAppCheckToken=e.token,new ru(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.tokenListener&&this.appCheck.removeTokenListener(this.tokenListener),this.tokenListener=void 0}}class rh{getToken(){return Promise.resolve(new ru(""))}invalidateToken(){}start(e,t){}shutdown(){}}function rd(e){if(!e)return new ri;switch(e.type){case"firstParty":return new rl(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new rt(tY,"makeAuthCredentialsProvider failed due to invalid credential type")}}function rf(e){return(0,tk.randomBytes)(e)}class rp{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,r="",n=20;for(;r.length<n;){let i=rf(40);for(let s=0;s<i.length;++s)r.length<n&&i[s]<t&&(r+=e.charAt(i[s]%e.length))}return r}}function rm(e,t){return e<t?-1:+(e>t)}function rg(e,t){let r=Math.min(e.length,t.length);for(let n=0;n<r;n++){let r=e.charAt(n),i=t.charAt(n);if(r!==i)return rb(r)===rb(i)?rm(r,i):rb(r)?1:-1}return rm(e.length,t.length)}let ry=55296,rv=57343;function rb(e){let t=e.charCodeAt(0);return t>=ry&&t<=rv}function rS(e,t,r){return e.length===t.length&&e.every((e,n)=>r(e,t[n]))}function rw(e){return e+"\0"}let rC="__name__";class rT{constructor(e,t,r){void 0===t?t=0:t>e.length&&tU(637,{offset:t,range:e.length}),void 0===r?r=e.length-t:r>e.length-t&&tU(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===rT.comparator(this,e)}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof rT?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let n=0;n<r;n++){let r=rT.compareSegments(e.get(n),t.get(n));if(0!==r)return r}return rm(e.length,t.length)}static compareSegments(e,t){let r=rT.isNumericId(e),n=rT.isNumericId(t);return r&&!n?-1:!r&&n?1:r&&n?rT.extractNumericId(e).compare(rT.extractNumericId(t)):rg(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return tS.fromString(e.substring(4,e.length-2))}}class rE extends rT{construct(e,t,r){return new rE(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new rt(tY,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(e=>e.length>0))}return new rE(t)}static emptyPath(){return new rE([])}}let r_=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class rI extends rT{construct(e,t,r){return new rI(e,t,r)}static isValidIdentifier(e){return r_.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),rI.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===rC}static keyField(){return new rI([rC])}static fromServerFormat(e){let t=[],r="",n=0,i=()=>{if(0===r.length)throw new rt(tY,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},s=!1;for(;n<e.length;){let t=e[n];if("\\"===t){if(n+1===e.length)throw new rt(tY,"Path has trailing escape character: "+e);let t=e[n+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new rt(tY,"Path has invalid escape sequence: "+e);r+=t,n+=2}else"`"===t?s=!s:"."!==t||s?r+=t:i(),n++}if(i(),s)throw new rt(tY,"Unterminated ` in path: "+e);return new rI(t)}static emptyPath(){return new rI([])}}class rk{constructor(e){this.path=e}static fromPath(e){return new rk(rE.fromString(e))}static fromName(e){return new rk(rE.fromString(e).popFirst(5))}static empty(){return new rk(rE.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===rE.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return rE.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new rk(new rE(e.slice()))}}function rx(e,t,r){if(!r)throw new rt(tY,`Function ${e}() cannot be called with an empty ${t}.`)}function rR(e,t,r,n){if(!0===t&&!0===n)throw new rt(tY,`${e} and ${r} cannot be used together.`)}function rD(e){if(!rk.isDocumentKey(e))throw new rt(tY,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function rA(e){if(rk.isDocumentKey(e))throw new rt(tY,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function rO(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function rN(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e)if(e instanceof Array)return"an array";else{let t=rP(e);return t?`a custom ${t} object`:"an object"}else if("function"==typeof e)return"a function";else return tU(12329,{type:typeof e})}function rP(e){return e.constructor?e.constructor.name:null}function rM(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t))if(t.name===e.constructor.name)throw new rt(tY,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");else{let r=rN(e);throw new rt(tY,`Expected type '${t.name}', but it was: ${r}`)}return e}function rL(e,t){if(t<=0)throw new rt(tY,`Function ${e}() requires a positive number, but it was: ${t}.`)}function rB(e,t){let r={typeString:e};return t&&(r.value=t),r}function rF(e,t){let r;if(!rO(e))throw new rt(tY,"JSON must be an object");for(let n in t)if(t[n]){let i=t[n].typeString,s="value"in t[n]?{value:t[n].value}:void 0;if(!(n in e)){r=`JSON missing required field: '${n}'`;break}let a=e[n];if(i&&typeof a!==i){r=`JSON field '${n}' must be a ${i}.`;break}if(void 0!==s&&a!==s.value){r=`Expected '${n}' field to equal '${s.value}'`;break}}if(r)throw new rt(tY,r);return!0}let rj=-0xe7791f700,rV=1e6;class rz{static now(){return rz.fromMillis(Date.now())}static fromDate(e){return rz.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*rV);return new rz(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0||t>=1e9)throw new rt(tY,"Timestamp nanoseconds out of range: "+t);if(e<rj||e>=0x3afff44180)throw new rt(tY,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/rV}_compareTo(e){return this.seconds===e.seconds?rm(this.nanoseconds,e.nanoseconds):rm(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:rz._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(rF(e,rz._jsonSchema))return new rz(e.seconds,e.nanoseconds)}valueOf(){return String(this.seconds-rj).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}rz._jsonSchemaVersion="firestore/timestamp/1.0",rz._jsonSchema={type:rB("string",rz._jsonSchemaVersion),seconds:rB("number"),nanoseconds:rB("number")};class rq{static fromTimestamp(e){return new rq(e)}static min(){return new rq(new rz(0,0))}static max(){return new rq(new rz(0x3afff4417f,1e9-1))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}let rU=-1,r$=0;class rK{constructor(e,t,r,n){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=n}}function rW(e){return e.fields.find(e=>2===e.kind)}function rG(e){return e.fields.filter(e=>2!==e.kind)}function rH(e){let t=rG(e);return 0===t.length?0:t[t.length-1].kind}function rQ(e,t){let r=rm(e.collectionGroup,t.collectionGroup);if(0!==r)return r;for(let n=0;n<Math.min(e.fields.length,t.fields.length);++n)if(0!==(r=rX(e.fields[n],t.fields[n])))return r;return rm(e.fields.length,t.fields.length)}function rJ(e){return`id=${e.indexId}|cg=${e.collectionGroup}|f=${e.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")}`}rK.UNKNOWN_ID=-1;class rY{constructor(e,t){this.fieldPath=e,this.kind=t}}function rX(e,t){let r=rI.comparator(e.fieldPath,t.fieldPath);return 0!==r?r:rm(e.kind,t.kind)}class rZ{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new rZ(r$,r2.min())}}function r0(e,t){let r=e.toTimestamp().seconds,n=e.toTimestamp().nanoseconds+1;return new r2(rq.fromTimestamp(1e9===n?new rz(r+1,0):new rz(r,n)),rk.empty(),t)}function r1(e){return new r2(e.readTime,e.key,rU)}class r2{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new r2(rq.min(),rk.empty(),rU)}static max(){return new r2(rq.max(),rk.empty(),rU)}}function r3(e,t){let r=e.readTime.compareTo(t.readTime);return 0!==r||0!==(r=rk.comparator(e.documentKey,t.documentKey))?r:rm(e.largestBatchId,t.largestBatchId)}let r6="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class r4{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function r5(e){if(e.code===t6&&e.message===r6)tj("LocalStore","Unexpectedly lost primary lease");else throw e}class r8{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return(this.callbackAttached&&tU(59440),this.callbackAttached=!0,this.isDone)?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new r8((r,n)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(r,n)},this.catchCallback=e=>{this.wrapFailure(t,e).next(r,n)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();if(t instanceof r8)return t;return r8.resolve(t)}catch(e){return r8.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):r8.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):r8.reject(t)}static resolve(e){return new r8((t,r)=>{t(e)})}static reject(e){return new r8((t,r)=>{r(e)})}static waitFor(e){return new r8((t,r)=>{let n=0,i=0,s=!1;e.forEach(e=>{++n,e.next(()=>{++i,s&&i===n&&t()},e=>r(e))}),s=!0,i===n&&t()})}static or(e){let t=r8.resolve(!1);for(let r of e)t=t.next(e=>e?r8.resolve(e):r());return t}static forEach(e,t){let r=[];return e.forEach((e,n)=>{r.push(t.call(this,e,n))}),this.waitFor(r)}static mapArray(e,t){return new r8((r,n)=>{let i=e.length,s=Array(i),a=0;for(let o=0;o<i;o++){let l=o;t(e[l]).next(e=>{s[l]=e,++a===i&&r(s)},e=>n(e))}})}static doWhile(e,t){return new r8((r,n)=>{let i=()=>{!0===e()?t().next(()=>{i()},n):r()};i()})}}let r7="SimpleDb",r9=3;class ne{static open(e,t,r,n){try{return new ne(t,e.transaction(n,r))}catch(e){throw new ni(t,e)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.completionDeferred=new rr,this.transaction.oncomplete=()=>{this.completionDeferred.resolve()},this.transaction.onabort=()=>{t.error?this.completionDeferred.reject(new ni(e,t.error)):this.completionDeferred.resolve()},this.transaction.onerror=t=>{let r=nu(t.target.error);this.completionDeferred.reject(new ni(e,r))}}get completionPromise(){return this.completionDeferred.promise}abort(e){e&&this.completionDeferred.reject(e),this.aborted||(tj(r7,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}maybeCommit(){let e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){return new na(this.transaction.objectStore(e))}}class nt{static delete(e){return tj(r7,"Removing database:",e),no(d().indexedDB.deleteDatabase(e)).toPromise()}static isAvailable(){if(!L())return!1;if(nt.isMockPersistence())return!0;let e=_(),t=nt.getIOSVersion(e),r=0<t&&t<10,n=nr(e),i=0<n&&n<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0)&&!r&&!i}static isMockPersistence(){return"undefined"!=typeof process&&process.env?.USE_MOCK_PERSISTENCE==="YES"}static getStore(e,t){return e.store(t)}static getIOSVersion(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i);return Number(t?t[1].split("_").slice(0,2).join("."):"-1")}constructor(e,t,r){this.name=e,this.version=t,this.schemaConverter=r,this.lastClosedDbVersion=null,12.2===nt.getIOSVersion(_())&&tV("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async ensureDb(e){return this.db||(tj(r7,"Opening database:",this.name),this.db=await new Promise((t,r)=>{let n=indexedDB.open(this.name,this.version);n.onsuccess=e=>{t(e.target.result)},n.onblocked=()=>{r(new ni(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},n.onerror=t=>{let n=t.target.error;"VersionError"===n.name?r(new rt(t6,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===n.name?r(new rt(t6,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+n)):r(new ni(e,n))},n.onupgradeneeded=e=>{tj(r7,'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);let t=e.target.result;this.schemaConverter.createOrUpgrade(t,n.transaction,e.oldVersion,this.version).next(()=>{tj(r7,"Database upgrade to version "+this.version+" complete")})}})),this.versionchangelistener&&(this.db.onversionchange=e=>this.versionchangelistener(e)),this.db}setVersionChangeListener(e){this.versionchangelistener=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,n){let i="readonly"===t,s=0;for(;;){++s;try{this.db=await this.ensureDb(e);let t=ne.open(this.db,e,i?"readonly":"readwrite",r),s=n(t).next(e=>(t.maybeCommit(),e)).catch(e=>(t.abort(e),r8.reject(e))).toPromise();return s.catch(()=>{}),await t.completionPromise,s}catch(r){let e=r,t="FirebaseError"!==e.name&&s<r9;if(tj(r7,"Transaction failed with error:",e.message,"Retrying:",t),this.close(),!t)return Promise.reject(e)}}}close(){this.db&&this.db.close(),this.db=void 0}}function nr(e){let t=e.match(/Android ([\d.]+)/i);return Number(t?t[1].split(".").slice(0,2).join("."):"-1")}class nn{constructor(e){this.dbCursor=e,this.shouldStop=!1,this.nextKey=null}get isDone(){return this.shouldStop}get skipToKey(){return this.nextKey}set cursor(e){this.dbCursor=e}done(){this.shouldStop=!0}skip(e){this.nextKey=e}delete(){return no(this.dbCursor.delete())}}class ni extends rt{constructor(e,t){super(t9,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function ns(e){return"IndexedDbTransactionError"===e.name}class na{constructor(e){this.store=e}put(e,t){let r;return void 0!==t?(tj(r7,"PUT",this.store.name,e,t),r=this.store.put(t,e)):(tj(r7,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),no(r)}add(e){return tj(r7,"ADD",this.store.name,e,e),no(this.store.add(e))}get(e){return no(this.store.get(e)).next(t=>(void 0===t&&(t=null),tj(r7,"GET",this.store.name,e,t),t))}delete(e){return tj(r7,"DELETE",this.store.name,e),no(this.store.delete(e))}count(){return tj(r7,"COUNT",this.store.name),no(this.store.count())}loadAll(e,t){let r=this.options(e,t),n=r.index?this.store.index(r.index):this.store;if("function"==typeof n.getAll){let e=n.getAll(r.range);return new r8((t,r)=>{e.onerror=e=>{r(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}{let e=this.cursor(r),t=[];return this.iterateCursor(e,(e,r)=>{t.push(r)}).next(()=>t)}}loadFirst(e,t){let r=this.store.getAll(e,null===t?void 0:t);return new r8((e,t)=>{r.onerror=e=>{t(e.target.error)},r.onsuccess=t=>{e(t.target.result)}})}deleteAll(e,t){tj(r7,"DELETE ALL",this.store.name);let r=this.options(e,t);r.keysOnly=!1;let n=this.cursor(r);return this.iterateCursor(n,(e,t,r)=>r.delete())}iterate(e,t){let r;t?r=e:(r={},t=e);let n=this.cursor(r);return this.iterateCursor(n,t)}iterateSerial(e){let t=this.cursor({});return new r8((r,n)=>{t.onerror=e=>{n(nu(e.target.error))},t.onsuccess=t=>{let n=t.target.result;n?e(n.primaryKey,n.value).next(e=>{e?n.continue():r()}):r()}})}iterateCursor(e,t){let r=[];return new r8((n,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{let i=e.target.result;if(!i)return void n();let s=new nn(i),a=t(i.primaryKey,i.value,s);if(a instanceof r8){let e=a.catch(e=>(s.done(),r8.reject(e)));r.push(e)}s.isDone?n():null===s.skipToKey?i.continue():i.continue(s.skipToKey)}}).next(()=>r8.waitFor(r))}options(e,t){let r;return void 0!==e&&("string"==typeof e?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),!e.index)return this.store.openCursor(e.range,t);{let r=this.store.index(e.index);return e.keysOnly?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}}}function no(e){return new r8((t,r)=>{e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{r(nu(e.target.error))}})}let nl=!1;function nu(e){let t=nt.getIOSVersion(_());if(t>=12.2&&t<13){let t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){let e=new rt("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return nl||(nl=!0,setTimeout(()=>{throw e},0)),e}}return e}let nc="IndexBackfiller",nh=15e3,nd=6e4,nf=50;class np{constructor(e,t){this.asyncQueue=e,this.backfiller=t,this.task=null}start(){this.schedule(nh)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}schedule(e){tj(nc,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{let e=await this.backfiller.backfill();tj(nc,`Documents written: ${e}`)}catch(e){ns(e)?tj(nc,"Ignoring IndexedDB error during index backfill: ",e):await r5(e)}await this.schedule(nd)})}}class nm{constructor(e,t){this.localStore=e,this.persistence=t}async backfill(e=nf){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.writeIndexEntries(t,e))}writeIndexEntries(e,t){let r=new Set,n=t,i=!0;return r8.doWhile(()=>!0===i&&n>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>{if(!(null===t||r.has(t)))return tj(nc,`Processing collection: ${t}`),this.writeEntriesForCollectionGroup(e,t,n).next(e=>{n-=e,r.add(t)});i=!1})).next(()=>t-n)}writeEntriesForCollectionGroup(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(n=>this.localStore.localDocuments.getNextDocuments(e,t,n,r).next(r=>{let i=r.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next(()=>this.getNewOffset(n,r)).next(r=>(tj(nc,`Updating offset: ${r}`),this.localStore.indexManager.updateCollectionGroup(e,t,r))).next(()=>i.size)}))}getNewOffset(e,t){let r=e;return t.changes.forEach((e,t)=>{let n=r1(t);r3(n,r)>0&&(r=n)}),new r2(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}class ng{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.setPreviousValue(e),this.writeNewSequenceNumber=e=>t.writeSequenceNumber(e))}setPreviousValue(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(e),e}}ng.INVALID=-1;let ny="\x01",nv="\x01",nb="\x10",nS="\x11";function nw(e){let t="";for(let r=0;r<e.length;r++)t.length>0&&(t=nT(t)),t=nC(e.get(r),t);return nT(t)}function nC(e,t){let r=t,n=e.length;for(let t=0;t<n;t++){let n=e.charAt(t);switch(n){case"\0":r+=ny+nb;break;case ny:r+=ny+nS;break;default:r+=n}}return r}function nT(e){return e+ny+nv}function nE(e){let t=e.length;if(tK(t>=2,64408,{path:e}),2===t)return tK(e.charAt(0)===ny&&e.charAt(1)===nv,56145,{path:e}),rE.emptyPath();let r=t-2,n=[],i="";for(let s=0;s<t;){let t=e.indexOf(ny,s);switch((t<0||t>r)&&tU(50515,{path:e}),e.charAt(t+1)){case nv:let a,o=e.substring(s,t);0===i.length?a=o:(i+=o,a=i,i=""),n.push(a);break;case nb:i+=e.substring(s,t),i+="\0";break;case nS:i+=e.substring(s,t+1);break;default:tU(61167,{path:e})}s=t+2}return new rE(n)}let n_="remoteDocuments",nI="owner",nk="owner",nx="mutationQueues",nR="userId",nD="mutations",nA="batchId",nO="userMutationsIndex",nN=["userId","batchId"];function nP(e){return[e]}function nM(e,t){return[e,nw(t)]}function nL(e,t,r){return[e,nw(t),r]}let nB={},nF="documentMutations",nj="remoteDocumentsV14",nV=["prefixPath","collectionGroup","readTime","documentId"],nz="documentKeyIndex",nq=["prefixPath","collectionGroup","documentId"],nU="collectionGroupIndex",n$=["collectionGroup","readTime","prefixPath","documentId"],nK="remoteDocumentGlobal",nW="remoteDocumentGlobalKey",nG="targets",nH="targetId",nQ="queryTargetsIndex",nJ=["canonicalId","targetId"],nY="targetDocuments",nX=["targetId","path"],nZ="documentTargetsIndex",n0=["path","targetId"],n1="targetGlobalKey",n2="targetGlobal",n3="collectionParents",n6=["collectionId","parent"],n4="clientMetadata",n5="clientId",n8="bundles",n7="bundleId",n9="namedQueries",ie="name",it="indexConfiguration",ir="indexId",ii="collectionGroupIndex",is="collectionGroup",ia="indexState",io=["indexId","uid"],il="sequenceNumberIndex",iu=["uid","sequenceNumber"],ic="indexEntries",ih=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],id="documentKeyIndex",ip=["indexId","uid","orderedDocumentKey"],im="documentOverlays",ig=["userId","collectionPath","documentId"],iy="collectionPathOverlayIndex",iv=["userId","collectionPath","largestBatchId"],ib="collectionGroupOverlayIndex",iS=["userId","collectionGroup","largestBatchId"],iw="globals",iC="name",iT=[nx,nD,nF,n_,nG,nI,n2,nY,n4,nK,n3,n8,n9],iE=[...iT,im],i_=[nx,nD,nF,nj,nG,nI,n2,nY,n4,nK,n3,n8,n9,im],iI=i_,ik=[...iI,it,ia,ic],ix=ik,iR=[...ik,iw],iD=iR;function iA(e){return 18===e?iD:17===e?iR:16===e?ix:15===e?ik:14===e?iI:13===e?i_:12===e?iE:11===e?iT:void tU(60245)}class iO extends r4{constructor(e,t){super(),this.simpleDbTransaction=e,this.currentSequenceNumber=t}}function iN(e,t){let r=tG(e);return nt.getStore(r.simpleDbTransaction,t)}function iP(e){let t=0;for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t++;return t}function iM(e,t){for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t(r,e[r])}function iL(e,t){let r=[];for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&r.push(t(e[n],n,e));return r}function iB(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class iF{constructor(e,t){this.comparator=e,this.root=t||iV.EMPTY}insert(e,t){return new iF(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,iV.BLACK,null,null))}remove(e){return new iF(this.comparator,this.root.remove(e,this.comparator).copy(null,null,iV.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let n=this.comparator(e,r.key);if(0===n)return t+r.left.size;n<0?r=r.left:(t+=r.left.size+1,r=r.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ij(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ij(this.root,e,this.comparator,!1)}getReverseIterator(){return new ij(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ij(this.root,e,this.comparator,!0)}}class ij{constructor(e,t,r,n){this.isReverse=n,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&n&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else if(0===i){this.nodeStack.push(e);break}else this.nodeStack.push(e),e=this.isReverse?e.right:e.left}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class iV{constructor(e,t,r,n,i){this.key=e,this.value=t,this.color=null!=r?r:iV.RED,this.left=null!=n?n:iV.EMPTY,this.right=null!=i?i:iV.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,n,i){return new iV(null!=e?e:this.key,null!=t?t:this.value,null!=r?r:this.color,null!=n?n:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let n=this,i=r(e,n.key);return(n=i<0?n.copy(null,null,null,n.left.insert(e,t,r),null):0===i?n.copy(null,t,null,null,null):n.copy(null,null,null,null,n.right.insert(e,t,r))).fixUp()}removeMin(){if(this.left.isEmpty())return iV.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let r,n=this;if(0>t(e,n.key))n.left.isEmpty()||n.left.isRed()||n.left.left.isRed()||(n=n.moveRedLeft()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed()&&(n=n.rotateRight()),n.right.isEmpty()||n.right.isRed()||n.right.left.isRed()||(n=n.moveRedRight()),0===t(e,n.key))if(n.right.isEmpty())return iV.EMPTY;else r=n.right.min(),n=n.copy(r.key,r.value,null,null,n.right.removeMin());n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}rotateLeft(){let e=this.copy(null,null,iV.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,iV.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw tU(43730,{key:this.key,value:this.value});if(this.right.isRed())throw tU(14113,{key:this.key,value:this.value});let e=this.left.check();if(e===this.right.check())return e+ +!this.isRed();throw tU(27949)}}iV.EMPTY=null,iV.RED=!0,iV.BLACK=!1;class iz{constructor(){this.size=0}get key(){throw tU(57766)}get value(){throw tU(16141)}get color(){throw tU(16727)}get left(){throw tU(29726)}get right(){throw tU(36894)}copy(e,t,r,n,i){return this}insert(e,t,r){return new iV(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}}iV.EMPTY=new iz;class iq{constructor(e){this.comparator=e,this.data=new iF(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let n=r.getNext();if(this.comparator(n.key,e[1])>=0)return;t(n.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new iU(this.data.getIterator())}getIteratorFrom(e){return new iU(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof iq)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let e=t.getNext().key,n=r.getNext().key;if(0!==this.comparator(e,n))return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new iq(this.comparator);return t.data=e,t}}class iU{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function i$(e,t,r,n,i){let s=e.getIterator(),a=t.getIterator(),o=iK(s),l=iK(a);for(;o||l;){let e=!1,t=!1;if(o&&l){let n=r(o,l);n<0?t=!0:n>0&&(e=!0)}else null!=o?t=!0:e=!0;e?(n(l),l=iK(a)):t?(i(o),o=iK(s)):(o=iK(s),l=iK(a))}}function iK(e){return e.hasNext()?e.getNext():void 0}class iW{constructor(e){this.fields=e,e.sort(rI.comparator)}static empty(){return new iW([])}unionWith(e){let t=new iq(rI.comparator);for(let e of this.fields)t=t.add(e);for(let r of e)t=t.add(r);return new iW(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return rS(this.fields,e.fields,(e,t)=>e.isEqual(t))}}function iG(e){return Buffer.from(e,"base64").toString("binary")}function iH(e){return Buffer.from(e,"binary").toString("base64")}function iQ(){return!0}class iJ{constructor(e){this.binaryString=e}static fromBase64String(e){return new iJ(iG(e))}static fromUint8Array(e){return new iJ(iY(e))}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return iH(this.binaryString)}toUint8Array(){return iX(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return rm(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}function iY(e){let t="";for(let r=0;r<e.length;++r)t+=String.fromCharCode(e[r]);return t}function iX(e){let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}iJ.EMPTY_BYTE_STRING=new iJ("");let iZ=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function i0(e){if(tK(!!e,39018),"string"==typeof e){let t=0,r=iZ.exec(e);if(tK(!!r,46558,{timestamp:e}),r[1]){let e=r[1];t=Number(e=(e+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(e).getTime()/1e3),nanos:t}}return{seconds:i1(e.seconds),nanos:i1(e.nanos)}}function i1(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function i2(e){return"string"==typeof e?iJ.fromBase64String(e):iJ.fromUint8Array(e)}let i3="server_timestamp",i6="__type__",i4="__previous_value__",i5="__local_write_time__";function i8(e){return(e?.mapValue?.fields||{})[i6]?.stringValue===i3}function i7(e,t){let r={fields:{[i6]:{stringValue:i3},[i5]:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&i8(t)&&(t=i9(t)),t&&(r.fields[i4]=t),{mapValue:r}}function i9(e){let t=e.mapValue.fields[i4];return i8(t)?i9(t):t}function se(e){let t=i0(e.mapValue.fields[i5].timestampValue);return new rz(t.seconds,t.nanos)}class st{constructor(e,t,r,n,i,s,a,o,l,u){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=n,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=l,this.isUsingEmulator=u}}let sr="(default)";class sn{constructor(e,t){this.projectId=e,this.database=t||sr}static empty(){return new sn("","")}get isDefaultDatabase(){return this.database===sr}isEqual(e){return e instanceof sn&&e.projectId===this.projectId&&e.database===this.database}}function si(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new rt(tY,'"projectId" not provided in firebase.initializeApp.');return new sn(e.options.projectId,t)}let ss=-1;function sa(e){return null==e}function so(e){return 0===e&&1/e==-1/0}function sl(e){return"number"==typeof e&&Number.isInteger(e)&&!so(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}let su="__type__",sc="__max__",sh={mapValue:{fields:{__type__:{stringValue:sc}}}},sd="__vector__",sf="value",sp={nullValue:"NULL_VALUE"};function sm(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?i8(e)?4:sZ(e)?0x1fffffffffffff:sY(e)?10:11:tU(28295,{value:e})}function sg(e,t){if(e===t)return!0;let r=sm(e);if(r!==sm(t))return!1;switch(r){case 0:case 0x1fffffffffffff:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return se(e).isEqual(se(t));case 3:return sy(e,t);case 5:return e.stringValue===t.stringValue;case 6:return sb(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return sv(e,t);case 2:return sS(e,t);case 9:return rS(e.arrayValue.values||[],t.arrayValue.values||[],sg);case 10:case 11:return sw(e,t);default:return tU(52216,{left:e})}}function sy(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;let r=i0(e.timestampValue),n=i0(t.timestampValue);return r.seconds===n.seconds&&r.nanos===n.nanos}function sv(e,t){return i1(e.geoPointValue.latitude)===i1(t.geoPointValue.latitude)&&i1(e.geoPointValue.longitude)===i1(t.geoPointValue.longitude)}function sb(e,t){return i2(e.bytesValue).isEqual(i2(t.bytesValue))}function sS(e,t){if("integerValue"in e&&"integerValue"in t)return i1(e.integerValue)===i1(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){let r=i1(e.doubleValue),n=i1(t.doubleValue);return r===n?so(r)===so(n):isNaN(r)&&isNaN(n)}return!1}function sw(e,t){let r=e.mapValue.fields||{},n=t.mapValue.fields||{};if(iP(r)!==iP(n))return!1;for(let e in r)if(r.hasOwnProperty(e)&&(void 0===n[e]||!sg(r[e],n[e])))return!1;return!0}function sC(e,t){return void 0!==(e.values||[]).find(e=>sg(e,t))}function sT(e,t){if(e===t)return 0;let r=sm(e),n=sm(t);if(r!==n)return rm(r,n);switch(r){case 0:case 0x1fffffffffffff:return 0;case 1:return rm(e.booleanValue,t.booleanValue);case 2:return sE(e,t);case 3:return s_(e.timestampValue,t.timestampValue);case 4:return s_(se(e),se(t));case 5:return rg(e.stringValue,t.stringValue);case 6:return sx(e.bytesValue,t.bytesValue);case 7:return sI(e.referenceValue,t.referenceValue);case 8:return sk(e.geoPointValue,t.geoPointValue);case 9:return sR(e.arrayValue,t.arrayValue);case 10:return sD(e.mapValue,t.mapValue);case 11:return sA(e.mapValue,t.mapValue);default:throw tU(23264,{leftType:r})}}function sE(e,t){let r=i1(e.integerValue||e.doubleValue),n=i1(t.integerValue||t.doubleValue);return r<n?-1:r>n?1:r===n?0:isNaN(r)?isNaN(n)?0:-1:1}function s_(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return rm(e,t);let r=i0(e),n=i0(t),i=rm(r.seconds,n.seconds);return 0!==i?i:rm(r.nanos,n.nanos)}function sI(e,t){let r=e.split("/"),n=t.split("/");for(let e=0;e<r.length&&e<n.length;e++){let t=rm(r[e],n[e]);if(0!==t)return t}return rm(r.length,n.length)}function sk(e,t){let r=rm(i1(e.latitude),i1(t.latitude));return 0!==r?r:rm(i1(e.longitude),i1(t.longitude))}function sx(e,t){let r=i2(e),n=i2(t);return r.compareTo(n)}function sR(e,t){let r=e.values||[],n=t.values||[];for(let e=0;e<r.length&&e<n.length;++e){let t=sT(r[e],n[e]);if(t)return t}return rm(r.length,n.length)}function sD(e,t){let r=e.fields||{},n=t.fields||{},i=r[sf]?.arrayValue,s=n[sf]?.arrayValue,a=rm(i?.values?.length||0,s?.values?.length||0);return 0!==a?a:sR(i,s)}function sA(e,t){if(e===sh.mapValue&&t===sh.mapValue)return 0;if(e===sh.mapValue)return 1;if(t===sh.mapValue)return -1;let r=e.fields||{},n=Object.keys(r),i=t.fields||{},s=Object.keys(i);n.sort(),s.sort();for(let e=0;e<n.length&&e<s.length;++e){let t=rg(n[e],s[e]);if(0!==t)return t;let a=sT(r[n[e]],i[s[e]]);if(0!==a)return a}return rm(n.length,s.length)}function sO(e){return sN(e)}function sN(e){if("nullValue"in e)return"null";if("booleanValue"in e)return""+e.booleanValue;if("integerValue"in e)return""+e.integerValue;if("doubleValue"in e)return""+e.doubleValue;if("timestampValue"in e)return sM(e.timestampValue);else if("stringValue"in e)return e.stringValue;else if("bytesValue"in e)return sP(e.bytesValue);else if("referenceValue"in e)return sB(e.referenceValue);else if("geoPointValue"in e)return sL(e.geoPointValue);else if("arrayValue"in e)return sj(e.arrayValue);else if("mapValue"in e)return sF(e.mapValue);else return tU(61005,{value:e})}function sP(e){return i2(e).toBase64()}function sM(e){let t=i0(e);return`time(${t.seconds},${t.nanos})`}function sL(e){return`geo(${e.latitude},${e.longitude})`}function sB(e){return rk.fromName(e).toString()}function sF(e){let t=Object.keys(e.fields||{}).sort(),r="{",n=!0;for(let i of t)n?n=!1:r+=",",r+=`${i}:${sN(e.fields[i])}`;return r+"}"}function sj(e){let t="[",r=!0;for(let n of e.values||[])r?r=!1:t+=",",t+=sN(n);return t+"]"}function sV(e){switch(sm(e)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let t=i9(e);return t?16+sV(t):16;case 5:return 2*e.stringValue.length;case 6:return i2(e.bytesValue).approximateByteSize();case 7:return e.referenceValue.length;case 9:return sq(e.arrayValue);case 10:case 11:return sz(e.mapValue);default:throw tU(13486,{value:e})}}function sz(e){let t=0;return iM(e.fields,(e,r)=>{t+=e.length+sV(r)}),t}function sq(e){return(e.values||[]).reduce((e,t)=>e+sV(t),0)}function sU(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function s$(e){return!!e&&"integerValue"in e}function sK(e){return!!e&&"doubleValue"in e}function sW(e){return s$(e)||sK(e)}function sG(e){return!!e&&"arrayValue"in e}function sH(e){return!!e&&"nullValue"in e}function sQ(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function sJ(e){return!!e&&"mapValue"in e}function sY(e){return(e?.mapValue?.fields||{})[su]?.stringValue===sd}function sX(e){if(e.geoPointValue)return{geoPointValue:{...e.geoPointValue}};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:{...e.timestampValue}};if(e.mapValue){let t={mapValue:{fields:{}}};return iM(e.mapValue.fields,(e,r)=>t.mapValue.fields[e]=sX(r)),t}{if(!e.arrayValue)return{...e};let t={arrayValue:{values:[]}};for(let r=0;r<(e.arrayValue.values||[]).length;++r)t.arrayValue.values[r]=sX(e.arrayValue.values[r]);return t}}function sZ(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===sc}let s0={mapValue:{fields:{[su]:{stringValue:sd},[sf]:{arrayValue:{}}}}};function s1(e){if("nullValue"in e)return sp;if("booleanValue"in e)return{booleanValue:!1};if("integerValue"in e||"doubleValue"in e)return{doubleValue:NaN};if("timestampValue"in e)return{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}};if("stringValue"in e)return{stringValue:""};else if("bytesValue"in e)return{bytesValue:""};else if("referenceValue"in e)return sU(sn.empty(),rk.empty());else if("geoPointValue"in e)return{geoPointValue:{latitude:-90,longitude:-180}};else if("arrayValue"in e)return{arrayValue:{}};else if(!("mapValue"in e))return tU(35942,{value:e});else return sY(e)?s0:{mapValue:{}}}function s2(e){if("nullValue"in e)return{booleanValue:!1};if("booleanValue"in e)return{doubleValue:NaN};if("integerValue"in e||"doubleValue"in e)return{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}};if("timestampValue"in e)return{stringValue:""};if("stringValue"in e)return{bytesValue:""};else if("bytesValue"in e)return sU(sn.empty(),rk.empty());else if("referenceValue"in e)return{geoPointValue:{latitude:-90,longitude:-180}};else if("geoPointValue"in e)return{arrayValue:{}};else if("arrayValue"in e)return s0;else if(!("mapValue"in e))return tU(61959,{value:e});else return sY(e)?{mapValue:{}}:sh}function s3(e,t){let r=sT(e.value,t.value);return 0!==r?r:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function s6(e,t){let r=sT(e.value,t.value);return 0!==r?r:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class s4{constructor(e){this.value=e}static empty(){return new s4({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(!sJ(t=(t.mapValue.fields||{})[e.get(r)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=sX(t)}setAll(e){let t=rI.emptyPath(),r={},n=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){let e=this.getFieldsMap(t);this.applyChanges(e,r,n),r={},n=[],t=i.popLast()}e?r[i.lastSegment()]=sX(e):n.push(i.lastSegment())});let i=this.getFieldsMap(t);this.applyChanges(i,r,n)}delete(e){let t=this.field(e.popLast());sJ(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return sg(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let n=t.mapValue.fields[e.get(r)];sJ(n)&&n.mapValue.fields||(n={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=n),t=n}return t.mapValue.fields}applyChanges(e,t,r){for(let n of(iM(t,(t,r)=>e[t]=r),r))delete e[n]}clone(){return new s4(sX(this.value))}}function s5(e){let t=[];return iM(e.fields,(e,r)=>{let n=new rI([e]);if(sJ(r)){let e=s5(r.mapValue).fields;if(0===e.length)t.push(n);else for(let r of e)t.push(n.child(r))}else t.push(n)}),new iW(t)}class s8{constructor(e,t,r,n,i,s,a){this.key=e,this.documentType=t,this.version=r,this.readTime=n,this.createTime=i,this.data=s,this.documentState=a}static newInvalidDocument(e){return new s8(e,0,rq.min(),rq.min(),rq.min(),s4.empty(),0)}static newFoundDocument(e,t,r,n){return new s8(e,1,t,rq.min(),r,n,0)}static newNoDocument(e,t){return new s8(e,2,t,rq.min(),rq.min(),s4.empty(),0)}static newUnknownDocument(e,t){return new s8(e,3,t,rq.min(),rq.min(),s4.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(rq.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=s4.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=s4.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=rq.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof s8&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new s8(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}function s7(e,t,r){let n=t.data.field(e),i=r.data.field(e);return null!==n&&null!==i?sT(n,i):tU(42886)}class s9{constructor(e,t){this.position=e,this.inclusive=t}}function ae(e,t,r){let n=0;for(let i=0;i<e.position.length;i++){let s=t[i],a=e.position[i];if(n=s.field.isKeyField()?rk.comparator(rk.fromName(a.referenceValue),r.key):sT(a,r.data.field(s.field)),"desc"===s.dir&&(n*=-1),0!==n)break}return n}function at(e,t,r){let n=ae(e,t,r);return e.inclusive?n>=0:n>0}function ar(e,t,r){let n=ae(e,t,r);return e.inclusive?n<=0:n<0}function an(e,t){if(null===e)return null===t;if(null===t||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let r=0;r<e.position.length;r++)if(!sg(e.position[r],t.position[r]))return!1;return!0}class ai{constructor(e,t="asc"){this.field=e,this.dir=t}}function as(e){return e.field.canonicalString()+e.dir}function aa(e){return`${e.field.canonicalString()} (${e.dir})`}function ao(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class al{}class au extends al{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){if(e.isKeyField())if("in"===t||"not-in"===t)return this.createKeyFieldInFilter(e,t,r);else return new aT(e,t,r);if("array-contains"===t)return new ak(e,r);if("in"===t)return new ax(e,r);if("not-in"===t)return new aR(e,r);if("array-contains-any"===t)return new aD(e,r);else return new au(e,t,r)}static createKeyFieldInFilter(e,t,r){return"in"===t?new aE(e,r):new a_(e,r)}matches(e){let t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(sT(t,this.value)):null!==t&&sm(this.value)===sm(t)&&this.matchesComparison(sT(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return tU(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ac extends al{constructor(e,t){super(),this.filters=e,this.op=t,this.memoizedFlattenedFilters=null}static create(e,t){return new ac(e,t)}matches(e){return ah(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.memoizedFlattenedFilters||(this.memoizedFlattenedFilters=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.memoizedFlattenedFilters}getFilters(){return Object.assign([],this.filters)}}function ah(e){return"and"===e.op}function ad(e){return"or"===e.op}function af(e){return ap(e)&&ah(e)}function ap(e){for(let t of e.filters)if(t instanceof ac)return!1;return!0}function am(e){if(e instanceof au)return e.field.canonicalString()+e.op.toString()+sO(e.value);{if(af(e))return e.filters.map(e=>am(e)).join(",");let t=e.filters.map(e=>am(e)).join(",");return`${e.op}(${t})`}}function ag(e,t){return e instanceof au?ay(e,t):e instanceof ac?av(e,t):void tU(19439)}function ay(e,t){return t instanceof au&&e.op===t.op&&e.field.isEqual(t.field)&&sg(e.value,t.value)}function av(e,t){return t instanceof ac&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce((e,r,n)=>e&&ag(r,t.filters[n]),!0)}function ab(e,t){let r=e.filters.concat(t);return ac.create(r,e.op)}function aS(e){return e instanceof au?aC(e):e instanceof ac?aw(e):"Filter"}function aw(e){return e.op.toString()+" {"+e.getFilters().map(aS).join(" ,")+"}"}function aC(e){return`${e.field.canonicalString()} ${e.op} ${sO(e.value)}`}class aT extends au{constructor(e,t,r){super(e,t,r),this.key=rk.fromName(r.referenceValue)}matches(e){let t=rk.comparator(e.key,this.key);return this.matchesComparison(t)}}class aE extends au{constructor(e,t){super(e,"in",t),this.keys=aI("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class a_ extends au{constructor(e,t){super(e,"not-in",t),this.keys=aI("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function aI(e,t){return(t.arrayValue?.values||[]).map(e=>rk.fromName(e.referenceValue))}class ak extends au{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return sG(t)&&sC(t.arrayValue,this.value)}}class ax extends au{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return null!==t&&sC(this.value.arrayValue,t)}}class aR extends au{constructor(e,t){super(e,"not-in",t)}matches(e){if(sC(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!sC(this.value.arrayValue,t)}}class aD extends au{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!!sG(t)&&!!t.arrayValue.values&&t.arrayValue.values.some(e=>sC(this.value.arrayValue,e))}}class aA{constructor(e,t=null,r=[],n=[],i=null,s=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=n,this.limit=i,this.startAt=s,this.endAt=a,this.memoizedCanonicalId=null}}function aO(e,t=null,r=[],n=[],i=null,s=null,a=null){return new aA(e,t,r,n,i,s,a)}function aN(e){let t=tG(e);if(null===t.memoizedCanonicalId){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>am(e)).join(","),e+="|ob:",e+=t.orderBy.map(e=>as(e)).join(","),sa(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(e=>sO(e)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(e=>sO(e)).join(",")),t.memoizedCanonicalId=e}return t.memoizedCanonicalId}function aP(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map(e=>aS(e)).join(", ")}]`),sa(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map(e=>aa(e)).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>sO(e)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>sO(e)).join(",")),`Target(${t})`}function aM(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let r=0;r<e.orderBy.length;r++)if(!ao(e.orderBy[r],t.orderBy[r]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let r=0;r<e.filters.length;r++)if(!ag(e.filters[r],t.filters[r]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!an(e.startAt,t.startAt)&&an(e.endAt,t.endAt)}function aL(e){return rk.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function aB(e,t){return e.filters.filter(e=>e instanceof au&&e.field.isEqual(t))}function aF(e,t){let r=rW(t);if(void 0===r)return null;for(let t of aB(e,r.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}function aj(e,t){let r=new Map;for(let n of rG(t))for(let t of aB(e,n.fieldPath))switch(t.op){case"==":case"in":r.set(n.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return r.set(n.fieldPath.canonicalString(),t.value),Array.from(r.values())}return null}function aV(e,t){let r=[],n=!0;for(let i of rG(t)){let t=0===i.kind?aq(e,i.fieldPath,e.startAt):aU(e,i.fieldPath,e.startAt);r.push(t.value),n&&(n=t.inclusive)}return new s9(r,n)}function az(e,t){let r=[],n=!0;for(let i of rG(t)){let t=0===i.kind?aU(e,i.fieldPath,e.endAt):aq(e,i.fieldPath,e.endAt);r.push(t.value),n&&(n=t.inclusive)}return new s9(r,n)}function aq(e,t,r){let n=sp,i=!0;for(let r of aB(e,t)){let e=sp,t=!0;switch(r.op){case"<":case"<=":e=s1(r.value);break;case"==":case"in":case">=":e=r.value;break;case">":e=r.value,t=!1;break;case"!=":case"not-in":e=sp}0>s3({value:n,inclusive:i},{value:e,inclusive:t})&&(n=e,i=t)}if(null!==r){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=r.position[s];0>s3({value:n,inclusive:i},{value:e,inclusive:r.inclusive})&&(n=e,i=r.inclusive);break}}return{value:n,inclusive:i}}function aU(e,t,r){let n=sh,i=!0;for(let r of aB(e,t)){let e=sh,t=!0;switch(r.op){case">=":case">":e=s2(r.value),t=!1;break;case"==":case"in":case"<=":e=r.value;break;case"<":e=r.value,t=!1;break;case"!=":case"not-in":e=sh}s6({value:n,inclusive:i},{value:e,inclusive:t})>0&&(n=e,i=t)}if(null!==r){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=r.position[s];s6({value:n,inclusive:i},{value:e,inclusive:r.inclusive})>0&&(n=e,i=r.inclusive);break}}return{value:n,inclusive:i}}function a$(e){let t=new iq(rI.comparator),r=!1;for(let n of e.filters)for(let e of n.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?r=!0:t=t.add(e.field));for(let r of e.orderBy)r.field.isKeyField()||(t=t.add(r.field));return t.size+ +!!r}function aK(e){return null!==e.limit}class aW{constructor(e,t=null,r=[],n=[],i=null,s="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=n,this.limit=i,this.limitType=s,this.startAt=a,this.endAt=o,this.memoizedNormalizedOrderBy=null,this.memoizedTarget=null,this.memoizedAggregateTarget=null,this.startAt,this.endAt}}function aG(e,t,r,n,i,s,a,o){return new aW(e,t,r,n,i,s,a,o)}function aH(e){return new aW(e)}function aQ(e,t){return new aW(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}function aJ(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function aY(e){let t=new iq(rI.comparator);return e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t}function aX(e){return new aW(rE.emptyPath(),e)}function aZ(e){return rk.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function a0(e){return null!==e.collectionGroup}function a1(e){let t=tG(e);if(null===t.memoizedNormalizedOrderBy){t.memoizedNormalizedOrderBy=[];let e=new Set;for(let r of t.explicitOrderBy)t.memoizedNormalizedOrderBy.push(r),e.add(r.field.canonicalString());let r=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";aY(t).forEach(n=>{e.has(n.canonicalString())||n.isKeyField()||t.memoizedNormalizedOrderBy.push(new ai(n,r))}),e.has(rI.keyField().canonicalString())||t.memoizedNormalizedOrderBy.push(new ai(rI.keyField(),r))}return t.memoizedNormalizedOrderBy}function a2(e){let t=tG(e);return t.memoizedTarget||(t.memoizedTarget=a6(t,a1(e))),t.memoizedTarget}function a3(e){let t=tG(e);return t.memoizedAggregateTarget||(t.memoizedAggregateTarget=a6(t,e.explicitOrderBy)),t.memoizedAggregateTarget}function a6(e,t){if("F"===e.limitType)return aO(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{let t="desc"===e.dir?"asc":"desc";return new ai(e.field,t)});let r=e.endAt?new s9(e.endAt.position,e.endAt.inclusive):null,n=e.startAt?new s9(e.startAt.position,e.startAt.inclusive):null;return aO(e.path,e.collectionGroup,t,e.filters,e.limit,r,n)}}function a4(e,t){let r=e.filters.concat([t]);return new aW(e.path,e.collectionGroup,e.explicitOrderBy.slice(),r,e.limit,e.limitType,e.startAt,e.endAt)}function a5(e,t){let r=e.explicitOrderBy.concat([t]);return new aW(e.path,e.collectionGroup,r,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}function a8(e,t,r){return new aW(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,r,e.startAt,e.endAt)}function a7(e,t){return new aW(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)}function a9(e,t){return new aW(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)}function oe(e,t){return aM(a2(e),a2(t))&&e.limitType===t.limitType}function ot(e){return`${aN(a2(e))}|lt:${e.limitType}`}function or(e){return`Query(target=${aP(a2(e))}; limitType=${e.limitType})`}function on(e,t){return t.isFoundDocument()&&oi(e,t)&&os(e,t)&&oa(e,t)&&oo(e,t)}function oi(e,t){let r=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(r):rk.isDocumentKey(e.path)?e.path.isEqual(r):e.path.isImmediateParentOf(r)}function os(e,t){for(let r of a1(e))if(!r.field.isKeyField()&&null===t.data.field(r.field))return!1;return!0}function oa(e,t){for(let r of e.filters)if(!r.matches(t))return!1;return!0}function oo(e,t){return(!e.startAt||!!ar(e.startAt,a1(e),t))&&(!e.endAt||!!at(e.endAt,a1(e),t))}function ol(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function ou(e){return(t,r)=>{let n=!1;for(let i of a1(e)){let e=oc(i,t,r);if(0!==e)return e;n=n||i.field.isKeyField()}return 0}}function oc(e,t,r){let n=e.field.isKeyField()?rk.comparator(t.key,r.key):s7(e.field,t,r);switch(e.dir){case"asc":return n;case"desc":return -1*n;default:return tU(19790,{direction:e.dir})}}class oh{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r){for(let[t,n]of r)if(this.equalsFn(t,e))return n}}has(e){return void 0!==this.get(e)}set(e,t){let r=this.mapKeyFn(e),n=this.inner[r];if(void 0===n){this.inner[r]=[[e,t]],this.innerSize++;return}for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e)){n[r]=[e,t];return}n.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return 1===r.length?delete this.inner[t]:r.splice(n,1),this.innerSize--,!0;return!1}forEach(e){iM(this.inner,(t,r)=>{for(let[t,n]of r)e(t,n)})}isEmpty(){return iB(this.inner)}size(){return this.innerSize}}let od=new iF(rk.comparator);function of(){return od}let op=new iF(rk.comparator);function om(...e){let t=op;for(let r of e)t=t.insert(r.key,r);return t}function og(){return oS()}function oy(e){let t=op;return e.forEach((e,r)=>t=t.insert(e,r.overlayedDocument)),t}function ov(){return oS()}function ob(){return oS()}function oS(){return new oh(e=>e.toString(),(e,t)=>e.isEqual(t))}let ow=new iF(rk.comparator);function oC(){return ow}let oT=new iq(rk.comparator);function oE(...e){let t=oT;for(let r of e)t=t.add(r);return t}let o_=new iq(rm);function oI(){return o_}function ok(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};else if(t===1/0)return{doubleValue:"Infinity"};else if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:so(t)?"-0":t}}function ox(e){return{integerValue:""+e}}function oR(e,t){return sl(t)?ox(t):ok(e,t)}class oD{constructor(){this._=void 0}}function oA(e,t,r){return e instanceof oM?i7(r,t):e instanceof oL?oB(e,t):e instanceof oF?oj(e,t):oz(e,t)}function oO(e,t,r){return e instanceof oL?oB(e,t):e instanceof oF?oj(e,t):r}function oN(e,t){return e instanceof oV?sW(t)?t:{integerValue:0}:null}function oP(e,t){return e instanceof oL&&t instanceof oL||e instanceof oF&&t instanceof oF?rS(e.elements,t.elements,sg):e instanceof oV&&t instanceof oV?sg(e.operand,t.operand):e instanceof oM&&t instanceof oM}class oM extends oD{}class oL extends oD{constructor(e){super(),this.elements=e}}function oB(e,t){let r=oU(t);for(let t of e.elements)r.some(e=>sg(e,t))||r.push(t);return{arrayValue:{values:r}}}class oF extends oD{constructor(e){super(),this.elements=e}}function oj(e,t){let r=oU(t);for(let t of e.elements)r=r.filter(e=>!sg(e,t));return{arrayValue:{values:r}}}class oV extends oD{constructor(e,t){super(),this.serializer=e,this.operand=t}}function oz(e,t){let r=oN(e,t),n=oq(r)+oq(e.operand);return s$(r)&&s$(e.operand)?ox(n):ok(e.serializer,n)}function oq(e){return i1(e.integerValue||e.doubleValue)}function oU(e){return sG(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class o${constructor(e,t){this.field=e,this.transform=t}}function oK(e,t){return e.field.isEqual(t.field)&&oP(e.transform,t.transform)}function oW(e,t){return void 0===e&&void 0===t||!!e&&!!t&&rS(e,t,(e,t)=>oK(e,t))}class oG{constructor(e,t){this.version=e,this.transformResults=t}}class oH{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new oH}static exists(e){return new oH(void 0,e)}static updateTime(e){return new oH(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function oQ(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class oJ{}function oY(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)if(e.isNoDocument())return new lt(e.key,oH.none());else return new o2(e.key,e.data,oH.none());{let r=e.data,n=s4.empty(),i=new iq(rI.comparator);for(let e of t.fields)if(!i.has(e)){let t=r.field(e);null===t&&e.length>1&&(e=e.popLast(),t=r.field(e)),null===t?n.delete(e):n.set(e,t),i=i.add(e)}return new o4(e.key,n,new iW(i.toArray()),oH.none())}}function oX(e,t,r){e instanceof o2?o3(e,t,r):e instanceof o4?o5(e,t,r):lr(e,t,r)}function oZ(e,t,r,n){return e instanceof o2?o6(e,t,r,n):e instanceof o4?o8(e,t,r,n):ln(e,t,r)}function o0(e,t){let r=null;for(let n of e.fieldTransforms){let e=t.data.field(n.field),i=oN(n.transform,e||null);null!=i&&(null===r&&(r=s4.empty()),r.set(n.field,i))}return r||null}function o1(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!oW(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class o2 extends oJ{constructor(e,t,r,n=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=n,this.type=0}getFieldMask(){return null}}function o3(e,t,r){let n=e.value.clone(),i=o9(e.fieldTransforms,t,r.transformResults);n.setAll(i),t.convertToFoundDocument(r.version,n).setHasCommittedMutations()}function o6(e,t,r,n){if(!oQ(e.precondition,t))return r;let i=e.value.clone(),s=le(e.fieldTransforms,n,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}class o4 extends oJ{constructor(e,t,r,n,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=n,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function o5(e,t,r){if(!oQ(e.precondition,t))return void t.convertToUnknownDocument(r.version);let n=o9(e.fieldTransforms,t,r.transformResults),i=t.data;i.setAll(o7(e)),i.setAll(n),t.convertToFoundDocument(r.version,i).setHasCommittedMutations()}function o8(e,t,r,n){if(!oQ(e.precondition,t))return r;let i=le(e.fieldTransforms,n,t),s=t.data;return(s.setAll(o7(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===r)?null:r.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}function o7(e){let t=new Map;return e.fieldMask.fields.forEach(r=>{if(!r.isEmpty()){let n=e.data.field(r);t.set(r,n)}}),t}function o9(e,t,r){let n=new Map;tK(e.length===r.length,32656,{serverTransformResultCount:r.length,fieldTransformCount:e.length});for(let i=0;i<r.length;i++){let s=e[i],a=s.transform,o=t.data.field(s.field);n.set(s.field,oO(a,o,r[i]))}return n}function le(e,t,r){let n=new Map;for(let i of e){let e=i.transform,s=r.data.field(i.field);n.set(i.field,oA(e,s,t))}return n}class lt extends oJ{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}function lr(e,t,r){t.convertToNoDocument(r.version).setHasCommittedMutations()}function ln(e,t,r){return oQ(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):r}class li extends oJ{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class ls{constructor(e,t,r,n){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=n}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let t=0;t<this.mutations.length;t++){let n=this.mutations[t];n.key.isEqual(e.key)&&oX(n,e,r[t])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=oZ(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=oZ(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=ob();return this.mutations.forEach(n=>{let i=e.get(n.key),s=i.overlayedDocument,a=this.applyToLocalView(s,i.mutatedFields),o=oY(s,a=t.has(n.key)?null:a);null!==o&&r.set(n.key,o),s.isValidDocument()||s.convertToNoDocument(rq.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),oE())}isEqual(e){return this.batchId===e.batchId&&rS(this.mutations,e.mutations,(e,t)=>o1(e,t))&&rS(this.baseMutations,e.baseMutations,(e,t)=>o1(e,t))}}class la{constructor(e,t,r,n){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=n}static from(e,t,r){tK(e.mutations.length===r.length,58842,{mutationsSent:e.mutations.length,resultsReceived:r.length});let n=oC(),i=e.mutations;for(let e=0;e<i.length;e++)n=n.insert(i[e].key,r[e].version);return new la(e,t,r,n)}}class lo{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class ll{constructor(e,t){this.count=e,this.unchangedNames=t}}function lu(e){switch(e){case tH:return tU(64938);case tQ:case tJ:case tX:case t3:case t7:case t9:case t2:return!1;case tY:case tZ:case t0:case t1:case t6:case t4:case t5:case t8:case re:return!0;default:return tU(15467,{code:e})}}function lc(e){return lu(e)&&e!==t4}function lh(e){if(void 0===e)return tV("GRPC error has no .code"),tJ;switch(e){case tC.OK:return tH;case tC.CANCELLED:return tQ;case tC.UNKNOWN:return tJ;case tC.DEADLINE_EXCEEDED:return tX;case tC.RESOURCE_EXHAUSTED:return t3;case tC.INTERNAL:return t7;case tC.UNAVAILABLE:return t9;case tC.UNAUTHENTICATED:return t2;case tC.INVALID_ARGUMENT:return tY;case tC.NOT_FOUND:return tZ;case tC.ALREADY_EXISTS:return t0;case tC.PERMISSION_DENIED:return t1;case tC.FAILED_PRECONDITION:return t6;case tC.ABORTED:return t4;case tC.OUT_OF_RANGE:return t5;case tC.UNIMPLEMENTED:return t8;case tC.DATA_LOSS:return re;default:return tU(39323,{code:e})}}!function(e){e[e.OK=0]="OK",e[e.CANCELLED=1]="CANCELLED",e[e.UNKNOWN=2]="UNKNOWN",e[e.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",e[e.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",e[e.NOT_FOUND=5]="NOT_FOUND",e[e.ALREADY_EXISTS=6]="ALREADY_EXISTS",e[e.PERMISSION_DENIED=7]="PERMISSION_DENIED",e[e.UNAUTHENTICATED=16]="UNAUTHENTICATED",e[e.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",e[e.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",e[e.ABORTED=10]="ABORTED",e[e.OUT_OF_RANGE=11]="OUT_OF_RANGE",e[e.UNIMPLEMENTED=12]="UNIMPLEMENTED",e[e.INTERNAL=13]="INTERNAL",e[e.UNAVAILABLE=14]="UNAVAILABLE",e[e.DATA_LOSS=15]="DATA_LOSS"}(tC||(tC={}));class ld extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}let lf=null;function lp(e){if(lf)throw Error("a TestingHooksSpi instance is already set");lf=e}function lm(){return new tE.TextEncoder}function lg(){return new tE.TextDecoder("utf-8")}let ly=new tS([0xffffffff,0xffffffff],0);function lv(e){let t=lm().encode(e),r=new tw;return r.update(t),new Uint8Array(r.digest())}function lb(e){let t=new DataView(e.buffer),r=t.getUint32(0,!0),n=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new tS([r,n],0),new tS([i,s],0)]}class lS{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new lw(`Invalid padding: ${t}`);if(r<0||e.length>0&&0===this.hashCount)throw new lw(`Invalid hash count: ${r}`);if(0===e.length&&0!==t)throw new lw(`Invalid padding when bitmap length is 0: ${t}`);this.bitCount=8*e.length-t,this.bitCountInInteger=tS.fromNumber(this.bitCount)}getBitIndex(e,t,r){let n=e.add(t.multiply(tS.fromNumber(r)));return 1===n.compare(ly)&&(n=new tS([n.getBits(0),n.getBits(1)],0)),n.modulo(this.bitCountInInteger).toNumber()}isBitSet(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(0===this.bitCount)return!1;let[t,r]=lb(lv(e));for(let e=0;e<this.hashCount;e++){let n=this.getBitIndex(t,r,e);if(!this.isBitSet(n))return!1}return!0}static create(e,t,r){let n=e%8==0?0:8-e%8,i=new lS(new Uint8Array(Math.ceil(e/8)),n,t);return r.forEach(e=>i.insert(e)),i}insert(e){if(0===this.bitCount)return;let[t,r]=lb(lv(e));for(let e=0;e<this.hashCount;e++){let n=this.getBitIndex(t,r,e);this.setBit(n)}}setBit(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class lw extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class lC{constructor(e,t,r,n,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=n,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let n=new Map;return n.set(e,lT.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new lC(rq.min(),n,new iF(rm),of(),oE())}}class lT{constructor(e,t,r,n,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=n,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new lT(r,t,oE(),oE(),oE())}}class lE{constructor(e,t,r,n){this.updatedTargetIds=e,this.removedTargetIds=t,this.key=r,this.newDoc=n}}class l_{constructor(e,t){this.targetId=e,this.existenceFilter=t}}class lI{constructor(e,t,r=iJ.EMPTY_BYTE_STRING,n=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=n}}class lk{constructor(){this.pendingResponses=0,this.documentChanges=lA(),this._resumeToken=iJ.EMPTY_BYTE_STRING,this._current=!1,this._hasPendingChanges=!0}get current(){return this._current}get resumeToken(){return this._resumeToken}get isPending(){return 0!==this.pendingResponses}get hasPendingChanges(){return this._hasPendingChanges}updateResumeToken(e){e.approximateByteSize()>0&&(this._hasPendingChanges=!0,this._resumeToken=e)}toTargetChange(){let e=oE(),t=oE(),r=oE();return this.documentChanges.forEach((n,i)=>{switch(i){case 0:e=e.add(n);break;case 2:t=t.add(n);break;case 1:r=r.add(n);break;default:tU(38017,{changeType:i})}}),new lT(this._resumeToken,this._current,e,t,r)}clearPendingChanges(){this._hasPendingChanges=!1,this.documentChanges=lA()}addDocumentChange(e,t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(e,t)}removeDocumentChange(e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(e)}recordPendingTargetRequest(){this.pendingResponses+=1}recordTargetResponse(){this.pendingResponses-=1,tK(this.pendingResponses>=0,3241,{pendingResponses:this.pendingResponses})}markCurrent(){this._hasPendingChanges=!0,this._current=!0}}let lx="WatchChangeAggregator";class lR{constructor(e){this.metadataProvider=e,this.targetStates=new Map,this.pendingDocumentUpdates=of(),this.pendingDocumentUpdatesByTarget=lD(),this.pendingDocumentTargetMapping=lD(),this.pendingTargetResets=new iF(rm)}handleDocumentChange(e){for(let t of e.updatedTargetIds)e.newDoc&&e.newDoc.isFoundDocument()?this.addDocumentToTarget(t,e.newDoc):this.removeDocumentFromTarget(t,e.key,e.newDoc);for(let t of e.removedTargetIds)this.removeDocumentFromTarget(t,e.key,e.newDoc)}handleTargetChange(e){this.forEachTarget(e,t=>{let r=this.ensureTargetState(t);switch(e.state){case 0:this.isActiveTarget(t)&&r.updateResumeToken(e.resumeToken);break;case 1:r.recordTargetResponse(),r.isPending||r.clearPendingChanges(),r.updateResumeToken(e.resumeToken);break;case 2:r.recordTargetResponse(),r.isPending||this.removeTarget(t);break;case 3:this.isActiveTarget(t)&&(r.markCurrent(),r.updateResumeToken(e.resumeToken));break;case 4:this.isActiveTarget(t)&&(this.resetTarget(t),r.updateResumeToken(e.resumeToken));break;default:tU(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.targetStates.forEach((e,r)=>{this.isActiveTarget(r)&&t(r)})}handleExistenceFilter(e){let t=e.targetId,r=e.existenceFilter.count,n=this.targetDataForActiveTarget(t);if(n){let i=n.target;if(aL(i))if(0===r){let e=new rk(i.path);this.removeDocumentFromTarget(t,e,s8.newNoDocument(e,rq.min()))}else tK(1===r,20013,{expectedCount:r});else{let n=this.getCurrentDocumentCountForTarget(t);if(n!==r){let r=this.parseBloomFilter(e),i=r?this.applyBloomFilter(r,e,n):1;if(0!==i){this.resetTarget(t);let e=2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.pendingTargetResets=this.pendingTargetResets.insert(t,e)}lf?.notifyOnExistenceFilterMismatch(lO(n,e.existenceFilter,this.metadataProvider.getDatabaseId(),r,i))}}}}parseBloomFilter(e){let t,r,n=e.existenceFilter.unchangedNames;if(!n||!n.bits)return null;let{bits:{bitmap:i="",padding:s=0},hashCount:a=0}=n;try{t=i2(i).toUint8Array()}catch(e){if(e instanceof ld)return tz("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{r=new lS(t,s,a)}catch(e){return e instanceof lw?tz("BloomFilter error: ",e):tz("Applying bloom filter failed: ",e),null}return 0===r.bitCount?null:r}applyBloomFilter(e,t,r){return 2*(t.existenceFilter.count!==r-this.filterRemovedDocuments(e,t.targetId))}filterRemovedDocuments(e,t){let r=this.metadataProvider.getRemoteKeysForTarget(t),n=0;return r.forEach(r=>{let i=this.metadataProvider.getDatabaseId(),s=`projects/${i.projectId}/databases/${i.database}/documents/${r.path.canonicalString()}`;!e.mightContain(s)&&(this.removeDocumentFromTarget(t,r,null),n++)}),n}createRemoteEvent(e){let t=new Map;this.targetStates.forEach((r,n)=>{let i=this.targetDataForActiveTarget(n);if(i){if(r.current&&aL(i.target)){let t=new rk(i.target.path);this.ensureDocumentUpdateByTarget(t).has(n)||this.targetContainsDocument(n,t)||this.removeDocumentFromTarget(n,t,s8.newNoDocument(t,e))}r.hasPendingChanges&&(t.set(n,r.toTargetChange()),r.clearPendingChanges())}});let r=oE();this.pendingDocumentTargetMapping.forEach((e,t)=>{let n=!0;t.forEachWhile(e=>{let t=this.targetDataForActiveTarget(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(n=!1,!1)}),n&&(r=r.add(e))}),this.pendingDocumentUpdates.forEach((t,r)=>r.setReadTime(e));let n=new lC(e,t,this.pendingTargetResets,this.pendingDocumentUpdates,r);return this.pendingDocumentUpdates=of(),this.pendingDocumentUpdatesByTarget=lD(),this.pendingDocumentTargetMapping=lD(),this.pendingTargetResets=new iF(rm),n}addDocumentToTarget(e,t){if(!this.isActiveTarget(e))return;let r=2*!!this.targetContainsDocument(e,t.key);this.ensureTargetState(e).addDocumentChange(t.key,r),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t.key,t),this.pendingDocumentUpdatesByTarget=this.pendingDocumentUpdatesByTarget.insert(t.key,this.ensureDocumentUpdateByTarget(t.key).add(e)),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t.key,this.ensureDocumentTargetMapping(t.key).add(e))}removeDocumentFromTarget(e,t,r){if(!this.isActiveTarget(e))return;let n=this.ensureTargetState(e);this.targetContainsDocument(e,t)?n.addDocumentChange(t,1):n.removeDocumentChange(t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,this.ensureDocumentTargetMapping(t).delete(e)),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,this.ensureDocumentTargetMapping(t).add(e)),r&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t,r))}removeTarget(e){this.targetStates.delete(e)}getCurrentDocumentCountForTarget(e){let t=this.ensureTargetState(e).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}recordPendingTargetRequest(e){this.ensureTargetState(e).recordPendingTargetRequest()}ensureTargetState(e){let t=this.targetStates.get(e);return t||(t=new lk,this.targetStates.set(e,t)),t}ensureDocumentTargetMapping(e){let t=this.pendingDocumentTargetMapping.get(e);return t||(t=new iq(rm),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,t)),t}ensureDocumentUpdateByTarget(e){let t=this.pendingDocumentUpdatesByTarget.get(e);return t||(t=new iq(rm),this.pendingDocumentUpdatesByTarget=this.pendingDocumentUpdatesByTarget.insert(e,t)),t}isActiveTarget(e){let t=null!==this.targetDataForActiveTarget(e);return t||tj(lx,"Detected inactive target",e),t}targetDataForActiveTarget(e){let t=this.targetStates.get(e);return t&&t.isPending?null:this.metadataProvider.getTargetDataForTarget(e)}resetTarget(e){this.targetStates.set(e,new lk),this.metadataProvider.getRemoteKeysForTarget(e).forEach(t=>{this.removeDocumentFromTarget(e,t,null)})}targetContainsDocument(e,t){return this.metadataProvider.getRemoteKeysForTarget(e).has(t)}}function lD(){return new iF(rk.comparator)}function lA(){return new iF(rk.comparator)}function lO(e,t,r,n,i){let s={localCacheCount:e,existenceFilterCount:t.count,databaseId:r.database,projectId:r.projectId},a=t.unchangedNames;return a&&(s.bloomFilter={applied:0===i,hashCount:a?.hashCount??0,bitmapLength:a?.bits?.bitmap?.length??0,padding:a?.bits?.padding??0,mightContain:e=>n?.mightContain(e)??!1}),s}let lN=(()=>{let e={};return e.asc="ASCENDING",e.desc="DESCENDING",e})(),lP=(()=>{let e={};return e["<"]="LESS_THAN",e["<="]="LESS_THAN_OR_EQUAL",e[">"]="GREATER_THAN",e[">="]="GREATER_THAN_OR_EQUAL",e["=="]="EQUAL",e["!="]="NOT_EQUAL",e["array-contains"]="ARRAY_CONTAINS",e.in="IN",e["not-in"]="NOT_IN",e["array-contains-any"]="ARRAY_CONTAINS_ANY",e})(),lM=(()=>{let e={};return e.and="AND",e.or="OR",e})();function lL(e,t){}class lB{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function lF(e){return new rt(void 0===e.code?tJ:lh(e.code),e.message||"")}function lj(e,t){return e.useProto3Json||sa(t)?t:{value:t}}function lV(e){let t;return sa(t="object"==typeof e?e.value:e)?null:t}function lz(e,t){if(!e.useProto3Json)return{seconds:""+t.seconds,nanos:t.nanoseconds};{let e=new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z",""),r=("000000000"+t.nanoseconds).slice(-9);return`${e}.${r}Z`}}function lq(e){let t=i0(e);return new rz(t.seconds,t.nanos)}function lU(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function l$(e,t){return e.useProto3Json?(tK(void 0===t||"string"==typeof t,58123),iJ.fromBase64String(t||"")):(tK(void 0===t||t instanceof Buffer||t instanceof Uint8Array,16193),iJ.fromUint8Array(t||new Uint8Array))}function lK(e,t){return lz(e,t.toTimestamp())}function lW(e){return tK(!!e,49232),rq.fromTimestamp(lq(e))}function lG(e,t){return lH(e,t).canonicalString()}function lH(e,t){let r=l1(e).child("documents");return void 0===t?r:r.child(t)}function lQ(e){let t=rE.fromString(e);return tK(uW(t),10190,{key:t.toString()}),t}function lJ(e,t){return lG(e.databaseId,t.path)}function lY(e,t){let r=lQ(t);if(r.get(1)!==e.databaseId.projectId)throw new rt(tY,"Tried to deserialize key from different project: "+r.get(1)+" vs "+e.databaseId.projectId);if(r.get(3)!==e.databaseId.database)throw new rt(tY,"Tried to deserialize key from different database: "+r.get(3)+" vs "+e.databaseId.database);return new rk(l2(r))}function lX(e,t){return lG(e.databaseId,t)}function lZ(e){let t=lQ(e);return 4===t.length?rE.emptyPath():l2(t)}function l0(e){return new rE(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function l1(e){return new rE(["projects",e.projectId,"databases",e.database])}function l2(e){return tK(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function l3(e,t,r){return{name:lJ(e,t),fields:r.value.mapValue.fields}}function l6(e,t){return{name:lJ(e,t.key),fields:t.data.value.mapValue.fields,updateTime:lz(e,t.version.toTimestamp()),createTime:lz(e,t.createTime.toTimestamp())}}function l4(e,t,r){let n=lY(e,t.name),i=lW(t.updateTime),s=t.createTime?lW(t.createTime):rq.min(),a=new s4({mapValue:{fields:t.fields}}),o=s8.newFoundDocument(n,i,s,a);return r&&o.setHasCommittedMutations(),r?o.setHasCommittedMutations():o}function l5(e,t){tK(!!t.found,43571),lL(t.found.name),lL(t.found.updateTime);let r=lY(e,t.found.name),n=lW(t.found.updateTime),i=t.found.createTime?lW(t.found.createTime):rq.min(),s=new s4({mapValue:{fields:t.found.fields}});return s8.newFoundDocument(r,n,i,s)}function l8(e,t){tK(!!t.missing,3894),tK(!!t.readTime,22933);let r=lY(e,t.missing),n=lW(t.readTime);return s8.newNoDocument(r,n)}function l7(e,t){return"found"in t?l5(e,t):"missing"in t?l8(e,t):tU(7234,{result:t})}function l9(e,t){let r;if("targetChange"in t){lL(t.targetChange);let n=ue(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=l$(e,t.targetChange.resumeToken),a=t.targetChange.cause;r=new lI(n,i,s,a&&lF(a)||null)}else if("documentChange"in t){lL(t.documentChange);let n=t.documentChange;lL(n.document),lL(n.document.name),lL(n.document.updateTime);let i=lY(e,n.document.name),s=lW(n.document.updateTime),a=n.document.createTime?lW(n.document.createTime):rq.min(),o=new s4({mapValue:{fields:n.document.fields}}),l=s8.newFoundDocument(i,s,a,o);r=new lE(n.targetIds||[],n.removedTargetIds||[],l.key,l)}else if("documentDelete"in t){lL(t.documentDelete);let n=t.documentDelete;lL(n.document);let i=lY(e,n.document),s=n.readTime?lW(n.readTime):rq.min(),a=s8.newNoDocument(i,s);r=new lE([],n.removedTargetIds||[],a.key,a)}else if("documentRemove"in t){lL(t.documentRemove);let n=t.documentRemove;lL(n.document);let i=lY(e,n.document);r=new lE([],n.removedTargetIds||[],i,null)}else{if(!("filter"in t))return tU(11601,{change:t});lL(t.filter);let e=t.filter;lL(e.targetId);let{count:n=0,unchangedNames:i}=e,s=new ll(n,i);r=new l_(e.targetId,s)}return r}function ue(e){if("NO_CHANGE"===e)return 0;if("ADD"===e)return 1;if("REMOVE"===e)return 2;if("CURRENT"===e)return 3;if("RESET"===e)return 4;else return tU(39313,{state:e})}function ut(e){if(!("targetChange"in e))return rq.min();let t=e.targetChange;return t.targetIds&&t.targetIds.length||!t.readTime?rq.min():lW(t.readTime)}function ur(e,t){let r;if(t instanceof o2)r={update:l3(e,t.key,t.value)};else if(t instanceof lt)r={delete:lJ(e,t.key)};else if(t instanceof o4)r={update:l3(e,t.key,t.data),updateMask:u$(t.fieldMask)};else{if(!(t instanceof li))return tU(16599,{mutationType:t.type});r={verify:lJ(e,t.key)}}return t.fieldTransforms.length>0&&(r.updateTransforms=t.fieldTransforms.map(t=>ul(e,t))),t.precondition.isNone||(r.currentDocument=ui(e,t.precondition)),r}function un(e,t){let r=t.currentDocument?us(t.currentDocument):oH.none(),n=t.updateTransforms?t.updateTransforms.map(t=>uu(e,t)):[];if(t.update){lL(t.update.name);let i=lY(e,t.update.name),s=new s4({mapValue:{fields:t.update.fields}});return t.updateMask?new o4(i,s,uK(t.updateMask),r,n):new o2(i,s,r,n)}return t.delete?new lt(lY(e,t.delete),r):t.verify?new li(lY(e,t.verify),r):tU(1463,{proto:t})}function ui(e,t){return void 0!==t.updateTime?{updateTime:lK(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:tU(27497)}function us(e){return void 0!==e.updateTime?oH.updateTime(lW(e.updateTime)):void 0!==e.exists?oH.exists(e.exists):oH.none()}function ua(e,t){let r=e.updateTime?lW(e.updateTime):lW(t);return r.isEqual(rq.min())&&(r=lW(t)),new oG(r,e.transformResults||[])}function uo(e,t){return e&&e.length>0?(tK(void 0!==t,14353),e.map(e=>ua(e,t))):[]}function ul(e,t){let r=t.transform;if(r instanceof oM)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(r instanceof oL)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:r.elements}};if(r instanceof oF)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:r.elements}};if(r instanceof oV)return{fieldPath:t.field.canonicalString(),increment:r.operand};throw tU(20930,{transform:t.transform})}function uu(e,t){let r=null;return"setToServerValue"in t?(tK("REQUEST_TIME"===t.setToServerValue,16630,{proto:t}),r=new oM):"appendMissingElements"in t?r=new oL(t.appendMissingElements.values||[]):"removeAllFromArray"in t?r=new oF(t.removeAllFromArray.values||[]):"increment"in t?r=new oV(e,t.increment):tU(16584,{proto:t}),new o$(rI.fromServerFormat(t.fieldPath),r)}function uc(e,t){return{documents:[lX(e,t.path)]}}function uh(e){let t=e.documents.length;return tK(1===t,1966,{count:t}),a2(aH(lZ(e.documents[0])))}function ud(e,t){let r,n={structuredQuery:{}},i=t.path;null!==t.collectionGroup?(r=i,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(r=i.popLast(),n.structuredQuery.from=[{collectionId:i.lastSegment()}]),n.parent=lX(e,r);let s=ub(t.filters);s&&(n.structuredQuery.where=s);let a=uC(t.orderBy);a&&(n.structuredQuery.orderBy=a);let o=lj(e,t.limit);return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt=uE(t.startAt)),t.endAt&&(n.structuredQuery.endAt=u_(t.endAt)),{queryTarget:n,parent:r}}function uf(e,t,r,n){let{queryTarget:i,parent:s}=ud(e,t),a={},o=[],l=0;return r.forEach(e=>{let t=n?e.alias:`aggregate_${l++}`;a[t]=e.alias,"count"===e.aggregateType?o.push({alias:t,count:{}}):"avg"===e.aggregateType?o.push({alias:t,avg:{field:uP(e.fieldPath)}}):"sum"===e.aggregateType&&o.push({alias:t,sum:{field:uP(e.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:o,structuredQuery:i.structuredQuery},parent:i.parent},aliasMap:a,parent:s}}function up(e){let t=lZ(e.parent),r=e.structuredQuery,n=r.from?r.from.length:0,i=null;if(n>0){tK(1===n,65062);let e=r.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let s=[];r.where&&(s=uS(r.where));let a=[];r.orderBy&&(a=uT(r.orderBy));let o=null;r.limit&&(o=lV(r.limit));let l=null;r.startAt&&(l=uI(r.startAt));let u=null;return r.endAt&&(u=uk(r.endAt)),aG(t,i,a,s,o,"F",l,u)}function um(e){return a2(up(e))}function ug(e,t){let r=uy(t.purpose);return null==r?null:{"goog-listen-tags":r}}function uy(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return tU(28987,{purpose:e})}}function uv(e,t){let r,n=t.target;if((r=aL(n)?{documents:uc(e,n)}:{query:ud(e,n).queryTarget}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0){r.resumeToken=lU(e,t.resumeToken);let n=lj(e,t.expectedCount);null!==n&&(r.expectedCount=n)}else if(t.snapshotVersion.compareTo(rq.min())>0){r.readTime=lz(e,t.snapshotVersion.toTimestamp());let n=lj(e,t.expectedCount);null!==n&&(r.expectedCount=n)}return r}function ub(e){if(0!==e.length)return uF(ac.create(e,"and"))}function uS(e){let t=uw(e);return t instanceof ac&&af(t)?t.getFilters():[t]}function uw(e){return void 0!==e.unaryFilter?uz(e):void 0!==e.fieldFilter?uq(e):void 0!==e.compositeFilter?uU(e):tU(30097,{filter:e})}function uC(e){if(0!==e.length)return e.map(e=>uL(e))}function uT(e){return e.map(e=>uB(e))}function uE(e){return{before:e.inclusive,values:e.position}}function u_(e){return{before:!e.inclusive,values:e.position}}function uI(e){let t=!!e.before;return new s9(e.values||[],t)}function uk(e){let t=!e.before;return new s9(e.values||[],t)}function ux(e){return lN[e]}function uR(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}function uD(e){return lP[e]}function uA(e){return lM[e]}function uO(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return tU(58110);default:return tU(50506)}}function uN(e){switch(e){case"AND":return"and";case"OR":return"or";default:return tU(1026)}}function uP(e){return{fieldPath:e.canonicalString()}}function uM(e){return rI.fromServerFormat(e.fieldPath)}function uL(e){return{field:uP(e.field),direction:ux(e.dir)}}function uB(e){return new ai(uM(e.field),uR(e.direction))}function uF(e){return e instanceof au?uV(e):e instanceof ac?uj(e):tU(54877,{filter:e})}function uj(e){let t=e.getFilters().map(e=>uF(e));return 1===t.length?t[0]:{compositeFilter:{op:uA(e.op),filters:t}}}function uV(e){if("=="===e.op){if(sQ(e.value))return{unaryFilter:{field:uP(e.field),op:"IS_NAN"}};else if(sH(e.value))return{unaryFilter:{field:uP(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(sQ(e.value))return{unaryFilter:{field:uP(e.field),op:"IS_NOT_NAN"}};else if(sH(e.value))return{unaryFilter:{field:uP(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:uP(e.field),op:uD(e.op),value:e.value}}}function uz(e){switch(e.unaryFilter.op){case"IS_NAN":let t=uM(e.unaryFilter.field);return au.create(t,"==",{doubleValue:NaN});case"IS_NULL":let r=uM(e.unaryFilter.field);return au.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let n=uM(e.unaryFilter.field);return au.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=uM(e.unaryFilter.field);return au.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return tU(61313);default:return tU(60726)}}function uq(e){return au.create(uM(e.fieldFilter.field),uO(e.fieldFilter.op),e.fieldFilter.value)}function uU(e){return ac.create(e.compositeFilter.filters.map(e=>uw(e)),uN(e.compositeFilter.op))}function u$(e){let t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function uK(e){return new iW((e.fieldPaths||[]).map(e=>rI.fromServerFormat(e)))}function uW(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class uG{constructor(e,t,r,n,i=rq.min(),s=rq.min(),a=iJ.EMPTY_BYTE_STRING,o=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=n,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new uG(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new uG(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new uG(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new uG(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class uH{constructor(e){this.remoteSerializer=e}}function uQ(e,t){let r;if(t.document)r=l4(e.remoteSerializer,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let e=rk.fromSegments(t.noDocument.path),n=u0(t.noDocument.readTime);r=s8.newNoDocument(e,n),t.hasCommittedMutations&&r.setHasCommittedMutations()}else{if(!t.unknownDocument)return tU(56709);let e=rk.fromSegments(t.unknownDocument.path),n=u0(t.unknownDocument.version);r=s8.newUnknownDocument(e,n)}return t.readTime&&r.setReadTime(uX(t.readTime)),r}function uJ(e,t){let r=t.key,n={prefixPath:r.getCollectionPath().popLast().toArray(),collectionGroup:r.collectionGroup,documentId:r.path.lastSegment(),readTime:uY(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())n.document=l6(e.remoteSerializer,t);else if(t.isNoDocument())n.noDocument={path:r.path.toArray(),readTime:uZ(t.version)};else{if(!t.isUnknownDocument())return tU(57904,{document:t});n.unknownDocument={path:r.path.toArray(),version:uZ(t.version)}}return n}function uY(e){let t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function uX(e){let t=new rz(e[0],e[1]);return rq.fromTimestamp(t)}function uZ(e){let t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function u0(e){let t=new rz(e.seconds,e.nanoseconds);return rq.fromTimestamp(t)}function u1(e,t,r){let n=r.baseMutations.map(t=>ur(e.remoteSerializer,t)),i=r.mutations.map(t=>ur(e.remoteSerializer,t));return{userId:t,batchId:r.batchId,localWriteTimeMs:r.localWriteTime.toMillis(),baseMutations:n,mutations:i}}function u2(e,t){let r=(t.baseMutations||[]).map(t=>un(e.remoteSerializer,t));for(let e=0;e<t.mutations.length-1;++e){let r=t.mutations[e];e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform&&(r.updateTransforms=t.mutations[e+1].transform.fieldTransforms,t.mutations.splice(e+1,1),++e)}let n=t.mutations.map(t=>un(e.remoteSerializer,t)),i=rz.fromMillis(t.localWriteTimeMs);return new ls(t.batchId,i,r,n)}function u3(e){let t,r=u0(e.readTime),n=void 0!==e.lastLimboFreeSnapshotVersion?u0(e.lastLimboFreeSnapshotVersion):rq.min();return new uG(t=u4(e.query)?uh(e.query):um(e.query),e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,r,n,iJ.fromBase64String(e.resumeToken))}function u6(e,t){let r,n=uZ(t.snapshotVersion),i=uZ(t.lastLimboFreeSnapshotVersion);r=aL(t.target)?uc(e.remoteSerializer,t.target):ud(e.remoteSerializer,t.target).queryTarget;let s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:aN(t.target),readTime:n,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:r}}function u4(e){return void 0!==e.documents}function u5(e){return{id:e.bundleId,createTime:u0(e.createTime),version:e.version}}function u8(e){return{bundleId:e.id,createTime:uZ(lW(e.createTime)),version:e.version}}function u7(e){return{name:e.name,query:ce(e.bundledQuery),readTime:u0(e.readTime)}}function u9(e){return{name:e.name,readTime:uZ(lW(e.readTime)),bundledQuery:e.bundledQuery}}function ce(e){let t=up({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?a8(t,t.limit,"L"):t}function ct(e){return{name:e.name,query:ce(e.bundledQuery),readTime:lW(e.readTime)}}function cr(e){return{id:e.id,version:e.version,createTime:lW(e.createTime)}}function cn(e,t){return new lo(t.largestBatchId,un(e.remoteSerializer,t.overlayMutation))}function ci(e,t,r){let[n,i,s]=cs(t,r.mutation.key);return{userId:t,collectionPath:i,documentId:s,collectionGroup:r.mutation.key.getCollectionGroup(),largestBatchId:r.largestBatchId,overlayMutation:ur(e.remoteSerializer,r.mutation)}}function cs(e,t){let r=t.path.lastSegment();return[e,nw(t.path.popLast()),r]}function ca(e){return{indexId:e.indexId,collectionGroup:e.collectionGroup,fields:e.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])}}function co(e,t){let r=t?new rZ(t.sequenceNumber,new r2(u0(t.readTime),new rk(nE(t.documentKey)),t.largestBatchId)):rZ.empty(),n=e.fields.map(([e,t])=>new rY(rI.fromServerFormat(e),t));return new rK(e.indexId,e.collectionGroup,n,r)}function cl(e,t,r,n){return{indexId:e,uid:t,sequenceNumber:r,readTime:uZ(n.readTime),documentKey:nw(n.documentKey.path),largestBatchId:n.largestBatchId}}class cu{getBundleMetadata(e,t){return cc(e).get(t).next(e=>{if(e)return u5(e)})}saveBundleMetadata(e,t){return cc(e).put(u8(t))}getNamedQuery(e,t){return ch(e).get(t).next(e=>{if(e)return u7(e)})}saveNamedQuery(e,t){return ch(e).put(u9(t))}}function cc(e){return iN(e,n8)}function ch(e){return iN(e,n9)}class cd{constructor(e,t){this.serializer=e,this.userId=t}static forUser(e,t){return new cd(e,t.uid||"")}getOverlay(e,t){return cf(e).get(cs(this.userId,t)).next(e=>e?cn(this.serializer,e):null)}getOverlays(e,t){let r=ov();return r8.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&r.set(t,e)})).next(()=>r)}saveOverlays(e,t,r){let n=[];return r.forEach((r,i)=>{let s=new lo(t,i);n.push(this.saveOverlay(e,s))}),r8.waitFor(n)}removeOverlaysForBatchId(e,t,r){let n=new Set;t.forEach(e=>n.add(nw(e.getCollectionPath())));let i=[];return n.forEach(t=>{let n=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,r+1],!1,!0);i.push(cf(e).deleteAll(iy,n))}),r8.waitFor(i)}getOverlaysForCollection(e,t,r){let n=ov(),i=nw(t),s=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,1/0],!0);return cf(e).loadAll(iy,s).next(e=>{for(let t of e){let e=cn(this.serializer,t);n.set(e.getKey(),e)}return n})}getOverlaysForCollectionGroup(e,t,r,n){let i,s=ov(),a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,1/0],!0);return cf(e).iterate({index:ib,range:a},(e,t,r)=>{let a=cn(this.serializer,t);s.size()<n||a.largestBatchId===i?(s.set(a.getKey(),a),i=a.largestBatchId):r.done()}).next(()=>s)}saveOverlay(e,t){return cf(e).put(ci(this.serializer,this.userId,t))}}function cf(e){return iN(e,im)}class cp{globalsStore(e){return iN(e,iw)}getSessionToken(e){return this.globalsStore(e).get("sessionToken").next(e=>{let t=e?.value;return t?iJ.fromUint8Array(t):iJ.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.globalsStore(e).put({name:"sessionToken",value:t.toUint8Array()})}}let cm=5,cg=10,cy=13,cv=15,cb=20,cS=25,cw=30,cC=37,cT=45,cE=50,c_=53,cI=55,ck=60,cx=2;class cR{constructor(){}writeIndexValue(e,t){this.writeIndexValueAux(e,t),t.writeInfinity()}writeIndexValueAux(e,t){if("nullValue"in e)this.writeValueTypeLabel(t,cm);else if("booleanValue"in e)this.writeValueTypeLabel(t,cg),t.writeNumber(+!!e.booleanValue);else if("integerValue"in e)this.writeValueTypeLabel(t,cv),t.writeNumber(i1(e.integerValue));else if("doubleValue"in e){let r=i1(e.doubleValue);isNaN(r)?this.writeValueTypeLabel(t,cy):(this.writeValueTypeLabel(t,cv),so(r)?t.writeNumber(0):t.writeNumber(r))}else if("timestampValue"in e){let r=e.timestampValue;this.writeValueTypeLabel(t,cb),"string"==typeof r&&(r=i0(r)),t.writeString(`${r.seconds||""}`),t.writeNumber(r.nanos||0)}else if("stringValue"in e)this.writeIndexString(e.stringValue,t),this.writeTruncationMarker(t);else if("bytesValue"in e)this.writeValueTypeLabel(t,cw),t.writeBytes(i2(e.bytesValue)),this.writeTruncationMarker(t);else if("referenceValue"in e)this.writeIndexEntityRef(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.writeValueTypeLabel(t,cT),t.writeNumber(r.latitude||0),t.writeNumber(r.longitude||0)}else"mapValue"in e?sZ(e)?this.writeValueTypeLabel(t,Number.MAX_SAFE_INTEGER):sY(e)?this.writeIndexVector(e.mapValue,t):(this.writeIndexMap(e.mapValue,t),this.writeTruncationMarker(t)):"arrayValue"in e?(this.writeIndexArray(e.arrayValue,t),this.writeTruncationMarker(t)):tU(19022,{indexValue:e})}writeIndexString(e,t){this.writeValueTypeLabel(t,cS),this.writeUnlabeledIndexString(e,t)}writeUnlabeledIndexString(e,t){t.writeString(e)}writeIndexMap(e,t){let r=e.fields||{};for(let e of(this.writeValueTypeLabel(t,cI),Object.keys(r)))this.writeIndexString(e,t),this.writeIndexValueAux(r[e],t)}writeIndexVector(e,t){let r=e.fields||{};this.writeValueTypeLabel(t,c_);let n=sf,i=r[n].arrayValue?.values?.length||0;this.writeValueTypeLabel(t,cv),t.writeNumber(i1(i)),this.writeIndexString(n,t),this.writeIndexValueAux(r[n],t)}writeIndexArray(e,t){let r=e.values||[];for(let e of(this.writeValueTypeLabel(t,cE),r))this.writeIndexValueAux(e,t)}writeIndexEntityRef(e,t){this.writeValueTypeLabel(t,cC),rk.fromName(e).path.forEach(e=>{this.writeValueTypeLabel(t,ck),this.writeUnlabeledIndexString(e,t)})}writeValueTypeLabel(e,t){e.writeNumber(t)}writeTruncationMarker(e){e.writeNumber(cx)}}cR.INSTANCE=new cR;let cD="\uD800",cA="\uDBFF",cO=0,cN=255,cP=1,cM=255,cL=255,cB=0,cF=64,cj=8,cV=1024;function cz(e){let t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}function cq(e){if(0===e)return 8;let t=0;return e>>4==0&&(t+=4,e<<=4),e>>6==0&&(t+=2,e<<=2),e>>7==0&&(t+=1),t}function cU(e){let t=0;for(let r=0;r<8;++r){let n=cq(255&e[r]);if(t+=n,8!==n)break}return t}function c$(e){return Math.ceil((cF-cU(e))/cj)}class cK{constructor(){this.buffer=new Uint8Array(cV),this.position=0}writeBytesAscending(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.writeByteAscending(r.value),r=t.next();this.writeSeparatorAscending()}writeBytesDescending(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.writeByteDescending(r.value),r=t.next();this.writeSeparatorDescending()}writeUtf8Ascending(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.writeByteAscending(e);else if(e<2048)this.writeByteAscending(960|e>>>6),this.writeByteAscending(128|63&e);else if(t<cD||cA<t)this.writeByteAscending(480|e>>>12),this.writeByteAscending(128|63&e>>>6),this.writeByteAscending(128|63&e);else{let e=t.codePointAt(0);this.writeByteAscending(240|e>>>18),this.writeByteAscending(128|63&e>>>12),this.writeByteAscending(128|63&e>>>6),this.writeByteAscending(128|63&e)}}this.writeSeparatorAscending()}writeUtf8Descending(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.writeByteDescending(e);else if(e<2048)this.writeByteDescending(960|e>>>6),this.writeByteDescending(128|63&e);else if(t<cD||cA<t)this.writeByteDescending(480|e>>>12),this.writeByteDescending(128|63&e>>>6),this.writeByteDescending(128|63&e);else{let e=t.codePointAt(0);this.writeByteDescending(240|e>>>18),this.writeByteDescending(128|63&e>>>12),this.writeByteDescending(128|63&e>>>6),this.writeByteDescending(128|63&e)}}this.writeSeparatorDescending()}writeNumberAscending(e){let t=this.toOrderedBits(e),r=c$(t);this.ensureAvailable(1+r),this.buffer[this.position++]=255&r;for(let e=t.length-r;e<t.length;++e)this.buffer[this.position++]=255&t[e]}writeNumberDescending(e){let t=this.toOrderedBits(e),r=c$(t);this.ensureAvailable(1+r),this.buffer[this.position++]=~(255&r);for(let e=t.length-r;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}writeInfinityAscending(){this.writeEscapedByteAscending(cM),this.writeEscapedByteAscending(cL)}writeInfinityDescending(){this.writeEscapedByteDescending(cM),this.writeEscapedByteDescending(cL)}reset(){this.position=0}seed(e){this.ensureAvailable(e.length),this.buffer.set(e,this.position),this.position+=e.length}encodedBytes(){return this.buffer.slice(0,this.position)}toOrderedBits(e){let t=cz(e),r=(128&t[0])!=0;t[0]^=r?255:128;for(let e=1;e<t.length;++e)t[e]^=255*!!r;return t}writeByteAscending(e){let t=255&e;t===cO?(this.writeEscapedByteAscending(cO),this.writeEscapedByteAscending(cN)):t===cM?(this.writeEscapedByteAscending(cM),this.writeEscapedByteAscending(cB)):this.writeEscapedByteAscending(t)}writeByteDescending(e){let t=255&e;t===cO?(this.writeEscapedByteDescending(cO),this.writeEscapedByteDescending(cN)):t===cM?(this.writeEscapedByteDescending(cM),this.writeEscapedByteDescending(cB)):this.writeEscapedByteDescending(e)}writeSeparatorAscending(){this.writeEscapedByteAscending(cO),this.writeEscapedByteAscending(cP)}writeSeparatorDescending(){this.writeEscapedByteDescending(cO),this.writeEscapedByteDescending(cP)}writeEscapedByteAscending(e){this.ensureAvailable(1),this.buffer[this.position++]=e}writeEscapedByteDescending(e){this.ensureAvailable(1),this.buffer[this.position++]=~e}ensureAvailable(e){let t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);let n=new Uint8Array(r);n.set(this.buffer),this.buffer=n}}class cW{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesAscending(e)}writeString(e){this.orderedCode.writeUtf8Ascending(e)}writeNumber(e){this.orderedCode.writeNumberAscending(e)}writeInfinity(){this.orderedCode.writeInfinityAscending()}}class cG{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesDescending(e)}writeString(e){this.orderedCode.writeUtf8Descending(e)}writeNumber(e){this.orderedCode.writeNumberDescending(e)}writeInfinity(){this.orderedCode.writeInfinityDescending()}}class cH{constructor(){this.orderedCode=new cK,this.ascending=new cW(this.orderedCode),this.descending=new cG(this.orderedCode)}seed(e){this.orderedCode.seed(e)}forKind(e){return 0===e?this.ascending:this.descending}encodedBytes(){return this.orderedCode.encodedBytes()}reset(){this.orderedCode.reset()}}class cQ{constructor(e,t,r,n){this._indexId=e,this._documentKey=t,this._arrayValue=r,this._directionalValue=n}successor(){let e=this._directionalValue.length,t=0===e||255===this._directionalValue[e-1]?e+1:e,r=new Uint8Array(t);return r.set(this._directionalValue,0),t!==e?r.set([0],this._directionalValue.length):++r[r.length-1],new cQ(this._indexId,this._documentKey,this._arrayValue,r)}dbIndexEntry(e,t,r){return{indexId:this._indexId,uid:e,arrayValue:cX(this._arrayValue),directionalValue:cX(this._directionalValue),orderedDocumentKey:cX(t),documentKey:r.path.toArray()}}dbIndexEntryKey(e,t,r){let n=this.dbIndexEntry(e,t,r);return[n.indexId,n.uid,n.arrayValue,n.directionalValue,n.orderedDocumentKey,n.documentKey]}}function cJ(e,t){let r=e._indexId-t._indexId;return 0!==r||0!==(r=cY(e._arrayValue,t._arrayValue))||0!==(r=cY(e._directionalValue,t._directionalValue))?r:rk.comparator(e._documentKey,t._documentKey)}function cY(e,t){for(let r=0;r<e.length&&r<t.length;++r){let n=e[r]-t[r];if(0!==n)return n}return e.length-t.length}function cX(e){return M()?c0(e):e}function cZ(e){return"string"!=typeof e?e:c1(e)}function c0(e){let t="";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}function c1(e){let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}class c2{constructor(e){for(const t of(this.inequalityFilters=new iq((e,t)=>rI.comparator(e.field,t.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.orderBys=e.orderBy,this.equalityFilters=[],e.filters)){const e=t;e.isInequality()?this.inequalityFilters=this.inequalityFilters.add(e):this.equalityFilters.push(e)}}get hasMultipleInequality(){return this.inequalityFilters.size>1}servedByIndex(e){if(tK(e.collectionGroup===this.collectionId,49279),this.hasMultipleInequality)return!1;let t=rW(e);if(void 0!==t&&!this.hasMatchingEqualityFilter(t))return!1;let r=rG(e),n=new Set,i=0,s=0;for(;i<r.length;++i)if(this.hasMatchingEqualityFilter(r[i]))n=n.add(r[i].fieldPath.canonicalString());else break;if(i===r.length)return!0;if(this.inequalityFilters.size>0){let e=this.inequalityFilters.getIterator().getNext();if(!n.has(e.field.canonicalString())){let t=r[i];if(!this.matchesFilter(e,t)||!this.matchesOrderBy(this.orderBys[s++],t))return!1}++i}for(;i<r.length;++i){let e=r[i];if(s>=this.orderBys.length||!this.matchesOrderBy(this.orderBys[s++],e))return!1}return!0}buildTargetIndex(){if(this.hasMultipleInequality)return null;let e=new iq(rI.comparator),t=[];for(let r of this.equalityFilters)if(!r.field.isKeyField())if("array-contains"===r.op||"array-contains-any"===r.op)t.push(new rY(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new rY(r.field,0))}for(let r of this.orderBys)!r.field.isKeyField()&&(e.has(r.field)||(e=e.add(r.field),t.push(new rY(r.field,+("asc"!==r.dir)))));return new rK(rK.UNKNOWN_ID,this.collectionId,t,rZ.empty())}hasMatchingEqualityFilter(e){for(let t of this.equalityFilters)if(this.matchesFilter(t,e))return!0;return!1}matchesFilter(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;let r="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===r}matchesOrderBy(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function c3(e){if(tK(e instanceof au||e instanceof ac,20012),e instanceof au)if(!(e instanceof ax))return e;else{let t=e.value.arrayValue?.values?.map(t=>au.create(e.field,"==",t))||[];return ac.create(t,"or")}let t=e.filters.map(e=>c3(e));return ac.create(t,e.op)}function c6(e){if(0===e.getFilters().length)return[];let t=c9(c3(e));return(tK(c8(t),7391),c4(t)||c5(t))?[t]:t.getFilters()}function c4(e){return e instanceof au}function c5(e){return e instanceof ac&&af(e)}function c8(e){return c4(e)||c5(e)||c7(e)}function c7(e){if(e instanceof ac&&ad(e)){for(let t of e.getFilters())if(!c4(t)&&!c5(t))return!1;return!0}return!1}function c9(e){if(tK(e instanceof au||e instanceof ac,34018),e instanceof au)return e;if(1===e.filters.length)return c9(e.filters[0]);let t=e.filters.map(e=>c9(e)),r=ac.create(t,e.op);return c8(r=hi(r))?r:(tK(r instanceof ac,64498),tK(ah(r),40251),tK(r.filters.length>1,57927),r.filters.reduce((e,t)=>he(e,t)))}function he(e,t){let r;return tK(e instanceof au||e instanceof ac,38388),tK(t instanceof au||t instanceof ac,25473),hi(r=e instanceof au?t instanceof au?ht(e,t):hn(e,t):t instanceof au?hn(t,e):hr(e,t))}function ht(e,t){return ac.create([e,t],"and")}function hr(e,t){if(tK(e.filters.length>0&&t.filters.length>0,48005),ah(e)&&ah(t))return ab(e,t.getFilters());let r=ad(e)?e:t,n=ad(e)?t:e,i=r.filters.map(e=>he(e,n));return ac.create(i,"or")}function hn(e,t){if(ah(t))return ab(t,e.getFilters());{let r=t.filters.map(t=>he(e,t));return ac.create(r,"or")}}function hi(e){if(tK(e instanceof au||e instanceof ac,11850),e instanceof au)return e;let t=e.getFilters();if(1===t.length)return hi(t[0]);if(ap(e))return e;let r=t.map(e=>hi(e)),n=[];return(r.forEach(t=>{t instanceof au?n.push(t):t instanceof ac&&(t.op===e.op?n.push(...t.filters):n.push(t))}),1===n.length)?n[0]:ac.create(n,e.op)}class hs{constructor(){this.collectionParentIndex=new ha}addToCollectionParentIndex(e,t){return this.collectionParentIndex.add(t),r8.resolve()}getCollectionParents(e,t){return r8.resolve(this.collectionParentIndex.getEntries(t))}addFieldIndex(e,t){return r8.resolve()}deleteFieldIndex(e,t){return r8.resolve()}deleteAllFieldIndexes(e){return r8.resolve()}createTargetIndexes(e,t){return r8.resolve()}getDocumentsMatchingTarget(e,t){return r8.resolve(null)}getIndexType(e,t){return r8.resolve(0)}getFieldIndexes(e,t){return r8.resolve([])}getNextCollectionGroupToUpdate(e){return r8.resolve(null)}getMinOffset(e,t){return r8.resolve(r2.min())}getMinOffsetFromCollectionGroup(e,t){return r8.resolve(r2.min())}updateCollectionGroup(e,t,r){return r8.resolve()}updateIndexEntries(e,t){return r8.resolve()}}class ha{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),n=this.index[t]||new iq(rE.comparator),i=!n.has(r);return this.index[t]=n.add(r),i}has(e){let t=e.lastSegment(),r=e.popLast(),n=this.index[t];return n&&n.has(r)}getEntries(e){return(this.index[e]||new iq(rE.comparator)).toArray()}}let ho="IndexedDbIndexManager",hl=new Uint8Array(0);class hu{constructor(e,t){this.databaseId=t,this.collectionParentsCache=new ha,this.targetToDnfSubTargets=new oh(e=>aN(e),(e,t)=>aM(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.collectionParentsCache.has(t)){let r=t.lastSegment(),n=t.popLast();e.addOnCommittedListener(()=>{this.collectionParentsCache.add(t)});let i={collectionId:r,parent:nw(n)};return hc(e).put(i)}return r8.resolve()}getCollectionParents(e,t){let r=[],n=IDBKeyRange.bound([t,""],[rw(t),""],!1,!0);return hc(e).loadAll(n).next(e=>{for(let n of e){if(n.collectionId!==t)break;r.push(nE(n.parent))}return r})}addFieldIndex(e,t){let r=hd(e),n=ca(t);delete n.indexId;let i=r.add(n);if(!t.indexState)return i.next();{let r=hf(e);return i.next(e=>{r.put(cl(e,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}}deleteFieldIndex(e,t){let r=hd(e),n=hf(e),i=hh(e);return r.delete(t.indexId).next(()=>n.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=hd(e),r=hh(e),n=hf(e);return t.deleteAll().next(()=>r.deleteAll()).next(()=>n.deleteAll())}createTargetIndexes(e,t){return r8.forEach(this.getSubTargets(t),t=>this.getIndexType(e,t).next(r=>{if(0===r||1===r){let r=new c2(t).buildTargetIndex();if(null!=r)return this.addFieldIndex(e,r)}}))}getDocumentsMatchingTarget(e,t){let r=hh(e),n=!0,i=new Map;return r8.forEach(this.getSubTargets(t),t=>this.getFieldIndex(e,t).next(e=>{n&&(n=!!e),i.set(t,e)})).next(()=>{if(!n)return r8.resolve(null);{let e=oE(),n=[];return r8.forEach(i,(i,s)=>{tj(ho,`Using index ${rJ(i)} to execute ${aN(t)}`);let a=aF(s,i),o=aj(s,i),l=aV(s,i),u=az(s,i),c=this.encodeBound(i,s,l),h=this.encodeBound(i,s,u),d=this.encodeValues(i,s,o),f=this.generateIndexRanges(i.indexId,a,c,l.inclusive,h,u.inclusive,d);return r8.forEach(f,i=>r.loadFirst(i,t.limit).next(t=>{t.forEach(t=>{let r=rk.fromSegments(t.documentKey);e.has(r)||(e=e.add(r),n.push(r))})}))}).next(()=>n)}})}getSubTargets(e){let t=this.targetToDnfSubTargets.get(e);return t||(t=0===e.filters.length?[e]:c6(ac.create(e.filters,"and")).map(t=>aO(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt)),this.targetToDnfSubTargets.set(e,t)),t}generateIndexRanges(e,t,r,n,i,s,a){let o=(null!=t?t.length:1)*Math.max(r.length,i.length),l=o/(null!=t?t.length:1),u=[];for(let c=0;c<o;++c){let o=t?this.encodeSingleElement(t[c/l]):hl,h=this.generateLowerBound(e,o,r[c%l],n),d=this.generateUpperBound(e,o,i[c%l],s),f=a.map(t=>this.generateLowerBound(e,o,t,!0));u.push(...this.createRange(h,d,f))}return u}generateLowerBound(e,t,r,n){let i=new cQ(e,rk.empty(),t,r);return n?i:i.successor()}generateUpperBound(e,t,r,n){let i=new cQ(e,rk.empty(),t,r);return n?i.successor():i}getFieldIndex(e,t){let r=new c2(t),n=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,n).next(e=>{let t=null;for(let n of e)r.servedByIndex(n)&&(!t||n.fields.length>t.fields.length)&&(t=n);return t})}getIndexType(e,t){let r=2,n=this.getSubTargets(t);return r8.forEach(n,t=>this.getFieldIndex(e,t).next(e=>{e?0!==r&&e.fields.length<a$(t)&&(r=1):r=0})).next(()=>aK(t)&&n.length>1&&2===r?1:r)}encodeDirectionalElements(e,t){let r=new cH;for(let n of rG(e)){let e=t.data.field(n.fieldPath);if(null==e)return null;let i=r.forKind(n.kind);cR.INSTANCE.writeIndexValue(e,i)}return r.encodedBytes()}encodeSingleElement(e){let t=new cH;return cR.INSTANCE.writeIndexValue(e,t.forKind(0)),t.encodedBytes()}encodeDirectionalKey(e,t){let r=new cH;return cR.INSTANCE.writeIndexValue(sU(this.databaseId,t),r.forKind(rH(e))),r.encodedBytes()}encodeValues(e,t,r){if(null===r)return[];let n=[];n.push(new cH);let i=0;for(let s of rG(e)){let e=r[i++];for(let r of n)if(this.isInFilter(t,s.fieldPath)&&sG(e))n=this.expandIndexValues(n,s,e);else{let t=r.forKind(s.kind);cR.INSTANCE.writeIndexValue(e,t)}}return this.getEncodedBytes(n)}encodeBound(e,t,r){return this.encodeValues(e,t,r.position)}getEncodedBytes(e){let t=[];for(let r=0;r<e.length;++r)t[r]=e[r].encodedBytes();return t}expandIndexValues(e,t,r){let n=[...e],i=[];for(let e of r.arrayValue.values||[])for(let r of n){let n=new cH;n.seed(r.encodedBytes()),cR.INSTANCE.writeIndexValue(e,n.forKind(t.kind)),i.push(n)}return i}isInFilter(e,t){return!!e.filters.find(e=>e instanceof au&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){let r=hd(e),n=hf(e);return(t?r.loadAll(ii,IDBKeyRange.bound(t,t)):r.loadAll()).next(e=>{let t=[];return r8.forEach(e,e=>n.get([e.indexId,this.uid]).next(r=>{t.push(co(e,r))})).next(()=>t)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{let r=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==r?r:rm(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,t,r){let n=hd(e),i=hf(e);return this.getNextSequenceNumber(e).next(e=>n.loadAll(ii,IDBKeyRange.bound(t,t)).next(t=>r8.forEach(t,t=>i.put(cl(t.indexId,this.uid,e,r)))))}updateIndexEntries(e,t){let r=new Map;return r8.forEach(t,(t,n)=>{let i=r.get(t.collectionGroup);return(i?r8.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next(i=>(r.set(t.collectionGroup,i),r8.forEach(i,r=>this.getExistingIndexEntries(e,t,r).next(t=>{let i=this.computeIndexEntries(n,r);return t.isEqual(i)?r8.resolve():this.updateEntries(e,n,r,t,i)}))))})}addIndexEntry(e,t,r,n){return hh(e).put(n.dbIndexEntry(this.uid,this.encodeDirectionalKey(r,t.key),t.key))}deleteIndexEntry(e,t,r,n){return hh(e).delete(n.dbIndexEntryKey(this.uid,this.encodeDirectionalKey(r,t.key),t.key))}getExistingIndexEntries(e,t,r){let n=hh(e),i=new iq(cJ);return n.iterate({index:id,range:IDBKeyRange.only([r.indexId,this.uid,cX(this.encodeDirectionalKey(r,t))])},(e,n)=>{i=i.add(new cQ(r.indexId,t,cZ(n.arrayValue),cZ(n.directionalValue)))}).next(()=>i)}computeIndexEntries(e,t){let r=new iq(cJ),n=this.encodeDirectionalElements(t,e);if(null==n)return r;let i=rW(t);if(null!=i){let s=e.data.field(i.fieldPath);if(sG(s))for(let i of s.arrayValue.values||[])r=r.add(new cQ(t.indexId,e.key,this.encodeSingleElement(i),n))}else r=r.add(new cQ(t.indexId,e.key,hl,n));return r}updateEntries(e,t,r,n,i){tj(ho,"Updating index entries for document '%s'",t.key);let s=[];return i$(n,i,cJ,n=>{s.push(this.addIndexEntry(e,t,r,n))},n=>{s.push(this.deleteIndexEntry(e,t,r,n))}),r8.waitFor(s)}getNextSequenceNumber(e){let t=1;return hf(e).iterate({index:il,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,r,n)=>{n.done(),t=r.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((e,t)=>cJ(e,t)).filter((e,t,r)=>!t||0!==cJ(e,r[t-1]));let n=[];for(let i of(n.push(e),r)){let r=cJ(i,e),s=cJ(i,t);if(0===r)n[0]=e.successor();else if(r>0&&s<0)n.push(i),n.push(i.successor());else if(s>0)break}n.push(t);let i=[];for(let e=0;e<n.length;e+=2){if(this.isRangeMatchable(n[e],n[e+1]))return[];let t=n[e].dbIndexEntryKey(this.uid,hl,rk.empty()),r=n[e+1].dbIndexEntryKey(this.uid,hl,rk.empty());i.push(IDBKeyRange.bound(t,r))}return i}isRangeMatchable(e,t){return cJ(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(hp)}getMinOffset(e,t){return r8.mapArray(this.getSubTargets(t),t=>this.getFieldIndex(e,t).next(e=>e||tU(44426))).next(hp)}}function hc(e){return iN(e,n3)}function hh(e){return iN(e,ic)}function hd(e){return iN(e,it)}function hf(e){return iN(e,ia)}function hp(e){tK(0!==e.length,28825);let t=e[0].indexState.offset,r=t.largestBatchId;for(let n=1;n<e.length;n++){let i=e[n].indexState.offset;0>r3(i,t)&&(t=i),r<i.largestBatchId&&(r=i.largestBatchId)}return new r2(t.readTime,t.documentKey,r)}function hm(e,t,r){let n=e.store(nD),i=e.store(nF),s=[],a=IDBKeyRange.only(r.batchId),o=0,l=n.iterate({range:a},(e,t,r)=>(o++,r.delete()));s.push(l.next(()=>{tK(1===o,47070,{batchId:r.batchId})}));let u=[];for(let e of r.mutations){let n=nL(t,e.key.path,r.batchId);s.push(i.delete(n)),u.push(e.key)}return r8.waitFor(s).next(()=>u)}function hg(e){let t;if(!e)return 0;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else if(e.noDocument)t=e.noDocument;else throw tU(14731);return JSON.stringify(t).length}class hy{constructor(e,t,r,n){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=n,this.documentKeysByBatchId={}}static forUser(e,t,r,n){return tK(""!==e.uid,64387),new hy(e.isAuthenticated()?e.uid:"",t,r,n)}checkEmpty(e){let t=!0,r=IDBKeyRange.bound([this.userId,-1/0],[this.userId,1/0]);return hS(e).iterate({index:nO,range:r},(e,r,n)=>{t=!1,n.done()}).next(()=>t)}addMutationBatch(e,t,r,n){let i=hw(e),s=hS(e);return s.add({}).next(a=>{tK("number"==typeof a,49019);let o=new ls(a,t,r,n),l=u1(this.serializer,this.userId,o),u=[],c=new iq((e,t)=>rm(e.canonicalString(),t.canonicalString()));for(let e of n){let t=nL(this.userId,e.key.path,a);c=c.add(e.key.path.popLast()),u.push(s.put(l)),u.push(i.put(t,nB))}return c.forEach(t=>{u.push(this.indexManager.addToCollectionParentIndex(e,t))}),e.addOnCommittedListener(()=>{this.documentKeysByBatchId[a]=o.keys()}),r8.waitFor(u).next(()=>o)})}lookupMutationBatch(e,t){return hS(e).get(t).next(e=>e?(tK(e.userId===this.userId,48,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),u2(this.serializer,e)):null)}lookupMutationKeys(e,t){return this.documentKeysByBatchId[t]?r8.resolve(this.documentKeysByBatchId[t]):this.lookupMutationBatch(e,t).next(e=>{if(!e)return null;{let r=e.keys();return this.documentKeysByBatchId[t]=r,r}})}getNextMutationBatchAfterBatchId(e,t){let r=t+1,n=IDBKeyRange.lowerBound([this.userId,r]),i=null;return hS(e).iterate({index:nO,range:n},(e,t,n)=>{t.userId===this.userId&&(tK(t.batchId>=r,47524,{nextBatchId:r}),i=u2(this.serializer,t)),n.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,1/0]),r=ss;return hS(e).iterate({index:nO,range:t,reverse:!0},(e,t,n)=>{r=t.batchId,n.done()}).next(()=>r)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,ss],[this.userId,1/0]);return hS(e).loadAll(nO,t).next(e=>e.map(e=>u2(this.serializer,e)))}getAllMutationBatchesAffectingDocumentKey(e,t){let r=nM(this.userId,t.path),n=IDBKeyRange.lowerBound(r),i=[];return hw(e).iterate({range:n},(r,n,s)=>{let[a,o,l]=r,u=nE(o);return a===this.userId&&t.path.isEqual(u)?hS(e).get(l).next(e=>{if(!e)throw tU(61480,{indexKey:r,batchId:l});tK(e.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:e.userId,batchId:l}),i.push(u2(this.serializer,e))}):void s.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new iq(rm),n=[];return t.forEach(t=>{let i=nM(this.userId,t.path),s=IDBKeyRange.lowerBound(i),a=hw(e).iterate({range:s},(e,n,i)=>{let[s,a,o]=e,l=nE(a);s===this.userId&&t.path.isEqual(l)?r=r.add(o):i.done()});n.push(a)}),r8.waitFor(n).next(()=>this.lookupMutationBatches(e,r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,n=r.length+1,i=nM(this.userId,r),s=IDBKeyRange.lowerBound(i),a=new iq(rm);return hw(e).iterate({range:s},(e,t,i)=>{let[s,o,l]=e,u=nE(o);s===this.userId&&r.isPrefixOf(u)?u.length===n&&(a=a.add(l)):i.done()}).next(()=>this.lookupMutationBatches(e,a))}lookupMutationBatches(e,t){let r=[],n=[];return t.forEach(t=>{n.push(hS(e).get(t).next(e=>{if(null===e)throw tU(35274,{batchId:t});tK(e.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),r.push(u2(this.serializer,e))}))}),r8.waitFor(n).next(()=>r)}removeMutationBatch(e,t){return hm(e.simpleDbTransaction,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.removeCachedMutationKeys(t.batchId)}),r8.forEach(r,t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))}removeCachedMutationKeys(e){delete this.documentKeysByBatchId[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return r8.resolve();let r=IDBKeyRange.lowerBound(nP(this.userId)),n=[];return hw(e).iterate({range:r},(e,t,r)=>{if(e[0]!==this.userId)return void r.done();{let t=nE(e[1]);n.push(t)}}).next(()=>{tK(0===n.length,56720,{danglingKeys:n.map(e=>e.canonicalString())})})})}containsKey(e,t){return hv(e,this.userId,t)}getMutationQueueMetadata(e){return hC(e).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:ss,lastStreamToken:""})}}function hv(e,t,r){let n=nM(t,r.path),i=n[1],s=IDBKeyRange.lowerBound(n),a=!1;return hw(e).iterate({range:s,keysOnly:!0},(e,r,n)=>{let[s,o,l]=e;s===t&&o===i&&(a=!0),n.done()}).next(()=>a)}function hb(e,t){let r=!1;return hC(e).iterateSerial(n=>hv(e,n,t).next(e=>(e&&(r=!0),r8.resolve(!e)))).next(()=>r)}function hS(e){return iN(e,nD)}function hw(e){return iN(e,nF)}function hC(e){return iN(e,nx)}let hT=2;class hE{constructor(e){this.lastId=e}next(){return this.lastId+=hT,this.lastId}static forTargetCache(){return new hE(2-hT)}static forSyncEngine(){return new hE(1-hT)}}class h_{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.retrieveMetadata(e).next(t=>{let r=new hE(t.highestTargetId);return t.highestTargetId=r.next(),this.saveMetadata(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.retrieveMetadata(e).next(e=>rq.fromTimestamp(new rz(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.retrieveMetadata(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.retrieveMetadata(e).next(n=>(n.highestListenSequenceNumber=t,r&&(n.lastRemoteSnapshotVersion=r.toTimestamp()),t>n.highestListenSequenceNumber&&(n.highestListenSequenceNumber=t),this.saveMetadata(e,n)))}addTargetData(e,t){return this.saveTargetData(e,t).next(()=>this.retrieveMetadata(e).next(r=>(r.targetCount+=1,this.updateMetadataFromTargetData(t,r),this.saveMetadata(e,r))))}updateTargetData(e,t){return this.saveTargetData(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>hI(e).delete(t.targetId)).next(()=>this.retrieveMetadata(e)).next(t=>(tK(t.targetCount>0,8065),t.targetCount-=1,this.saveMetadata(e,t)))}removeTargets(e,t,r){let n=0,i=[];return hI(e).iterate((s,a)=>{let o=u3(a);o.sequenceNumber<=t&&null===r.get(o.targetId)&&(n++,i.push(this.removeTargetData(e,o)))}).next(()=>r8.waitFor(i)).next(()=>n)}forEachTarget(e,t){return hI(e).iterate((e,r)=>{t(u3(r))})}retrieveMetadata(e){return hk(e).get(n1).next(e=>(tK(null!==e,2888),e))}saveMetadata(e,t){return hk(e).put(n1,t)}saveTargetData(e,t){return hI(e).put(u6(this.serializer,t))}updateMetadataFromTargetData(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.retrieveMetadata(e).next(e=>e.targetCount)}getTargetData(e,t){let r=aN(t),n=IDBKeyRange.bound([r,-1/0],[r,1/0]),i=null;return hI(e).iterate({range:n,index:nQ},(e,r,n)=>{let s=u3(r);aM(t,s.target)&&(i=s,n.done())}).next(()=>i)}addMatchingKeys(e,t,r){let n=[],i=hx(e);return t.forEach(t=>{let s=nw(t.path);n.push(i.put({targetId:r,path:s})),n.push(this.referenceDelegate.addReference(e,r,t))}),r8.waitFor(n)}removeMatchingKeys(e,t,r){let n=hx(e);return r8.forEach(t,t=>{let i=nw(t.path);return r8.waitFor([n.delete([r,i]),this.referenceDelegate.removeReference(e,r,t)])})}removeMatchingKeysForTargetId(e,t){let r=hx(e),n=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(n)}getMatchingKeysForTargetId(e,t){let r=IDBKeyRange.bound([t],[t+1],!1,!0),n=hx(e),i=oE();return n.iterate({range:r,keysOnly:!0},(e,t,r)=>{let n=new rk(nE(e[1]));i=i.add(n)}).next(()=>i)}containsKey(e,t){let r=nw(t.path),n=IDBKeyRange.bound([r],[rw(r)],!1,!0),i=0;return hx(e).iterate({index:nZ,keysOnly:!0,range:n},([e,t],r,n)=>{0!==e&&(i++,n.done())}).next(()=>i>0)}getTargetDataForTarget(e,t){return hI(e).get(t).next(e=>e?u3(e):null)}}function hI(e){return iN(e,nG)}function hk(e){return iN(e,n2)}function hx(e){return iN(e,nY)}let hR={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},hD=-1,hA=0x2800000;class hO{static withCacheSize(e){return new hO(e,hO.DEFAULT_COLLECTION_PERCENTILE,hO.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}hO.DEFAULT_COLLECTION_PERCENTILE=10,hO.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,hO.DEFAULT=new hO(hA,hO.DEFAULT_COLLECTION_PERCENTILE,hO.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),hO.DISABLED=new hO(hD,0,0);let hN="LruGarbageCollector",hP=1048576,hM=6e4,hL=3e5;function hB([e,t],[r,n]){let i=rm(e,r);return 0===i?rm(t,n):i}class hF{constructor(e){this.maxElements=e,this.buffer=new iq(hB),this.previousIndex=0}nextIndex(){return++this.previousIndex}addElement(e){let t=[e,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(t);else{let e=this.buffer.last();0>hB(t,e)&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class hj{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.gcTask=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==hD&&this.scheduleGC(hM)}stop(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)}get started(){return null!==this.gcTask}scheduleGC(e){tj(hN,`Garbage collection scheduled in ${e}ms`),this.gcTask=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.gcTask=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){ns(e)?tj(hN,"Ignoring IndexedDB error during garbage collection: ",e):await r5(e)}await this.scheduleGC(hL)})}}class hV{constructor(e,t){this.delegate=e,this.params=t}calculateTargetCount(e,t){return this.delegate.getSequenceNumberCount(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return r8.resolve(ng.INVALID);let r=new hF(t);return this.delegate.forEachTarget(e,e=>r.addElement(e.sequenceNumber)).next(()=>this.delegate.forEachOrphanedDocumentSequenceNumber(e,e=>r.addElement(e))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.delegate.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.delegate.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===hD?(tj("LruGarbageCollector","Garbage collection skipped; disabled"),r8.resolve(hR)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(tj("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),hR):this.runGarbageCollection(e,t))}getCacheSize(e){return this.delegate.getCacheSize(e)}runGarbageCollection(e,t){let r,n,i,s,a,o,l,u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(tj("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),n=this.params.maximumSequenceNumbersToCollect):n=t,s=Date.now(),this.nthSequenceNumber(e,n))).next(n=>(r=n,a=Date.now(),this.removeTargets(e,r,t))).next(t=>(i=t,o=Date.now(),this.removeOrphanedDocuments(e,r))).next(e=>(l=Date.now(),tB()<=tb.DEBUG&&tj("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${s-u}ms
	Determined least recently used ${n} in ${a-s}ms
	Removed ${i} targets in ${o-a}ms
	Removed ${e} documents in ${l-o}ms
Total Duration: ${l-u}ms`),r8.resolve({didRun:!0,sequenceNumbersCollected:n,targetsRemoved:i,documentsRemoved:e})))}}function hz(e,t){return new hV(e,t)}class hq{constructor(e,t){this.db=e,this.garbageCollector=hz(this,t)}getSequenceNumberCount(e){let t=this.orphanedDocumentCount(e);return this.db.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}orphanedDocumentCount(e){let t=0;return this.forEachOrphanedDocumentSequenceNumber(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}forEachOrphanedDocumentSequenceNumber(e,t){return this.forEachOrphanedDocument(e,(e,r)=>t(r))}addReference(e,t,r){return hK(e,r)}removeReference(e,t,r){return hK(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return hK(e,t)}isPinned(e,t){return hb(e,t)}removeOrphanedDocuments(e,t){let r=this.db.getRemoteDocumentCache().newChangeBuffer(),n=[],i=0;return this.forEachOrphanedDocument(e,(s,a)=>{if(a<=t){let t=this.isPinned(e,s).next(t=>{if(!t)return i++,r.getEntry(e,s).next(()=>(r.removeEntry(s,rq.min()),hx(e).delete(hU(s))))});n.push(t)}}).next(()=>r8.waitFor(n)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return hK(e,t)}forEachOrphanedDocument(e,t){let r,n=hx(e),i=ng.INVALID;return n.iterate({index:nZ},([e,n],{path:s,sequenceNumber:a})=>{0===e?(i!==ng.INVALID&&t(new rk(nE(r)),i),i=a,r=s):i=ng.INVALID}).next(()=>{i!==ng.INVALID&&t(new rk(nE(r)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function hU(e){return[0,nw(e.path)]}function h$(e,t){return{targetId:0,path:nw(e.path),sequenceNumber:t}}function hK(e,t){return hx(e).put(h$(t,e.currentSequenceNumber))}class hW{constructor(){this.changes=new oh(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,s8.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return void 0!==r?r8.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class hG{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return hY(e).put(r)}removeEntry(e,t,r){return hY(e).delete(hZ(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.setMetadata(e,r)))}getEntry(e,t){let r=s8.newInvalidDocument(t);return hY(e).iterate({index:nz,range:IDBKeyRange.only(hX(t))},(e,n)=>{r=this.maybeDecodeDocument(t,n)}).next(()=>r)}getSizedEntry(e,t){let r={size:0,document:s8.newInvalidDocument(t)};return hY(e).iterate({index:nz,range:IDBKeyRange.only(hX(t))},(e,n)=>{r={document:this.maybeDecodeDocument(t,n),size:hg(n)}}).next(()=>r)}getEntries(e,t){let r=of();return this.forEachDbEntry(e,t,(e,t)=>{let n=this.maybeDecodeDocument(e,t);r=r.insert(e,n)}).next(()=>r)}getSizedEntries(e,t){let r=of(),n=new iF(rk.comparator);return this.forEachDbEntry(e,t,(e,t)=>{let i=this.maybeDecodeDocument(e,t);r=r.insert(e,i),n=n.insert(e,hg(t))}).next(()=>({documents:r,sizeMap:n}))}forEachDbEntry(e,t,r){if(t.isEmpty())return r8.resolve();let n=new iq(h1);t.forEach(e=>n=n.add(e));let i=IDBKeyRange.bound(hX(n.first()),hX(n.last())),s=n.getIterator(),a=s.getNext();return hY(e).iterate({index:nz,range:i},(e,t,n)=>{let i=rk.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;a&&0>h1(a,i);)r(a,null),a=s.getNext();a&&a.isEqual(i)&&(r(a,t),a=s.hasNext()?s.getNext():null),a?n.skip(hX(a)):n.done()}).next(()=>{for(;a;)r(a,null),a=s.hasNext()?s.getNext():null})}getDocumentsMatchingQuery(e,t,r,n,i){let s=t.path,a=[s.popLast().toArray(),s.lastSegment(),uY(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],o=[s.popLast().toArray(),s.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return hY(e).loadAll(IDBKeyRange.bound(a,o,!0)).next(e=>{i?.incrementDocumentReadCount(e.length);let r=of();for(let i of e){let e=this.maybeDecodeDocument(rk.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);e.isFoundDocument()&&(on(t,e)||n.has(e.key))&&(r=r.insert(e.key,e))}return r})}getAllFromCollectionGroup(e,t,r,n){let i=of(),s=h0(t,r),a=h0(t,r2.max());return hY(e).iterate({index:nU,range:IDBKeyRange.bound(s,a,!0)},(e,t,r)=>{let s=this.maybeDecodeDocument(rk.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);(i=i.insert(s.key,s)).size===n&&r.done()}).next(()=>i)}newChangeBuffer(e){return new hQ(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return hJ(e).get(nW).next(e=>(tK(!!e,20021),e))}setMetadata(e,t){return hJ(e).put(nW,t)}maybeDecodeDocument(e,t){if(t){let e=uQ(this.serializer,t);if(!(e.isNoDocument()&&e.version.isEqual(rq.min())))return e}return s8.newInvalidDocument(e)}}function hH(e){return new hG(e)}class hQ extends hW{constructor(e,t){super(),this.documentCache=e,this.trackRemovals=t,this.documentStates=new oh(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(e){let t=[],r=0,n=new iq((e,t)=>rm(e.canonicalString(),t.canonicalString()));return this.changes.forEach((i,s)=>{let a=this.documentStates.get(i);if(t.push(this.documentCache.removeEntry(e,i,a.readTime)),s.isValidDocument()){let o=uJ(this.documentCache.serializer,s);n=n.add(i.path.popLast());let l=hg(o);r+=l-a.size,t.push(this.documentCache.addEntry(e,i,o))}else if(r-=a.size,this.trackRemovals){let r=uJ(this.documentCache.serializer,s.convertToNoDocument(rq.min()));t.push(this.documentCache.addEntry(e,i,r))}}),n.forEach(r=>{t.push(this.documentCache.indexManager.addToCollectionParentIndex(e,r))}),t.push(this.documentCache.updateMetadata(e,r)),r8.waitFor(t)}getFromCache(e,t){return this.documentCache.getSizedEntry(e,t).next(e=>(this.documentStates.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.documentCache.getSizedEntries(e,t).next(({documents:e,sizeMap:t})=>(t.forEach((t,r)=>{this.documentStates.set(t,{size:r,readTime:e.get(t).readTime})}),e))}}function hJ(e){return iN(e,nK)}function hY(e){return iN(e,nj)}function hX(e){let t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function hZ(e,t){let r=e.path.toArray();return[r.slice(0,r.length-2),r[r.length-2],uY(t),r[r.length-1]]}function h0(e,t){let r=t.documentKey.path.toArray();return[e,uY(t.readTime),r.slice(0,r.length-2),r.length>0?r[r.length-1]:""]}function h1(e,t){let r=e.path.toArray(),n=t.path.toArray(),i=0;for(let e=0;e<r.length-2&&e<n.length-2;++e)if(i=rm(r[e],n[e]))return i;return(i=rm(r.length,n.length))||(i=rm(r[r.length-2],n[n.length-2]))?i:rm(r[r.length-1],n[n.length-1])}let h2=18;class h3{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class h6{constructor(e,t,r,n){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=n}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(n=>(r=n,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==r&&oZ(r.mutation,e,iW.empty(),rz.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,oE()).next(()=>t))}getLocalViewOfDocuments(e,t,r=oE()){let n=ov();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,r).next(e=>{let t=om();return e.forEach((e,r)=>{t=t.insert(e,r.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){let r=ov();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,oE()))}populateOverlays(e,t,r){let n=[];return r.forEach(e=>{t.has(e)||n.push(e)}),this.documentOverlayCache.getOverlays(e,n).next(e=>{e.forEach((e,r)=>{t.set(e,r)})})}computeViews(e,t,r,n){let i=of(),s=oS(),a=og();return t.forEach((e,t)=>{let a=r.get(t.key);n.has(t.key)&&(void 0===a||a.mutation instanceof o4)?i=i.insert(t.key,t):void 0!==a?(s.set(t.key,a.mutation.getFieldMask()),oZ(a.mutation,t,a.mutation.getFieldMask(),rz.now())):s.set(t.key,iW.empty())}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>a.set(e,new h3(t,s.get(e)??null))),a))}recalculateAndSaveOverlays(e,t){let r=oS(),n=new iF((e,t)=>e-t),i=oE();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(let i of e)i.keys().forEach(e=>{let s=t.get(e);if(null===s)return;let a=r.get(e)||iW.empty();a=i.applyToLocalView(s,a),r.set(e,a);let o=(n.get(i.batchId)||oE()).add(e);n=n.insert(i.batchId,o)})}).next(()=>{let s=[],a=n.getReverseIterator();for(;a.hasNext();){let n=a.getNext(),o=n.key,l=n.value,u=ob();l.forEach(e=>{if(!i.has(e)){let n=oY(t.get(e),r.get(e));null!==n&&u.set(e,n),i=i.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,o,u))}return r8.waitFor(s)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,r,n){return aZ(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):a0(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,n):this.getDocumentsMatchingCollectionQuery(e,t,r,n)}getNextDocuments(e,t,r,n){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,n).next(i=>{let s=n-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,n-i.size):r8.resolve(ov()),a=rU,o=i;return s.next(t=>r8.forEach(t,(t,r)=>(a<r.largestBatchId&&(a=r.largestBatchId),i.get(t))?r8.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{o=o.insert(t,e)})).next(()=>this.populateOverlays(e,t,i)).next(()=>this.computeViews(e,o,t,oE())).next(e=>({batchId:a,changes:oy(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new rk(t)).next(e=>{let t=om();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,r,n){let i=t.collectionGroup,s=om();return this.indexManager.getCollectionParents(e,i).next(a=>r8.forEach(a,a=>{let o=aQ(t,a.child(i));return this.getDocumentsMatchingCollectionQuery(e,o,r,n).next(e=>{e.forEach((e,t)=>{s=s.insert(e,t)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,r,n){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,n))).next(e=>{i.forEach((t,r)=>{let n=r.getKey();null===e.get(n)&&(e=e.insert(n,s8.newInvalidDocument(n)))});let r=om();return e.forEach((e,n)=>{let s=i.get(e);void 0!==s&&oZ(s.mutation,n,iW.empty(),rz.now()),on(t,n)&&(r=r.insert(e,n))}),r})}}class h4{constructor(e){this.serializer=e,this.bundles=new Map,this.namedQueries=new Map}getBundleMetadata(e,t){return r8.resolve(this.bundles.get(t))}saveBundleMetadata(e,t){return this.bundles.set(t.id,cr(t)),r8.resolve()}getNamedQuery(e,t){return r8.resolve(this.namedQueries.get(t))}saveNamedQuery(e,t){return this.namedQueries.set(t.name,ct(t)),r8.resolve()}}class h5{constructor(){this.overlays=new iF(rk.comparator),this.overlayByBatchId=new Map}getOverlay(e,t){return r8.resolve(this.overlays.get(t))}getOverlays(e,t){let r=ov();return r8.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&r.set(t,e)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((r,n)=>{this.saveOverlay(e,t,n)}),r8.resolve()}removeOverlaysForBatchId(e,t,r){let n=this.overlayByBatchId.get(r);return void 0!==n&&(n.forEach(e=>this.overlays=this.overlays.remove(e)),this.overlayByBatchId.delete(r)),r8.resolve()}getOverlaysForCollection(e,t,r){let n=ov(),i=t.length+1,s=new rk(t.child("")),a=this.overlays.getIteratorFrom(s);for(;a.hasNext();){let e=a.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>r&&n.set(e.getKey(),e)}return r8.resolve(n)}getOverlaysForCollectionGroup(e,t,r,n){let i=new iF((e,t)=>e-t),s=this.overlays.getIterator();for(;s.hasNext();){let e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>r){let t=i.get(e.largestBatchId);null===t&&(t=ov(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}let a=ov(),o=i.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=n)););return r8.resolve(a)}saveOverlay(e,t,r){let n=this.overlays.get(r.key);if(null!==n){let e=this.overlayByBatchId.get(n.largestBatchId).delete(r.key);this.overlayByBatchId.set(n.largestBatchId,e)}this.overlays=this.overlays.insert(r.key,new lo(t,r));let i=this.overlayByBatchId.get(t);void 0===i&&(i=oE(),this.overlayByBatchId.set(t,i)),this.overlayByBatchId.set(t,i.add(r.key))}}class h8{constructor(){this.sessionToken=iJ.EMPTY_BYTE_STRING}getSessionToken(e){return r8.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,r8.resolve()}}class h7{constructor(){this.refsByKey=new iq(h9.compareByKey),this.refsByTarget=new iq(h9.compareByTargetId)}isEmpty(){return this.refsByKey.isEmpty()}addReference(e,t){let r=new h9(e,t);this.refsByKey=this.refsByKey.add(r),this.refsByTarget=this.refsByTarget.add(r)}addReferences(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.removeRef(new h9(e,t))}removeReferences(e,t){e.forEach(e=>this.removeReference(e,t))}removeReferencesForId(e){let t=new rk(new rE([])),r=new h9(t,e),n=new h9(t,e+1),i=[];return this.refsByTarget.forEachInRange([r,n],e=>{this.removeRef(e),i.push(e.key)}),i}removeAllReferences(){this.refsByKey.forEach(e=>this.removeRef(e))}removeRef(e){this.refsByKey=this.refsByKey.delete(e),this.refsByTarget=this.refsByTarget.delete(e)}referencesForId(e){let t=new rk(new rE([])),r=new h9(t,e),n=new h9(t,e+1),i=oE();return this.refsByTarget.forEachInRange([r,n],e=>{i=i.add(e.key)}),i}containsKey(e){let t=new h9(e,0),r=this.refsByKey.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class h9{constructor(e,t){this.key=e,this.targetOrBatchId=t}static compareByKey(e,t){return rk.comparator(e.key,t.key)||rm(e.targetOrBatchId,t.targetOrBatchId)}static compareByTargetId(e,t){return rm(e.targetOrBatchId,t.targetOrBatchId)||rk.comparator(e.key,t.key)}}class de{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.nextBatchId=1,this.batchesByDocumentKey=new iq(h9.compareByKey)}checkEmpty(e){return r8.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,r,n){let i=this.nextBatchId;this.nextBatchId++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let s=new ls(i,t,r,n);for(let t of(this.mutationQueue.push(s),n))this.batchesByDocumentKey=this.batchesByDocumentKey.add(new h9(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return r8.resolve(s)}lookupMutationBatch(e,t){return r8.resolve(this.findMutationBatch(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,n=this.indexOfBatchId(r),i=n<0?0:n;return r8.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return r8.resolve(0===this.mutationQueue.length?ss:this.nextBatchId-1)}getAllMutationBatches(e){return r8.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new h9(t,0),n=new h9(t,1/0),i=[];return this.batchesByDocumentKey.forEachInRange([r,n],e=>{let t=this.findMutationBatch(e.targetOrBatchId);i.push(t)}),r8.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new iq(rm);return t.forEach(e=>{let t=new h9(e,0),n=new h9(e,1/0);this.batchesByDocumentKey.forEachInRange([t,n],e=>{r=r.add(e.targetOrBatchId)})}),r8.resolve(this.findMutationBatches(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,n=r.length+1,i=r;rk.isDocumentKey(i)||(i=i.child(""));let s=new h9(new rk(i),0),a=new iq(rm);return this.batchesByDocumentKey.forEachWhile(e=>{let t=e.key.path;return!!r.isPrefixOf(t)&&(t.length===n&&(a=a.add(e.targetOrBatchId)),!0)},s),r8.resolve(this.findMutationBatches(a))}findMutationBatches(e){let t=[];return e.forEach(e=>{let r=this.findMutationBatch(e);null!==r&&t.push(r)}),t}removeMutationBatch(e,t){tK(0===this.indexOfExistingBatchId(t.batchId,"removed"),55003),this.mutationQueue.shift();let r=this.batchesByDocumentKey;return r8.forEach(t.mutations,n=>{let i=new h9(n.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,n.key)}).next(()=>{this.batchesByDocumentKey=r})}removeCachedMutationKeys(e){}containsKey(e,t){let r=new h9(t,0),n=this.batchesByDocumentKey.firstAfterOrEqual(r);return r8.resolve(t.isEqual(n&&n.key))}performConsistencyCheck(e){return this.mutationQueue.length,r8.resolve()}indexOfExistingBatchId(e,t){return this.indexOfBatchId(e)}indexOfBatchId(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}findMutationBatch(e){let t=this.indexOfBatchId(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}let dt="-9223372036854775808";function dr(){return new iF(rk.comparator)}class dn{constructor(e){this.sizer=e,this.docs=dr(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,n=this.docs.get(r),i=n?n.size:0,s=this.sizer(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return r8.resolve(r?r.document.mutableCopy():s8.newInvalidDocument(t))}getEntries(e,t){let r=of();return t.forEach(e=>{let t=this.docs.get(e);r=r.insert(e,t?t.document.mutableCopy():s8.newInvalidDocument(e))}),r8.resolve(r)}getDocumentsMatchingQuery(e,t,r,n){let i=of(),s=t.path,a=new rk(s.child("__id"+dt+"__")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){let{key:e,value:{document:a}}=o.getNext();if(!s.isPrefixOf(e.path))break;!(e.path.length>s.length+1||0>=r3(r1(a),r))&&(n.has(a.key)||on(t,a))&&(i=i.insert(a.key,a.mutableCopy()))}return r8.resolve(i)}getAllFromCollectionGroup(e,t,r,n){tU(9500)}forEachDocumentKey(e,t){return r8.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new ds(this)}getSize(e){return r8.resolve(this.size)}}function di(e){return new dn(e)}class ds extends hW{constructor(e){super(),this.documentCache=e}applyChanges(e){let t=[];return this.changes.forEach((r,n)=>{n.isValidDocument()?t.push(this.documentCache.addEntry(e,n)):this.documentCache.removeEntry(r)}),r8.waitFor(t)}getFromCache(e,t){return this.documentCache.getEntry(e,t)}getAllFromCache(e,t){return this.documentCache.getEntries(e,t)}}class da{constructor(e){this.persistence=e,this.targets=new oh(e=>aN(e),aM),this.lastRemoteSnapshotVersion=rq.min(),this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new h7,this.targetCount=0,this.targetIdGenerator=hE.forTargetCache()}forEachTarget(e,t){return this.targets.forEach((e,r)=>t(r)),r8.resolve()}getLastRemoteSnapshotVersion(e){return r8.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return r8.resolve(this.highestSequenceNumber)}allocateTargetId(e){return this.highestTargetId=this.targetIdGenerator.next(),r8.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.highestSequenceNumber&&(this.highestSequenceNumber=t),r8.resolve()}saveTargetData(e){this.targets.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.targetIdGenerator=new hE(t),this.highestTargetId=t),e.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=e.sequenceNumber)}addTargetData(e,t){return this.saveTargetData(t),this.targetCount+=1,r8.resolve()}updateTargetData(e,t){return this.saveTargetData(t),r8.resolve()}removeTargetData(e,t){return this.targets.delete(t.target),this.references.removeReferencesForId(t.targetId),this.targetCount-=1,r8.resolve()}removeTargets(e,t,r){let n=0,i=[];return this.targets.forEach((s,a)=>{a.sequenceNumber<=t&&null===r.get(a.targetId)&&(this.targets.delete(s),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),n++)}),r8.waitFor(i).next(()=>n)}getTargetCount(e){return r8.resolve(this.targetCount)}getTargetData(e,t){let r=this.targets.get(t)||null;return r8.resolve(r)}addMatchingKeys(e,t,r){return this.references.addReferences(t,r),r8.resolve()}removeMatchingKeys(e,t,r){this.references.removeReferences(t,r);let n=this.persistence.referenceDelegate,i=[];return n&&t.forEach(t=>{i.push(n.markPotentiallyOrphaned(e,t))}),r8.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.references.removeReferencesForId(t),r8.resolve()}getMatchingKeysForTargetId(e,t){let r=this.references.referencesForId(t);return r8.resolve(r)}containsKey(e,t){return r8.resolve(this.references.containsKey(t))}}let dl="MemoryPersistence";class du{constructor(e,t){this.mutationQueues={},this.overlays={},this.listenSequence=new ng(0),this._started=!1,this._started=!0,this.globalsCache=new h8,this.referenceDelegate=e(this),this.targetCache=new da(this);const r=e=>this.referenceDelegate.documentSize(e);this.indexManager=new hs,this.remoteDocumentCache=di(r),this.serializer=new uH(t),this.bundleCache=new h4(this.serializer)}start(){return Promise.resolve()}shutdown(){return this._started=!1,Promise.resolve()}get started(){return this._started}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new h5,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.mutationQueues[e.toKey()];return r||(r=new de(t,this.referenceDelegate),this.mutationQueues[e.toKey()]=r),r}getGlobalsCache(){return this.globalsCache}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.bundleCache}runTransaction(e,t,r){tj(dl,"Starting transaction:",e);let n=new dc(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),r(n).next(e=>this.referenceDelegate.onTransactionCommitted(n).next(()=>e)).toPromise().then(e=>(n.raiseOnCommittedEvent(),e))}mutationQueuesContainKey(e,t){return r8.or(Object.values(this.mutationQueues).map(r=>()=>r.containsKey(e,t)))}}class dc extends r4{constructor(e){super(),this.currentSequenceNumber=e}}class dh{constructor(e){this.persistence=e,this.localViewReferences=new h7,this._orphanedDocuments=null}static factory(e){return new dh(e)}get orphanedDocuments(){if(this._orphanedDocuments)return this._orphanedDocuments;throw tU(60996)}addReference(e,t,r){return this.localViewReferences.addReference(r,t),this.orphanedDocuments.delete(r.toString()),r8.resolve()}removeReference(e,t,r){return this.localViewReferences.removeReference(r,t),this.orphanedDocuments.add(r.toString()),r8.resolve()}markPotentiallyOrphaned(e,t){return this.orphanedDocuments.add(t.toString()),r8.resolve()}removeTarget(e,t){this.localViewReferences.removeReferencesForId(t.targetId).forEach(e=>this.orphanedDocuments.add(e.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.orphanedDocuments.add(e.toString()))}).next(()=>r.removeTargetData(e,t))}onTransactionStarted(){this._orphanedDocuments=new Set}onTransactionCommitted(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return r8.forEach(this.orphanedDocuments,r=>{let n=rk.fromPath(r);return this.isReferenced(e,n).next(e=>{e||t.removeEntry(n,rq.min())})}).next(()=>(this._orphanedDocuments=null,t.apply(e)))}updateLimboDocument(e,t){return this.isReferenced(e,t).next(e=>{e?this.orphanedDocuments.delete(t.toString()):this.orphanedDocuments.add(t.toString())})}documentSize(e){return 0}isReferenced(e,t){return r8.or([()=>r8.resolve(this.localViewReferences.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.mutationQueuesContainKey(e,t)])}}class dd{constructor(e,t){this.persistence=e,this.orphanedSequenceNumbers=new oh(e=>nw(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=hz(this,t)}static factory(e,t){return new dd(e,t)}onTransactionStarted(){}onTransactionCommitted(e){return r8.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}getSequenceNumberCount(e){let t=this.orphanedDocumentCount(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}orphanedDocumentCount(e){let t=0;return this.forEachOrphanedDocumentSequenceNumber(e,e=>{t++}).next(()=>t)}forEachOrphanedDocumentSequenceNumber(e,t){return r8.forEach(this.orphanedSequenceNumbers,(r,n)=>this.isPinned(e,r,n).next(e=>e?r8.resolve():t(n)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0,n=this.persistence.getRemoteDocumentCache(),i=n.newChangeBuffer();return n.forEachDocumentKey(e,n=>this.isPinned(e,n,t).next(e=>{e||(r++,i.removeEntry(n,rq.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.orphanedSequenceNumbers.set(t,e.currentSequenceNumber),r8.resolve()}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.orphanedSequenceNumbers.set(r,e.currentSequenceNumber),r8.resolve()}removeReference(e,t,r){return this.orphanedSequenceNumbers.set(r,e.currentSequenceNumber),r8.resolve()}updateLimboDocument(e,t){return this.orphanedSequenceNumbers.set(t,e.currentSequenceNumber),r8.resolve()}documentSize(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=sV(e.data.value)),t}isPinned(e,t,r){return r8.or([()=>this.persistence.mutationQueuesContainKey(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let e=this.orphanedSequenceNumbers.get(t);return r8.resolve(void 0!==e&&e>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class df{constructor(e){this.serializer=e}createOrUpgrade(e,t,r,n){let i=new ne("createOrUpgrade",t);r<1&&n>=1&&(dm(e),dg(e),dw(e),dv(e));let s=r8.resolve();return r<3&&n>=3&&(0!==r&&(dC(e),dw(e)),s=s.next(()=>dE(i))),r<4&&n>=4&&(0!==r&&(s=s.next(()=>dy(e,i))),s=s.next(()=>{d_(e)})),r<5&&n>=5&&(s=s.next(()=>this.removeAcknowledgedMutations(i))),r<6&&n>=6&&(s=s.next(()=>(dS(e),this.addDocumentGlobal(i)))),r<7&&n>=7&&(s=s.next(()=>this.ensureSequenceNumbers(i))),r<8&&n>=8&&(s=s.next(()=>this.createCollectionParentIndex(e,i))),r<9&&n>=9&&(s=s.next(()=>{dT(e)})),r<10&&n>=10&&(s=s.next(()=>this.rewriteCanonicalIds(i))),r<11&&n>=11&&(s=s.next(()=>{dI(e),dk(e)})),r<12&&n>=12&&(s=s.next(()=>{dR(e)})),r<13&&n>=13&&(s=s.next(()=>db(e)).next(()=>this.rewriteRemoteDocumentCache(e,i)).next(()=>e.deleteObjectStore(n_))),r<14&&n>=14&&(s=s.next(()=>this.runOverlayMigration(e,i))),r<15&&n>=15&&(s=s.next(()=>dx(e))),r<16&&n>=16&&(s=s.next(()=>{t.objectStore(ia).clear()}).next(()=>{t.objectStore(ic).clear()})),r<17&&n>=17&&(s=s.next(()=>{dD(e)})),r<18&&n>=18&&M()&&(s=s.next(()=>{t.objectStore(ia).clear()}).next(()=>{t.objectStore(ic).clear()})),s}addDocumentGlobal(e){let t=0;return e.store(n_).iterate((e,r)=>{t+=hg(r)}).next(()=>{let r={byteSize:t};return e.store(nK).put(nW,r)})}removeAcknowledgedMutations(e){let t=e.store(nx),r=e.store(nD);return t.loadAll().next(t=>r8.forEach(t,t=>{let n=IDBKeyRange.bound([t.userId,ss],[t.userId,t.lastAcknowledgedBatchId]);return r.loadAll(nO,n).next(r=>r8.forEach(r,r=>{tK(r.userId===t.userId,18650,"Cannot process batch from unexpected user",{batchId:r.batchId});let n=u2(this.serializer,r);return hm(e,t.userId,n).next(()=>{})}))}))}ensureSequenceNumbers(e){let t=e.store(nY),r=e.store(n_);return e.store(n2).get(n1).next(e=>{let n=r=>t.put({targetId:0,path:nw(r),sequenceNumber:e.highestListenSequenceNumber}),i=[];return r.iterate((e,r)=>{let s=new rE(e),a=dp(s);i.push(t.get(a).next(e=>e?r8.resolve():n(s)))}).next(()=>r8.waitFor(i))})}createCollectionParentIndex(e,t){e.createObjectStore(n3,{keyPath:n6});let r=t.store(n3),n=new ha,i=e=>{if(n.add(e)){let t=e.lastSegment(),n=e.popLast();return r.put({collectionId:t,parent:nw(n)})}};return t.store(n_).iterate({keysOnly:!0},(e,t)=>i(new rE(e).popLast())).next(()=>t.store(nF).iterate({keysOnly:!0},([e,t,r],n)=>i(nE(t).popLast())))}rewriteCanonicalIds(e){let t=e.store(nG);return t.iterate((e,r)=>{let n=u3(r),i=u6(this.serializer,n);return t.put(i)})}rewriteRemoteDocumentCache(e,t){let r=t.store(n_),n=[];return r.iterate((e,r)=>{let i=t.store(nj),s=dA(r).path.toArray(),a={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:r.readTime||[0,0],unknownDocument:r.unknownDocument,noDocument:r.noDocument,document:r.document,hasCommittedMutations:!!r.hasCommittedMutations};n.push(i.put(a))}).next(()=>r8.waitFor(n))}runOverlayMigration(e,t){let r=t.store(nD),n=hH(this.serializer),i=new du(dh.factory,this.serializer.remoteSerializer);return r.loadAll().next(e=>{let r=new Map;return e.forEach(e=>{let t=r.get(e.userId)??oE();u2(this.serializer,e).keys().forEach(e=>t=t.add(e)),r.set(e.userId,t)}),r8.forEach(r,(e,r)=>{let s=new tO(r),a=cd.forUser(this.serializer,s),o=i.getIndexManager(s);return new h6(n,hy.forUser(s,this.serializer,o,i.referenceDelegate),a,o).recalculateAndSaveOverlaysForDocumentKeys(new iO(t,ng.INVALID),e).next()})})}}function dp(e){return[0,nw(e)]}function dm(e){e.createObjectStore(nI)}function dg(e){e.createObjectStore(nx,{keyPath:nR}),e.createObjectStore(nD,{keyPath:nA,autoIncrement:!0}).createIndex(nO,nN,{unique:!0}),e.createObjectStore(nF)}function dy(e,t){return t.store(nD).loadAll().next(r=>{e.deleteObjectStore(nD),e.createObjectStore(nD,{keyPath:nA,autoIncrement:!0}).createIndex(nO,nN,{unique:!0});let n=t.store(nD),i=r.map(e=>n.put(e));return r8.waitFor(i)})}function dv(e){e.createObjectStore(n_)}function db(e){let t=e.createObjectStore(nj,{keyPath:nV});t.createIndex(nz,nq),t.createIndex(nU,n$)}function dS(e){e.createObjectStore(nK)}function dw(e){e.createObjectStore(nY,{keyPath:nX}).createIndex(nZ,n0,{unique:!0}),e.createObjectStore(nG,{keyPath:nH}).createIndex(nQ,nJ,{unique:!0}),e.createObjectStore(n2)}function dC(e){e.deleteObjectStore(nY),e.deleteObjectStore(nG),e.deleteObjectStore(n2)}function dT(e){e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")}function dE(e){let t=e.store(n2),r={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:rq.min().toTimestamp(),targetCount:0};return t.put(n1,r)}function d_(e){e.createObjectStore(n4,{keyPath:n5})}function dI(e){e.createObjectStore(n8,{keyPath:n7})}function dk(e){e.createObjectStore(n9,{keyPath:ie})}function dx(e){e.createObjectStore(it,{keyPath:ir,autoIncrement:!0}).createIndex(ii,is,{unique:!1}),e.createObjectStore(ia,{keyPath:io}).createIndex(il,iu,{unique:!1}),e.createObjectStore(ic,{keyPath:ih}).createIndex(id,ip,{unique:!1})}function dR(e){let t=e.createObjectStore(im,{keyPath:ig});t.createIndex(iy,iv,{unique:!1}),t.createIndex(ib,iS,{unique:!1})}function dD(e){e.createObjectStore(iw,{keyPath:iC})}function dA(e){return e.document?new rk(rE.fromString(e.document.name).popFirst(5)):e.noDocument?rk.fromSegments(e.noDocument.path):e.unknownDocument?rk.fromSegments(e.unknownDocument.path):tU(36783)}let dO="IndexedDbPersistence",dN=18e5,dP=5e3,dM=4e3,dL="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",dB="This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.",dF="firestore_zombie",dj="main";class dV{constructor(e,t,r,n,i,s,a,o,l,u,c=h2){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.queue=i,this.window=s,this.document=a,this.sequenceNumberSyncer=l,this.forceOwningTab=u,this.schemaVersion=c,this.listenSequence=null,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.windowUnloadHandler=null,this.inForeground=!1,this.documentVisibilityHandler=null,this.clientMetadataRefresher=null,this.lastGarbageCollectionTime=-1/0,this.primaryStateListener=e=>Promise.resolve(),!dV.isAvailable())throw new rt(t8,dB);this.referenceDelegate=new hq(this,n),this.dbName=t+dj,this.serializer=new uH(o),this.simpleDb=new nt(this.dbName,this.schemaVersion,new df(this.serializer)),this.globalsCache=new cp,this.targetCache=new h_(this.referenceDelegate,this.serializer),this.remoteDocumentCache=hH(this.serializer),this.bundleCache=new cu,this.window&&this.window.localStorage?this.webStorage=this.window.localStorage:(this.webStorage=null,!1===u&&tV(dO,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.updateClientMetadataAndTryBecomePrimary().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new rt(t6,dL);return this.attachVisibilityHandler(),this.attachWindowUnloadHook(),this.scheduleClientMetadataAndPrimaryLeaseRefreshes(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.targetCache.getHighestSequenceNumber(e))}).then(e=>{this.listenSequence=new ng(e,this.sequenceNumberSyncer)}).then(()=>{this._started=!0}).catch(e=>(this.simpleDb&&this.simpleDb.close(),Promise.reject(e)))}setPrimaryStateListener(e){return this.primaryStateListener=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.simpleDb.setVersionChangeListener(async t=>{null===t.newVersion&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.queue.enqueueAndForget(async()=>{this.started&&await this.updateClientMetadataAndTryBecomePrimary()}))}updateClientMetadataAndTryBecomePrimary(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>dq(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.verifyPrimaryLease(e).next(e=>{e||(this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)))})}).next(()=>this.canActAsPrimary(e)).next(t=>this.isPrimary&&!t?this.releasePrimaryLeaseIfHeld(e).next(()=>!1):!!t&&this.acquireOrExtendPrimaryLease(e).next(()=>!0))).catch(e=>{if(ns(e))return tj(dO,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return tj(dO,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.queue.enqueueRetryable(()=>this.primaryStateListener(e)),this.isPrimary=e})}verifyPrimaryLease(e){return dz(e).get(nk).next(e=>r8.resolve(this.isLocalClient(e)))}removeClientMetadata(e){return dq(e).delete(this.clientId)}async maybeGarbageCollectMultiClientState(){if(this.isPrimary&&!this.isWithinAge(this.lastGarbageCollectionTime,dN)){this.lastGarbageCollectionTime=Date.now();let e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let t=iN(e,n4);return t.loadAll().next(e=>{let r=this.filterActiveClients(e,dN),n=e.filter(e=>-1===r.indexOf(e));return r8.forEach(n,e=>t.delete(e.clientId)).next(()=>n)})}).catch(()=>[]);if(this.webStorage)for(let t of e)this.webStorage.removeItem(this.zombiedClientLocalStorageKey(t.clientId))}}scheduleClientMetadataAndPrimaryLeaseRefreshes(){this.clientMetadataRefresher=this.queue.enqueueAfterDelay("client_metadata_refresh",dM,()=>this.updateClientMetadataAndTryBecomePrimary().then(()=>this.maybeGarbageCollectMultiClientState()).then(()=>this.scheduleClientMetadataAndPrimaryLeaseRefreshes()))}isLocalClient(e){return!!e&&e.ownerId===this.clientId}canActAsPrimary(e){return this.forceOwningTab?r8.resolve(!0):dz(e).get(nk).next(t=>{if(null!==t&&this.isWithinAge(t.leaseTimestampMs,dP)&&!this.isClientZombied(t.ownerId)){if(this.isLocalClient(t)&&this.networkEnabled)return!0;if(!this.isLocalClient(t)){if(!t.allowTabSynchronization)throw new rt(t6,dL);return!1}}return!!this.networkEnabled&&!!this.inForeground||dq(e).loadAll().next(e=>void 0===this.filterActiveClients(e,dP).find(e=>{if(this.clientId!==e.clientId){let t=!this.networkEnabled&&e.networkEnabled,r=!this.inForeground&&e.inForeground,n=this.networkEnabled===e.networkEnabled;if(t||r&&n)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&tj(dO,`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&(this.clientMetadataRefresher.cancel(),this.clientMetadataRefresher=null),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),await this.simpleDb.runTransaction("shutdown","readwrite",[nI,n4],e=>{let t=new iO(e,ng.INVALID);return this.releasePrimaryLeaseIfHeld(t).next(()=>this.removeClientMetadata(t))}),this.simpleDb.close(),this.removeClientZombiedEntry()}filterActiveClients(e,t){return e.filter(e=>this.isWithinAge(e.updateTimeMs,t)&&!this.isClientZombied(e.clientId))}getActiveClients(){return this.runTransaction("getActiveClients","readonly",e=>dq(e).loadAll().next(e=>this.filterActiveClients(e,dN).map(e=>e.clientId)))}get started(){return this._started}getGlobalsCache(){return this.globalsCache}getMutationQueue(e,t){return hy.forUser(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new hu(e,this.serializer.remoteSerializer.databaseId)}getDocumentOverlayCache(e){return cd.forUser(this.serializer,e)}getBundleCache(){return this.bundleCache}runTransaction(e,t,r){let n;tj(dO,"Starting transaction:",e);let i="readonly"===t?"readonly":"readwrite",s=iA(this.schemaVersion);return this.simpleDb.runTransaction(e,i,s,i=>(n=new iO(i,this.listenSequence?this.listenSequence.next():ng.INVALID),"readwrite-primary"===t)?this.verifyPrimaryLease(n).next(e=>!!e||this.canActAsPrimary(n)).next(t=>{if(!t)throw tV(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)),new rt(t6,r6);return r(n)}).next(e=>this.acquireOrExtendPrimaryLease(n).next(()=>e)):this.verifyAllowTabSynchronization(n).next(()=>r(n))).then(e=>(n.raiseOnCommittedEvent(),e))}verifyAllowTabSynchronization(e){return dz(e).get(nk).next(e=>{if(null!==e&&this.isWithinAge(e.leaseTimestampMs,dP)&&!this.isClientZombied(e.ownerId)&&!this.isLocalClient(e)&&!this.forceOwningTab&&(!this.allowTabSynchronization||!e.allowTabSynchronization))throw new rt(t6,dL)})}acquireOrExtendPrimaryLease(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return dz(e).put(nk,t)}static isAvailable(){return nt.isAvailable()}releasePrimaryLeaseIfHeld(e){let t=dz(e);return t.get(nk).next(e=>this.isLocalClient(e)?(tj(dO,"Releasing primary lease."),t.delete(nk)):r8.resolve())}isWithinAge(e,t){let r=Date.now(),n=r-t,i=r;return!(e<n)&&(!(e>i)||(tV(`Detected an update time that is in the future: ${e} > ${i}`),!1))}attachVisibilityHandler(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.documentVisibilityHandler=()=>{this.queue.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.updateClientMetadataAndTryBecomePrimary()))},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground="visible"===this.document.visibilityState)}detachVisibilityHandler(){this.documentVisibilityHandler&&(this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)}attachWindowUnloadHook(){"function"==typeof this.window?.addEventListener&&(this.windowUnloadHandler=()=>{this.markClientZombied();let e=/(?:Version|Mobile)\/1[456]/;P()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.queue.enterRestrictedMode(!0),this.queue.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.windowUnloadHandler))}detachWindowUnloadHook(){this.windowUnloadHandler&&(this.window.removeEventListener("pagehide",this.windowUnloadHandler),this.windowUnloadHandler=null)}isClientZombied(e){try{let t=this.webStorage?.getItem(this.zombiedClientLocalStorageKey(e))!==null;return tj(dO,`Client '${e}' ${t?"is":"is not"} zombied in LocalStorage`),t}catch(e){return tV(dO,"Failed to get zombied client id.",e),!1}}markClientZombied(){if(this.webStorage)try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(e){tV("Failed to set zombie client id.",e)}}removeClientZombiedEntry(){if(this.webStorage)try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch(e){}}zombiedClientLocalStorageKey(e){return`${dF}_${this.persistenceKey}_${e}`}}function dz(e){return iN(e,nI)}function dq(e){return iN(e,n4)}function dU(e,t){let r=e.projectId;return e.isDefaultDatabase||(r+="."+e.database),"firestore/"+t+"/"+r+"/"}async function d$(e){if(!nt.isAvailable())return Promise.resolve();let t=e+dj;await nt.delete(t)}function dK(e,t,r,n,i){t=[...t],(e=[...e]).sort(r),t.sort(r);let s=e.length,a=t.length,o=0,l=0;for(;o<a&&l<s;){let s=r(e[l],t[o]);s<0?i(e[l++]):s>0?n(t[o++]):(o++,l++)}for(;o<a;)n(t[o++]);for(;l<s;)i(e[l++])}function dW(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}let dG="LocalStore",dH=3e8;class dQ{constructor(e,t,r,n){this.persistence=e,this.queryEngine=t,this.serializer=n,this.targetDataByTarget=new iF(rm),this.targetIdByTarget=new oh(e=>aN(e),aM),this.collectionGroupReadTime=new Map,this.remoteDocuments=e.getRemoteDocumentCache(),this.targetCache=e.getTargetCache(),this.bundleCache=e.getBundleCache(),this.initializeUserComponents(r)}initializeUserComponents(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new h6(this.remoteDocuments,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.remoteDocuments.setIndexManager(this.indexManager),this.queryEngine.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.targetDataByTarget))}}function dJ(e,t,r,n){return new dQ(e,t,r,n)}async function dY(e,t){let r=tG(e);return await r.persistence.runTransaction("Handle user change","readonly",e=>{let n;return r.mutationQueue.getAllMutationBatches(e).next(i=>(n=i,r.initializeUserComponents(t),r.mutationQueue.getAllMutationBatches(e))).next(t=>{let i=[],s=[],a=oE();for(let e of n)for(let t of(i.push(e.batchId),e.mutations))a=a.add(t.key);for(let e of t)for(let t of(s.push(e.batchId),e.mutations))a=a.add(t.key);return r.localDocuments.getDocuments(e,a).next(e=>({affectedDocuments:e,removedBatchIds:i,addedBatchIds:s}))})})}function dX(e,t){let r,n,i=tG(e),s=rz.now(),a=t.reduce((e,t)=>e.add(t.key),oE());return i.persistence.runTransaction("Locally write mutations","readwrite",e=>{let o=of(),l=oE();return i.remoteDocuments.getEntries(e,a).next(e=>{(o=e).forEach((e,t)=>{t.isValidDocument()||(l=l.add(e))})}).next(()=>i.localDocuments.getOverlayedDocuments(e,o)).next(n=>{r=n;let a=[];for(let e of t){let t=o0(e,r.get(e.key).overlayedDocument);null!=t&&a.push(new o4(e.key,t,s5(t.value.mapValue),oH.exists(!0)))}return i.mutationQueue.addMutationBatch(e,s,a,t)}).next(t=>{n=t;let s=t.applyToLocalDocumentSet(r,l);return i.documentOverlayCache.saveOverlays(e,t.batchId,s)})}).then(()=>({batchId:n.batchId,changes:oy(r)}))}function dZ(e,t){let r=tG(e);return r.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{let n=t.batch.keys(),i=r.remoteDocuments.newChangeBuffer({trackRemovals:!0});return fi(r,e,t,i).next(()=>i.apply(e)).next(()=>r.mutationQueue.performConsistencyCheck(e)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(e,n,t.batch.batchId)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,d0(t))).next(()=>r.localDocuments.getDocuments(e,n))})}function d0(e){let t=oE();for(let r=0;r<e.mutationResults.length;++r)e.mutationResults[r].transformResults.length>0&&(t=t.add(e.batch.mutations[r].key));return t}function d1(e,t){let r=tG(e);return r.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let n;return r.mutationQueue.lookupMutationBatch(e,t).next(t=>(tK(null!==t,37113),n=t.keys(),r.mutationQueue.removeMutationBatch(e,t))).next(()=>r.mutationQueue.performConsistencyCheck(e)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(e,n,t)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,n)).next(()=>r.localDocuments.getDocuments(e,n))})}function d2(e){let t=tG(e);return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",e=>t.mutationQueue.getHighestUnacknowledgedBatchId(e))}function d3(e){let t=tG(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.targetCache.getLastRemoteSnapshotVersion(e))}function d6(e,t){let r=tG(e),n=t.snapshotVersion,i=r.targetDataByTarget;return r.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{let s=r.remoteDocuments.newChangeBuffer({trackRemovals:!0});i=r.targetDataByTarget;let a=[];t.targetChanges.forEach((s,o)=>{let l=i.get(o);if(!l)return;a.push(r.targetCache.removeMatchingKeys(e,s.removedDocuments,o).next(()=>r.targetCache.addMatchingKeys(e,s.addedDocuments,o)));let u=l.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(o)?u=u.withResumeToken(iJ.EMPTY_BYTE_STRING,rq.min()).withLastLimboFreeSnapshotVersion(rq.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,n)),i=i.insert(o,u),d5(l,u,s)&&a.push(r.targetCache.updateTargetData(e,u))});let o=of(),l=oE();if(t.documentUpdates.forEach(n=>{t.resolvedLimboDocuments.has(n)&&a.push(r.persistence.referenceDelegate.updateLimboDocument(e,n))}),a.push(d4(e,s,t.documentUpdates).next(e=>{o=e.changedDocuments,l=e.existenceChangedKeys})),!n.isEqual(rq.min())){let t=r.targetCache.getLastRemoteSnapshotVersion(e).next(t=>r.targetCache.setTargetsMetadata(e,e.currentSequenceNumber,n));a.push(t)}return r8.waitFor(a).next(()=>s.apply(e)).next(()=>r.localDocuments.getLocalViewOfDocuments(e,o,l)).next(()=>o)}).then(e=>(r.targetDataByTarget=i,e))}function d4(e,t,r){let n=oE(),i=oE();return r.forEach(e=>n=n.add(e)),t.getEntries(e,n).next(e=>{let n=of();return r.forEach((r,s)=>{let a=e.get(r);s.isFoundDocument()!==a.isFoundDocument()&&(i=i.add(r)),s.isNoDocument()&&s.version.isEqual(rq.min())?(t.removeEntry(r,s.readTime),n=n.insert(r,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(s),n=n.insert(r,s)):tj(dG,"Ignoring outdated watch update for ",r,". Current version:",a.version," Watch version:",s.version)}),{changedDocuments:n,existenceChangedKeys:i}})}function d5(e,t,r){return!!(0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=dH)||r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size>0}async function d8(e,t){let r=tG(e);try{await r.persistence.runTransaction("notifyLocalViewChanges","readwrite",e=>r8.forEach(t,t=>r8.forEach(t.addedKeys,n=>r.persistence.referenceDelegate.addReference(e,t.targetId,n)).next(()=>r8.forEach(t.removedKeys,n=>r.persistence.referenceDelegate.removeReference(e,t.targetId,n)))))}catch(e){if(ns(e))tj(dG,"Failed to update sequence numbers: "+e);else throw e}for(let e of t){let t=e.targetId;if(!e.fromCache){let e=r.targetDataByTarget.get(t),n=e.snapshotVersion,i=e.withLastLimboFreeSnapshotVersion(n);r.targetDataByTarget=r.targetDataByTarget.insert(t,i)}}}function d7(e,t){let r=tG(e);return r.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=ss),r.mutationQueue.getNextMutationBatchAfterBatchId(e,t)))}function d9(e,t){let r=tG(e);return r.persistence.runTransaction("read document","readonly",e=>r.localDocuments.getDocument(e,t))}function fe(e,t){let r=tG(e);return r.persistence.runTransaction("Allocate target","readwrite",e=>{let n;return r.targetCache.getTargetData(e,t).next(i=>i?(n=i,r8.resolve(n)):r.targetCache.allocateTargetId(e).next(i=>(n=new uG(t,i,"TargetPurposeListen",e.currentSequenceNumber),r.targetCache.addTargetData(e,n).next(()=>n))))}).then(e=>{let n=r.targetDataByTarget.get(e.targetId);return(null===n||e.snapshotVersion.compareTo(n.snapshotVersion)>0)&&(r.targetDataByTarget=r.targetDataByTarget.insert(e.targetId,e),r.targetIdByTarget.set(t,e.targetId)),e})}function ft(e,t,r){let n=tG(e),i=n.targetIdByTarget.get(r);return void 0!==i?r8.resolve(n.targetDataByTarget.get(i)):n.targetCache.getTargetData(t,r)}async function fr(e,t,r){let n=tG(e),i=n.targetDataByTarget.get(t),s=r?"readwrite":"readwrite-primary";try{r||await n.persistence.runTransaction("Release target",s,e=>n.persistence.referenceDelegate.removeTarget(e,i))}catch(e){if(ns(e))tj(dG,`Failed to update sequence numbers for target ${t}: ${e}`);else throw e}n.targetDataByTarget=n.targetDataByTarget.remove(t),n.targetIdByTarget.delete(i.target)}function fn(e,t,r){let n=tG(e),i=rq.min(),s=oE();return n.persistence.runTransaction("Execute query","readwrite",e=>ft(n,e,a2(t)).next(t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,n.targetCache.getMatchingKeysForTargetId(e,t.targetId).next(e=>{s=e})}).next(()=>n.queryEngine.getDocumentsMatchingQuery(e,t,r?i:rq.min(),r?s:oE())).next(e=>(fc(n,ol(t),e),{documents:e,remoteKeys:s})))}function fi(e,t,r,n){let i=r.batch,s=i.keys(),a=r8.resolve();return s.forEach(e=>{a=a.next(()=>n.getEntry(t,e)).next(t=>{let s=r.docVersions.get(e);tK(null!==s,48541),0>t.version.compareTo(s)&&(i.applyToRemoteDocument(t,r),t.isValidDocument()&&(t.setReadTime(r.commitVersion),n.addEntry(t)))})}),a.next(()=>e.mutationQueue.removeMutationBatch(t,i))}function fs(e,t){let r=tG(e),n=tG(r.mutationQueue);return r.persistence.runTransaction("Lookup mutation documents","readonly",e=>n.lookupMutationKeys(e,t).next(t=>t?r.localDocuments.getDocuments(e,t):r8.resolve(null)))}function fa(e,t){tG(tG(e,dQ).mutationQueue).removeCachedMutationKeys(t)}function fo(e){return tG(tG(e,dQ).persistence).getActiveClients()}function fl(e,t){let r=tG(e),n=tG(r.targetCache),i=r.targetDataByTarget.get(t);return i?Promise.resolve(i.target):r.persistence.runTransaction("Get target data","readonly",e=>n.getTargetDataForTarget(e,t).next(e=>e?e.target:null))}function fu(e,t){let r=tG(e),n=r.collectionGroupReadTime.get(t)||rq.min();return r.persistence.runTransaction("Get new document changes","readonly",e=>r.remoteDocuments.getAllFromCollectionGroup(e,t,r0(n,rU),Number.MAX_SAFE_INTEGER)).then(e=>(fc(r,t,e),e))}function fc(e,t,r){let n=e.collectionGroupReadTime.get(t)||rq.min();r.forEach((e,t)=>{t.readTime.compareTo(n)>0&&(n=t.readTime)}),e.collectionGroupReadTime.set(t,n)}function fh(e){return a2(aH(rE.fromString(`__bundle__/docs/${e}`)))}async function fd(e,t,r,n){let i=tG(e),s=oE(),a=of();for(let e of r){let r=t.toDocumentKey(e.metadata.name);e.document&&(s=s.add(r));let n=t.toMutableDocument(e);n.setReadTime(t.toSnapshotVersion(e.metadata.readTime)),a=a.insert(r,n)}let o=i.remoteDocuments.newChangeBuffer({trackRemovals:!0}),l=await fe(i,fh(n));return i.persistence.runTransaction("Apply bundle documents","readwrite",e=>d4(e,o,a).next(t=>(o.apply(e),t)).next(t=>i.targetCache.removeMatchingKeysForTargetId(e,l.targetId).next(()=>i.targetCache.addMatchingKeys(e,s,l.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(e,t.changedDocuments,t.existenceChangedKeys)).next(()=>t.changedDocuments)))}function ff(e,t){let r=tG(e),n=lW(t.createTime);return r.persistence.runTransaction("hasNewerBundle","readonly",e=>r.bundleCache.getBundleMetadata(e,t.id)).then(e=>!!e&&e.createTime.compareTo(n)>=0)}function fp(e,t){let r=tG(e);return r.persistence.runTransaction("Save bundle","readwrite",e=>r.bundleCache.saveBundleMetadata(e,t))}function fm(e,t){let r=tG(e);return r.persistence.runTransaction("Get named query","readonly",e=>r.bundleCache.getNamedQuery(e,t))}async function fg(e,t,r=oE()){let n=await fe(e,a2(ce(t.bundledQuery))),i=tG(e);return i.persistence.runTransaction("Save named query","readwrite",e=>{let s=lW(t.readTime);if(n.snapshotVersion.compareTo(s)>=0)return i.bundleCache.saveNamedQuery(e,t);let a=n.withResumeToken(iJ.EMPTY_BYTE_STRING,s);return i.targetDataByTarget=i.targetDataByTarget.insert(a.targetId,a),i.targetCache.updateTargetData(e,a).next(()=>i.targetCache.removeMatchingKeysForTargetId(e,n.targetId)).next(()=>i.targetCache.addMatchingKeys(e,r,n.targetId)).next(()=>i.bundleCache.saveNamedQuery(e,t))})}async function fy(e,t){let r=tG(e),n=r.indexManager,i=[];return r.persistence.runTransaction("Configure indexes","readwrite",e=>n.getFieldIndexes(e).next(r=>dK(r,t,rQ,t=>{i.push(n.addFieldIndex(e,t))},t=>{i.push(n.deleteFieldIndex(e,t))})).next(()=>r8.waitFor(i)))}function fv(e,t){tG(e).queryEngine.indexAutoCreationEnabled=t}function fb(e){let t=tG(e),r=t.indexManager;return t.persistence.runTransaction("Delete All Indexes","readwrite",e=>r.deleteAllFieldIndexes(e))}class fS{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}let fw=100;function fC(){return P()?8:nr(_())>0?6:4}class fT{constructor(){this.initialized=!1,this.indexAutoCreationEnabled=!1,this.indexAutoCreationMinCollectionSize=fw,this.relativeIndexReadCostPerDocument=fC()}initialize(e,t){this.localDocumentsView=e,this.indexManager=t,this.initialized=!0}getDocumentsMatchingQuery(e,t,r,n){let i={result:null};return this.performQueryUsingIndex(e,t).next(e=>{i.result=e}).next(()=>{if(!i.result)return this.performQueryUsingRemoteKeys(e,t,n,r).next(e=>{i.result=e})}).next(()=>{if(i.result)return;let r=new fS;return this.executeFullCollectionScan(e,t,r).next(n=>{if(i.result=n,this.indexAutoCreationEnabled)return this.createCacheIndexes(e,t,r,n.size)})}).next(()=>i.result)}createCacheIndexes(e,t,r,n){return r.documentReadCount<this.indexAutoCreationMinCollectionSize?(tB()<=tb.DEBUG&&tj("QueryEngine","SDK will not create cache indexes for query:",or(t),"since it only creates cache indexes for collection contains","more than or equal to",this.indexAutoCreationMinCollectionSize,"documents"),r8.resolve()):(tB()<=tb.DEBUG&&tj("QueryEngine","Query:",or(t),"scans",r.documentReadCount,"local documents and returns",n,"documents as results."),r.documentReadCount>this.relativeIndexReadCostPerDocument*n)?(tB()<=tb.DEBUG&&tj("QueryEngine","The SDK decides to create cache indexes for query:",or(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,a2(t))):r8.resolve()}performQueryUsingIndex(e,t){if(aJ(t))return r8.resolve(null);let r=a2(t);return this.indexManager.getIndexType(e,r).next(n=>0===n?null:(null!==t.limit&&1===n&&(r=a2(t=a8(t,null,"F"))),this.indexManager.getDocumentsMatchingTarget(e,r).next(n=>{let i=oE(...n);return this.localDocumentsView.getDocuments(e,i).next(n=>this.indexManager.getMinOffset(e,r).next(r=>{let s=this.applyQuery(t,n);return this.needsRefill(t,s,i,r.readTime)?this.performQueryUsingIndex(e,a8(t,null,"F")):this.appendRemainingResults(e,s,t,r)}))})))}performQueryUsingRemoteKeys(e,t,r,n){return aJ(t)||n.isEqual(rq.min())?r8.resolve(null):this.localDocumentsView.getDocuments(e,r).next(i=>{let s=this.applyQuery(t,i);return this.needsRefill(t,s,r,n)?r8.resolve(null):(tB()<=tb.DEBUG&&tj("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),or(t)),this.appendRemainingResults(e,s,t,r0(n,rU)).next(e=>e))})}applyQuery(e,t){let r=new iq(ou(e));return t.forEach((t,n)=>{on(e,n)&&(r=r.add(n))}),r}needsRefill(e,t,r,n){if(null===e.limit)return!1;if(r.size!==t.size)return!0;let i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(n)>0)}executeFullCollectionScan(e,t,r){return tB()<=tb.DEBUG&&tj("QueryEngine","Using full collection scan to execute query:",or(t)),this.localDocumentsView.getDocumentsMatchingQuery(e,t,r2.min(),r)}appendRemainingResults(e,t,r,n){return this.localDocumentsView.getDocumentsMatchingQuery(e,r,n).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}let fE="firestore_clients";function f_(e,t){return`${fE}_${e}_${t}`}let fI="firestore_mutations";function fk(e,t,r){let n=`${fI}_${e}_${r}`;return t.isAuthenticated()&&(n+=`_${t.uid}`),n}let fx="firestore_targets";function fR(e,t){return`${fx}_${e}_${t}`}let fD="firestore_online_state";function fA(e){return`${fD}_${e}`}let fO="firestore_bundle_loaded_v2";function fN(e){return`${fO}_${e}`}let fP="firestore_sequence_number";function fM(e){return`${fP}_${e}`}let fL="SharedClientState";class fB{constructor(e,t,r,n){this.user=e,this.batchId=t,this.state=r,this.error=n}static fromWebStorageEntry(e,t,r){let n,i=JSON.parse(r),s="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return(s&&i.error&&(s="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(n=new rt(i.error.code,i.error.message)),s)?new fB(e,t,i.state,n):(tV(fL,`Failed to parse mutation state for ID '${t}': ${r}`),null)}toWebStorageJSON(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class fF{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static fromWebStorageEntry(e,t){let r,n=JSON.parse(t),i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return(i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(r=new rt(n.error.code,n.error.message)),i)?new fF(e,n.state,r):(tV(fL,`Failed to parse target state for ID '${e}': ${t}`),null)}toWebStorageJSON(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class fj{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static fromWebStorageEntry(e,t){let r=JSON.parse(t),n="object"==typeof r&&r.activeTargetIds instanceof Array,i=oI();for(let e=0;n&&e<r.activeTargetIds.length;++e)n=sl(r.activeTargetIds[e]),i=i.add(r.activeTargetIds[e]);return n?new fj(e,i):(tV(fL,`Failed to parse client data for instance '${e}': ${t}`),null)}}class fV{constructor(e,t){this.clientId=e,this.onlineState=t}static fromWebStorageEntry(e){let t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new fV(t.clientId,t.onlineState):(tV(fL,`Failed to parse online state: ${e}`),null)}}class fz{constructor(){this.activeTargetIds=oI()}addQueryTarget(e){this.activeTargetIds=this.activeTargetIds.add(e)}removeQueryTarget(e){this.activeTargetIds=this.activeTargetIds.delete(e)}toWebStorageJSON(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class fq{constructor(e,t,r,n,i){this.window=e,this.queue=t,this.persistenceKey=r,this.localClientId=n,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.storageListener=this.handleWebStorageEvent.bind(this),this.activeClients=new iF(rm),this.started=!1,this.earlyEvents=[];const s=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.localClientStorageKey=f_(this.persistenceKey,this.localClientId),this.sequenceNumberKey=fM(this.persistenceKey),this.activeClients=this.activeClients.insert(this.localClientId,new fz),this.clientStateKeyRe=RegExp(`^${fE}_${s}_([^_]*)$`),this.mutationBatchKeyRe=RegExp(`^${fI}_${s}_(\\d+)(?:_(.*))?$`),this.queryTargetKeyRe=RegExp(`^${fx}_${s}_(\\d+)$`),this.onlineStateKey=fA(this.persistenceKey),this.bundleLoadedKey=fN(this.persistenceKey),this.window.addEventListener("storage",this.storageListener)}static isAvailable(e){return!!(e&&e.localStorage)}async start(){for(let e of(await this.syncEngine.getActiveClients())){if(e===this.localClientId)continue;let t=this.getItem(f_(this.persistenceKey,e));if(t){let r=fj.fromWebStorageEntry(e,t);r&&(this.activeClients=this.activeClients.insert(r.clientId,r))}}this.persistClientState();let e=this.storage.getItem(this.onlineStateKey);if(e){let t=this.fromWebStorageOnlineState(e);t&&this.handleOnlineStateEvent(t)}for(let e of this.earlyEvents)this.handleWebStorageEvent(e);this.earlyEvents=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.sequenceNumberKey,JSON.stringify(e))}getAllActiveQueryTargets(){return this.extractActiveQueryTargets(this.activeClients)}isActiveQueryTarget(e){let t=!1;return this.activeClients.forEach((r,n)=>{n.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.persistMutationState(e,"pending")}updateMutationState(e,t,r){this.persistMutationState(e,t,r),this.removeMutationState(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){let t=this.storage.getItem(fR(this.persistenceKey,e));if(t){let n=fF.fromWebStorageEntry(e,t);n&&(r=n.state)}}return t&&this.localClientState.addQueryTarget(e),this.persistClientState(),r}removeLocalQueryTarget(e){this.localClientState.removeQueryTarget(e),this.persistClientState()}isLocalQueryTarget(e){return this.localClientState.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(fR(this.persistenceKey,e))}updateQueryState(e,t,r){this.persistQueryTargetState(e,t,r)}handleUserChange(e,t,r){t.forEach(e=>{this.removeMutationState(e)}),this.currentUser=e,r.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.persistOnlineState(e)}notifyBundleLoaded(e){this.persistBundleLoadedState(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return tj(fL,"READ",e,t),t}setItem(e,t){tj(fL,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){tj(fL,"REMOVE",e),this.storage.removeItem(e)}handleWebStorageEvent(e){let t=e;if(t.storageArea===this.storage){if(tj(fL,"EVENT",t.key,t.newValue),t.key===this.localClientStorageKey)return void tV("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.queue.enqueueRetryable(async()=>{if(!this.started)return void this.earlyEvents.push(t);if(null!==t.key){if(this.clientStateKeyRe.test(t.key))if(null!=t.newValue){let e=this.fromWebStorageClientState(t.key,t.newValue);if(e)return this.handleClientStateEvent(e.clientId,e)}else{let e=this.fromWebStorageClientStateKey(t.key);return this.handleClientStateEvent(e,null)}else if(this.mutationBatchKeyRe.test(t.key)){if(null!==t.newValue){let e=this.fromWebStorageMutationMetadata(t.key,t.newValue);if(e)return this.handleMutationBatchEvent(e)}}else if(this.queryTargetKeyRe.test(t.key)){if(null!==t.newValue){let e=this.fromWebStorageQueryTargetMetadata(t.key,t.newValue);if(e)return this.handleQueryTargetEvent(e)}}else if(t.key===this.onlineStateKey){if(null!==t.newValue){let e=this.fromWebStorageOnlineState(t.newValue);if(e)return this.handleOnlineStateEvent(e)}}else if(t.key===this.sequenceNumberKey){let e=fU(t.newValue);e!==ng.INVALID&&this.sequenceNumberHandler(e)}else if(t.key===this.bundleLoadedKey){let e=this.fromWebStoreBundleLoadedState(t.newValue);await Promise.all(e.map(e=>this.syncEngine.synchronizeWithChangedDocuments(e)))}}})}}get localClientState(){return this.activeClients.get(this.localClientId)}persistClientState(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())}persistMutationState(e,t,r){let n=new fB(this.currentUser,e,t,r),i=fk(this.persistenceKey,this.currentUser,e);this.setItem(i,n.toWebStorageJSON())}removeMutationState(e){let t=fk(this.persistenceKey,this.currentUser,e);this.removeItem(t)}persistOnlineState(e){let t={clientId:this.localClientId,onlineState:e};this.storage.setItem(this.onlineStateKey,JSON.stringify(t))}persistQueryTargetState(e,t,r){let n=fR(this.persistenceKey,e),i=new fF(e,t,r);this.setItem(n,i.toWebStorageJSON())}persistBundleLoadedState(e){let t=JSON.stringify(Array.from(e));this.setItem(this.bundleLoadedKey,t)}fromWebStorageClientStateKey(e){let t=this.clientStateKeyRe.exec(e);return t?t[1]:null}fromWebStorageClientState(e,t){let r=this.fromWebStorageClientStateKey(e);return fj.fromWebStorageEntry(r,t)}fromWebStorageMutationMetadata(e,t){let r=this.mutationBatchKeyRe.exec(e),n=Number(r[1]),i=void 0!==r[2]?r[2]:null;return fB.fromWebStorageEntry(new tO(i),n,t)}fromWebStorageQueryTargetMetadata(e,t){let r=Number(this.queryTargetKeyRe.exec(e)[1]);return fF.fromWebStorageEntry(r,t)}fromWebStorageOnlineState(e){return fV.fromWebStorageEntry(e)}fromWebStoreBundleLoadedState(e){return JSON.parse(e)}async handleMutationBatchEvent(e){return e.user.uid!==this.currentUser.uid?void tj(fL,`Ignoring mutation for non-active user ${e.user.uid}`):this.syncEngine.applyBatchState(e.batchId,e.state,e.error)}handleQueryTargetEvent(e){return this.syncEngine.applyTargetState(e.targetId,e.state,e.error)}handleClientStateEvent(e,t){let r=t?this.activeClients.insert(e,t):this.activeClients.remove(e),n=this.extractActiveQueryTargets(this.activeClients),i=this.extractActiveQueryTargets(r),s=[],a=[];return i.forEach(e=>{n.has(e)||s.push(e)}),n.forEach(e=>{i.has(e)||a.push(e)}),this.syncEngine.applyActiveTargetsChange(s,a).then(()=>{this.activeClients=r})}handleOnlineStateEvent(e){this.activeClients.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}extractActiveQueryTargets(e){let t=oI();return e.forEach((e,r)=>{t=t.unionWith(r.activeTargetIds)}),t}}function fU(e){let t=ng.INVALID;if(null!=e)try{let r=JSON.parse(e);tK("number"==typeof r,30636,{seqString:e}),t=r}catch(e){tV(fL,"Failed to read sequence number from WebStorage",e)}return t}class f${constructor(){this.localState=new fz,this.queryState={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.localState.addQueryTarget(e),this.queryState[e]||"not-current"}updateQueryState(e,t,r){this.queryState[e]=t}removeLocalQueryTarget(e){this.localState.removeQueryTarget(e)}isLocalQueryTarget(e){return this.localState.activeTargetIds.has(e)}clearQueryState(e){delete this.queryState[e]}getAllActiveQueryTargets(){return this.localState.activeTargetIds}isActiveQueryTarget(e){return this.localState.activeTargetIds.has(e)}start(){return this.localState=new fz,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class fK{addCallback(e){}shutdown(){}}class fW{constructor(e){this.sendFn=e.sendFn,this.closeFn=e.closeFn}onConnected(e){this.wrappedOnConnected=e}onOpen(e){this.wrappedOnOpen=e}onClose(e){this.wrappedOnClose=e}onMessage(e){this.wrappedOnMessage=e}close(){this.closeFn()}send(e){this.sendFn(e)}callOnConnected(){this.wrappedOnConnected()}callOnOpen(){this.wrappedOnOpen()}callOnClose(e){this.wrappedOnClose(e)}callOnMessage(e){this.wrappedOnMessage(e)}}let fG=null;function fH(){return 0x10000000+Math.round(0x80000000*Math.random())}function fQ(){return null===fG?fG=fH():fG++,"0x"+fG.toString(16)}function fJ(e){return new Promise((t,r)=>{e((e,n)=>{e?r(e):t(n)})})}let fY="1.9.15",fX="GrpcConnection",fZ=`gl-node/${process.versions.node} fire/${tN} grpc/${fY}`;function f0(e,t,r,n){tK(null===t||"OAuth"===t.type,36936);let i=new tx.Metadata;return t&&t.headers.forEach((e,t)=>i.set(t,e)),r&&r.headers.forEach((e,t)=>i.set(t,e)),n&&i.set("X-Firebase-GMPID",n),i.set("X-Goog-Api-Client",fZ),i.set("Google-Cloud-Resource-Prefix",e),i.set("x-goog-request-params",e),i}class f1{get shouldResourcePathBeIncludedInRequest(){return!0}constructor(e,t){this.databaseInfo=t,this.cachedStub=null,this.firestore=e.google.firestore.v1,this.databasePath=`projects/${t.databaseId.projectId}/databases/${t.databaseId.database}`}ensureActiveStub(){if(!this.cachedStub){tj(fX,"Creating Firestore stub.");let e=this.databaseInfo.ssl?tx.credentials.createSsl():tx.credentials.createInsecure();this.cachedStub=new this.firestore.Firestore(this.databaseInfo.host,e)}return this.cachedStub}invokeRPC(e,t,r,n,i){let s=fQ(),a=this.ensureActiveStub(),o=f0(this.databasePath,n,i,this.databaseInfo.appId),l={database:this.databasePath,...r};return fJ(t=>(tj(fX,`RPC '${e}' ${s} invoked with request:`,r),a[e](l,o,(r,n)=>{r?(tj(fX,`RPC '${e}' ${s} failed with error:`,r),t(new rt(lh(r.code),r.message))):(tj(fX,`RPC '${e}' ${s} completed with response:`,n),t(void 0,n))})))}invokeStreamingRPC(e,t,r,n,i,s){let a=fQ(),o=[],l=new rr;tj(fX,`RPC '${e}' ${a} invoked (streaming) with request:`,r);let u=this.ensureActiveStub(),c=f0(this.databasePath,n,i,this.databaseInfo.appId),h={...r,database:this.databasePath},d=u[e](h,c),f=!1;return d.on("data",t=>{tj(fX,`RPC ${e} ${a} received result:`,t),o.push(t),void 0!==s&&o.length===s&&(f=!0,l.resolve(o))}),d.on("end",()=>{tj(fX,`RPC '${e}' ${a} completed.`),f||(f=!0,l.resolve(o))}),d.on("error",t=>{tj(fX,`RPC '${e}' ${a} failed with error:`,t);let r=lh(t.code);l.reject(new rt(r,t.message))}),l.promise}openStream(e,t,r){let n=fQ(),i=this.ensureActiveStub(),s=f0(this.databasePath,t,r,this.databaseInfo.appId),a=i[e](s),o=!1,l=e=>{o||(o=!0,u.callOnClose(e),a.end())},u=new fW({sendFn:t=>{if(o)tj(fX,`RPC '${e}' stream ${n} not sending because gRPC stream is closed:`,t);else{tj(fX,`RPC '${e}' stream ${n} sending:`,t);try{a.write(t)}catch(e){throw tV("Failure sending:",t),tV("Error:",e),e}}},closeFn:()=>{tj(fX,`RPC '${e}' stream ${n} closed locally via close().`),l()}}),c=!1;return a.on("data",t=>{o||(tj(fX,`RPC '${e}' stream ${n} received:`,t),c||(u.callOnConnected(),c=!0),u.callOnMessage(t))}),a.on("end",()=>{tj(fX,`RPC '${e}' stream ${n} ended.`),l()}),a.on("error",t=>{o||(tz(fX,`RPC '${e}' stream ${n} error. Code:`,t.code,"Message:",t.message),l(new rt(lh(t.code),t.message)))}),tj(fX,`Opening RPC '${e}' stream ${n} to ${this.databaseInfo.host}`),setTimeout(()=>{u.callOnOpen()},0),u}terminate(){this.cachedStub&&(this.cachedStub.close(),this.cachedStub=void 0)}}let f2={google:{nested:{protobuf:{options:{csharp_namespace:"Google.Protobuf.WellKnownTypes",go_package:"github.com/golang/protobuf/ptypes/wrappers",java_package:"com.google.protobuf",java_outer_classname:"WrappersProto",java_multiple_files:!0,objc_class_prefix:"GPB",cc_enable_arenas:!0,optimize_for:"SPEED"},nested:{Timestamp:{fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}},FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}},Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},Empty:{fields:{}},DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}},Any:{fields:{typeUrl:{type:"string",id:1},value:{type:"bytes",id:2}}}}},firestore:{nested:{v1:{options:{csharp_namespace:"Google.Cloud.Firestore.V1",go_package:"google.golang.org/genproto/googleapis/firestore/v1;firestore",java_multiple_files:!0,java_outer_classname:"WriteProto",java_package:"com.google.firestore.v1",objc_class_prefix:"GCFS",php_namespace:"Google\\Cloud\\Firestore\\V1",ruby_package:"Google::Cloud::Firestore::V1"},nested:{AggregationResult:{fields:{aggregateFields:{keyType:"string",type:"Value",id:2}}},BitSequence:{fields:{bitmap:{type:"bytes",id:1},padding:{type:"int32",id:2}}},BloomFilter:{fields:{bits:{type:"BitSequence",id:1},hashCount:{type:"int32",id:2}}},DocumentMask:{fields:{fieldPaths:{rule:"repeated",type:"string",id:1}}},Precondition:{oneofs:{conditionType:{oneof:["exists","updateTime"]}},fields:{exists:{type:"bool",id:1},updateTime:{type:"google.protobuf.Timestamp",id:2}}},TransactionOptions:{oneofs:{mode:{oneof:["readOnly","readWrite"]}},fields:{readOnly:{type:"ReadOnly",id:2},readWrite:{type:"ReadWrite",id:3}},nested:{ReadWrite:{fields:{retryTransaction:{type:"bytes",id:1}}},ReadOnly:{oneofs:{consistencySelector:{oneof:["readTime"]}},fields:{readTime:{type:"google.protobuf.Timestamp",id:2}}}}},Document:{fields:{name:{type:"string",id:1},fields:{keyType:"string",type:"Value",id:2},createTime:{type:"google.protobuf.Timestamp",id:3},updateTime:{type:"google.protobuf.Timestamp",id:4}}},Value:{oneofs:{valueType:{oneof:["nullValue","booleanValue","integerValue","doubleValue","timestampValue","stringValue","bytesValue","referenceValue","geoPointValue","arrayValue","mapValue"]}},fields:{nullValue:{type:"google.protobuf.NullValue",id:11},booleanValue:{type:"bool",id:1},integerValue:{type:"int64",id:2},doubleValue:{type:"double",id:3},timestampValue:{type:"google.protobuf.Timestamp",id:10},stringValue:{type:"string",id:17},bytesValue:{type:"bytes",id:18},referenceValue:{type:"string",id:5},geoPointValue:{type:"google.type.LatLng",id:8},arrayValue:{type:"ArrayValue",id:9},mapValue:{type:"MapValue",id:6}}},ArrayValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},MapValue:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Firestore:{options:{"(google.api.default_host)":"firestore.googleapis.com","(google.api.oauth_scopes)":"https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/datastore"},methods:{GetDocument:{requestType:"GetDocumentRequest",responseType:"Document",options:{"(google.api.http).get":"/v1/{name=projects/*/databases/*/documents/*/**}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{name=projects/*/databases/*/documents/*/**}"}}]},ListDocuments:{requestType:"ListDocumentsRequest",responseType:"ListDocumentsResponse",options:{"(google.api.http).get":"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"}}]},UpdateDocument:{requestType:"UpdateDocumentRequest",responseType:"Document",options:{"(google.api.http).patch":"/v1/{document.name=projects/*/databases/*/documents/*/**}","(google.api.http).body":"document","(google.api.method_signature)":"document,update_mask"},parsedOptions:[{"(google.api.http)":{patch:"/v1/{document.name=projects/*/databases/*/documents/*/**}",body:"document"}},{"(google.api.method_signature)":"document,update_mask"}]},DeleteDocument:{requestType:"DeleteDocumentRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).delete":"/v1/{name=projects/*/databases/*/documents/*/**}","(google.api.method_signature)":"name"},parsedOptions:[{"(google.api.http)":{delete:"/v1/{name=projects/*/databases/*/documents/*/**}"}},{"(google.api.method_signature)":"name"}]},BatchGetDocuments:{requestType:"BatchGetDocumentsRequest",responseType:"BatchGetDocumentsResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchGet","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchGet",body:"*"}}]},BeginTransaction:{requestType:"BeginTransactionRequest",responseType:"BeginTransactionResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:beginTransaction","(google.api.http).body":"*","(google.api.method_signature)":"database"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:beginTransaction",body:"*"}},{"(google.api.method_signature)":"database"}]},Commit:{requestType:"CommitRequest",responseType:"CommitResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:commit","(google.api.http).body":"*","(google.api.method_signature)":"database,writes"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:commit",body:"*"}},{"(google.api.method_signature)":"database,writes"}]},Rollback:{requestType:"RollbackRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:rollback","(google.api.http).body":"*","(google.api.method_signature)":"database,transaction"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:rollback",body:"*"}},{"(google.api.method_signature)":"database,transaction"}]},RunQuery:{requestType:"RunQueryRequest",responseType:"RunQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery",body:"*"}}}]},RunAggregationQuery:{requestType:"RunAggregationQueryRequest",responseType:"RunAggregationQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery",body:"*"}}}]},PartitionQuery:{requestType:"PartitionQueryRequest",responseType:"PartitionQueryResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:partitionQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:partitionQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery",body:"*"}}}]},Write:{requestType:"WriteRequest",requestStream:!0,responseType:"WriteResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:write","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:write",body:"*"}}]},Listen:{requestType:"ListenRequest",requestStream:!0,responseType:"ListenResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:listen","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:listen",body:"*"}}]},ListCollectionIds:{requestType:"ListCollectionIdsRequest",responseType:"ListCollectionIdsResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds","(google.api.http).additional_bindings.body":"*","(google.api.method_signature)":"parent"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds",body:"*"}}},{"(google.api.method_signature)":"parent"}]},BatchWrite:{requestType:"BatchWriteRequest",responseType:"BatchWriteResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchWrite","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchWrite",body:"*"}}]},CreateDocument:{requestType:"CreateDocumentRequest",responseType:"Document",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}","(google.api.http).body":"document"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}",body:"document"}}]}}},GetDocumentRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:5}}},ListDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:3},pageToken:{type:"string",id:4},orderBy:{type:"string",id:6},mask:{type:"DocumentMask",id:7},transaction:{type:"bytes",id:8},readTime:{type:"google.protobuf.Timestamp",id:10},showMissing:{type:"bool",id:12}}},ListDocumentsResponse:{fields:{documents:{rule:"repeated",type:"Document",id:1},nextPageToken:{type:"string",id:2}}},CreateDocumentRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},documentId:{type:"string",id:3},document:{type:"Document",id:4,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:5}}},UpdateDocumentRequest:{fields:{document:{type:"Document",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},updateMask:{type:"DocumentMask",id:2},mask:{type:"DocumentMask",id:3},currentDocument:{type:"Precondition",id:4}}},DeleteDocumentRequest:{fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},currentDocument:{type:"Precondition",id:2}}},BatchGetDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},documents:{rule:"repeated",type:"string",id:2},mask:{type:"DocumentMask",id:3},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:7}}},BatchGetDocumentsResponse:{oneofs:{result:{oneof:["found","missing"]}},fields:{found:{type:"Document",id:1},missing:{type:"string",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:4}}},BeginTransactionRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},options:{type:"TransactionOptions",id:2}}},BeginTransactionResponse:{fields:{transaction:{type:"bytes",id:1}}},CommitRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},transaction:{type:"bytes",id:3}}},CommitResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},commitTime:{type:"google.protobuf.Timestamp",id:2}}},RollbackRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},transaction:{type:"bytes",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}}}},RunQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},transaction:{type:"bytes",id:5},newTransaction:{type:"TransactionOptions",id:6},readTime:{type:"google.protobuf.Timestamp",id:7}}},RunQueryResponse:{fields:{transaction:{type:"bytes",id:2},document:{type:"Document",id:1},readTime:{type:"google.protobuf.Timestamp",id:3},skippedResults:{type:"int32",id:4}}},RunAggregationQueryRequest:{oneofs:{queryType:{oneof:["structuredAggregationQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredAggregationQuery:{type:"StructuredAggregationQuery",id:2},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:6}}},RunAggregationQueryResponse:{fields:{result:{type:"AggregationResult",id:1},transaction:{type:"bytes",id:2},readTime:{type:"google.protobuf.Timestamp",id:3}}},PartitionQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},partitionCount:{type:"int64",id:3},pageToken:{type:"string",id:4},pageSize:{type:"int32",id:5}}},PartitionQueryResponse:{fields:{partitions:{rule:"repeated",type:"Cursor",id:1},nextPageToken:{type:"string",id:2}}},WriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},streamId:{type:"string",id:2},writes:{rule:"repeated",type:"Write",id:3},streamToken:{type:"bytes",id:4},labels:{keyType:"string",type:"string",id:5}}},WriteResponse:{fields:{streamId:{type:"string",id:1},streamToken:{type:"bytes",id:2},writeResults:{rule:"repeated",type:"WriteResult",id:3},commitTime:{type:"google.protobuf.Timestamp",id:4}}},ListenRequest:{oneofs:{targetChange:{oneof:["addTarget","removeTarget"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},addTarget:{type:"Target",id:2},removeTarget:{type:"int32",id:3},labels:{keyType:"string",type:"string",id:4}}},ListenResponse:{oneofs:{responseType:{oneof:["targetChange","documentChange","documentDelete","documentRemove","filter"]}},fields:{targetChange:{type:"TargetChange",id:2},documentChange:{type:"DocumentChange",id:3},documentDelete:{type:"DocumentDelete",id:4},documentRemove:{type:"DocumentRemove",id:6},filter:{type:"ExistenceFilter",id:5}}},Target:{oneofs:{targetType:{oneof:["query","documents"]},resumeType:{oneof:["resumeToken","readTime"]}},fields:{query:{type:"QueryTarget",id:2},documents:{type:"DocumentsTarget",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:11},targetId:{type:"int32",id:5},once:{type:"bool",id:6},expectedCount:{type:"google.protobuf.Int32Value",id:12}},nested:{DocumentsTarget:{fields:{documents:{rule:"repeated",type:"string",id:2}}},QueryTarget:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1},structuredQuery:{type:"StructuredQuery",id:2}}}}},TargetChange:{fields:{targetChangeType:{type:"TargetChangeType",id:1},targetIds:{rule:"repeated",type:"int32",id:2},cause:{type:"google.rpc.Status",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:6}},nested:{TargetChangeType:{values:{NO_CHANGE:0,ADD:1,REMOVE:2,CURRENT:3,RESET:4}}}},ListCollectionIdsRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:2},pageToken:{type:"string",id:3}}},ListCollectionIdsResponse:{fields:{collectionIds:{rule:"repeated",type:"string",id:1},nextPageToken:{type:"string",id:2}}},BatchWriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},labels:{keyType:"string",type:"string",id:3}}},BatchWriteResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},status:{rule:"repeated",type:"google.rpc.Status",id:2}}},StructuredQuery:{fields:{select:{type:"Projection",id:1},from:{rule:"repeated",type:"CollectionSelector",id:2},where:{type:"Filter",id:3},orderBy:{rule:"repeated",type:"Order",id:4},startAt:{type:"Cursor",id:7},endAt:{type:"Cursor",id:8},offset:{type:"int32",id:6},limit:{type:"google.protobuf.Int32Value",id:5}},nested:{CollectionSelector:{fields:{collectionId:{type:"string",id:2},allDescendants:{type:"bool",id:3}}},Filter:{oneofs:{filterType:{oneof:["compositeFilter","fieldFilter","unaryFilter"]}},fields:{compositeFilter:{type:"CompositeFilter",id:1},fieldFilter:{type:"FieldFilter",id:2},unaryFilter:{type:"UnaryFilter",id:3}}},CompositeFilter:{fields:{op:{type:"Operator",id:1},filters:{rule:"repeated",type:"Filter",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,AND:1,OR:2}}}},FieldFilter:{fields:{field:{type:"FieldReference",id:1},op:{type:"Operator",id:2},value:{type:"Value",id:3}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,LESS_THAN:1,LESS_THAN_OR_EQUAL:2,GREATER_THAN:3,GREATER_THAN_OR_EQUAL:4,EQUAL:5,NOT_EQUAL:6,ARRAY_CONTAINS:7,IN:8,ARRAY_CONTAINS_ANY:9,NOT_IN:10}}}},UnaryFilter:{oneofs:{operandType:{oneof:["field"]}},fields:{op:{type:"Operator",id:1},field:{type:"FieldReference",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,IS_NAN:2,IS_NULL:3,IS_NOT_NAN:4,IS_NOT_NULL:5}}}},Order:{fields:{field:{type:"FieldReference",id:1},direction:{type:"Direction",id:2}}},FieldReference:{fields:{fieldPath:{type:"string",id:2}}},Projection:{fields:{fields:{rule:"repeated",type:"FieldReference",id:2}}},Direction:{values:{DIRECTION_UNSPECIFIED:0,ASCENDING:1,DESCENDING:2}}}},StructuredAggregationQuery:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{structuredQuery:{type:"StructuredQuery",id:1},aggregations:{rule:"repeated",type:"Aggregation",id:3}},nested:{Aggregation:{oneofs:{operator:{oneof:["count","sum","avg"]}},fields:{count:{type:"Count",id:1},sum:{type:"Sum",id:2},avg:{type:"Avg",id:3},alias:{type:"string",id:7}},nested:{Count:{fields:{upTo:{type:"google.protobuf.Int64Value",id:1}}},Sum:{fields:{field:{type:"FieldReference",id:1}}},Avg:{fields:{field:{type:"FieldReference",id:1}}}}}}},Cursor:{fields:{values:{rule:"repeated",type:"Value",id:1},before:{type:"bool",id:2}}},Write:{oneofs:{operation:{oneof:["update","delete","verify","transform"]}},fields:{update:{type:"Document",id:1},delete:{type:"string",id:2},verify:{type:"string",id:5},transform:{type:"DocumentTransform",id:6},updateMask:{type:"DocumentMask",id:3},updateTransforms:{rule:"repeated",type:"DocumentTransform.FieldTransform",id:7},currentDocument:{type:"Precondition",id:4}}},DocumentTransform:{fields:{document:{type:"string",id:1},fieldTransforms:{rule:"repeated",type:"FieldTransform",id:2}},nested:{FieldTransform:{oneofs:{transformType:{oneof:["setToServerValue","increment","maximum","minimum","appendMissingElements","removeAllFromArray"]}},fields:{fieldPath:{type:"string",id:1},setToServerValue:{type:"ServerValue",id:2},increment:{type:"Value",id:3},maximum:{type:"Value",id:4},minimum:{type:"Value",id:5},appendMissingElements:{type:"ArrayValue",id:6},removeAllFromArray:{type:"ArrayValue",id:7}},nested:{ServerValue:{values:{SERVER_VALUE_UNSPECIFIED:0,REQUEST_TIME:1}}}}}},WriteResult:{fields:{updateTime:{type:"google.protobuf.Timestamp",id:1},transformResults:{rule:"repeated",type:"Value",id:2}}},DocumentChange:{fields:{document:{type:"Document",id:1},targetIds:{rule:"repeated",type:"int32",id:5},removedTargetIds:{rule:"repeated",type:"int32",id:6}}},DocumentDelete:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:6},readTime:{type:"google.protobuf.Timestamp",id:4}}},DocumentRemove:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:2},readTime:{type:"google.protobuf.Timestamp",id:4}}},ExistenceFilter:{fields:{targetId:{type:"int32",id:1},count:{type:"int32",id:2},unchangedNames:{type:"BloomFilter",id:3}}}}}}},api:{options:{go_package:"google.golang.org/genproto/googleapis/api/annotations;annotations",java_multiple_files:!0,java_outer_classname:"HttpProto",java_package:"com.google.api",objc_class_prefix:"GAPI",cc_enable_arenas:!0},nested:{http:{type:"HttpRule",id:0x44f2530,extend:"google.protobuf.MethodOptions"},Http:{fields:{rules:{rule:"repeated",type:"HttpRule",id:1}}},HttpRule:{oneofs:{pattern:{oneof:["get","put","post","delete","patch","custom"]}},fields:{get:{type:"string",id:2},put:{type:"string",id:3},post:{type:"string",id:4},delete:{type:"string",id:5},patch:{type:"string",id:6},custom:{type:"CustomHttpPattern",id:8},selector:{type:"string",id:1},body:{type:"string",id:7},additionalBindings:{rule:"repeated",type:"HttpRule",id:11}}},CustomHttpPattern:{fields:{kind:{type:"string",id:1},path:{type:"string",id:2}}},methodSignature:{rule:"repeated",type:"string",id:1051,extend:"google.protobuf.MethodOptions"},defaultHost:{type:"string",id:1049,extend:"google.protobuf.ServiceOptions"},oauthScopes:{type:"string",id:1050,extend:"google.protobuf.ServiceOptions"},fieldBehavior:{rule:"repeated",type:"google.api.FieldBehavior",id:1052,extend:"google.protobuf.FieldOptions"},FieldBehavior:{values:{FIELD_BEHAVIOR_UNSPECIFIED:0,OPTIONAL:1,REQUIRED:2,OUTPUT_ONLY:3,INPUT_ONLY:4,IMMUTABLE:5,UNORDERED_LIST:6,NON_EMPTY_DEFAULT:7}}}},type:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/type/latlng;latlng",java_multiple_files:!0,java_outer_classname:"LatLngProto",java_package:"com.google.type",objc_class_prefix:"GTP"},nested:{LatLng:{fields:{latitude:{type:"double",id:1},longitude:{type:"double",id:2}}}}},rpc:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/rpc/status;status",java_multiple_files:!0,java_outer_classname:"StatusProto",java_package:"com.google.rpc",objc_class_prefix:"RPC"},nested:{Status:{fields:{code:{type:"int32",id:1},message:{type:"string",id:2},details:{rule:"repeated",type:"google.protobuf.Any",id:3}}}}}}}};var f3={nested:f2},f6=Object.freeze({__proto__:null,nested:f2,default:f3});let f4={longs:String,enums:String,defaults:!0,oneofs:!1};function f5(){let e=tR.fromJSON(f6,f4);return tx.loadPackageDefinition(e)}function f8(e){return new f1(f5(),e)}function f7(){return new fK}function f9(){return"YES"===process.env.USE_MOCK_PERSISTENCE?window:null}function pe(){return null}function pt(e){return new lB(e,!1)}let pr="ExponentialBackoff",pn=1e3,pi=1.5,ps=6e4;class pa{constructor(e,t,r=pn,n=pi,i=ps){this.queue=e,this.timerId=t,this.initialDelayMs=r,this.backoffFactor=n,this.maxDelayMs=i,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}reset(){this.currentBaseMs=0}resetToMax(){this.currentBaseMs=this.maxDelayMs}backoffAndRun(e){this.cancel();let t=Math.floor(this.currentBaseMs+this.jitterDelayMs()),r=Math.max(0,Date.now()-this.lastAttemptTime),n=Math.max(0,t-r);n>0&&tj(pr,`Backing off for ${n} ms (base delay: ${this.currentBaseMs} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,n,()=>(this.lastAttemptTime=Date.now(),e())),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)}skipBackoff(){null!==this.timerPromise&&(this.timerPromise.skipDelay(),this.timerPromise=null)}cancel(){null!==this.timerPromise&&(this.timerPromise.cancel(),this.timerPromise=null)}jitterDelayMs(){return(Math.random()-.5)*this.currentBaseMs}}let po="PersistentStream",pl=6e4,pu=1e4;class pc{constructor(e,t,r,n,i,s,a,o){this.queue=e,this.idleTimerId=r,this.healthTimerId=n,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.closeCount=0,this.idleTimer=null,this.healthCheck=null,this.stream=null,this.responseCount=0,this.backoff=new pa(e,t)}isStarted(){return 1===this.state||5===this.state||this.isOpen()}isOpen(){return 2===this.state||3===this.state}start(){(this.responseCount=0,4===this.state)?this.performBackoff():this.auth()}async stop(){this.isStarted()&&await this.close(0)}inhibitBackoff(){this.state=0,this.backoff.reset()}markIdle(){this.isOpen()&&null===this.idleTimer&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,pl,()=>this.handleIdleCloseTimer()))}sendRequest(e){this.cancelIdleCheck(),this.stream.send(e)}async handleIdleCloseTimer(){if(this.isOpen())return this.close(0)}cancelIdleCheck(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)}cancelHealthCheck(){this.healthCheck&&(this.healthCheck.cancel(),this.healthCheck=null)}async close(e,t){this.cancelIdleCheck(),this.cancelHealthCheck(),this.backoff.cancel(),this.closeCount++,4!==e?this.backoff.reset():t&&t.code===t3?(tV(t.toString()),tV("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):t&&t.code===t2&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=e,await this.listener.onClose(t)}tearDown(){}auth(){this.state=1;let e=this.getCloseGuardedDispatcher(this.closeCount),t=this.closeCount;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,r])=>{this.closeCount===t&&this.startStream(e,r)},t=>{e(()=>{let e=new rt(tJ,"Fetching auth token failed: "+t.message);return this.handleStreamClose(e)})})}startStream(e,t){let r=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(e,t),this.stream.onConnected(()=>{r(()=>this.listener.onConnected())}),this.stream.onOpen(()=>{r(()=>(this.state=2,this.healthCheck=this.queue.enqueueAfterDelay(this.healthTimerId,pu,()=>(this.isOpen()&&(this.state=3),Promise.resolve())),this.listener.onOpen()))}),this.stream.onClose(e=>{r(()=>this.handleStreamClose(e))}),this.stream.onMessage(e=>{r(()=>1==++this.responseCount?this.onFirst(e):this.onNext(e))})}performBackoff(){this.state=5,this.backoff.backoffAndRun(async()=>{this.state=0,this.start()})}handleStreamClose(e){return tj(po,`close with error: ${e}`),this.stream=null,this.close(4,e)}getCloseGuardedDispatcher(e){return t=>{this.queue.enqueueAndForget(()=>this.closeCount===e?t():(tj(po,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class ph extends pc{constructor(e,t,r,n,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,n,s),this.serializer=i}startRpc(e,t){return this.connection.openStream("Listen",e,t)}onFirst(e){return this.onNext(e)}onNext(e){this.backoff.reset();let t=l9(this.serializer,e),r=ut(e);return this.listener.onWatchChange(t,r)}watch(e){let t={};t.database=l0(this.serializer),t.addTarget=uv(this.serializer,e);let r=ug(this.serializer,e);r&&(t.labels=r),this.sendRequest(t)}unwatch(e){let t={};t.database=l0(this.serializer),t.removeTarget=e,this.sendRequest(t)}}class pd extends pc{constructor(e,t,r,n,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,n,s),this.serializer=i}get handshakeComplete(){return this.responseCount>0}start(){this.lastStreamToken=void 0,super.start()}tearDown(){this.handshakeComplete&&this.writeMutations([])}startRpc(e,t){return this.connection.openStream("Write",e,t)}onFirst(e){return tK(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,tK(!e.writeResults||0===e.writeResults.length,55816),this.listener.onHandshakeComplete()}onNext(e){tK(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.backoff.reset();let t=uo(e.writeResults,e.commitTime),r=lW(e.commitTime);return this.listener.onMutationResult(r,t)}writeHandshake(){let e={};e.database=l0(this.serializer),this.sendRequest(e)}writeMutations(e){let t={streamToken:this.lastStreamToken,writes:e.map(e=>ur(this.serializer,e))};this.sendRequest(t)}}class pf{}class pp extends pf{constructor(e,t,r,n){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=n,this.terminated=!1}verifyInitialized(){if(this.terminated)throw new rt(t6,"The client has already been terminated.")}invokeRPC(e,t,r,n){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.invokeRPC(e,lH(t,r),n,i,s)).catch(e=>{if("FirebaseError"===e.name)throw e.code===t2&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e;throw new rt(tJ,e.toString())})}invokeStreamingRPC(e,t,r,n,i){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.invokeStreamingRPC(e,lH(t,r),n,s,a,i)).catch(e=>{if("FirebaseError"===e.name)throw e.code===t2&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e;throw new rt(tJ,e.toString())})}terminate(){this.terminated=!0,this.connection.terminate()}}function pm(e,t,r,n){return new pp(e,t,r,n)}async function pg(e,t){let r=tG(e),n={writes:t.map(e=>ur(r.serializer,e))};await r.invokeRPC("Commit",r.serializer.databaseId,rE.emptyPath(),n)}async function py(e,t){let r=tG(e),n={documents:t.map(e=>lJ(r.serializer,e))},i=await r.invokeStreamingRPC("BatchGetDocuments",r.serializer.databaseId,rE.emptyPath(),n,t.length),s=new Map;i.forEach(e=>{let t=l7(r.serializer,e);s.set(t.key.toString(),t)});let a=[];return t.forEach(e=>{let t=s.get(e.toString());tK(!!t,55234,{key:e}),a.push(t)}),a}async function pv(e,t,r){let n=tG(e),{request:i,aliasMap:s,parent:a}=uf(n.serializer,a3(t),r);n.connection.shouldResourcePathBeIncludedInRequest||delete i.parent;let o=(await n.invokeStreamingRPC("RunAggregationQuery",n.serializer.databaseId,a,i,1)).filter(e=>!!e.result);tK(1===o.length,64727);let l=o[0].result?.aggregateFields;return Object.keys(l).reduce((e,t)=>(e[s[t]]=l[t],e),{})}function pb(e,t,r){let n=tG(e);return n.verifyInitialized(),new pd(t,n.connection,n.authCredentials,n.appCheckCredentials,n.serializer,r)}function pS(e,t,r){let n=tG(e);return n.verifyInitialized(),new ph(t,n.connection,n.authCredentials,n.appCheckCredentials,n.serializer,r)}let pw="OnlineStateTracker",pC=1,pT=1e4;class pE{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}handleWatchStreamStart(){0===this.watchStreamFailures&&(this.setAndBroadcast("Unknown"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay("online_state_timeout",pT,()=>(this.onlineStateTimer=null,this.logClientOfflineWarningIfNecessary(`Backend didn't respond within ${pT/1e3} seconds.`),this.setAndBroadcast("Offline"),Promise.resolve())))}handleWatchStreamFailure(e){"Online"===this.state?this.setAndBroadcast("Unknown"):(this.watchStreamFailures++,this.watchStreamFailures>=pC&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary(`Connection failed ${pC} times. Most recent error: ${e.toString()}`),this.setAndBroadcast("Offline")))}set(e){this.clearOnlineStateTimer(),this.watchStreamFailures=0,"Online"===e&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(e)}setAndBroadcast(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}logClientOfflineWarningIfNecessary(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.shouldWarnClientIsOffline?(tV(t),this.shouldWarnClientIsOffline=!1):tj(pw,t)}clearOnlineStateTimer(){null!==this.onlineStateTimer&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)}}let p_="RemoteStore",pI=10;class pk{constructor(e,t,r,n,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.writePipeline=[],this.listenTargets=new Map,this.offlineCauses=new Set,this.onNetworkStatusChange=[],this.connectivityMonitor=i,this.connectivityMonitor.addCallback(e=>{r.enqueueAndForget(async()=>{pV(this)&&(tj(p_,"Restarting streams for network reachability change."),await p5(this))})}),this.onlineStateTracker=new pE(r,n)}}function px(e,t,r,n,i){return new pk(e,t,r,n,i)}function pR(e){let t=tG(e);return t.offlineCauses.delete(0),pD(t)}async function pD(e){if(pV(e))for(let t of e.onNetworkStatusChange)await t(!0)}async function pA(e){let t=tG(e);t.offlineCauses.add(0),await pO(t),t.onlineStateTracker.set("Offline")}async function pO(e){for(let t of e.onNetworkStatusChange)await t(!1)}async function pN(e){let t=tG(e);tj(p_,"RemoteStore shutting down."),t.offlineCauses.add(5),await pO(t),t.connectivityMonitor.shutdown(),t.onlineStateTracker.set("Unknown")}function pP(e,t){let r=tG(e);!r.listenTargets.has(t.targetId)&&(r.listenTargets.set(t.targetId,t),pj(r)?pF(r):p9(r).isOpen()&&pL(r,t))}function pM(e,t){let r=tG(e),n=p9(r);r.listenTargets.delete(t),n.isOpen()&&pB(r,t),0===r.listenTargets.size&&(n.isOpen()?n.markIdle():pV(r)&&r.onlineStateTracker.set("Unknown"))}function pL(e,t){if(e.watchChangeAggregator.recordPendingTargetRequest(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(rq.min())>0){let r=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(r)}p9(e).watch(t)}function pB(e,t){e.watchChangeAggregator.recordPendingTargetRequest(t),p9(e).unwatch(t)}function pF(e){e.watchChangeAggregator=new lR({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),getTargetDataForTarget:t=>e.listenTargets.get(t)||null,getDatabaseId:()=>e.datastore.serializer.databaseId}),p9(e).start(),e.onlineStateTracker.handleWatchStreamStart()}function pj(e){return pV(e)&&!p9(e).isStarted()&&e.listenTargets.size>0}function pV(e){return 0===tG(e).offlineCauses.size}function pz(e){e.watchChangeAggregator=void 0}async function pq(e){e.onlineStateTracker.set("Online")}async function pU(e){e.listenTargets.forEach((t,r)=>{pL(e,t)})}async function p$(e,t){pz(e),pj(e)?(e.onlineStateTracker.handleWatchStreamFailure(t),pF(e)):e.onlineStateTracker.set("Unknown")}async function pK(e,t,r){if(e.onlineStateTracker.set("Online"),t instanceof lI&&2===t.state&&t.cause){try{await pQ(e,t)}catch(r){tj(p_,"Failed to remove targets %s: %s ",t.targetIds.join(","),r),await pW(e,r)}return}if(t instanceof lE?e.watchChangeAggregator.handleDocumentChange(t):t instanceof l_?e.watchChangeAggregator.handleExistenceFilter(t):e.watchChangeAggregator.handleTargetChange(t),!r.isEqual(rq.min()))try{let t=await d3(e.localStore);r.compareTo(t)>=0&&await pH(e,r)}catch(t){tj(p_,"Failed to raise snapshot:",t),await pW(e,t)}}async function pW(e,t,r){if(ns(t))e.offlineCauses.add(1),await pO(e),e.onlineStateTracker.set("Offline"),r||(r=()=>d3(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{tj(p_,"Retrying IndexedDB access"),await r(),e.offlineCauses.delete(1),await pD(e)});else throw t}function pG(e,t){return t().catch(r=>pW(e,r,t))}function pH(e,t){let r=e.watchChangeAggregator.createRemoteEvent(t);return r.targetChanges.forEach((r,n)=>{if(r.resumeToken.approximateByteSize()>0){let i=e.listenTargets.get(n);i&&e.listenTargets.set(n,i.withResumeToken(r.resumeToken,t))}}),r.targetMismatches.forEach((t,r)=>{let n=e.listenTargets.get(t);n&&(e.listenTargets.set(t,n.withResumeToken(iJ.EMPTY_BYTE_STRING,n.snapshotVersion)),pB(e,t),pL(e,new uG(n.target,t,r,n.sequenceNumber)))}),e.remoteSyncer.applyRemoteEvent(r)}async function pQ(e,t){let r=t.cause;for(let n of t.targetIds)e.listenTargets.has(n)&&(await e.remoteSyncer.rejectListen(n,r),e.listenTargets.delete(n),e.watchChangeAggregator.removeTarget(n))}async function pJ(e){let t=tG(e),r=me(t),n=t.writePipeline.length>0?t.writePipeline[t.writePipeline.length-1].batchId:ss;for(;pY(t);)try{let e=await d7(t.localStore,n);if(null===e){0===t.writePipeline.length&&r.markIdle();break}n=e.batchId,pX(t,e)}catch(e){await pW(t,e)}pZ(t)&&p0(t)}function pY(e){return pV(e)&&e.writePipeline.length<pI}function pX(e,t){e.writePipeline.push(t);let r=me(e);r.isOpen()&&r.handshakeComplete&&r.writeMutations(t.mutations)}function pZ(e){return pV(e)&&!me(e).isStarted()&&e.writePipeline.length>0}function p0(e){me(e).start()}async function p1(e){me(e).writeHandshake()}async function p2(e){let t=me(e);for(let r of e.writePipeline)t.writeMutations(r.mutations)}async function p3(e,t,r){let n=e.writePipeline.shift(),i=la.from(n,t,r);await pG(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await pJ(e)}async function p6(e,t){t&&me(e).handshakeComplete&&await p4(e,t),pZ(e)&&p0(e)}async function p4(e,t){if(lc(t.code)){let r=e.writePipeline.shift();me(e).inhibitBackoff(),await pG(e,()=>e.remoteSyncer.rejectFailedWrite(r.batchId,t)),await pJ(e)}}async function p5(e){let t=tG(e);t.offlineCauses.add(4),await pO(t),t.onlineStateTracker.set("Unknown"),t.offlineCauses.delete(4),await pD(t)}async function p8(e,t){let r=tG(e);r.asyncQueue.verifyOperationInProgress(),tj(p_,"RemoteStore received new credentials");let n=pV(r);r.offlineCauses.add(3),await pO(r),n&&r.onlineStateTracker.set("Unknown"),await r.remoteSyncer.handleCredentialChange(t),r.offlineCauses.delete(3),await pD(r)}async function p7(e,t){let r=tG(e);t?(r.offlineCauses.delete(2),await pD(r)):t||(r.offlineCauses.add(2),await pO(r),r.onlineStateTracker.set("Unknown"))}function p9(e){return e.watchStream||(e.watchStream=pS(e.datastore,e.asyncQueue,{onConnected:pq.bind(null,e),onOpen:pU.bind(null,e),onClose:p$.bind(null,e),onWatchChange:pK.bind(null,e)}),e.onNetworkStatusChange.push(async t=>{t?(e.watchStream.inhibitBackoff(),pj(e)?pF(e):e.onlineStateTracker.set("Unknown")):(await e.watchStream.stop(),pz(e))})),e.watchStream}function me(e){return e.writeStream||(e.writeStream=pb(e.datastore,e.asyncQueue,{onConnected:()=>Promise.resolve(),onOpen:p1.bind(null,e),onClose:p6.bind(null,e),onHandshakeComplete:p2.bind(null,e),onMutationResult:p3.bind(null,e)}),e.onNetworkStatusChange.push(async t=>{t?(e.writeStream.inhibitBackoff(),await pJ(e)):(await e.writeStream.stop(),e.writePipeline.length>0&&(tj(p_,`Stopping write stream with ${e.writePipeline.length} pending writes`),e.writePipeline=[]))})),e.writeStream}let mt="AsyncQueue";class mr{constructor(e,t,r,n,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=n,this.removalCallback=i,this.deferred=new rr,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,n,i){let s=new mr(e,t,Date.now()+r,n,i);return s.start(r),s}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new rt(tQ,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function mn(e,t){if(tV(mt,`${t}: ${e}`),ns(e))return new rt(t9,`${t}: ${e}`);throw e}class mi{static emptySet(e){return new mi(e.comparator)}constructor(e){e?this.comparator=(t,r)=>e(t,r)||rk.comparator(t.key,r.key):this.comparator=(e,t)=>rk.comparator(e.key,t.key),this.keyedMap=om(),this.sortedSet=new iF(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof mi)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let e=t.getNext().key,n=r.getNext().key;if(!e.isEqual(n))return!1}return!0}toString(){let e=[];return(this.forEach(t=>{e.push(t.toString())}),0===e.length)?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){let r=new mi;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class ms{constructor(){this.changeMap=new iF(rk.comparator)}track(e){let t=e.doc.key,r=this.changeMap.get(t);if(!r){this.changeMap=this.changeMap.insert(t,e);return}0!==e.type&&3===r.type?this.changeMap=this.changeMap.insert(t,e):3===e.type&&1!==r.type?this.changeMap=this.changeMap.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.changeMap=this.changeMap.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.changeMap=this.changeMap.remove(t):1===e.type&&2===r.type?this.changeMap=this.changeMap.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):tU(63341,{change:e,oldChange:r})}getChanges(){let e=[];return this.changeMap.inorderTraversal((t,r)=>{e.push(r)}),e}}class ma{constructor(e,t,r,n,i,s,a,o,l){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=n,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=l}static fromInitialDocuments(e,t,r,n,i){let s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new ma(e,t,mi.emptySet(t),s,r,n,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(this.fromCache!==e.fromCache||this.hasCachedResults!==e.hasCachedResults||this.syncStateChanged!==e.syncStateChanged||!this.mutatedKeys.isEqual(e.mutatedKeys)||!oe(this.query,e.query)||!this.docs.isEqual(e.docs)||!this.oldDocs.isEqual(e.oldDocs))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==r[e].type||!t[e].doc.isEqual(r[e].doc))return!1;return!0}}class mo{constructor(){this.viewSnap=void 0,this.listeners=[]}hasRemoteListeners(){return this.listeners.some(e=>e.listensToRemoteStore())}}function ml(){return new mu}class mu{constructor(){this.queries=mc(),this.onlineState="Unknown",this.snapshotsInSyncListeners=new Set}terminate(){mv(this,new rt(t4,"Firestore shutting down"))}}function mc(){return new oh(e=>ot(e),oe)}async function mh(e,t){let r=tG(e),n=3,i=t.query,s=r.queries.get(i);s?!s.hasRemoteListeners()&&t.listensToRemoteStore()&&(n=2):(s=new mo,n=+!t.listensToRemoteStore());try{switch(n){case 0:s.viewSnap=await r.onListen(i,!0);break;case 1:s.viewSnap=await r.onListen(i,!1);break;case 2:await r.onFirstRemoteStoreListen(i)}}catch(r){let e=mn(r,`Initialization of query '${or(t.query)}' failed`);t.onError(e);return}r.queries.set(i,s),s.listeners.push(t),t.applyOnlineStateChange(r.onlineState),s.viewSnap&&t.onViewSnapshot(s.viewSnap)&&mb(r)}async function md(e,t){let r=tG(e),n=t.query,i=3,s=r.queries.get(n);if(s){let e=s.listeners.indexOf(t);e>=0&&(s.listeners.splice(e,1),0===s.listeners.length?i=+!t.listensToRemoteStore():!s.hasRemoteListeners()&&t.listensToRemoteStore()&&(i=2))}switch(i){case 0:return r.queries.delete(n),r.onUnlisten(n,!0);case 1:return r.queries.delete(n),r.onUnlisten(n,!1);case 2:return r.onLastRemoteStoreUnlisten(n);default:return}}function mf(e,t){let r=tG(e),n=!1;for(let e of t){let t=e.query,i=r.queries.get(t);if(i){for(let t of i.listeners)t.onViewSnapshot(e)&&(n=!0);i.viewSnap=e}}n&&mb(r)}function mp(e,t,r){let n=tG(e),i=n.queries.get(t);if(i)for(let e of i.listeners)e.onError(r);n.queries.delete(t)}function mm(e,t){let r=tG(e);r.onlineState=t;let n=!1;r.queries.forEach((e,r)=>{for(let e of r.listeners)e.applyOnlineStateChange(t)&&(n=!0)}),n&&mb(r)}function mg(e,t){tG(e).snapshotsInSyncListeners.add(t),t.next()}function my(e,t){tG(e).snapshotsInSyncListeners.delete(t)}function mv(e,t){let r=tG(e),n=r.queries;r.queries=mc(),n.forEach((e,r)=>{for(let e of r.listeners)e.onError(t)})}function mb(e){e.snapshotsInSyncListeners.forEach(e=>{e.next()})}!function(e){e.Default="default",e.Cache="cache"}(tT||(tT={}));class mS{constructor(e,t,r){this.query=e,this.queryObserver=t,this.raisedInitialEvent=!1,this.snap=null,this.onlineState="Unknown",this.options=r||{}}onViewSnapshot(e){if(!this.options.includeMetadataChanges){let t=[];for(let r of e.docChanges)3!==r.type&&t.push(r);e=new ma(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.raisedInitialEvent?this.shouldRaiseEvent(e)&&(this.queryObserver.next(e),t=!0):this.shouldRaiseInitialEvent(e,this.onlineState)&&(this.raiseInitialEvent(e),t=!0),this.snap=e,t}onError(e){this.queryObserver.error(e)}applyOnlineStateChange(e){this.onlineState=e;let t=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,e)&&(this.raiseInitialEvent(this.snap),t=!0),t}shouldRaiseInitialEvent(e,t){if(!e.fromCache||!this.listensToRemoteStore())return!0;let r="Offline"!==t;return(!this.options.waitForSyncWhenOnline||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}shouldRaiseEvent(e){if(e.docChanges.length>0)return!0;let t=this.snap&&this.snap.hasPendingWrites!==e.hasPendingWrites;return(!!e.syncStateChanged||!!t)&&!0===this.options.includeMetadataChanges}raiseInitialEvent(e){e=ma.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.raisedInitialEvent=!0,this.queryObserver.next(e)}listensToRemoteStore(){return this.options.source!==tT.Cache}}class mw{constructor(e,t,r,n){this.targetId=e,this.fromCache=t,this.addedKeys=r,this.removedKeys=n}static fromSnapshot(e,t){let r=oE(),n=oE();for(let e of t.docChanges)switch(e.type){case 0:r=r.add(e.doc.key);break;case 1:n=n.add(e.doc.key)}return new mw(e,t.fromCache,r,n)}}class mC{constructor(e){this.serializer=e}toDocumentKey(e){return lY(this.serializer,e)}toMutableDocument(e){return e.metadata.exists?l4(this.serializer,e.document,!1):s8.newNoDocument(this.toDocumentKey(e.metadata.name),this.toSnapshotVersion(e.metadata.readTime))}toSnapshotVersion(e){return lW(e)}}class mT{constructor(e,t){this.bundleMetadata=e,this.serializer=t,this._queries=[],this._documents=[],this.collectionGroups=new Set,this.progress=mE(e)}get queries(){return this._queries}get documents(){return this._documents}addSizedElement(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.payload.namedQuery)this._queries.push(e.payload.namedQuery);else if(e.payload.documentMetadata){this._documents.push({metadata:e.payload.documentMetadata}),!e.payload.documentMetadata.exists&&++t;let r=rE.fromString(e.payload.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.payload.document&&(this._documents[this._documents.length-1].document=e.payload.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,{...this.progress}):null}getQueryDocumentMapping(e){let t=new Map,r=new mC(this.serializer);for(let n of e)if(n.metadata.queries){let e=r.toDocumentKey(n.metadata.name);for(let r of n.metadata.queries){let n=(t.get(r)||oE()).add(e);t.set(r,n)}}return t}async completeAndStoreAsync(e){let t=await fd(e,new mC(this.serializer),this._documents,this.bundleMetadata.id),r=this.getQueryDocumentMapping(this.documents);for(let t of this._queries)await fg(e,t,r.get(t.name));return this.progress.taskState="Success",{progress:this.progress,changedCollectionGroups:this.collectionGroups,changedDocs:t}}}function mE(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}function m_(e){return{taskState:"Success",documentsLoaded:e.totalDocuments,bytesLoaded:e.totalBytes,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class mI{constructor(e){this.key=e}}class mk{constructor(e){this.key=e}}class mx{constructor(e,t){this.query=e,this._syncedDocuments=t,this.syncState=null,this.hasCachedResults=!1,this.current=!1,this.limboDocuments=oE(),this.mutatedKeys=oE(),this.docComparator=ou(e),this.documentSet=new mi(this.docComparator)}get syncedDocuments(){return this._syncedDocuments}computeDocChanges(e,t){let r=t?t.changeSet:new ms,n=t?t.documentSet:this.documentSet,i=t?t.mutatedKeys:this.mutatedKeys,s=n,a=!1,o="F"===this.query.limitType&&n.size===this.query.limit?n.last():null,l="L"===this.query.limitType&&n.size===this.query.limit?n.first():null;if(e.inorderTraversal((e,t)=>{let u=n.get(e),c=on(this.query,t)?t:null,h=!!u&&this.mutatedKeys.has(u.key),d=!!c&&(c.hasLocalMutations||this.mutatedKeys.has(c.key)&&c.hasCommittedMutations),f=!1;u&&c?u.data.isEqual(c.data)?h!==d&&(r.track({type:3,doc:c}),f=!0):!this.shouldWaitForSyncedDocument(u,c)&&(r.track({type:2,doc:c}),f=!0,(o&&this.docComparator(c,o)>0||l&&0>this.docComparator(c,l))&&(a=!0)):!u&&c?(r.track({type:0,doc:c}),f=!0):u&&!c&&(r.track({type:1,doc:u}),f=!0,(o||l)&&(a=!0)),f&&(c?(s=s.add(c),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){let e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),r.track({type:1,doc:e})}return{documentSet:s,changeSet:r,needsRefill:a,mutatedKeys:i}}shouldWaitForSyncedDocument(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,n){let i=this.documentSet;this.documentSet=e.documentSet,this.mutatedKeys=e.mutatedKeys;let s=e.changeSet.getChanges();s.sort((e,t)=>mR(e.type,t.type)||this.docComparator(e.doc,t.doc)),this.applyTargetChange(r),n=n??!1;let a=t&&!n?this.updateLimboDocuments():[],o=+!!(0===this.limboDocuments.size&&this.current&&!n),l=o!==this.syncState;return(this.syncState=o,0!==s.length||l)?{snapshot:new ma(this.query,e.documentSet,i,s,e.mutatedKeys,0===o,l,!1,!!r&&r.resumeToken.approximateByteSize()>0),limboChanges:a}:{limboChanges:a}}applyOnlineStateChange(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new ms,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}}shouldBeInLimbo(e){return!this._syncedDocuments.has(e)&&!!this.documentSet.has(e)&&!this.documentSet.get(e).hasLocalMutations}applyTargetChange(e){e&&(e.addedDocuments.forEach(e=>this._syncedDocuments=this._syncedDocuments.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this._syncedDocuments=this._syncedDocuments.delete(e)),this.current=e.current)}updateLimboDocuments(){if(!this.current)return[];let e=this.limboDocuments;this.limboDocuments=oE(),this.documentSet.forEach(e=>{this.shouldBeInLimbo(e.key)&&(this.limboDocuments=this.limboDocuments.add(e.key))});let t=[];return e.forEach(e=>{this.limboDocuments.has(e)||t.push(new mk(e))}),this.limboDocuments.forEach(r=>{e.has(r)||t.push(new mI(r))}),t}synchronizeWithPersistedState(e){this._syncedDocuments=e.remoteKeys,this.limboDocuments=oE();let t=this.computeDocChanges(e.documents);return this.applyChanges(t,!0)}computeInitialSnapshot(){return ma.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,0===this.syncState,this.hasCachedResults)}}function mR(e,t){let r=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return tU(20277,{change:e})}};return r(e)-r(t)}let mD="SyncEngine";class mA{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class mO{constructor(e){this.key=e,this.receivedDocument=!1}}class mN{constructor(e,t,r,n,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=n,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.syncEngineListener={},this.queryViewsByQuery=new oh(e=>ot(e),oe),this.queriesByTarget=new Map,this.enqueuedLimboResolutions=new Set,this.activeLimboTargetsByKey=new iF(rk.comparator),this.activeLimboResolutionsByTarget=new Map,this.limboDocumentRefs=new h7,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=hE.forSyncEngine(),this.onlineState="Unknown",this._isPrimaryClient=void 0}get isPrimaryClient(){return!0===this._isPrimaryClient}}function mP(e,t,r,n,i,s,a){let o=new mN(e,t,r,n,i,s);return a&&(o._isPrimaryClient=!0),o}async function mM(e,t,r=!0){let n,i=go(e),s=i.queryViewsByQuery.get(t);return s?(i.sharedClientState.addLocalQueryTarget(s.targetId),n=s.view.computeInitialSnapshot()):n=await mB(i,t,r,!0),n}async function mL(e,t){let r=go(e);await mB(r,t,!0,!1)}async function mB(e,t,r,n){let i,s=await fe(e.localStore,a2(t)),a=s.targetId,o=e.sharedClientState.addLocalQueryTarget(a,r);return n&&(i=await mF(e,t,a,"current"===o,s.resumeToken)),e.isPrimaryClient&&r&&pP(e.remoteStore,s),i}async function mF(e,t,r,n,i){e.applyDocChanges=(t,r,n)=>m6(e,t,r,n);let s=await fn(e.localStore,t,!0),a=new mx(t,s.remoteKeys),o=a.computeDocChanges(s.documents),l=lT.createSynthesizedTargetChangeForCurrentChange(r,n&&"Offline"!==e.onlineState,i),u=a.applyChanges(o,e.isPrimaryClient,l);m0(e,r,u.limboChanges);let c=new mA(t,r,a);return e.queryViewsByQuery.set(t,c),e.queriesByTarget.has(r)?e.queriesByTarget.get(r).push(t):e.queriesByTarget.set(r,[t]),u.snapshot}async function mj(e,t,r){let n=tG(e),i=n.queryViewsByQuery.get(t),s=n.queriesByTarget.get(i.targetId);if(s.length>1){n.queriesByTarget.set(i.targetId,s.filter(e=>!oe(e,t))),n.queryViewsByQuery.delete(t);return}n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||await fr(n.localStore,i.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(i.targetId),r&&pM(n.remoteStore,i.targetId),mX(n,i.targetId)}).catch(r5)):(mX(n,i.targetId),await fr(n.localStore,i.targetId,!0))}async function mV(e,t){let r=tG(e),n=r.queryViewsByQuery.get(t),i=r.queriesByTarget.get(n.targetId);r.isPrimaryClient&&1===i.length&&(r.sharedClientState.removeLocalQueryTarget(n.targetId),pM(r.remoteStore,n.targetId))}async function mz(e,t,r){let n=gl(e);try{let e=await dX(n.localStore,t);n.sharedClientState.addPendingMutation(e.batchId),mJ(n,e.batchId,r),await m3(n,e.changes),await pJ(n.remoteStore)}catch(t){let e=mn(t,"Failed to persist write");r.reject(e)}}async function mq(e,t){let r=tG(e);try{let e=await d6(r.localStore,t);t.targetChanges.forEach((e,t)=>{let n=r.activeLimboResolutionsByTarget.get(t);n&&(tK(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,22616),e.addedDocuments.size>0?n.receivedDocument=!0:e.modifiedDocuments.size>0?tK(n.receivedDocument,14607):e.removedDocuments.size>0&&(tK(n.receivedDocument,42227),n.receivedDocument=!1))}),await m3(r,e,t)}catch(e){await r5(e)}}function mU(e,t,r){let n=tG(e);if(n.isPrimaryClient&&0===r||!n.isPrimaryClient&&1===r){let e=[];n.queryViewsByQuery.forEach((r,n)=>{let i=n.view.applyOnlineStateChange(t);i.snapshot&&e.push(i.snapshot)}),mm(n.eventManager,t),e.length&&n.syncEngineListener.onWatchChange(e),n.onlineState=t,n.isPrimaryClient&&n.sharedClientState.setOnlineState(t)}}async function m$(e,t,r){let n=tG(e);n.sharedClientState.updateQueryState(t,"rejected",r);let i=n.activeLimboResolutionsByTarget.get(t),s=i&&i.key;if(s){let e=new iF(rk.comparator);e=e.insert(s,s8.newNoDocument(s,rq.min()));let r=oE().add(s),i=new lC(rq.min(),new Map,new iF(rm),e,r);await mq(n,i),n.activeLimboTargetsByKey=n.activeLimboTargetsByKey.remove(s),n.activeLimboResolutionsByTarget.delete(t),m2(n)}else await fr(n.localStore,t,!1).then(()=>mX(n,t,r)).catch(r5)}async function mK(e,t){let r=tG(e),n=t.batch.batchId;try{let e=await dZ(r.localStore,t);mY(r,n,null),mH(r,n),r.sharedClientState.updateMutationState(n,"acknowledged"),await m3(r,e)}catch(e){await r5(e)}}async function mW(e,t,r){let n=tG(e);try{let e=await d1(n.localStore,t);mY(n,t,r),mH(n,t),n.sharedClientState.updateMutationState(t,"rejected",r),await m3(n,e)}catch(e){await r5(e)}}async function mG(e,t){let r=tG(e);pV(r.remoteStore)||tj(mD,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let e=await d2(r.localStore);if(e===ss)return void t.resolve();let n=r.pendingWritesCallbacks.get(e)||[];n.push(t),r.pendingWritesCallbacks.set(e,n)}catch(r){let e=mn(r,"Initialization of waitForPendingWrites() operation failed");t.reject(e)}}function mH(e,t){(e.pendingWritesCallbacks.get(t)||[]).forEach(e=>{e.resolve()}),e.pendingWritesCallbacks.delete(t)}function mQ(e,t){e.pendingWritesCallbacks.forEach(e=>{e.forEach(e=>{e.reject(new rt(tQ,t))})}),e.pendingWritesCallbacks.clear()}function mJ(e,t,r){let n=e.mutationUserCallbacks[e.currentUser.toKey()];n||(n=new iF(rm)),n=n.insert(t,r),e.mutationUserCallbacks[e.currentUser.toKey()]=n}function mY(e,t,r){let n=tG(e),i=n.mutationUserCallbacks[n.currentUser.toKey()];if(i){let e=i.get(t);e&&(r?e.reject(r):e.resolve(),i=i.remove(t)),n.mutationUserCallbacks[n.currentUser.toKey()]=i}}function mX(e,t,r=null){for(let n of(e.sharedClientState.removeLocalQueryTarget(t),e.queriesByTarget.get(t)))e.queryViewsByQuery.delete(n),r&&e.syncEngineListener.onWatchError(n,r);e.queriesByTarget.delete(t),e.isPrimaryClient&&e.limboDocumentRefs.removeReferencesForId(t).forEach(t=>{e.limboDocumentRefs.containsKey(t)||mZ(e,t)})}function mZ(e,t){e.enqueuedLimboResolutions.delete(t.path.canonicalString());let r=e.activeLimboTargetsByKey.get(t);null!==r&&(pM(e.remoteStore,r),e.activeLimboTargetsByKey=e.activeLimboTargetsByKey.remove(t),e.activeLimboResolutionsByTarget.delete(r),m2(e))}function m0(e,t,r){for(let n of r)n instanceof mI?(e.limboDocumentRefs.addReference(n.key,t),m1(e,n)):n instanceof mk?(tj(mD,"Document no longer in limbo: "+n.key),e.limboDocumentRefs.removeReference(n.key,t),e.limboDocumentRefs.containsKey(n.key)||mZ(e,n.key)):tU(19791,{limboChange:n})}function m1(e,t){let r=t.key,n=r.path.canonicalString();e.activeLimboTargetsByKey.get(r)||e.enqueuedLimboResolutions.has(n)||(tj(mD,"New document in limbo: "+r),e.enqueuedLimboResolutions.add(n),m2(e))}function m2(e){for(;e.enqueuedLimboResolutions.size>0&&e.activeLimboTargetsByKey.size<e.maxConcurrentLimboResolutions;){let t=e.enqueuedLimboResolutions.values().next().value;e.enqueuedLimboResolutions.delete(t);let r=new rk(rE.fromString(t)),n=e.limboTargetIdGenerator.next();e.activeLimboResolutionsByTarget.set(n,new mO(r)),e.activeLimboTargetsByKey=e.activeLimboTargetsByKey.insert(r,n),pP(e.remoteStore,new uG(a2(aH(r.path)),n,"TargetPurposeLimboResolution",ng.INVALID))}}async function m3(e,t,r){let n=tG(e),i=[],s=[],a=[];n.queryViewsByQuery.isEmpty()||(n.queryViewsByQuery.forEach((e,o)=>{a.push(n.applyDocChanges(o,t,r).then(e=>{if((e||r)&&n.isPrimaryClient){let t=e?!e.fromCache:r?.targetChanges.get(o.targetId)?.current;n.sharedClientState.updateQueryState(o.targetId,t?"current":"not-current")}if(e){i.push(e);let t=mw.fromSnapshot(o.targetId,e);s.push(t)}}))}),await Promise.all(a),n.syncEngineListener.onWatchChange(i),await d8(n.localStore,s))}async function m6(e,t,r,n){let i=t.view.computeDocChanges(r);i.needsRefill&&(i=await fn(e.localStore,t.query,!1).then(({documents:e})=>t.view.computeDocChanges(e,i)));let s=n&&n.targetChanges.get(t.targetId),a=n&&null!=n.targetMismatches.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s,a);return m0(e,t.targetId,o.limboChanges),o.snapshot}async function m4(e,t){let r=tG(e);if(!r.currentUser.isEqual(t)){tj(mD,"User change. New user:",t.toKey());let e=await dY(r.localStore,t);r.currentUser=t,mQ(r,"'waitForPendingWrites' promise is rejected due to a user change."),r.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await m3(r,e.affectedDocuments)}}function m5(e,t){let r=tG(e),n=r.activeLimboResolutionsByTarget.get(t);if(n&&n.receivedDocument)return oE().add(n.key);{let e=oE(),n=r.queriesByTarget.get(t);if(!n)return e;for(let t of n){let n=r.queryViewsByQuery.get(t);e=e.unionWith(n.view.syncedDocuments)}return e}}async function m8(e,t){let r=tG(e),n=await fn(r.localStore,t.query,!0),i=t.view.synchronizeWithPersistedState(n);return r.isPrimaryClient&&m0(r,t.targetId,i.limboChanges),i}async function m7(e,t){let r=tG(e);return fu(r.localStore,t).then(e=>m3(r,e))}async function m9(e,t,r,n){let i=tG(e),s=await fs(i.localStore,t);null===s?tj(mD,"Cannot apply mutation batch with id: "+t):("pending"===r?await pJ(i.remoteStore):"acknowledged"===r||"rejected"===r?(mY(i,t,n||null),mH(i,t),fa(i.localStore,t)):tU(6720,"Unknown batchState",{batchState:r}),await m3(i,s))}async function ge(e,t){let r=tG(e);if(go(r),gl(r),!0===t&&!0!==r._isPrimaryClient){let e=r.sharedClientState.getAllActiveQueryTargets(),t=await gr(r,e.toArray());for(let e of(r._isPrimaryClient=!0,await p7(r.remoteStore,!0),t))pP(r.remoteStore,e)}else if(!1===t&&!1!==r._isPrimaryClient){let e=[],t=Promise.resolve();r.queriesByTarget.forEach((n,i)=>{r.sharedClientState.isLocalQueryTarget(i)?e.push(i):t=t.then(()=>(mX(r,i),fr(r.localStore,i,!0))),pM(r.remoteStore,i)}),await t,await gr(r,e),gt(r),r._isPrimaryClient=!1,await p7(r.remoteStore,!1)}}function gt(e){let t=tG(e);t.activeLimboResolutionsByTarget.forEach((e,r)=>{pM(t.remoteStore,r)}),t.limboDocumentRefs.removeAllReferences(),t.activeLimboResolutionsByTarget=new Map,t.activeLimboTargetsByKey=new iF(rk.comparator)}async function gr(e,t,r){let n=tG(e),i=[],s=[];for(let e of t){let t,r=n.queriesByTarget.get(e);if(r&&0!==r.length)for(let e of(t=await fe(n.localStore,a2(r[0])),r)){let t=n.queryViewsByQuery.get(e),r=await m8(n,t);r.snapshot&&s.push(r.snapshot)}else{let r=await fl(n.localStore,e);t=await fe(n.localStore,r),await mF(n,gn(r),e,!1,t.resumeToken)}i.push(t)}return n.syncEngineListener.onWatchChange(s),i}function gn(e){return aG(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function gi(e){return fo(tG(e).localStore)}async function gs(e,t,r,n){let i=tG(e);if(i._isPrimaryClient)return void tj(mD,"Ignoring unexpected query state notification.");let s=i.queriesByTarget.get(t);if(s&&s.length>0)switch(r){case"current":case"not-current":{let e=await fu(i.localStore,ol(s[0])),n=lC.createSynthesizedRemoteEventForCurrentChange(t,"current"===r,iJ.EMPTY_BYTE_STRING);await m3(i,e,n);break}case"rejected":await fr(i.localStore,t,!0),mX(i,t,n);break;default:tU(64155,r)}}async function ga(e,t,r){let n=go(e);if(n._isPrimaryClient){for(let e of t){if(n.queriesByTarget.has(e)&&n.sharedClientState.isActiveQueryTarget(e)){tj(mD,"Adding an already active target "+e);continue}let t=await fl(n.localStore,e),r=await fe(n.localStore,t);await mF(n,gn(t),r.targetId,!1,r.resumeToken),pP(n.remoteStore,r)}for(let e of r)n.queriesByTarget.has(e)&&await fr(n.localStore,e,!1).then(()=>{pM(n.remoteStore,e),mX(n,e)}).catch(r5)}}function go(e){let t=tG(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=mq.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=m5.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=m$.bind(null,t),t.syncEngineListener.onWatchChange=mf.bind(null,t.eventManager),t.syncEngineListener.onWatchError=mp.bind(null,t.eventManager),t}function gl(e){let t=tG(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=mK.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=mW.bind(null,t),t}function gu(e,t,r){let n=tG(e);gc(n,t,r).then(e=>{n.sharedClientState.notifyBundleLoaded(e)})}async function gc(e,t,r){try{let n=await t.getMetadata();if(await ff(e.localStore,n))return await t.close(),r._completeWith(m_(n)),Promise.resolve(new Set);r._updateProgress(mE(n));let i=new mT(n,t.serializer),s=await t.nextElement();for(;s;){let e=await i.addSizedElement(s);e&&r._updateProgress(e),s=await t.nextElement()}let a=await i.completeAndStoreAsync(e.localStore);return await m3(e,a.changedDocs,void 0),await fp(e.localStore,n),r._completeWith(a.progress),Promise.resolve(a.changedCollectionGroups)}catch(e){return tz(mD,`Loading bundle failed with ${e}`),r._failWith(e),Promise.resolve(new Set)}}class gh{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=pt(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return dJ(this.persistence,new fT,e.initialUser,this.serializer)}createPersistence(e){return new du(dh.factory,this.serializer)}createSharedClientState(e){return new f$}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}gh.provider={build:()=>new gh};class gd extends gh{constructor(e){super(),this.cacheSizeBytes=e}createGarbageCollectionScheduler(e,t){return tK(this.persistence.referenceDelegate instanceof dd,46915),new hj(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}createPersistence(e){let t=void 0!==this.cacheSizeBytes?hO.withCacheSize(this.cacheSizeBytes):hO.DEFAULT;return new du(e=>dd.factory(e,t),this.serializer)}}class gf extends gh{constructor(e,t,r){super(),this.onlineComponentProvider=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.onlineComponentProvider.initialize(this,e),await gl(this.onlineComponentProvider.syncEngine),await pJ(this.onlineComponentProvider.remoteStore),await this.persistence.setPrimaryStateListener(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}createLocalStore(e){return dJ(this.persistence,new fT,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){return new hj(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){let r=new nm(t,this.persistence);return new np(e.asyncQueue,r)}createPersistence(e){let t=dU(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=void 0!==this.cacheSizeBytes?hO.withCacheSize(this.cacheSizeBytes):hO.DEFAULT;return new dV(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,f9(),pe(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new f$}}class gp extends gf{constructor(e,t){super(e,t,!1),this.onlineComponentProvider=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);let t=this.onlineComponentProvider.syncEngine;this.sharedClientState instanceof fq&&(this.sharedClientState.syncEngine={applyBatchState:m9.bind(null,t),applyTargetState:gs.bind(null,t),applyActiveTargetsChange:ga.bind(null,t),getActiveClients:gi.bind(null,t),synchronizeWithChangedDocuments:m7.bind(null,t)},await this.sharedClientState.start()),await this.persistence.setPrimaryStateListener(async e=>{await ge(this.onlineComponentProvider.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())})}createSharedClientState(e){let t=f9();if(!fq.isAvailable(t))throw new rt(t8,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=dU(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new fq(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class gm{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>mU(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=m4.bind(null,this.syncEngine),await p7(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return ml()}createDatastore(e){let t=pt(e.databaseInfo.databaseId),r=f8(e.databaseInfo);return pm(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return px(this.localStore,this.datastore,e.asyncQueue,e=>mU(this.syncEngine,e,0),f7())}createSyncEngine(e,t){return mP(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await pN(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}gm.provider={build:()=>new gm};let gg=10240;function gy(e,t=gg){let r=0;return{async read(){if(r<e.byteLength){let n={value:e.slice(r,r+t),done:!1};return r+=t,n}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}function gv(e,t){if(!(e instanceof Uint8Array))throw new rt(tY,`NodePlatform.toByteStreamReader expects source to be Uint8Array, got ${rN(e)}`);return gy(e,t)}class gb{constructor(e){this.observer=e,this.muted=!1}next(e){!this.muted&&this.observer.next&&this.scheduleEvent(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.scheduleEvent(this.observer.error,e):tV("Uncaught Error in snapshot listener:",e.toString()))}mute(){this.muted=!0}scheduleEvent(e,t){setTimeout(()=>{this.muted||e(t)},0)}}class gS{constructor(e,t){this.payload=e,this.byteLength=t}isBundleMetadata(){return"metadata"in this.payload}}class gw{constructor(e,t){this.reader=e,this.serializer=t,this.metadata=new rr,this.buffer=new Uint8Array,this.textDecoder=lg(),this.nextElementImpl().then(e=>{e&&e.isBundleMetadata()?this.metadata.resolve(e.payload.metadata):this.metadata.reject(Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(e?.payload)}`))},e=>this.metadata.reject(e))}close(){return this.reader.cancel()}async getMetadata(){return this.metadata.promise}async nextElement(){return await this.getMetadata(),this.nextElementImpl()}async nextElementImpl(){let e=await this.readLength();if(null===e)return null;let t=this.textDecoder.decode(e),r=Number(t);return isNaN(r)&&this.raiseError(`length string (${t}) is not valid number`),new gS(JSON.parse(await this.readJsonString(r)),e.length+r)}indexOfOpenBracket(){return this.buffer.findIndex(e=>123===e)}async readLength(){for(;0>this.indexOfOpenBracket()&&!await this.pullMoreDataToBuffer(););if(0===this.buffer.length)return null;let e=this.indexOfOpenBracket();e<0&&this.raiseError("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async readJsonString(e){for(;this.buffer.length<e;)await this.pullMoreDataToBuffer()&&this.raiseError("Reached the end of bundle when more is expected.");let t=this.textDecoder.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}raiseError(e){throw this.reader.cancel(),Error(`Invalid bundle format: ${e}`)}async pullMoreDataToBuffer(){let e=await this.reader.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}function gC(e,t){return new gw(e,t)}class gT{constructor(e,t){this.bundleData=e,this.serializer=t,this.cursor=0,this.elements=[];let r=this.nextElement();if(r&&r.isBundleMetadata())this.metadata=r;else throw Error(`The first element of the bundle is not a metadata object, it is
         ${JSON.stringify(r?.payload)}`);do null!==(r=this.nextElement())&&this.elements.push(r);while(null!==r)}getMetadata(){return this.metadata}getElements(){return this.elements}nextElement(){if(this.cursor===this.bundleData.length)return null;let e=this.readLength();return new gS(JSON.parse(this.readJsonString(e)),e)}readJsonString(e){if(this.cursor+e>this.bundleData.length)throw new rt(t7,"Reached the end of bundle when more is expected.");return this.bundleData.slice(this.cursor,this.cursor+=e)}readLength(){let e=this.cursor,t=this.cursor;for(;t<this.bundleData.length;){if("{"===this.bundleData[t]){if(t===e)throw Error("First character is a bracket and not a number");return this.cursor=t,Number(this.bundleData.slice(e,t))}t++}throw Error("Reached the end of bundle when more is expected.")}}function gE(e,t){return new gT(e,t)}class g_{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new rt(tY,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=await py(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastTransactionError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new lt(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((e,t)=>{let r=rk.fromPath(t);this.mutations.push(new li(r,this.precondition(r)))}),await pg(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else if(e.isNoDocument())t=rq.min();else throw tU(50498,{documentName:e.constructor.name});let r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new rt(t4,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return this.writtenDocs.has(e.toString())||!t?oH.none():t.isEqual(rq.min())?oH.exists(!1):oH.updateTime(t)}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(this.writtenDocs.has(e.toString())||!t)return oH.exists(!0);if(t.isEqual(rq.min()))throw new rt(tY,"Can't update a document that doesn't exist.");return oH.updateTime(t)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class gI{constructor(e,t,r,n,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=n,this.deferred=i,this.attemptsRemaining=r.maxAttempts,this.backoff=new pa(this.asyncQueue,"transaction_retry")}run(){this.attemptsRemaining-=1,this.runWithBackOff()}runWithBackOff(){this.backoff.backoffAndRun(async()=>{let e=new g_(this.datastore),t=this.tryRunUpdateFunction(e);t&&t.then(t=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(t)}).catch(e=>{this.handleTransactionError(e)}))}).catch(e=>{this.handleTransactionError(e)})})}tryRunUpdateFunction(e){try{let t=this.updateFunction(e);if(sa(t)||!t.catch||!t.then)return this.deferred.reject(Error("Transaction callback must return a Promise")),null;return t}catch(e){return this.deferred.reject(e),null}}handleTransactionError(e){this.attemptsRemaining>0&&this.isRetryableTransactionError(e)?(this.attemptsRemaining-=1,this.asyncQueue.enqueueAndForget(()=>(this.runWithBackOff(),Promise.resolve()))):this.deferred.reject(e)}isRetryableTransactionError(e){if(e?.name==="FirebaseError"){let t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!lu(t)}return!1}}let gk="FirestoreClient",gx=100,gR=11,gD=20,gA=22;class gO{constructor(e,t,r,n,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=n,this.user=tO.UNAUTHENTICATED,this.clientId=rp.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async e=>{tj(gk,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(r,e=>(tj(gk,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:gx}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new rr;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(r){let t=mn(r,"Failed to shutdown persistence");e.reject(t)}}),e.promise}}async function gN(e,t){e.asyncQueue.verifyOperationInProgress(),tj(gk,"Initializing OfflineComponentProvider");let r=e.configuration;await t.initialize(r);let n=r.initialUser;e.setCredentialChangeListener(async e=>{n.isEqual(e)||(await dY(t.localStore,e),n=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function gP(e,t){e.asyncQueue.verifyOperationInProgress();let r=await gL(e);tj(gk,"Initializing OnlineComponentProvider"),await t.initialize(r,e.configuration),e.setCredentialChangeListener(e=>p8(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,r)=>p8(t.remoteStore,r)),e._onlineComponents=t}function gM(e){return"FirebaseError"===e.name?e.code===t6||e.code===t8:!("undefined"!=typeof DOMException&&e instanceof DOMException)||e.code===gA||e.code===gD||e.code===gR}async function gL(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){tj(gk,"Using user provided OfflineComponentProvider");try{await gN(e,e._uninitializedComponentsProvider._offline)}catch(r){let t=r;if(!gM(t))throw t;tz("Error using user provided cache. Falling back to memory cache: "+t),await gN(e,new gh)}}else tj(gk,"Using default OfflineComponentProvider"),await gN(e,new gd(void 0));return e._offlineComponents}async function gB(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(tj(gk,"Using user provided OnlineComponentProvider"),await gP(e,e._uninitializedComponentsProvider._online)):(tj(gk,"Using default OnlineComponentProvider"),await gP(e,new gm))),e._onlineComponents}function gF(e){return gL(e).then(e=>e.persistence)}function gj(e){return gL(e).then(e=>e.localStore)}function gV(e){return gB(e).then(e=>e.remoteStore)}function gz(e){return gB(e).then(e=>e.syncEngine)}function gq(e){return gB(e).then(e=>e.datastore)}async function gU(e){let t=await gB(e),r=t.eventManager;return r.onListen=mM.bind(null,t.syncEngine),r.onUnlisten=mj.bind(null,t.syncEngine),r.onFirstRemoteStoreListen=mL.bind(null,t.syncEngine),r.onLastRemoteStoreUnlisten=mV.bind(null,t.syncEngine),r}function g$(e){return e.asyncQueue.enqueue(async()=>{let t=await gF(e),r=await gV(e);return t.setNetworkEnabled(!0),pR(r)})}function gK(e){return e.asyncQueue.enqueue(async()=>{let t=await gF(e),r=await gV(e);return t.setNetworkEnabled(!1),pA(r)})}function gW(e){let t=new rr;return e.asyncQueue.enqueueAndForget(async()=>mG(await gz(e),t)),t.promise}function gG(e,t,r,n){let i=new gb(n),s=new mS(t,i,r);return e.asyncQueue.enqueueAndForget(async()=>mh(await gU(e),s)),()=>{i.mute(),e.asyncQueue.enqueueAndForget(async()=>md(await gU(e),s))}}function gH(e,t){let r=new rr;return e.asyncQueue.enqueueAndForget(async()=>g2(await gj(e),t,r)),r.promise}function gQ(e,t,r={}){let n=new rr;return e.asyncQueue.enqueueAndForget(async()=>g3(await gU(e),e.asyncQueue,t,r,n)),n.promise}function gJ(e,t){let r=new rr;return e.asyncQueue.enqueueAndForget(async()=>g6(await gj(e),t,r)),r.promise}function gY(e,t,r={}){let n=new rr;return e.asyncQueue.enqueueAndForget(async()=>g4(await gU(e),e.asyncQueue,t,r,n)),n.promise}function gX(e,t,r){let n=new rr;return e.asyncQueue.enqueueAndForget(async()=>{try{let i=await gq(e);n.resolve(pv(i,t,r))}catch(e){n.reject(e)}}),n.promise}function gZ(e,t){let r=new rr;return e.asyncQueue.enqueueAndForget(async()=>mz(await gz(e),t,r)),r.promise}function g0(e,t){let r=new gb(t);return e.asyncQueue.enqueueAndForget(async()=>mg(await gU(e),r)),()=>{r.mute(),e.asyncQueue.enqueueAndForget(async()=>my(await gU(e),r))}}function g1(e,t,r){let n=new rr;return e.asyncQueue.enqueueAndForget(async()=>{let i=await gq(e);new gI(e.asyncQueue,i,r,t,n).run()}),n.promise}async function g2(e,t,r){try{let n=await d9(e,t);n.isFoundDocument()?r.resolve(n):n.isNoDocument()?r.resolve(null):r.reject(new rt(t9,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(n){let e=mn(n,`Failed to get document '${t} from cache`);r.reject(e)}}function g3(e,t,r,n,i){let s=new gb({next:o=>{s.mute(),t.enqueueAndForget(()=>md(e,a));let l=o.docs.has(r);!l&&o.fromCache?i.reject(new rt(t9,"Failed to get document because the client is offline.")):l&&o.fromCache&&n&&"server"===n.source?i.reject(new rt(t9,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:e=>i.reject(e)}),a=new mS(aH(r.path),s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return mh(e,a)}async function g6(e,t,r){try{let n=await fn(e,t,!0),i=new mx(t,n.remoteKeys),s=i.computeDocChanges(n.documents),a=i.applyChanges(s,!1);r.resolve(a.snapshot)}catch(n){let e=mn(n,`Failed to execute query '${t} against cache`);r.reject(e)}}function g4(e,t,r,n,i){let s=new gb({next:r=>{s.mute(),t.enqueueAndForget(()=>md(e,a)),r.fromCache&&"server"===n.source?i.reject(new rt(t9,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(r)},error:e=>i.reject(e)}),a=new mS(r,s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return mh(e,a)}function g5(e,t,r,n){let i=g7(r,pt(t));e.asyncQueue.enqueueAndForget(async()=>{gu(await gz(e),i,n)})}function g8(e,t){return e.asyncQueue.enqueue(async()=>fm(await gj(e),t))}function g7(e,t){let r;return gC(gv(r="string"==typeof e?lm().encode(e):e),t)}function g9(e,t){return gE(e,t)}function ye(e,t){return e.asyncQueue.enqueue(async()=>fy(await gj(e),t))}function yt(e,t){return e.asyncQueue.enqueue(async()=>fv(await gj(e),t))}function yr(e){return e.asyncQueue.enqueue(async()=>fb(await gj(e)))}function yn(e,t){return e.timeoutSeconds===t.timeoutSeconds}function yi(e){let t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}let ys="ComponentProvider",ya=new Map;function yo(e){let t=ya.get(e);t&&(tj(ys,"Removing Datastore"),ya.delete(e),t.terminate())}function yl(e,t,r,n){return new st(e,t,r,n.host,n.ssl,n.experimentalForceLongPolling,n.experimentalAutoDetectLongPolling,yi(n.experimentalLongPollingOptions),n.useFetchStreams,n.isUsingEmulator)}let yu="firestore.googleapis.com",yc=!0,yh=5,yd=30,yf=!0;class yp{constructor(e){if(void 0===e.host){if(void 0!==e.ssl)throw new rt(tY,"Can't provide ssl option if host option is not set");this.host=yu,this.ssl=yc}else this.host=e.host,this.ssl=e.ssl??yc;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=hA;else if(e.cacheSizeBytes!==hD&&e.cacheSizeBytes<hP)throw new rt(tY,`cacheSizeBytes must be at least ${hP}`);else this.cacheSizeBytes=e.cacheSizeBytes;rR("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=yf:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=yi(e.experimentalLongPollingOptions??{}),ym(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&yn(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}function ym(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new rt(tY,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<yh)throw new rt(tY,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is ${yh})`);if(e.timeoutSeconds>yd)throw new rt(tY,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is ${yd})`)}}class yg{constructor(e,t,r,n){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new yp({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new rt(t6,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new rt(t6,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new yp(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=rd(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return yo(this),Promise.resolve()}}function yy(e,t,r,n={}){e=rM(e,yg);let i=w(t),s=e._getSettings(),a={...s,emulatorOptions:e._getEmulatorOptions()},o=`${t}:${r}`;i&&(C(`https://${o}`),E("Firestore",!0)),s.host!==yu&&s.host!==o&&tz("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let l={...s,host:o,ssl:i,emulatorOptions:n};if(!U(l,a)&&(e._setSettings(l),n.mockUserToken)){let t,r;if("string"==typeof n.mockUserToken)t=n.mockUserToken,r=tO.MOCK_USER;else{t=T(n.mockUserToken,e._app?.options.projectId);let i=n.mockUserToken.sub||n.mockUserToken.user_id;if(!i)throw new rt(tY,"mockUserToken must contain 'sub' or 'user_id' field!");r=new tO(i)}e._authCredentials=new rs(new rn(t,r))}}class yv{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new yv(this.firestore,e,this._query)}}class yb{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new yS(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new yb(this.firestore,e,this._key)}toJSON(){return{type:yb._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(rF(t,yb._jsonSchema))return new yb(e,r||null,new rk(rE.fromString(t.referencePath)))}}yb._jsonSchemaVersion="firestore/documentReference/1.0",yb._jsonSchema={type:rB("string",yb._jsonSchemaVersion),referencePath:rB("string")};class yS extends yv{constructor(e,t,r){super(e,t,aH(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new yb(this.firestore,null,new rk(e))}withConverter(e){return new yS(this.firestore,e,this._path)}}function yw(e,t,...r){if(e=X(e),rx("collection","path",t),e instanceof yg){let n=rE.fromString(t,...r);return rA(n),new yS(e,null,n)}{if(!(e instanceof yb)&&!(e instanceof yS))throw new rt(tY,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=e._path.child(rE.fromString(t,...r));return rA(n),new yS(e.firestore,null,n)}}function yC(e,t){if(e=rM(e,yg),rx("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new rt(tY,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new yv(e,null,aX(t))}function yT(e,t,...r){if(e=X(e),1==arguments.length&&(t=rp.newId()),rx("doc","path",t),e instanceof yg){let n=rE.fromString(t,...r);return rD(n),new yb(e,null,new rk(n))}{if(!(e instanceof yb)&&!(e instanceof yS))throw new rt(tY,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=e._path.child(rE.fromString(t,...r));return rD(n),new yb(e.firestore,e instanceof yS?e.converter:null,new rk(n))}}function yE(e,t){return e=X(e),t=X(t),(e instanceof yb||e instanceof yS)&&(t instanceof yb||t instanceof yS)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function y_(e,t){return e=X(e),t=X(t),e instanceof yv&&t instanceof yv&&e.firestore===t.firestore&&oe(e._query,t._query)&&e.converter===t.converter}let yI="AsyncQueue";class yk{constructor(e=Promise.resolve()){this.retryableOps=[],this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.skipNonRestrictedTasks=!1,this.timerIdsToSkip=[],this.backoff=new pa(this,"async_queue_retry"),this.visibilityHandler=()=>{this.backoff.skipBackoff()},this.tail=e}get isShuttingDown(){return this._isShuttingDown}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.verifyNotFailed(),this.enqueueInternal(e)}enterRestrictedMode(e){this._isShuttingDown||(this._isShuttingDown=!0,this.skipNonRestrictedTasks=e||!1)}enqueue(e){if(this.verifyNotFailed(),this._isShuttingDown)return new Promise(()=>{});let t=new rr;return this.enqueueInternal(()=>this._isShuttingDown&&this.skipNonRestrictedTasks?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.retryableOps.push(e),this.retryNextOp()))}async retryNextOp(){if(0!==this.retryableOps.length){try{await this.retryableOps[0](),this.retryableOps.shift(),this.backoff.reset()}catch(e){if(ns(e))tj(yI,"Operation failed with retryable error: "+e);else throw e}this.retryableOps.length>0&&this.backoff.backoffAndRun(()=>this.retryNextOp())}}enqueueInternal(e){let t=this.tail.then(()=>(this.operationInProgress=!0,e().catch(e=>{throw this.failure=e,this.operationInProgress=!1,tV("INTERNAL UNHANDLED ERROR: ",yx(e)),e}).then(e=>(this.operationInProgress=!1,e))));return this.tail=t,t}enqueueAfterDelay(e,t,r){this.verifyNotFailed(),this.timerIdsToSkip.indexOf(e)>-1&&(t=0);let n=mr.createAndSchedule(this,e,t,r,e=>this.removeDelayedOperation(e));return this.delayedOperations.push(n),n}verifyNotFailed(){this.failure&&tU(47125,{messageOrStack:yx(this.failure)})}verifyOperationInProgress(){}async drain(){let e;do e=this.tail,await e;while(e!==this.tail)}containsDelayedOperation(e){for(let t of this.delayedOperations)if(t.timerId===e)return!0;return!1}runAllDelayedOperationsUntil(e){return this.drain().then(()=>{for(let t of(this.delayedOperations.sort((e,t)=>e.targetTimeMs-t.targetTimeMs),this.delayedOperations))if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.drain()})}skipDelaysForTimerId(e){this.timerIdsToSkip.push(e)}removeDelayedOperation(e){let t=this.delayedOperations.indexOf(e);this.delayedOperations.splice(t,1)}}function yx(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}class yR{constructor(){this._progressObserver={},this._taskCompletionResolver=new rr,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}let yD=hD;class yA extends yg{constructor(e,t,r,n){super(e,t,r,n),this.type="firestore",this._queue=new yk,this._persistenceKey=n?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new yk(e),this._firestoreClient=void 0,await e}}}function yO(e,t,r){r||(r=sr);let n=eH(e,"firestore");if(n.isInitialized(r)){let e=n.getImmediate({identifier:r});if(U(n.getOptions(r),t))return e;throw new rt(t6,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(void 0!==t.cacheSizeBytes&&void 0!==t.localCache)throw new rt(tY,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(void 0!==t.cacheSizeBytes&&t.cacheSizeBytes!==yD&&t.cacheSizeBytes<hP)throw new rt(tY,`cacheSizeBytes must be at least ${hP}`);return t.host&&w(t.host)&&C(t.host),n.initialize({options:t,instanceIdentifier:r})}function yN(e,t){let r="object"==typeof e?e:e8(),n="string"==typeof e?e:t||sr,i=eH(r,"firestore").getImmediate({identifier:n});if(!i._initialized){let e=v("firestore");e&&yy(i,...e)}return i}function yP(e){if(e._terminated)throw new rt(t6,"The client has already been terminated.");return e._firestoreClient||yM(e),e._firestoreClient}function yM(e){let t=e._freezeSettings(),r=yl(e._databaseId,e._app?.options.appId||"",e._persistenceKey,t);!e._componentsProvider&&t.localCache?._offlineComponentProvider&&t.localCache?._onlineComponentProvider&&(e._componentsProvider={_offline:t.localCache._offlineComponentProvider,_online:t.localCache._onlineComponentProvider}),e._firestoreClient=new gO(e._authCredentials,e._appCheckCredentials,e._queue,r,e._componentsProvider&&yL(e._componentsProvider))}function yL(e){let t=e?._online.build();return{_offline:e?._offline.build(t),_online:t}}function yB(e,t){tz("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let r=e._freezeSettings();return yj(e,gm.provider,{build:e=>new gf(e,r.cacheSizeBytes,t?.forceOwnership)}),Promise.resolve()}async function yF(e){tz("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=e._freezeSettings();yj(e,gm.provider,{build:e=>new gp(e,t.cacheSizeBytes)})}function yj(e,t,r){if((e=rM(e,yA))._firestoreClient||e._terminated)throw new rt(t6,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(e._componentsProvider||e._getSettings().localCache)throw new rt(t6,"SDK cache is already specified.");e._componentsProvider={_online:t,_offline:r},yM(e)}function yV(e){if(e._initialized&&!e._terminated)throw new rt(t6,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let t=new rr;return e._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await d$(dU(e._databaseId,e._persistenceKey)),t.resolve()}catch(e){t.reject(e)}}),t.promise}function yz(e){return gW(yP(e=rM(e,yA)))}function yq(e){return g$(yP(e=rM(e,yA)))}function yU(e){return gK(yP(e=rM(e,yA)))}function y$(e){return eQ(e.app,"firestore",e._databaseId.database),e._delete()}function yK(e,t){let r=yP(e=rM(e,yA)),n=new yR;return g5(r,e._databaseId,t,n),n}function yW(e,t){return g8(yP(e=rM(e,yA)),t).then(t=>t?new yv(e,null,t.query):null)}function yG(e,t=!0){tP(e6),eG(new Z("firestore",(e,{instanceIdentifier:r,options:n})=>{let i=e.getProvider("app").getImmediate(),s=new yA(new ra(e.getProvider("auth-internal")),new rc(i,e.getProvider("app-check-internal")),si(i,r),i);return n={useFetchStreams:t,...n},s._setSettings(n),s},"PUBLIC").setMultipleInstances(!0)),te(tD,tA,e),te(tD,tA,"esm2020")}class yH{constructor(e,t,r){this.alias=e,this.aggregateType=t,this.fieldPath=r}}class yQ{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class yJ{constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}class yY{constructor(e){this._byteString=e}static fromBase64String(e){try{return new yY(iJ.fromBase64String(e))}catch(e){throw new rt(tY,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new yY(iJ.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:yY._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(rF(e,yY._jsonSchema))return yY.fromBase64String(e.bytes)}}yY._jsonSchemaVersion="firestore/bytes/1.0",yY._jsonSchema={type:rB("string",yY._jsonSchemaVersion),bytes:rB("string")};class yX{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new rt(tY,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new rI(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function yZ(){return new yX(rC)}class y0{constructor(e){this._methodName=e}}class y1{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new rt(tY,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new rt(tY,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return rm(this._lat,e._lat)||rm(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:y1._jsonSchemaVersion}}static fromJSON(e){if(rF(e,y1._jsonSchema))return new y1(e.latitude,e.longitude)}}y1._jsonSchemaVersion="firestore/geoPoint/1.0",y1._jsonSchema={type:rB("string",y1._jsonSchemaVersion),latitude:rB("number"),longitude:rB("number")};class y2{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return dW(this._values,e._values)}toJSON(){return{type:y2._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(rF(e,y2._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(e=>"number"==typeof e))return new y2(e.vectorValues);throw new rt(tY,"Expected 'vectorValues' field to be a number array")}}}y2._jsonSchemaVersion="firestore/vectorValue/1.0",y2._jsonSchema={type:rB("string",y2._jsonSchemaVersion),vectorValues:rB("object")};let y3=/^__.*__$/;class y6{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new o4(e,this.data,this.fieldMask,t,this.fieldTransforms):new o2(e,this.data,t,this.fieldTransforms)}}class y4{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new o4(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function y5(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw tU(40011,{dataSource:e})}}class y8{constructor(e,t,r,n,i,s){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=n,void 0===i&&this.validatePath(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new y8({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){let t=this.path?.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePathSegment(e),r}childContextForFieldPath(e){let t=this.path?.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePath(),r}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return vw(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(0===e.length)throw this.createError("Document fields must not be empty");if(y5(this.dataSource)&&y3.test(e))throw this.createError('Document fields cannot begin and end with "__"')}}class y7{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||pt(e)}createContext(e,t,r,n=!1){return new y8({dataSource:e,methodName:t,targetDoc:r,path:rI.emptyPath(),arrayElement:!1,hasConverter:n},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function y9(e){let t=e._freezeSettings(),r=pt(e._databaseId);return new y7(e._databaseId,!!t.ignoreUndefinedProperties,r)}function ve(e,t,r,n,i,s={}){let a,o,l=e.createContext(s.merge||s.mergeFields?2:0,t,r,i);vy("Data must be an object, but it was:",l,n);let u=vh(n,l);if(s.merge)a=new iW(l.fieldMask),o=l.fieldTransforms;else if(s.mergeFields){let e=[];for(let n of s.mergeFields){let i=vv(t,n,r);if(!l.contains(i))throw new rt(tY,`Field '${i}' is specified in your field mask but missing from your input data.`);vC(e,i)||e.push(i)}a=new iW(e),o=l.fieldTransforms.filter(e=>a.covers(e.field))}else a=null,o=l.fieldTransforms;return new y6(new s4(u),a,o)}class vt extends y0{_toFieldTransform(e){if(2===e.dataSource)e.fieldMask.push(e.path);else if(1===e.dataSource)throw e.createError(`${this._methodName}() can only appear at the top level of your update data`);else throw e.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return null}isEqual(e){return e instanceof vt}}function vr(e,t,r){return new y8({dataSource:3,targetDoc:t.settings.targetDoc,methodName:e._methodName,arrayElement:r},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class vn extends y0{_toFieldTransform(e){return new o$(e.path,new oM)}isEqual(e){return e instanceof vn}}class vi extends y0{constructor(e,t){super(e),this._elements=t}_toFieldTransform(e){let t=vr(this,e,!0),r=new oL(this._elements.map(e=>vc(e,t)));return new o$(e.path,r)}isEqual(e){return e instanceof vi&&U(this._elements,e._elements)}}class vs extends y0{constructor(e,t){super(e),this._elements=t}_toFieldTransform(e){let t=vr(this,e,!0),r=new oF(this._elements.map(e=>vc(e,t)));return new o$(e.path,r)}isEqual(e){return e instanceof vs&&U(this._elements,e._elements)}}class va extends y0{constructor(e,t){super(e),this._operand=t}_toFieldTransform(e){let t=new oV(e.serializer,oR(e.serializer,this._operand));return new o$(e.path,t)}isEqual(e){return e instanceof va&&this._operand===e._operand}}function vo(e,t,r,n){let i=e.createContext(1,t,r);vy("Data must be an object, but it was:",i,n);let s=[],a=s4.empty();return iM(n,(e,n)=>{let o=vS(t,e,r);n=X(n);let l=i.childContextForFieldPath(o);if(n instanceof vt)s.push(o);else{let e=vc(n,l);null!=e&&(s.push(o),a.set(o,e))}}),new y4(a,new iW(s),i.fieldTransforms)}function vl(e,t,r,n,i,s){let a=e.createContext(1,t,r),o=[vv(t,n,r)],l=[i];if(s.length%2!=0)throw new rt(tY,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)o.push(vv(t,s[e])),l.push(s[e+1]);let u=[],c=s4.empty();for(let e=o.length-1;e>=0;--e)if(!vC(u,o[e])){let t=o[e],r=l[e];r=X(r);let n=a.childContextForFieldPath(t);if(r instanceof vt)u.push(t);else{let e=vc(r,n);null!=e&&(u.push(t),c.set(t,e))}}return new y4(c,new iW(u),a.fieldTransforms)}function vu(e,t,r,n=!1){return vc(r,e.createContext(n?4:3,t))}function vc(e,t){if(vg(e=X(e)))return vy("Unsupported field value:",t,e),vh(e,t);if(e instanceof y0)return vf(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),!(e instanceof Array))return vp(e,t);if(t.settings.arrayElement&&4!==t.dataSource)throw t.createError("Nested arrays are not supported");return vd(e,t)}function vh(e,t){let r={};return iB(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):iM(e,(e,n)=>{let i=vc(n,t.childContextForField(e));null!=i&&(r[e]=i)}),{mapValue:{fields:r}}}function vd(e,t){let r=[],n=0;for(let i of e){let e=vc(i,t.childContextForArray(n));null==e&&(e={nullValue:"NULL_VALUE"}),r.push(e),n++}return{arrayValue:{values:r}}}function vf(e,t){if(!y5(t.dataSource))throw t.createError(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.createError(`${e._methodName}() is not currently supported inside arrays`);let r=e._toFieldTransform(t);r&&t.fieldTransforms.push(r)}function vp(e,t){if(null===(e=X(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return oR(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){let r=rz.fromDate(e);return{timestampValue:lz(t.serializer,r)}}else if(e instanceof rz){let r=new rz(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:lz(t.serializer,r)}}else if(e instanceof y1)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};else if(e instanceof yY)return{bytesValue:lU(t.serializer,e._byteString)};else if(e instanceof yb){let r=t.databaseId,n=e.firestore._databaseId;if(!n.isEqual(r))throw t.createError(`Document reference is for database ${n.projectId}/${n.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:lG(e.firestore._databaseId||t.databaseId,e._key.path)}}else if(e instanceof y2)return vm(e,t);else throw t.createError(`Unsupported field value: ${rN(e)}`)}function vm(e,t){return{mapValue:{fields:{[su]:{stringValue:sd},[sf]:{arrayValue:{values:e.toArray().map(e=>{if("number"!=typeof e)throw t.createError("VectorValues must only contain numeric values.");return ok(t.serializer,e)})}}}}}}function vg(e){return"object"==typeof e&&null!==e&&!(e instanceof Array)&&!(e instanceof Date)&&!(e instanceof rz)&&!(e instanceof y1)&&!(e instanceof yY)&&!(e instanceof yb)&&!(e instanceof y0)&&!(e instanceof y2)}function vy(e,t,r){if(!vg(r)||!rO(r)){let n=rN(r);if("an object"===n)throw t.createError(e+" a custom object");throw t.createError(e+" "+n)}}function vv(e,t,r){if((t=X(t))instanceof yX)return t._internalPath;if("string"==typeof t)return vS(e,t);throw vw("Field path arguments must be of type string or ",e,!1,void 0,r)}let vb=RegExp("[~\\*/\\[\\]]");function vS(e,t,r){if(t.search(vb)>=0)throw vw(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,r);try{return new yX(...t.split("."))._internalPath}catch(n){throw vw(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,r)}}function vw(e,t,r,n,i){let s=n&&!n.isEmpty(),a=void 0!==i,o=`Function ${t}() called with invalid data`;r&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${n}`),a&&(l+=` in document ${i}`),l+=")"),new rt(tY,o+e+l)}function vC(e,t){return e.some(e=>e.isEqual(t))}class vT{constructor(e,t,r,n,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=n,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new yb(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(!this._converter)return this._userDataWriter.convertValue(this._document.data.value);{let e=new vE(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}}}get(e){if(this._document){let t=this._document.data.field(v_("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class vE extends vT{data(){return super.data()}}function v_(e,t){return"string"==typeof t?vS(e,t):t instanceof yX?t._internalPath:t._delegate._internalPath}function vI(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new rt(t8,"limitToLast() queries require specifying at least one orderBy() clause")}class vk{}class vx extends vk{}function vR(e,t,...r){let n=[];for(let i of(t instanceof vk&&n.push(t),v6(n=n.concat(r)),n))e=i._apply(e);return e}class vD extends vx{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new vD(e,t,r)}_apply(e){let t=this._parse(e);return v0(e._query,t),new yv(e.firestore,e.converter,a4(e._query,t))}_parse(e){let t=y9(e.firestore);return vG(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function vA(e,t,r){let n=t,i=v_("where",e);return vD._create(i,n,r)}class vO extends vk{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new vO(e,t)}_parse(e){let t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:ac.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return 0===t.getFilters().length?e:(v1(e._query,t),new yv(e.firestore,e.converter,a4(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}function vN(...e){return e.forEach(e=>v3("or",e)),vO._create("or",e)}function vP(...e){return e.forEach(e=>v3("and",e)),vO._create("and",e)}class vM extends vx{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new vM(e,t)}_apply(e){let t=vH(e._query,this._field,this._direction);return new yv(e.firestore,e.converter,a5(e._query,t))}}function vL(e,t="asc"){let r=t,n=v_("orderBy",e);return vM._create(n,r)}class vB extends vx{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new vB(e,t,r)}_apply(e){return new yv(e.firestore,e.converter,a8(e._query,this._limit,this._limitType))}}function vF(e){return rL("limit",e),vB._create("limit",e,"F")}function vj(e){return rL("limitToLast",e),vB._create("limitToLast",e,"L")}class vV extends vx{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new vV(e,t,r)}_apply(e){let t=vW(e,this.type,this._docOrFields,this._inclusive);return new yv(e.firestore,e.converter,a7(e._query,t))}}function vz(...e){return vV._create("startAt",e,!0)}function vq(...e){return vV._create("startAfter",e,!1)}class vU extends vx{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new vU(e,t,r)}_apply(e){let t=vW(e,this.type,this._docOrFields,this._inclusive);return new yv(e.firestore,e.converter,a9(e._query,t))}}function v$(...e){return vU._create("endBefore",e,!1)}function vK(...e){return vU._create("endAt",e,!0)}function vW(e,t,r,n){if(r[0]=X(r[0]),r[0]instanceof vT)return vQ(e._query,e.firestore._databaseId,t,r[0]._document,n);{let i=y9(e.firestore);return vJ(e._query,e.firestore._databaseId,i,t,r,n)}}function vG(e,t,r,n,i,s,a){let o;if(i.isKeyField())if("array-contains"===s||"array-contains-any"===s)throw new rt(tY,`Invalid Query. You can't perform '${s}' queries on documentId().`);else if("in"===s||"not-in"===s){vX(a,s);let t=[];for(let r of a)t.push(vY(n,e,r));o={arrayValue:{values:t}}}else o=vY(n,e,a);else("in"===s||"not-in"===s||"array-contains-any"===s)&&vX(a,s),o=vu(r,t,a,"in"===s||"not-in"===s);return au.create(i,s,o)}function vH(e,t,r){if(null!==e.startAt)throw new rt(tY,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new rt(tY,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new ai(t,r)}function vQ(e,t,r,n,i){if(!n)throw new rt(tZ,`Can't use a DocumentSnapshot that doesn't exist for ${r}().`);let s=[];for(let r of a1(e))if(r.field.isKeyField())s.push(sU(t,n.key));else{let e=n.data.field(r.field);if(i8(e))throw new rt(tY,'Invalid query. You are trying to start or end a query using a document for which the field "'+r.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null!==e)s.push(e);else{let e=r.field.canonicalString();throw new rt(tY,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}}return new s9(s,i)}function vJ(e,t,r,n,i,s){let a=e.explicitOrderBy;if(i.length>a.length)throw new rt(tY,`Too many arguments provided to ${n}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let o=[];for(let s=0;s<i.length;s++){let l=i[s];if(a[s].field.isKeyField()){if("string"!=typeof l)throw new rt(tY,`Invalid query. Expected a string for document ID in ${n}(), but got a ${typeof l}`);if(!a0(e)&&-1!==l.indexOf("/"))throw new rt(tY,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${n}() must be a plain document ID, but '${l}' contains a slash.`);let r=e.path.child(rE.fromString(l));if(!rk.isDocumentKey(r))throw new rt(tY,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${n}() must result in a valid document path, but '${r}' is not because it contains an odd number of segments.`);let i=new rk(r);o.push(sU(t,i))}else{let e=vu(r,n,l);o.push(e)}}return new s9(o,s)}function vY(e,t,r){if("string"==typeof(r=X(r))){if(""===r)throw new rt(tY,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!a0(t)&&-1!==r.indexOf("/"))throw new rt(tY,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${r}' contains a '/' character.`);let n=t.path.child(rE.fromString(r));if(!rk.isDocumentKey(n))throw new rt(tY,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return sU(e,new rk(n))}if(r instanceof yb)return sU(e,r._key);throw new rt(tY,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${rN(r)}.`)}function vX(e,t){if(!Array.isArray(e)||0===e.length)throw new rt(tY,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function vZ(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}function v0(e,t){let r=v2(e.filters,vZ(t.op));if(null!==r)if(r===t.op)throw new rt(tY,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`);else throw new rt(tY,`Invalid query. You cannot use '${t.op.toString()}' filters with '${r.toString()}' filters.`)}function v1(e,t){let r=e;for(let e of t.getFlattenedFilters())v0(r,e),r=a4(r,e)}function v2(e,t){for(let r of e)for(let e of r.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}function v3(e,t){if(!(t instanceof vD)&&!(t instanceof vO))throw new rt(tY,`Function ${e}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}function v6(e){let t=e.filter(e=>e instanceof vO).length,r=e.filter(e=>e instanceof vD).length;if(t>1||t>0&&r>0)throw new rt(tY,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}class v4{convertValue(e,t="none"){switch(sm(e)){case 0:return null;case 1:return e.booleanValue;case 2:return i1(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(i2(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw tU(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return iM(e,(e,n)=>{r[e]=this.convertValue(n,t)}),r}convertVectorValue(e){return new y2(e.fields?.[sf].arrayValue?.values?.map(e=>i1(e.doubleValue)))}convertGeoPoint(e){return new y1(i1(e.latitude),i1(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=i9(e);if(null==r)return null;return this.convertValue(r,t);case"estimate":return this.convertTimestamp(se(e));default:return null}}convertTimestamp(e){let t=i0(e);return new rz(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=rE.fromString(e);tK(uW(r),9688,{name:e});let n=new sn(r.get(1),r.get(3)),i=new rk(r.popFirst(5));return n.isEqual(t)||tV(`Document ${i} contains a document reference within a different database (${n.projectId}/${n.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function v5(e,t,r){return e?r&&(r.merge||r.mergeFields)?e.toFirestore(t,r):e.toFirestore(t):t}class v8 extends v4{constructor(e){super(),this.firestore=e}convertBytes(e){return new yY(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new yb(this.firestore,null,t)}}function v7(e){return new yQ("sum",vv("sum",e))}function v9(e){return new yQ("avg",vv("average",e))}function be(){return new yQ("count")}function bt(e,t){return e instanceof yQ&&t instanceof yQ&&e.aggregateType===t.aggregateType&&e._internalFieldPath?.canonicalString()===t._internalFieldPath?.canonicalString()}function br(e,t){return y_(e.query,t.query)&&U(e.data(),t.data())}function bn(e){return bi(e,["next","error","complete"])}function bi(e,t){if("object"!=typeof e||null===e)return!1;let r=e;for(let e of t)if(e in r&&"function"==typeof r[e])return!0;return!1}let bs=lm();function ba(e){let t=JSON.stringify(e),r=bs.encode(t).byteLength;return`${r}${t}`}ba({metadata:{id:"test-bundle",createTime:{seconds:0x5e0be105,nanos:6},version:1,totalDocuments:1,totalBytes:416}}),ba({documentMetadata:{name:"projects/test-project/databases/(default)/documents/collectionId/doc1",readTime:{seconds:5,nanos:6},exists:!0}}),ba({document:{name:"projects/test-project/databases/(default)/documents/collectionId/doc1",createTime:{seconds:1,nanos:2e6},updateTime:{seconds:3,nanos:4e3},fields:{foo:{stringValue:"value"},bar:{integerValue:-42}}}}),ba({documentMetadata:{name:"projects/test-project/databases/(default)/documents/collectionId/doc2",readTime:{seconds:5,nanos:6},exists:!0}}),ba({document:{name:"projects/test-project/databases/(default)/documents/collectionId/doc2",createTime:{seconds:1,nanos:2e6},updateTime:{seconds:3,nanos:4e3},fields:{foo:{stringValue:"value1"},bar:{integerValue:42},emptyArray:{arrayValue:{}},emptyMap:{mapValue:{}}}}}),ba({documentMetadata:{name:"projects/test-project/databases/(default)/documents/collectionId/nodoc",readTime:{seconds:5,nanos:6},exists:!1}}),ba({namedQuery:{name:"limitQuery",bundledQuery:{parent:"projects/fireeats-97d5e/databases/(default)/documents",structuredQuery:{from:[{collectionId:"node_3.7.5_7Li7XoCjutvNxwD0tpo9"}],orderBy:[{field:{fieldPath:"sort"},direction:"DESCENDING"}],limit:{value:1}},limitType:"FIRST"},readTime:{seconds:0x5ec5a5f3,nanos:191164e3}}}),ba({namedQuery:{name:"limitToLastQuery",bundledQuery:{parent:"projects/fireeats-97d5e/databases/(default)/documents",structuredQuery:{from:[{collectionId:"node_3.7.5_7Li7XoCjutvNxwD0tpo9"}],orderBy:[{field:{fieldPath:"sort"},direction:"ASCENDING"}],limit:{value:1}},limitType:"LAST"},readTime:{seconds:0x5ec5a5f3,nanos:543063e3}}});let bo=1;class bl{constructor(e,t){this.firestore=e,this.bundleId=t,this.documents=new Map,this.namedQueries=new Map,this.latestReadTime=new rz(0,0),this.databaseId=e._databaseId,this.serializer=new lB(this.databaseId,!0),this.userDataReader=new y7(this.databaseId,!0,this.serializer)}addBundleDocument(e,t){let r=this.documents.get(e.documentPath),n=r?.metadata.queries,i=e.readTime,s=r?.metadata.readTime?lq(r.metadata.readTime):null,a=!i&&null==s,o=void 0!==i&&(null==s||s<i);if((a||o)&&this.documents.set(e.documentPath,{document:this.toBundleDocument(e),metadata:{name:lJ(this.serializer,e.documentKey),readTime:i?lz(this.serializer,i):void 0,exists:e.documentExists}}),i&&i>this.latestReadTime&&(this.latestReadTime=i),t){let r=this.documents.get(e.documentPath);r.metadata.queries=n||[],r.metadata.queries.push(t)}}addBundleQuery(e){if(this.namedQueries.has(e.name))throw Error(`Query name conflict: ${name} has already been added.`);let t=new rz(0,0);for(let r of e.docBundleDataArray)this.addBundleDocument(r,e.name),r.readTime&&r.readTime>t&&(t=r.readTime);let r=ud(this.serializer,a2(e.query)),n={parent:e.parent,structuredQuery:r.queryTarget.structuredQuery};this.namedQueries.set(e.name,{name:e.name,bundledQuery:n,readTime:lz(this.serializer,t)})}toBundleDocument(e){let t=this.userDataReader.createContext(4,"internal toBundledDocument"),r=vh(e.documentData,t);return{name:lJ(this.serializer,e.documentKey),fields:r.mapValue.fields,updateTime:lz(this.serializer,e.versionTime),createTime:lz(this.serializer,e.createdTime)}}lengthPrefixedString(e){let t=JSON.stringify(e),r=bs.encode(t).byteLength;return`${r}${t}`}build(){let e="";for(let t of this.namedQueries.values())e+=this.lengthPrefixedString({namedQuery:t});for(let t of this.documents.values()){let r=t.metadata;e+=this.lengthPrefixedString({documentMetadata:r});let n=t.document;n&&(e+=this.lengthPrefixedString({document:n}))}let t={id:this.bundleId,createTime:lz(this.serializer,this.latestReadTime),version:bo,totalDocuments:this.documents.size,totalBytes:bs.encode(e).length};return this.lengthPrefixedString({metadata:t})+e}}function bu(e,t,r,n){let i=new bl(e,rp.newId());return i.addBundleDocument(bh(n,r,t)),i.build()}function bc(e,t,r,n,i,s,a){let o=[];for(let e=0;e<s.length;e++)o.push(bh(i[e],a[e],s[e]));let l={name:r,query:t,parent:n,docBundleDataArray:o},u=new bl(e,r);return u.addBundleQuery(l),u.build()}function bh(e,t,r){return{documentData:t,documentKey:r.mutableCopy().key,documentPath:e,documentExists:!0,createdTime:r.createTime.toTimestamp(),readTime:r.readTime.toTimestamp(),versionTime:r.version.toTimestamp()}}let bd="NOT SUPPORTED";class bf{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class bp extends vT{constructor(e,t,r,n,i,s){super(e,t,r,n,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(!this._converter)return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps);{let t=new bg(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}}}get(e,t={}){if(this._document){let r=this._document.data.field(v_("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new rt(t6,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e=this._document,t={};if(t.type=bp._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument())return t;let r=this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous");return t.bundle=bu(this._firestore,e,r,this.ref.path),t}}function bm(e,t,r){if(rF(t,bp._jsonSchema)){if(t.bundle===bd)throw new rt(tY,"The provided JSON object was created in a client environment, which is not supported.");let n=pt(e._databaseId),i=g9(t.bundle,n),s=i.getElements(),a=new mT(i.getMetadata(),n);for(let e of s)a.addSizedElement(e);let o=a.documents;if(1!==o.length)throw new rt(tY,`Expected bundle data to contain 1 document, but it contains ${o.length} documents.`);let l=l4(n,o[0].document),u=new rk(rE.fromString(t.bundleName));return new bp(e,new v8(e),u,l,new bf(!1,!1),r||null)}}bp._jsonSchemaVersion="firestore/documentSnapshot/1.0",bp._jsonSchema={type:rB("string",bp._jsonSchemaVersion),bundleSource:rB("string","DocumentSnapshot"),bundleName:rB("string"),bundle:rB("string")};class bg extends bp{data(e={}){return super.data(e)}}class by{constructor(e,t,r,n){this._firestore=e,this._userDataWriter=t,this._snapshot=n,this.metadata=new bf(n.hasPendingWrites,n.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new bg(this._firestore,this._userDataWriter,r.key,r,new bf(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new rt(tY,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=bb(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new rt(t6,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e={};e.type=by._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=rp.newId();let t=this._firestore._databaseId.database,r=this._firestore._databaseId.projectId,n=`projects/${r}/databases/${t}/documents`,i=[],s=[],a=[];return this.docs.forEach(e=>{null!==e._document&&(i.push(e._document),s.push(this._userDataWriter.convertObjectMap(e._document.data.value.mapValue.fields,"previous")),a.push(e.ref.path))}),e.bundle=bc(this._firestore,this.query._query,e.bundleName,n,a,i,s),e}}function bv(e,t,r){if(rF(t,by._jsonSchema)){if(t.bundle===bd)throw new rt(tY,"The provided JSON object was created in a client environment, which is not supported.");let n=pt(e._databaseId),i=g9(t.bundle,n),s=i.getElements(),a=new mT(i.getMetadata(),n);for(let e of s)a.addSizedElement(e);if(1!==a.queries.length)throw new rt(tY,`Snapshot data expected 1 query but found ${a.queries.length} queries.`);let o=ce(a.queries[0].bundledQuery),l=a.documents,u=new mi;l.map(e=>{let t=l4(n,e.document);u=u.add(t)});let c=ma.fromInitialDocuments(o,u,oE(),!1,!1),h=new yv(e,r||null,o);return new by(e,new v8(e),h,c)}}function bb(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(r=>{let n=new bg(e._firestore,e._userDataWriter,r.doc.key,r.doc,new bf(e._snapshot.mutatedKeys.has(r.doc.key),e._snapshot.fromCache),e.query.converter);return r.doc,{type:"added",doc:n,oldIndex:-1,newIndex:t++}})}{let r=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{let n=new bg(e._firestore,e._userDataWriter,t.doc.key,t.doc,new bf(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,s=-1;return 0!==t.type&&(i=r.indexOf(t.doc.key),r=r.delete(t.doc.key)),1!==t.type&&(s=(r=r.add(t.doc)).indexOf(t.doc.key)),{type:bS(t.type),doc:n,oldIndex:i,newIndex:s}})}}function bS(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return tU(61501,{type:e})}}function bw(e,t){return e instanceof bp&&t instanceof bp?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof by&&t instanceof by&&e._firestore===t._firestore&&y_(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}function bC(e){e=rM(e,yb);let t=rM(e.firestore,yA);return gQ(yP(t),e._key).then(r=>bB(t,e,r))}by._jsonSchemaVersion="firestore/querySnapshot/1.0",by._jsonSchema={type:rB("string",by._jsonSchemaVersion),bundleSource:rB("string","QuerySnapshot"),bundleName:rB("string"),bundle:rB("string")};class bT extends v4{constructor(e){super(),this.firestore=e}convertBytes(e){return new yY(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new yb(this.firestore,null,t)}}function bE(e){e=rM(e,yb);let t=rM(e.firestore,yA),r=yP(t),n=new bT(t);return gH(r,e._key).then(r=>new bp(t,n,e._key,r,new bf(null!==r&&r.hasLocalMutations,!0),e.converter))}function b_(e){e=rM(e,yb);let t=rM(e.firestore,yA);return gQ(yP(t),e._key,{source:"server"}).then(r=>bB(t,e,r))}function bI(e){e=rM(e,yv);let t=rM(e.firestore,yA),r=yP(t),n=new bT(t);return vI(e._query),gY(r,e._query).then(r=>new by(t,n,e,r))}function bk(e){e=rM(e,yv);let t=rM(e.firestore,yA),r=yP(t),n=new bT(t);return gJ(r,e._query).then(r=>new by(t,n,e,r))}function bx(e){e=rM(e,yv);let t=rM(e.firestore,yA),r=yP(t),n=new bT(t);return gY(r,e._query,{source:"server"}).then(r=>new by(t,n,e,r))}function bR(e,t,r){e=rM(e,yb);let n=rM(e.firestore,yA),i=v5(e.converter,t,r),s=ve(y9(n),"setDoc",e._key,i,null!==e.converter,r).toMutation(e._key,oH.none());return bL(n,[s])}function bD(e,t,r,...n){let i;e=rM(e,yb);let s=rM(e.firestore,yA),a=y9(s);return bL(s,[(i="string"==typeof(t=X(t))||t instanceof yX?vl(a,"updateDoc",e._key,t,r,n):vo(a,"updateDoc",e._key,t)).toMutation(e._key,oH.exists(!0))])}function bA(e){return bL(rM(e.firestore,yA),[new lt(e._key,oH.none())])}function bO(e,t){let r=rM(e.firestore,yA),n=yT(e),i=v5(e.converter,t);return bL(r,[ve(y9(e.firestore),"addDoc",n._key,i,null!==e.converter,{}).toMutation(n._key,oH.exists(!1))]).then(()=>n)}function bN(e,...t){let r,n,i;e=X(e);let s={includeMetadataChanges:!1,source:"default"},a=0;"object"!=typeof t[0]||bn(t[a])||(s=t[a++]);let o={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(bn(t[a])){let e=t[a];t[a]=e.next?.bind(e),t[a+1]=e.error?.bind(e),t[a+2]=e.complete?.bind(e)}if(e instanceof yb)n=rM(e.firestore,yA),i=aH(e._key.path),r={next:r=>{t[a]&&t[a](bB(n,e,r))},error:t[a+1],complete:t[a+2]};else{let s=rM(e,yv);n=rM(s.firestore,yA),i=s._query;let o=new bT(n);r={next:e=>{t[a]&&t[a](new by(n,o,s,e))},error:t[a+1],complete:t[a+2]},vI(e._query)}return gG(yP(n),i,o,r)}function bP(e,t,...r){let n,i=X(e),s=bF(t);if(s.error)throw new rt(tY,s.error);let a=0;if("object"!=typeof r[0]||bn(r[a])||(n=r[a++]),"QuerySnapshot"===s.bundleSource){let e=null;if("object"==typeof r[a]&&bn(r[a])){let t=r[a++];e={next:t.next,error:t.error,complete:t.complete}}else e={next:r[a++],error:r[a++],complete:r[a++]};return bV(i,s,n,e,r[a])}if("DocumentSnapshot"===s.bundleSource){let e=null;if("object"==typeof r[a]&&bn(r[a])){let t=r[a++];e={next:t.next,error:t.error,complete:t.complete}}else e={next:r[a++],error:r[a++],complete:r[a++]};return bj(i,s,n,e,r[a])}throw new rt(tY,`unsupported bundle source: ${s.bundleSource}`)}function bM(e,t){return g0(yP(e=rM(e,yA)),bn(t)?t:{next:t})}function bL(e,t){return gZ(yP(e),t)}function bB(e,t,r){let n=r.docs.get(t._key),i=new bT(e);return new bp(e,i,t._key,n,new bf(r.hasPendingWrites,r.fromCache),t.converter)}function bF(e){let t={bundle:"",bundleName:"",bundleSource:""};for(let r of["bundle","bundleName","bundleSource"]){if(!(r in e)){t.error=`snapshotJson missing required field: ${r}`;break}let n=e[r];if("string"!=typeof n){t.error=`snapshotJson field '${r}' must be a string.`;break}if(0===n.length){t.error=`snapshotJson field '${r}' cannot be an empty string.`;break}"bundle"===r?t.bundle=n:"bundleName"===r?t.bundleName=n:"bundleSource"===r&&(t.bundleSource=n)}return t}function bj(e,t,r,n,i){let s,a=!1;return yK(e,t.bundle).then(()=>{a||(s=bN(new yb(e,i||null,rk.fromPath(t.bundleName)),r||{},n))}).catch(e=>(n.error&&n.error(e),()=>{})),()=>{!a&&(a=!0,s&&s())}}function bV(e,t,r,n,i){let s,a=!1;return yK(e,t.bundle).then(()=>yW(e,t.bundleName)).then(e=>{if(e&&!a){let t=e;i&&t.withConverter(i),s=bN(e,r||{},n)}}).catch(e=>(n.error&&n.error(e),()=>{})),()=>{!a&&(a=!0,s&&s())}}function bz(e){return bq(e,{count:be()})}function bq(e,t){let r=rM(e.firestore,yA),n=yP(r),i=iL(t,(e,t)=>new yH(t,e.aggregateType,e._internalFieldPath));return gX(n,e._query,i).then(t=>bU(r,e,t))}function bU(e,t,r){return new yJ(t,new bT(e),r)}class b${constructor(e){this.kind="memory",this._onlineComponentProvider=gm.provider,e?.garbageCollector?this._offlineComponentProvider=e.garbageCollector._offlineComponentProvider:this._offlineComponentProvider={build:()=>new gd(void 0)}}toJSON(){return{kind:this.kind}}}class bK{constructor(e){let t;this.kind="persistent",e?.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=b0(void 0))._initialize(e),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class bW{constructor(){this.kind="memoryEager",this._offlineComponentProvider=gh.provider}toJSON(){return{kind:this.kind}}}class bG{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new gd(e)}}toJSON(){return{kind:this.kind}}}function bH(){return new bW}function bQ(e){return new bG(e?.cacheSizeBytes)}function bJ(e){return new b$(e)}function bY(e){return new bK(e)}class bX{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=gm.provider,this._offlineComponentProvider={build:t=>new gf(t,e?.cacheSizeBytes,this.forceOwnership)}}}class bZ{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=gm.provider,this._offlineComponentProvider={build:t=>new gp(t,e?.cacheSizeBytes)}}}function b0(e){return new bX(e?.forceOwnership)}function b1(){return new bZ}let b2={maxAttempts:5};function b3(e){if(e.maxAttempts<1)throw new rt(tY,"Max attempts must be at least 1")}class b6{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=y9(e)}set(e,t,r){this._verifyNotCommitted();let n=b4(e,this._firestore),i=v5(n.converter,t,r),s=ve(this._dataReader,"WriteBatch.set",n._key,i,null!==n.converter,r);return this._mutations.push(s.toMutation(n._key,oH.none())),this}update(e,t,r,...n){let i;this._verifyNotCommitted();let s=b4(e,this._firestore);return i="string"==typeof(t=X(t))||t instanceof yX?vl(this._dataReader,"WriteBatch.update",s._key,t,r,n):vo(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(i.toMutation(s._key,oH.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=b4(e,this._firestore);return this._mutations=this._mutations.concat(new lt(t._key,oH.none())),this}commit(){return(this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0)?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new rt(t6,"A write batch can no longer be used after commit() has been called.")}}function b4(e,t){if((e=X(e)).firestore===t)return e;throw new rt(tY,"Provided document reference is from a different Firestore instance.")}class b5{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=y9(e)}get(e){let t=b4(e,this._firestore),r=new v8(this._firestore);return this._transaction.lookup([t._key]).then(e=>{if(!e||1!==e.length)return tU(24041);let n=e[0];if(n.isFoundDocument())return new vT(this._firestore,r,n.key,n,t.converter);if(n.isNoDocument())return new vT(this._firestore,r,t._key,null,t.converter);throw tU(18433,{doc:n})})}set(e,t,r){let n=b4(e,this._firestore),i=v5(n.converter,t,r),s=ve(this._dataReader,"Transaction.set",n._key,i,null!==n.converter,r);return this._transaction.set(n._key,s),this}update(e,t,r,...n){let i,s=b4(e,this._firestore);return i="string"==typeof(t=X(t))||t instanceof yX?vl(this._dataReader,"Transaction.update",s._key,t,r,n):vo(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,i),this}delete(e){let t=b4(e,this._firestore);return this._transaction.delete(t._key),this}}class b8 extends b5{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=b4(e,this._firestore),r=new bT(this._firestore);return super.get(e).then(e=>new bp(this._firestore,r,t._key,e._document,new bf(!1,!1),t.converter))}}function b7(e,t,r){e=rM(e,yA);let n={...b2,...r};return b3(n),g1(yP(e),r=>t(new b8(e,r)),n)}function b9(){return new vt("deleteField")}function Se(){return new vn("serverTimestamp")}function St(...e){return new vi("arrayUnion",e)}function Sr(...e){return new vs("arrayRemove",e)}function Sn(e){return new va("increment",e)}function Si(e){return new y2(e)}function Ss(e){return yP(e=rM(e,yA)),new b6(e,t=>bL(e,t))}function Sa(e,t){let r=yP(e=rM(e,yA));return r._uninitializedComponentsProvider&&"memory"!==r._uninitializedComponentsProvider._offline.kind?ye(r,So(t)):(tz("Cannot enable indexes when persistence is disabled"),Promise.resolve())}function So(e){let t="string"==typeof e?Sl(e):e,r=[];if(Array.isArray(t.indexes))for(let e of t.indexes){let t=Su(e,"collectionGroup"),n=[];if(Array.isArray(e.fields))for(let t of e.fields){let e=vS("setIndexConfiguration",Su(t,"fieldPath"));"CONTAINS"===t.arrayConfig?n.push(new rY(e,2)):"ASCENDING"===t.order?n.push(new rY(e,0)):"DESCENDING"===t.order&&n.push(new rY(e,1))}r.push(new rK(rK.UNKNOWN_ID,t,n,rZ.empty()))}return r}function Sl(e){try{return JSON.parse(e)}catch(e){throw new rt(tY,"Failed to parse JSON: "+e?.message)}}function Su(e,t){if("string"!=typeof e[t])throw new rt(tY,"Missing string value for: "+t);return e[t]}class Sc{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function Sh(e){e=rM(e,yA);let t=Sg.get(e);if(t)return t;let r=yP(e);if(r._uninitializedComponentsProvider?._offline.kind!=="persistent")return null;let n=new Sc(e);return Sg.set(e,n),n}function Sd(e){Sm(e,!0)}function Sf(e){Sm(e,!1)}function Sp(e){yr(yP(e._firestore)).then(e=>tj("deleting all persistent cache indexes succeeded")).catch(e=>tz("deleting all persistent cache indexes failed",e))}function Sm(e,t){yt(yP(e._firestore),t).then(e=>tj(`setting persistent cache index auto creation isEnabled=${t} succeeded`)).catch(e=>tz(`setting persistent cache index auto creation isEnabled=${t} failed`,e))}let Sg=new WeakMap;function Sy(e){let t=yP(rM(e.firestore,yA)),r=t._onlineComponents?.datastore.serializer;return void 0===r?null:ud(r,a2(e._query)).queryTarget}function Sv(e,t){let r=iL(t,(e,t)=>new yH(t,e.aggregateType,e._internalFieldPath)),n=yP(rM(e.firestore,yA)),i=n._onlineComponents?.datastore.serializer;return void 0===i?null:uf(i,a3(e._query),r,!0).request}class Sb{constructor(){throw Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return SS.instance.onExistenceFilterMismatch(e)}}class SS{constructor(){this.existenceFilterMismatchCallbacksById=new Map}static get instance(){return Sw||lp(Sw=new SS),Sw}notifyOnExistenceFilterMismatch(e){this.existenceFilterMismatchCallbacksById.forEach(t=>t(e))}onExistenceFilterMismatch(e){let t=Symbol(),r=this.existenceFilterMismatchCallbacksById;return r.set(t,e),()=>r.delete(t)}}let Sw=null;yG("node"),e.s(["AbstractUserDataWriter",()=>v4,"AggregateField",()=>yQ,"AggregateQuerySnapshot",()=>yJ,"Bytes",()=>yY,"CACHE_SIZE_UNLIMITED",()=>yD,"CollectionReference",()=>yS,"DocumentReference",()=>yb,"DocumentSnapshot",()=>bp,"FieldPath",()=>yX,"FieldValue",()=>y0,"Firestore",()=>yA,"FirestoreError",()=>rt,"GeoPoint",()=>y1,"LoadBundleTask",()=>yR,"PersistentCacheIndexManager",()=>Sc,"Query",()=>yv,"QueryCompositeFilterConstraint",()=>vO,"QueryConstraint",()=>vx,"QueryDocumentSnapshot",()=>bg,"QueryEndAtConstraint",()=>vU,"QueryFieldFilterConstraint",()=>vD,"QueryLimitConstraint",()=>vB,"QueryOrderByConstraint",()=>vM,"QuerySnapshot",()=>by,"QueryStartAtConstraint",()=>vV,"SnapshotMetadata",()=>bf,"Timestamp",()=>rz,"Transaction",()=>b8,"VectorValue",()=>y2,"WriteBatch",()=>b6,"_AutoId",()=>rp,"_ByteString",()=>iJ,"_DatabaseId",()=>sn,"_DocumentKey",()=>rk,"_EmptyAppCheckTokenProvider",()=>rh,"_EmptyAuthCredentialsProvider",()=>ri,"_FieldPath",()=>rI,"_TestingHooks",()=>Sb,"_cast",()=>rM,"_debugAssert",()=>tW,"_internalAggregationQueryToProtoRunAggregationQueryRequest",()=>Sv,"_internalQueryToProtoQueryTarget",()=>Sy,"_isBase64Available",()=>iQ,"_logWarn",()=>tz,"_validateIsNotUsedTogether",()=>rR,"addDoc",()=>bO,"aggregateFieldEqual",()=>bt,"aggregateQuerySnapshotEqual",()=>br,"and",()=>vP,"arrayRemove",()=>Sr,"arrayUnion",()=>St,"average",()=>v9,"clearIndexedDbPersistence",()=>yV,"collection",()=>yw,"collectionGroup",()=>yC,"connectFirestoreEmulator",()=>yy,"count",()=>be,"deleteAllPersistentCacheIndexes",()=>Sp,"deleteDoc",()=>bA,"deleteField",()=>b9,"disableNetwork",()=>yU,"disablePersistentCacheIndexAutoCreation",()=>Sf,"doc",()=>yT,"documentId",()=>yZ,"documentSnapshotFromJSON",()=>bm,"enableIndexedDbPersistence",()=>yB,"enableMultiTabIndexedDbPersistence",()=>yF,"enableNetwork",()=>yq,"enablePersistentCacheIndexAutoCreation",()=>Sd,"endAt",()=>vK,"endBefore",()=>v$,"ensureFirestoreConfigured",()=>yP,"executeWrite",()=>bL,"getAggregateFromServer",()=>bq,"getCountFromServer",()=>bz,"getDoc",()=>bC,"getDocFromCache",()=>bE,"getDocFromServer",()=>b_,"getDocs",()=>bI,"getDocsFromCache",()=>bk,"getDocsFromServer",()=>bx,"getFirestore",()=>yN,"getPersistentCacheIndexManager",()=>Sh,"increment",()=>Sn,"initializeFirestore",()=>yO,"limit",()=>vF,"limitToLast",()=>vj,"loadBundle",()=>yK,"memoryEagerGarbageCollector",()=>bH,"memoryLocalCache",()=>bJ,"memoryLruGarbageCollector",()=>bQ,"namedQuery",()=>yW,"onSnapshot",()=>bN,"onSnapshotResume",()=>bP,"onSnapshotsInSync",()=>bM,"or",()=>vN,"orderBy",()=>vL,"persistentLocalCache",()=>bY,"persistentMultipleTabManager",()=>b1,"persistentSingleTabManager",()=>b0,"query",()=>vR,"queryEqual",()=>y_,"querySnapshotFromJSON",()=>bv,"refEqual",()=>yE,"runTransaction",()=>b7,"serverTimestamp",()=>Se,"setDoc",()=>bR,"setIndexConfiguration",()=>Sa,"setLogLevel",()=>tF,"snapshotEqual",()=>bw,"startAfter",()=>vq,"startAt",()=>vz,"sum",()=>v7,"terminate",()=>y$,"updateDoc",()=>bD,"vector",()=>Si,"waitForPendingWrites",()=>yz,"where",()=>vA,"writeBatch",()=>Ss],686),e.s([],41582)}];

//# sourceMappingURL=34e88_5cb0b8b1._.js.map