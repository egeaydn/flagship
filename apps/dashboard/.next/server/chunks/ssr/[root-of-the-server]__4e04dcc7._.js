module.exports=[56704,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},20635,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},24361,(a,b,c)=>{b.exports=a.x("util",()=>require("util"))},14747,(a,b,c)=>{b.exports=a.x("path",()=>require("path"))},73804,(a,b,c)=>{"use strict";b.exports=a.r(96086).vendored.contexts.AppRouterContext},97556,(a,b,c)=>{"use strict";b.exports=a.r(96086).vendored.contexts.HooksClientContext},98950,(a,b,c)=>{"use strict";b.exports=a.r(96086).vendored.contexts.ServerInsertedHtml},54799,(a,b,c)=>{b.exports=a.x("crypto",()=>require("crypto"))},36470,a=>{"use strict";a.s(["buttonRipple",0,a=>{},"cardHover",0,a=>{},"cardHoverEnd",0,a=>{},"fadeIn",0,(a,b=0)=>{},"scaleIn",0,(a,b=0)=>{},"slideInBottom",0,(a,b=0)=>{},"staggerFadeIn",0,a=>{}])},72005,a=>{"use strict";a.i(70853);var b=a.i(3837),c=a.i(71022);let d={ORGANIZATIONS:"organizations",ORGANIZATION_MEMBERS:"organization_members",PROJECTS:"projects",ENVIRONMENTS:"environments",FEATURE_FLAGS:"feature_flags",FLAG_VALUES:"flag_values",API_KEYS:"api_keys",AUDIT_LOGS:"audit_logs",FLAG_ANALYTICS:"flag_analytics"};async function e(a){let e=await (0,b.addDoc)((0,b.collection)(c.db,d.ORGANIZATIONS),{...a,createdAt:(0,b.serverTimestamp)(),updatedAt:(0,b.serverTimestamp)()});return await (0,b.setDoc)((0,b.doc)(c.db,d.ORGANIZATION_MEMBERS,`${a.createdBy}_${e.id}`),{organizationId:e.id,userId:a.createdBy,role:"owner",createdAt:(0,b.serverTimestamp)()}),e.id}async function f(a){let e=(0,b.query)((0,b.collection)(c.db,d.ORGANIZATION_MEMBERS),(0,b.where)("userId","==",a)),f=(await (0,b.getDocs)(e)).docs.map(a=>a.data().organizationId);if(0===f.length)return[];let g=(0,b.query)((0,b.collection)(c.db,d.ORGANIZATIONS),(0,b.where)("__name__","in",f));return(await (0,b.getDocs)(g)).docs.map(a=>({id:a.id,...a.data()}))}async function g(a){let e=await (0,b.addDoc)((0,b.collection)(c.db,d.PROJECTS),{...a,createdAt:(0,b.serverTimestamp)(),updatedAt:(0,b.serverTimestamp)()});for(let a of[{name:"Development",key:"dev"},{name:"Staging",key:"staging"},{name:"Production",key:"prod"}])await (0,b.addDoc)((0,b.collection)(c.db,d.ENVIRONMENTS),{projectId:e.id,...a,createdAt:(0,b.serverTimestamp)(),updatedAt:(0,b.serverTimestamp)()});return e.id}async function h(a){let e=await (0,b.addDoc)((0,b.collection)(c.db,d.FEATURE_FLAGS),{...a,tags:a.tags||[],createdAt:(0,b.serverTimestamp)(),updatedAt:(0,b.serverTimestamp)()}),f=(0,b.query)((0,b.collection)(c.db,d.ENVIRONMENTS),(0,b.where)("projectId","==",a.projectId));for(let g of(await (0,b.getDocs)(f)).docs)await (0,b.addDoc)((0,b.collection)(c.db,d.FLAG_VALUES),{flagId:e.id,environmentId:g.id,enabled:!1,value:a.defaultValue,updatedAt:(0,b.serverTimestamp)()});return e}async function i(e){let f=(await a.A(16912)).default,g=Array.from(crypto.getRandomValues(new Uint8Array(16))).map(a=>a.toString(16).padStart(2,"0")).join(""),h=`fsk_${e.keyType}_${g}`,i=await f.hash(h,10),j=h.substring(0,12);return await (0,b.addDoc)((0,b.collection)(c.db,d.API_KEYS),{environmentId:e.environmentId,name:e.name,keyPrefix:j,keyHash:i,keyType:e.keyType,revoked:!1,lastUsedAt:null,createdAt:(0,b.serverTimestamp)(),createdBy:e.createdBy}),h}async function j(a){let e=(0,b.doc)(c.db,d.API_KEYS,a);await (0,b.updateDoc)(e,{revoked:!0,updatedAt:(0,b.serverTimestamp)()})}async function k(a){let e=(0,b.query)((0,b.collection)(c.db,d.API_KEYS),(0,b.where)("environmentId","==",a),(0,b.where)("revoked","==",!1));return(await (0,b.getDocs)(e)).docs.map(a=>({id:a.id,...a.data()}))}async function l(e){let f=await (0,b.addDoc)((0,b.collection)(c.db,d.AUDIT_LOGS),{...e,timestamp:(0,b.serverTimestamp)(),createdAt:(0,b.serverTimestamp)()});if(e.projectId&&e.action){let{triggerWebhooks:b}=await a.A(54592),c={FLAG_CREATED:"flag.created",FLAG_UPDATED:"flag.updated",FLAG_DELETED:"flag.deleted",FLAG_TOGGLED:"flag.toggled",TARGETING_RULES_UPDATED:"targeting.updated"}[e.action];c&&b(e.projectId,c,{flagKey:e.metadata?.flagKey||e.resourceName,flagName:e.resourceName,action:e.action,actor:e.userEmail||"Unknown",changes:e.changes,before:e.changes?.before,after:e.changes?.after}).catch(a=>console.error("Webhook trigger error:",a))}return f}async function m(a,e=100){let f=(0,b.query)((0,b.collection)(c.db,d.AUDIT_LOGS),(0,b.where)("organizationId","==",a));return(await (0,b.getDocs)(f)).docs.map(a=>({id:a.id,...a.data()})).sort((a,b)=>{let c=a.timestamp?.toMillis()||a.createdAt?.toMillis()||0;return(b.timestamp?.toMillis()||b.createdAt?.toMillis()||0)-c}).slice(0,e)}async function n(a,e,f=7){let g=(0,b.query)((0,b.collection)(c.db,d.FLAG_ANALYTICS),(0,b.where)("projectId","==",a),(0,b.where)("environmentId","==",e)),h=(await (0,b.getDocs)(g)).docs.map(a=>({id:a.id,...a.data()})),i=Date.now()-24*f*36e5;return h.filter(a=>(a.timestamp?.toMillis()||a.createdAt?.toMillis()||0)>=i)}async function o(a,b,c=7){let d=await n(a,b,c),e={};return d.forEach(a=>{let b=a.flagKey;e[b]||(e[b]={flagKey:b,flagId:a.flagId,evaluations:0,uniqueUsers:new Set,trueCount:0,falseCount:0,targetingAppliedCount:0}),e[b].evaluations++,a.userId&&e[b].uniqueUsers.add(a.userId),!0===a.result&&e[b].trueCount++,!1===a.result&&e[b].falseCount++,a.targetingApplied&&e[b].targetingAppliedCount++}),Object.values(e).map(a=>({...a,uniqueUsers:a.uniqueUsers.size}))}a.s(["COLLECTIONS",0,d,"createApiKey",()=>i,"createAuditLog",()=>l,"createFeatureFlag",()=>h,"createOrganization",()=>e,"createProject",()=>g,"getAggregatedAnalytics",()=>o,"getAuditLogs",()=>m,"getEnvironmentApiKeys",()=>k,"getUserOrganizations",()=>f,"revokeApiKey",()=>j])},61221,a=>{"use strict";var b=a.i(6559),c=a.i(33895);a.i(89651);var d=a.i(83295),e=a.i(71022),f=a.i(59283);a.i(70853);var g=a.i(3837),h=a.i(72005),i=a.i(36470);function j(){let a=(0,f.useParams)(),j=a.slug,k=a.projectKey,l=(0,f.useRouter)(),[m,n]=(0,c.useState)(null),[o,p]=(0,c.useState)(!0),[q,r]=(0,c.useState)(null),[s,t]=(0,c.useState)([]),[u,v]=(0,c.useState)(""),[w,x]=(0,c.useState)([]),[y,z]=(0,c.useState)(!1),[A,B]=(0,c.useState)({name:"",keyType:"server"}),[C,D]=(0,c.useState)(!1),[E,F]=(0,c.useState)(""),[G,H]=(0,c.useState)(!1),I=(0,c.useRef)(null),J=(0,c.useRef)(null);(0,c.useEffect)(()=>{document.title="API Keys | Flagship"},[]),(0,c.useEffect)(()=>{let a=(0,d.onAuthStateChanged)(e.auth,async a=>{a?(n(a),await K()):l.push("/login"),p(!1)});return()=>a()},[l,k]),(0,c.useEffect)(()=>{u&&M()},[u]);let K=async()=>{try{let a=(0,g.query)((0,g.collection)(e.db,h.COLLECTIONS.PROJECTS),(0,g.where)("key","==",k)),b=await (0,g.getDocs)(a);if(b.empty)l.push(`/dashboard/${j}`);else{let a={id:b.docs[0].id,...b.docs[0].data()};r(a),await L(a.id)}}catch(a){console.error("Error loading project:",a)}},L=async a=>{try{let b=(0,g.query)((0,g.collection)(e.db,h.COLLECTIONS.ENVIRONMENTS),(0,g.where)("projectId","==",a)),c=(await (0,g.getDocs)(b)).docs.map(a=>({id:a.id,...a.data()}));t(c),c.length>0&&v(c[0].id)}catch(a){console.error("Error loading environments:",a)}},M=async()=>{try{let a=await (0,h.getEnvironmentApiKeys)(u);x(a)}catch(a){console.error("Error loading API keys:",a)}},N=async a=>{if(a.preventDefault(),m){D(!0);try{let a=await (0,h.createApiKey)({environmentId:u,name:A.name,keyType:A.keyType,createdBy:m.uid});F(a),B({name:"",keyType:"server"}),await M()}catch(a){console.error("Error creating API key:",a),alert("Hata: "+a.message)}finally{D(!1)}}};(0,c.useEffect)(()=>{I.current&&(0,i.fadeIn)(I.current,0),J.current&&(0,i.slideInBottom)(J.current,200)},[o]),(0,c.useEffect)(()=>{document.querySelectorAll(".api-key-card").length>0&&(0,i.staggerFadeIn)(".api-key-card")},[w]);let O=async a=>{if(confirm("Bu API key'i iptal etmek istediğinize emin misiniz?"))try{await (0,h.revokeApiKey)(a),await M()}catch(a){console.error("Error revoking key:",a)}};return o?(0,b.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,b.jsx)("div",{className:"text-gray-600",children:"Yükleniyor..."})}):q?(0,b.jsxs)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[(0,b.jsx)("nav",{className:"bg-white shadow",children:(0,b.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,b.jsxs)("div",{className:"flex justify-between h-16",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,b.jsx)("button",{onClick:()=>l.push(`/dashboard/${j}/projects/${k}`),className:"text-gray-600 hover:text-gray-900",children:"← Geri"}),(0,b.jsxs)("h1",{className:"text-xl font-bold text-gray-900",children:[q.name," - API Keys"]})]}),(0,b.jsx)("div",{className:"flex items-center space-x-4",children:(0,b.jsx)("span",{className:"text-gray-700",children:m?.email})})]})})}),(0,b.jsx)("main",{className:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8",children:(0,b.jsxs)("div",{className:"px-4 py-6 sm:px-0",children:[(0,b.jsxs)("div",{className:"mb-6",children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Environment"}),(0,b.jsx)("div",{className:"flex space-x-2",children:s.map(a=>(0,b.jsx)("button",{onClick:()=>v(a.id),className:`px-4 py-2 rounded-md font-medium transition-colors ${u===a.id?"bg-blue-600 text-white":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"}`,children:a.name},a.id))})]}),(0,b.jsxs)("div",{ref:I,className:"flex justify-between items-center mb-6",children:[(0,b.jsx)("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"API Keys"}),(0,b.jsx)("button",{onClick:()=>z(!y),disabled:!!E,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 font-medium disabled:opacity-50",children:y?"İptal":"+ Yeni API Key"})]}),E&&(0,b.jsxs)("div",{className:"bg-green-50 border-2 border-green-500 rounded-lg p-6 mb-6",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold text-green-900 mb-2",children:"✅ API Key Oluşturuldu!"}),(0,b.jsx)("p",{className:"text-sm text-green-800 mb-4",children:"Bu key sadece bir kez gösterilecek. Lütfen güvenli bir yerde saklayın."}),(0,b.jsx)("div",{className:"bg-white border border-green-300 rounded p-4 mb-4",children:(0,b.jsx)("code",{className:"text-sm text-gray-900 break-all",children:E})}),(0,b.jsxs)("div",{className:"flex space-x-2",children:[(0,b.jsx)("button",{onClick:()=>{navigator.clipboard.writeText(E),H(!0),setTimeout(()=>H(!1),2e3)},className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 font-medium",children:G?"✓ Kopyalandı":"Kopyala"}),(0,b.jsx)("button",{onClick:()=>{F(""),z(!1)},className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 font-medium",children:"Kapat"})]})]}),y&&!E&&(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Yeni API Key Oluştur"}),(0,b.jsxs)("form",{onSubmit:N,className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Key Adı"}),(0,b.jsx)("input",{type:"text",required:!0,value:A.name,onChange:a=>B({...A,name:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Production Mobile App"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Key Tipi"}),(0,b.jsxs)("select",{value:A.keyType,onChange:a=>B({...A,keyType:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,b.jsx)("option",{value:"server",children:"Server-side (tam erişim)"}),(0,b.jsx)("option",{value:"client",children:"Client-side (sadece okuma)"})]}),(0,b.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"server"===A.keyType?"Backend uygulamalar için. Tüm flag bilgilerine erişir.":"Frontend uygulamalar için. Sadece aktif flag değerlerini döner."})]}),(0,b.jsx)("button",{type:"submit",disabled:C,className:"w-full px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 font-medium disabled:opacity-50",children:C?"Oluşturuluyor...":"Oluştur"})]})]}),0===w.length?(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow p-8 text-center",children:[(0,b.jsx)("p",{className:"text-gray-500 mb-4",children:"Bu environment için henüz API key oluşturmadınız."}),(0,b.jsx)("button",{onClick:()=>z(!0),className:"text-blue-600 hover:text-blue-700 font-medium",children:"İlk API key'inizi oluşturun →"})]}):(0,b.jsx)("div",{ref:J,className:"bg-white rounded-lg shadow overflow-hidden",children:(0,b.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,b.jsx)("thead",{className:"bg-gray-50",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Ad"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Prefix"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tip"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Son Kullanım"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"İşlemler"})]})}),(0,b.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:w.map(a=>(0,b.jsxs)("tr",{className:"api-key-card hover:bg-gray-50",onMouseEnter:a=>(0,i.cardHover)(a.currentTarget),onMouseLeave:a=>(0,i.cardHoverEnd)(a.currentTarget),children:[(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,b.jsx)("div",{className:"text-sm font-medium text-gray-900",children:a.name})}),(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,b.jsxs)("code",{className:"text-sm text-gray-600 bg-gray-100 px-2 py-1 rounded",children:[a.keyPrefix,"..."]})}),(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,b.jsx)("span",{className:`px-2 py-1 text-xs font-medium rounded ${"server"===a.keyType?"bg-purple-100 text-purple-800":"bg-blue-100 text-blue-800"}`,children:a.keyType})}),(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:a.lastUsedAt?.toDate?.()?.toLocaleDateString("tr-TR")||"Hiç kullanılmadı"}),(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:(0,b.jsx)("button",{onClick:()=>O(a.id),className:"text-red-600 hover:text-red-900 font-medium",children:"İptal Et"})})]},a.id))})]})})]})})]}):null}a.s(["default",()=>j])},16912,a=>{a.v(b=>Promise.all(["server/chunks/ssr/34e88_bcryptjs_index_ddcfd574.js"].map(b=>a.l(b))).then(()=>b(93638)))},54592,a=>{a.v(b=>Promise.all(["server/chunks/ssr/Desktop_Proje Klosörü_React_flagship_160ce42f._.js"].map(b=>a.l(b))).then(()=>b(67581)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__4e04dcc7._.js.map