module.exports=[56704,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},20635,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},24361,(a,b,c)=>{b.exports=a.x("util",()=>require("util"))},14747,(a,b,c)=>{b.exports=a.x("path",()=>require("path"))},54799,(a,b,c)=>{b.exports=a.x("crypto",()=>require("crypto"))},73804,(a,b,c)=>{"use strict";b.exports=a.r(96086).vendored.contexts.AppRouterContext},97556,(a,b,c)=>{"use strict";b.exports=a.r(96086).vendored.contexts.HooksClientContext},98950,(a,b,c)=>{"use strict";b.exports=a.r(96086).vendored.contexts.ServerInsertedHtml},21107,(a,b,c)=>{"use strict";b.exports=a.r(96086).vendored["react-ssr"].ReactServerDOMTurbopackClient},72005,a=>{"use strict";a.i(70853);var b=a.i(3837),c=a.i(71022);let d={ORGANIZATIONS:"organizations",ORGANIZATION_MEMBERS:"organization_members",PROJECTS:"projects",ENVIRONMENTS:"environments",FEATURE_FLAGS:"feature_flags",FLAG_VALUES:"flag_values",API_KEYS:"api_keys",AUDIT_LOGS:"audit_logs",FLAG_ANALYTICS:"flag_analytics"};async function e(a){let e=await (0,b.addDoc)((0,b.collection)(c.db,d.ORGANIZATIONS),{...a,createdAt:(0,b.serverTimestamp)(),updatedAt:(0,b.serverTimestamp)()});return await (0,b.setDoc)((0,b.doc)(c.db,d.ORGANIZATION_MEMBERS,`${a.createdBy}_${e.id}`),{organizationId:e.id,userId:a.createdBy,role:"owner",createdAt:(0,b.serverTimestamp)()}),e.id}async function f(a){let e=(0,b.query)((0,b.collection)(c.db,d.ORGANIZATION_MEMBERS),(0,b.where)("userId","==",a)),f=(await (0,b.getDocs)(e)).docs.map(a=>a.data().organizationId);if(0===f.length)return[];let g=(0,b.query)((0,b.collection)(c.db,d.ORGANIZATIONS),(0,b.where)("__name__","in",f));return(await (0,b.getDocs)(g)).docs.map(a=>({id:a.id,...a.data()}))}async function g(a){let e=await (0,b.addDoc)((0,b.collection)(c.db,d.PROJECTS),{...a,createdAt:(0,b.serverTimestamp)(),updatedAt:(0,b.serverTimestamp)()});for(let a of[{name:"Development",key:"dev"},{name:"Staging",key:"staging"},{name:"Production",key:"prod"}])await (0,b.addDoc)((0,b.collection)(c.db,d.ENVIRONMENTS),{projectId:e.id,...a,createdAt:(0,b.serverTimestamp)(),updatedAt:(0,b.serverTimestamp)()});return e.id}async function h(a){let e=await (0,b.addDoc)((0,b.collection)(c.db,d.FEATURE_FLAGS),{...a,tags:a.tags||[],createdAt:(0,b.serverTimestamp)(),updatedAt:(0,b.serverTimestamp)()}),f=(0,b.query)((0,b.collection)(c.db,d.ENVIRONMENTS),(0,b.where)("projectId","==",a.projectId));for(let g of(await (0,b.getDocs)(f)).docs)await (0,b.addDoc)((0,b.collection)(c.db,d.FLAG_VALUES),{flagId:e.id,environmentId:g.id,enabled:!1,value:a.defaultValue,updatedAt:(0,b.serverTimestamp)()});return e}async function i(e){let f=(await a.A(16912)).default,g=Array.from(crypto.getRandomValues(new Uint8Array(16))).map(a=>a.toString(16).padStart(2,"0")).join(""),h=`fsk_${e.keyType}_${g}`,i=await f.hash(h,10),j=h.substring(0,12);return await (0,b.addDoc)((0,b.collection)(c.db,d.API_KEYS),{environmentId:e.environmentId,name:e.name,keyPrefix:j,keyHash:i,keyType:e.keyType,revoked:!1,lastUsedAt:null,createdAt:(0,b.serverTimestamp)(),createdBy:e.createdBy}),h}async function j(a){let e=(0,b.doc)(c.db,d.API_KEYS,a);await (0,b.updateDoc)(e,{revoked:!0,updatedAt:(0,b.serverTimestamp)()})}async function k(a){let e=(0,b.query)((0,b.collection)(c.db,d.API_KEYS),(0,b.where)("environmentId","==",a),(0,b.where)("revoked","==",!1));return(await (0,b.getDocs)(e)).docs.map(a=>({id:a.id,...a.data()}))}async function l(e){let f=await (0,b.addDoc)((0,b.collection)(c.db,d.AUDIT_LOGS),{...e,timestamp:(0,b.serverTimestamp)(),createdAt:(0,b.serverTimestamp)()});if(e.projectId&&e.action){let{triggerWebhooks:b}=await a.A(54592),c={FLAG_CREATED:"flag.created",FLAG_UPDATED:"flag.updated",FLAG_DELETED:"flag.deleted",FLAG_TOGGLED:"flag.toggled",TARGETING_RULES_UPDATED:"targeting.updated"}[e.action];c&&b(e.projectId,c,{flagKey:e.metadata?.flagKey||e.resourceName,flagName:e.resourceName,action:e.action,actor:e.userEmail||"Unknown",changes:e.changes,before:e.changes?.before,after:e.changes?.after}).catch(a=>console.error("Webhook trigger error:",a))}return f}async function m(a,e=100){let f=(0,b.query)((0,b.collection)(c.db,d.AUDIT_LOGS),(0,b.where)("organizationId","==",a));return(await (0,b.getDocs)(f)).docs.map(a=>({id:a.id,...a.data()})).sort((a,b)=>{let c=a.timestamp?.toMillis()||a.createdAt?.toMillis()||0;return(b.timestamp?.toMillis()||b.createdAt?.toMillis()||0)-c}).slice(0,e)}async function n(a,e,f=7){let g=(0,b.query)((0,b.collection)(c.db,d.FLAG_ANALYTICS),(0,b.where)("projectId","==",a),(0,b.where)("environmentId","==",e)),h=(await (0,b.getDocs)(g)).docs.map(a=>({id:a.id,...a.data()})),i=Date.now()-24*f*36e5;return h.filter(a=>(a.timestamp?.toMillis()||a.createdAt?.toMillis()||0)>=i)}async function o(a,b,c=7){let d=await n(a,b,c),e={};return d.forEach(a=>{let b=a.flagKey;e[b]||(e[b]={flagKey:b,flagId:a.flagId,evaluations:0,uniqueUsers:new Set,trueCount:0,falseCount:0,targetingAppliedCount:0}),e[b].evaluations++,a.userId&&e[b].uniqueUsers.add(a.userId),!0===a.result&&e[b].trueCount++,!1===a.result&&e[b].falseCount++,a.targetingApplied&&e[b].targetingAppliedCount++}),Object.values(e).map(a=>({...a,uniqueUsers:a.uniqueUsers.size}))}a.s(["COLLECTIONS",0,d,"createApiKey",()=>i,"createAuditLog",()=>l,"createFeatureFlag",()=>h,"createOrganization",()=>e,"createProject",()=>g,"getAggregatedAnalytics",()=>o,"getAuditLogs",()=>m,"getEnvironmentApiKeys",()=>k,"getUserOrganizations",()=>f,"revokeApiKey",()=>j])},33598,a=>{"use strict";var b=a.i(6559),c=a.i(33895),d=a.i(59283),e=a.i(3982);a.i(89651);var f=a.i(83295),g=a.i(71022),h=a.i(72005);function i(){let a=(0,d.useParams)(),[i,j]=(0,c.useState)(null),[k,l]=(0,c.useState)([]),[m,n]=(0,c.useState)(!0),[o,p]=(0,c.useState)(7),[q,r]=(0,c.useState)(""),[s,t]=(0,c.useState)(""),[u,v]=(0,c.useState)(!1),[w,x]=(0,c.useState)(null);async function y(){try{n(!0);let b=a.projectKey,c="production";console.log("ðŸ“Š Analytics Query:",{projId:b,envId:c,slug:a.slug}),r(b),t(c);let d=await (0,h.getAggregatedAnalytics)(b,c,o);console.log("ðŸ“Š Analytics Data:",d),l(d),x(new Date)}catch(a){console.error("Error loading analytics:",a)}finally{n(!1)}}(0,c.useEffect)(()=>{document.title="Analytics | Flagship"},[]),(0,c.useEffect)(()=>{let a=(0,f.onAuthStateChanged)(g.auth,a=>{j(a)});return()=>a()},[]),(0,c.useEffect)(()=>{i&&y()},[i,o]),(0,c.useEffect)(()=>{if(u&&i){let a=setInterval(()=>{y()},5e3);return()=>clearInterval(a)}},[u,i]),(0,c.useEffect)(()=>{if(u&&i){let a=setInterval(()=>{y()},5e3);return()=>clearInterval(a)}},[u,i]);let z=k.reduce((a,b)=>a+b.evaluations,0);new Set(k.flatMap(()=>[])).size;let A=k.length>0?Math.round(z/k.length):0;return m?(0,b.jsx)("div",{className:"min-h-screen bg-gray-50 p-8",children:(0,b.jsx)("div",{className:"max-w-7xl mx-auto",children:(0,b.jsx)("p",{className:"text-gray-500",children:"Loading analytics..."})})}):(0,b.jsx)("div",{className:"min-h-screen bg-gray-50 p-8",children:(0,b.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,b.jsx)("div",{className:"mb-6",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(e.default,{href:`/dashboard/${a.slug}/projects/${a.projectKey}`,className:"text-blue-600 hover:text-blue-700 text-sm mb-2 inline-block",children:"â† Back to Project"}),(0,b.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"ðŸ“Š Analytics Dashboard"}),(0,b.jsx)("p",{className:"text-gray-600 mt-2",children:"Flag usage and performance metrics"}),w&&(0,b.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:["Last updated: ",w.toLocaleTimeString("tr-TR"),u&&(0,b.jsx)("span",{className:"ml-2 text-green-600",children:"â— Live"})]})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)("button",{onClick:()=>y(),disabled:m,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"ðŸ”„ Refresh"}),(0,b.jsx)("button",{onClick:()=>v(!u),className:`px-4 py-2 rounded-lg font-medium ${u?"bg-red-600 text-white hover:bg-red-700":"bg-green-600 text-white hover:bg-green-700"}`,children:u?"â¸ï¸ Stop Auto-Refresh":"â–¶ï¸ Auto-Refresh"}),(0,b.jsxs)("select",{value:o,onChange:a=>p(Number(a.target.value)),className:"px-4 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500",children:[(0,b.jsx)("option",{value:1,children:"Last 24 hours"}),(0,b.jsx)("option",{value:7,children:"Last 7 days"}),(0,b.jsx)("option",{value:30,children:"Last 30 days"}),(0,b.jsx)("option",{value:90,children:"Last 90 days"})]})]})]})}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[(0,b.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"Total Evaluations"}),(0,b.jsx)("p",{className:"text-3xl font-bold text-gray-900 mt-2",children:z.toLocaleString()})]}),(0,b.jsx)("div",{className:"text-4xl",children:"ðŸ“ˆ"})]})}),(0,b.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"Active Flags"}),(0,b.jsx)("p",{className:"text-3xl font-bold text-gray-900 mt-2",children:k.length})]}),(0,b.jsx)("div",{className:"text-4xl",children:"ðŸš©"})]})}),(0,b.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"Avg Evaluations/Flag"}),(0,b.jsx)("p",{className:"text-3xl font-bold text-gray-900 mt-2",children:A.toLocaleString()})]}),(0,b.jsx)("div",{className:"text-4xl",children:"âš¡"})]})})]}),0===k.length?(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow p-8 text-center",children:[(0,b.jsx)("p",{className:"text-gray-500",children:"No analytics data available"}),(0,b.jsx)("p",{className:"text-sm text-gray-400 mt-2",children:"Data will appear here as your flags are evaluated via the API"})]}):(0,b.jsx)("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:(0,b.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,b.jsx)("thead",{className:"bg-gray-50",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Flag"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Evaluations"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Unique Users"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Enabled %"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Targeting Used"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Distribution"})]})}),(0,b.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:k.sort((a,b)=>b.evaluations-a.evaluations).map(a=>{var c;let d,e=0===(d=(c=a.trueCount)+a.falseCount)?0:Math.round(c/d*100),f=a.evaluations>0?Math.round(a.targetingAppliedCount/a.evaluations*100):0;return(0,b.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,b.jsx)("div",{className:"flex items-center",children:(0,b.jsx)("div",{className:"text-sm font-medium text-gray-900",children:a.flagKey})})}),(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,b.jsx)("div",{className:"text-sm text-gray-900",children:a.evaluations.toLocaleString()})}),(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,b.jsx)("div",{className:"text-sm text-gray-900",children:a.uniqueUsers.toLocaleString()})}),(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,b.jsxs)("div",{className:"flex items-center",children:[(0,b.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:[e,"%"]}),(0,b.jsx)("div",{className:"ml-2 w-16 bg-gray-200 rounded-full h-2",children:(0,b.jsx)("div",{className:"bg-green-500 h-2 rounded-full",style:{width:`${e}%`}})})]})}),(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,b.jsxs)("span",{className:`px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${f>0?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,children:[f,"%"]})}),(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)("span",{className:"text-green-600",children:["âœ“ ",a.trueCount]}),(0,b.jsx)("span",{className:"text-gray-400",children:"|"}),(0,b.jsxs)("span",{className:"text-red-600",children:["âœ— ",a.falseCount]})]})})]},a.flagKey)})})]})}),(0,b.jsx)("div",{className:"mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4",children:(0,b.jsxs)("div",{className:"flex items-start",children:[(0,b.jsx)("div",{className:"text-blue-600 text-xl mr-3",children:"ðŸ’¡"}),(0,b.jsxs)("div",{className:"text-sm text-blue-800",children:[(0,b.jsx)("p",{className:"font-medium",children:"Analytics Tracking"}),(0,b.jsx)("p",{className:"mt-1",children:"Every flag evaluation via the API is tracked here. Use this data to understand which features are most used, identify unused flags for cleanup, and monitor targeting rule effectiveness."})]})]})})]})})}a.s(["default",()=>i])},16912,a=>{a.v(b=>Promise.all(["server/chunks/ssr/34e88_bcryptjs_index_ddcfd574.js"].map(b=>a.l(b))).then(()=>b(93638)))},54592,a=>{a.v(b=>Promise.all(["server/chunks/ssr/Desktop_Proje KlosÃ¶rÃ¼_React_flagship_160ce42f._.js"].map(b=>a.l(b))).then(()=>b(67581)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__7224d16e._.js.map